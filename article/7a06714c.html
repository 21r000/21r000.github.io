<!-- build time:Tue Mar 29 2022 19:04:26 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="未入江湖，怎敢佩刀" href="https://www.21r000.xyz/rss.xml"><link rel="alternate" type="application/atom+xml" title="未入江湖，怎敢佩刀" href="https://www.21r000.xyz/atom.xml"><link rel="alternate" type="application/json" title="未入江湖，怎敢佩刀" href="https://www.21r000.xyz/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="linux"><link rel="canonical" href="https://www.21r000.xyz/article/7a06714c.html"><title>Linux /etc/shadow（影子文件）解析 - linux | 21r000 = 未入江湖，怎敢佩刀 = 你的骑士还没有来，你就永远是我的公主。</title><meta name="generator" content="Hexo 6.0.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">Linux /etc/shadow（影子文件）解析</h1><div class="meta"><span class="item" title="创建时间：2022-03-27 20:58:23"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2022-03-27T20:58:23+08:00">2022-03-27</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>4.6k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>4 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">21r000</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://21r000-image.oss-cn-shanghai.aliyuncs.com/pic2021/6833939bly1giph47e9vtj20zk0m8x6l.jpg"></li><li class="item" data-background-image="https://21r000-image.oss-cn-shanghai.aliyuncs.com/pic2021/6833939bly1giph4lm9i7j20zk0m84qp.jpg"></li><li class="item" data-background-image="https://21r000-image.oss-cn-shanghai.aliyuncs.com/pic2021/6833939bly1giclj9410cj20zk0m8h12.jpg"></li><li class="item" data-background-image="https://21r000-image.oss-cn-shanghai.aliyuncs.com/pic2021/6833939bly1gipeyonbf9j20zk0m8e81.jpg"></li><li class="item" data-background-image="https://21r000-image.oss-cn-shanghai.aliyuncs.com/pic2021/6833939bly1giclga70tsj20zk0m84mr.jpg"></li><li class="item" data-background-image="https://21r000-image.oss-cn-shanghai.aliyuncs.com/pic2021/6833939bly1gipevuctzzj20zk0m84qp.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/linux/" itemprop="item" rel="index" title="分类于 linux"><span itemprop="name">linux</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.21r000.xyz/article/7a06714c.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="21r000"><meta itemprop="description" content="你的骑士还没有来，你就永远是我的公主。, 固态规则长方体空间移动工程师"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="未入江湖，怎敢佩刀"></span><div class="body md" itemprop="articleBody"><h2 id="前言"><a class="anchor" href="#前言">#</a> 前言</h2><p>某准备开始摆烂的精神小伙突然被大佬叫住编写 /etc/shadow 加密脚本，于是有了这篇文章。</p><p><img data-src="https://21r000-image.oss-cn-shanghai.aliyuncs.com/pic2021/image-20220327210238985.png" alt="image-20220327210238985"></p><h2 id="文件介绍"><a class="anchor" href="#文件介绍">#</a> 文件介绍</h2><p>/etc/shadow 文件，用于存储 Linux 系统中用户的密码信息，又称为 “影子文件”。</p><p>由于 /etc/passwd 文件允许所有用户读取，易导致用户密码泄露，因此 Linux 系统将用户的密码信息从 /etc/passwd 文件中分离出来，并单独放到了 /etc/shadow 文件中。</p><p>/etc/shadow 文件只有 root 用户拥有读权限，其他用户没有任何权限，这样就保证了用户密码的安全性。</p><p>在解析 /etc/shadow 文件之前，我们先看看密文结构，执行如下命令：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">cat</span> /etc/shadow</pre></td></tr></table></figure><p><img data-src="https://21r000-image.oss-cn-shanghai.aliyuncs.com/pic2021/image-20220327203540828.png" alt="image-20220327203540828"></p><p>同 /etc/passwd 文件一样，文件中每行代表一个用户，同样使用 &quot;:&quot; 作为分隔符，不同之处在于，每行用户信息被划分为 9 个字段。每个字段的含义如下：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>用户名</pre></td></tr><tr><td data-num="2"></td><td><pre>加密密码</pre></td></tr><tr><td data-num="3"></td><td><pre>最后一次修改时间</pre></td></tr><tr><td data-num="4"></td><td><pre>最小修改时间间隔</pre></td></tr><tr><td data-num="5"></td><td><pre>密码有效期</pre></td></tr><tr><td data-num="6"></td><td><pre>密码需要变更前的警告天数</pre></td></tr><tr><td data-num="7"></td><td><pre>密码过期后的宽限时间</pre></td></tr><tr><td data-num="8"></td><td><pre>账号失效时间</pre></td></tr><tr><td data-num="9"></td><td><pre>保留字段</pre></td></tr></table></figure><h2 id="字段解析"><a class="anchor" href="#字段解析">#</a> 字段解析</h2><h3 id="用户名"><a class="anchor" href="#用户名">#</a> 用户名</h3><p>同 /etc/passwd 文件的用户名有相同的含义。</p><h3 id="加密密码"><a class="anchor" href="#加密密码">#</a> 加密密码</h3><p>这里保存的是真正加密的密码。目前 Linux 的密码采用的是 SHA512 散列加密算法，原来采用的是 MD5 或 DES 加密算法。SHA512 散列加密算法的加密等级更高，也更加安全。</p><p>注意，这串密码产生的乱码不能手工修改，如果手工修改，系统将无法识别密码，导致密码失效。很多软件透过这个功能，在密码串前加上 &quot;!&quot;、&quot;*&quot; 或 &quot;x&quot; 使密码暂时失效。</p><p>所有伪用户的密码都是 &quot;!!&quot; 或 &quot;*&quot;，代表没有密码是不能登录的。当然，新创建的用户如果不设定密码，那么它的密码项也是 &quot;!!&quot;，代表这个用户没有密码，不能登录。</p><h3 id="最后一次修改时间"><a class="anchor" href="#最后一次修改时间">#</a> 最后一次修改时间</h3><p>此字段表示最后一次修改密码的时间，可是，为什么 root 用户显示的是 18580 呢？</p><p>这是因为，Linux 计算日期的时间是以 1970 年 1 月 1 日作为 1 不断累加得到的时间，到 1971 年 1 月 1 日，则为 366 天。这里显示 18580 天，也就是说，此 root 账号在 1970 年 1 月 1 日之后的第 18580 天修改的 root 用户密码。</p><p>那么，到底 18580 代表的是哪一天呢？可以使用如下命令进行换算：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">date</span> -d <span class="token string">"1970-01-01 18580 days"</span></pre></td></tr></table></figure><p><img data-src="https://21r000-image.oss-cn-shanghai.aliyuncs.com/pic2021/image-20220327203920182.png" alt="image-20220327203920182"></p><p>可以看到，通过以上命令，即可将其换算为我们习惯的系统日期。</p><h3 id="最小修改时间间隔"><a class="anchor" href="#最小修改时间间隔">#</a> 最小修改时间间隔</h3><p>最小修改间隔时间，也就是说，该字段规定了从第 3 字段（最后一次修改密码的日期）起，多长时间之内不能修改密码。如果是 0，则密码可以随时修改；如果是 10，则代表密码修改后 10 天之内不能再次修改密码。</p><p>此字段是为了针对某些人频繁更改账户密码而设计的。</p><h3 id="密码有效期"><a class="anchor" href="#密码有效期">#</a> 密码有效期</h3><p>经常变更密码是个好习惯，为了强制要求用户变更密码，这个字段可以指定距离第 3 字段（最后一次更改密码）多长时间内需要再次变更密码，否则该账户密码进行过期阶段。<br>该字段的默认值为 99999，也就是 273 年，可认为是永久生效。如果改为 90，则表示密码被修改 90 天之后必须再次修改，否则该用户即将过期。管理服务器时，通过这个字段强制用户定期修改密码。</p><h3 id="密码需要变更前的警告天数"><a class="anchor" href="#密码需要变更前的警告天数">#</a> 密码需要变更前的警告天数</h3><p>与第 5 字段相比较，当账户密码有效期快到时，系统会发出警告信息给此账户，提醒用户 &quot;再过 n 天你的密码就要过期了，请尽快重新设置你的密码！&quot;。</p><p>该字段的默认值是 7，也就是说，距离密码有效期的第 7 天开始，每次登录系统都会向该账户发出 &quot;修改密码&quot; 的警告信息。</p><h3 id="密码过期后的宽限天数"><a class="anchor" href="#密码过期后的宽限天数">#</a> 密码过期后的宽限天数</h3><p>也称为 “口令失效日”，简单理解就是，在密码过期后，用户如果还是没有修改密码，则在此字段规定的宽限天数内，用户还是可以登录系统的；如果过了宽限天数，系统将不再让此账户登陆，也不会提示账户过期，是完全禁用。</p><p>比如说，此字段规定的宽限天数是 10，则代表密码过期 10 天后失效；如果是 0，则代表密码过期后立即失效；如果是 -1，则代表密码永远不会失效。</p><h3 id="账号失效时间"><a class="anchor" href="#账号失效时间">#</a> 账号失效时间</h3><p>同第 3 个字段一样，使用自 1970 年 1 月 1 日以来的总天数作为账户的失效时间。该字段表示，账号在此字段规定的时间之外，不论你的密码是否过期，都将无法使用！</p><p>该字段通常被使用在具有收费服务的系统中。</p><h3 id="保留"><a class="anchor" href="#保留">#</a> 保留</h3><p>这个字段目前没有使用，等待新功能的加入。</p><h3 id="忘记密码怎么办"><a class="anchor" href="#忘记密码怎么办">#</a> 忘记密码怎么办</h3><p>对于普通账户的密码遗失，可以通过 root 账户解决，它会重新给你配置好指定账户的密码，而不需知道你原有的密码（利用 root 的身份使用 passwd 命令即可）。</p><p>如果 root 账号的密码遗失，则需要重新启动进入单用户模式，系统会提供 root 权限的 bash 接口，此时可以用 passwd 命令修改账户密码；也可以通过挂载根目录，修改 /etc/shadow，将账户的 root 密码清空的方法，此方式可使用 root 无法密码即可登陆，建议登陆后使用 passwd 命令配置 root 密码。</p><h2 id="linux-etcshadow破解"><a class="anchor" href="#linux-etcshadow破解">#</a> linux /etc/shadow 破解</h2><h3 id="密码格式"><a class="anchor" href="#密码格式">#</a> 密码格式</h3><p>在 <code>/etc/shadow</code> 中的密码是用以下格式所储存的：</p><pre><code>$ID$SALT$ENCRYPTED
</code></pre><p><code>ID</code> 代表加密演算法，可能的值如下：</p><ul><li><code>1</code> ：MD5（长度为 22 个字元）</li><li><code>5</code> ：SHA-256（长度为 43 个字元）</li><li><code>6</code> ：SHA-512（长度为 86 个字元）</li></ul><p><code>SALT</code> 是随机字串（最长不超过 16 个字元），而 <code>ENCRYPTED</code> 则是密码的哈希值。</p><p>由于进行 hash 的时候，采用了 salt 机制，所以传统的彩虹表方式将起不到作用。破解方法有字典破解和暴力破解。</p><h3 id="算法结构"><a class="anchor" href="#算法结构">#</a> 算法结构</h3><p>linux /etc/shadow 中 hash 算法包括：</p><ul><li>缺省的 DES 经典算法</li><li>MD5 哈希算法 ($1)</li><li>Blowfish 加密算法 ($2 或 $2a)</li><li>SHA 哈希算法 ($5 或 $6）</li></ul><p>同时 hashcat 工具也可据此来进行破解，对于不同的加密算法 hashcat 所进行的参数也不同</p><p>比如：</p><ul><li>MD5 哈希算法 ($1)，使用 hashcat -m 500 参数</li><li>SHA 哈希算法 ($5 或 $6），使用 hashcat -m 1800 参数</li></ul><p>利用 hashcat 进行破解时，hash 值存储方式为：</p><ul><li>MD5 哈希算法，存储为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">1</span></span></span></span>salt$encrypted</li><li>SHA 哈希算法，存储为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>5</mn></mrow><annotation encoding="application/x-tex">5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">5</span></span></span></span>salt$encrypted 或<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>6</mn></mrow><annotation encoding="application/x-tex">6</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">6</span></span></span></span>salt$encrypted</li></ul><h3 id="加解密脚本"><a class="anchor" href="#加解密脚本">#</a> 加 / 解密脚本</h3><p>利用 Linux 系统中的 <strong>crypt</strong> 模块模拟了 Linux 系统中用户密码的加密，而在 Windows 中是不存在这个库的。</p><p>在了解了 shadow 文件中密码的加密方式之后，我们就可以开始编写 python 脚本了。</p><h4 id="加密脚本"><a class="anchor" href="#加密脚本">#</a> 加密脚本</h4><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> random<span class="token punctuation">,</span>string</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> crypt</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">#MD5 加密</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">def</span> <span class="token function">Encode_MD5</span><span class="token punctuation">(</span>Passwd<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment"># 随机生成 slot</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    randomSalt <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>random<span class="token punctuation">.</span>sample<span class="token punctuation">(</span>string<span class="token punctuation">.</span>ascii_letters<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment"># MD5 加密</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    enmd5 <span class="token operator">=</span> crypt<span class="token punctuation">.</span>crypt<span class="token punctuation">(</span>Passwd<span class="token punctuation">,</span> <span class="token string">'$1$%s$'</span> <span class="token operator">%</span> randomSalt<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">return</span> enmd5</pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">#Sha256 加密</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">def</span> <span class="token function">Encode_Sha256</span><span class="token punctuation">(</span>Passwd<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    randomSalt <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>random<span class="token punctuation">.</span>sample<span class="token punctuation">(</span>string<span class="token punctuation">.</span>ascii_letters<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    ensha256 <span class="token operator">=</span> crypt<span class="token punctuation">.</span>crypt<span class="token punctuation">(</span>Passwd<span class="token punctuation">,</span> <span class="token string">'$5$%s$'</span> <span class="token operator">%</span> randomSalt<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">return</span> ensha256</pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment">#Sha512 加密</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">def</span> <span class="token function">Encode_Sha512</span><span class="token punctuation">(</span>Passwd<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    randomSalt <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>random<span class="token punctuation">.</span>sample<span class="token punctuation">(</span>string<span class="token punctuation">.</span>ascii_letters<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    ensha512 <span class="token operator">=</span> crypt<span class="token punctuation">.</span>crypt<span class="token punctuation">(</span>Passwd<span class="token punctuation">,</span> <span class="token string">'$6$%s$'</span> <span class="token operator">%</span> randomSalt<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token keyword">return</span> ensha512</pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token comment"># 明文输入</span></pre></td></tr><tr><td data-num="23"></td><td><pre>Passwd <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'Please input your passwd: '</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Encode_MD5:'</span><span class="token punctuation">,</span>Encode_MD5<span class="token punctuation">(</span>Passwd<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Encode_Sha256:'</span><span class="token punctuation">,</span>Encode_Sha256<span class="token punctuation">(</span>Passwd<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Encode_Sha512:'</span><span class="token punctuation">,</span>Encode_Sha512<span class="token punctuation">(</span>Passwd<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>对 hello123 的加密结果如下：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>Please input your passwd: hello123</pre></td></tr><tr><td data-num="2"></td><td><pre>Encode_MD5: <span class="token variable">$1</span><span class="token variable">$TCenuLql</span><span class="token variable">$RIf2Od8i4BPZfsbRNRnhr1</span></pre></td></tr><tr><td data-num="3"></td><td><pre>Encode_Sha256: <span class="token variable">$5</span><span class="token variable">$sSLEKQRw</span><span class="token variable">$9e2BEmcwW59eIp9mcYqcSJ72WsJYPpyCj8Bxrn8AhFB</span></pre></td></tr><tr><td data-num="4"></td><td><pre>Encode_Sha512: <span class="token variable">$6</span><span class="token variable">$UwWdIVnk</span><span class="token variable">$yMKWqE3cEn</span>.IziaQCD9yEDrO5mdCa74QCOu1j9PkHoBKmwP2wsaciK4pK/x9vj35xLVmEBf6tAzP3hUAC9G1N.</pre></td></tr></table></figure><p><img data-src="https://21r000-image.oss-cn-shanghai.aliyuncs.com/pic2021/image-20220327205213040.png" alt="image-20220327205213040"></p><h4 id="解密脚本"><a class="anchor" href="#解密脚本">#</a> 解密脚本</h4><p>解密脚本来自<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTkyL2FydGljbGUvZGV0YWlscy84MzUxNDI0NA==">谢公子</span>，小编略加修改。</p><p>创建的两个函数：</p><ul><li><p>main () 函数打开 shadow.txt 文件中的内容读取其中的用户名字段和密码字段 cryptPass。</p></li><li><p>testPass () 函数将密码字段中的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mi>d</mi></mrow><annotation encoding="application/x-tex">id</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.69444em;vertical-align:0"></span><span class="mord mathnormal">i</span><span class="mord mathnormal">d</span></span></span></span>salt 提取出来赋值给 salt ，然后读取 key.txt 中的密码字段，赋值给 word 。</p></li></ul><p>从而利用 Linux 系统 python 库中的 crypt 库，将 word 和 salt 一起作为参数传进去进行加密，得到 cryptWord 。最后将 cryptWord 和 cryptPass 进行对比，如果相等，则这个 word 就是该用户的密码，否则不是。</p><p>同时还需要准备好密码字典文件 key.txt ，只有当密码字典足够大时，才有可能破解出密码。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># -*- coding: utf-8 -*-</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token triple-quoted-string string">"""</span></pre></td></tr><tr><td data-num="3"></td><td><pre>Created on Mon Oct 29 15:01:54 2018</pre></td></tr><tr><td data-num="4"></td><td><pre>@author: 小谢</pre></td></tr><tr><td data-num="5"></td><td><pre>"""</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">import</span> crypt   <span class="token comment">## 导入 Linux 口令加密库</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">def</span> <span class="token function">testPass</span><span class="token punctuation">(</span>cryptPass<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    salt<span class="token operator">=</span>cryptPass<span class="token punctuation">[</span>cryptPass<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"$"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>cryptPass<span class="token punctuation">.</span>rfind<span class="token punctuation">(</span><span class="token string">"$"</span><span class="token punctuation">)</span><span class="token punctuation">]</span>  <span class="token comment">## 获得盐值，包含 $id 部分</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    dictFile<span class="token operator">=</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'key.txt'</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">for</span> word <span class="token keyword">in</span> dictFile<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        word<span class="token operator">=</span>word<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        cryptWord<span class="token operator">=</span>crypt<span class="token punctuation">.</span>crypt<span class="token punctuation">(</span>word<span class="token punctuation">,</span>salt<span class="token punctuation">)</span>                   <span class="token comment">## 将密码字典中的值和盐值一起加密</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>cryptWord<span class="token operator">==</span>cryptPass<span class="token punctuation">)</span><span class="token punctuation">:</span>                           <span class="token comment">## 判断加密后的数据和密码字段是否相等</span></pre></td></tr><tr><td data-num="14"></td><td><pre>            <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"[+]Found Password:"</span><span class="token operator">+</span>word<span class="token operator">+</span><span class="token string">"\n"</span> <span class="token punctuation">)</span>      <span class="token comment">## 如果相等则打印出来</span></pre></td></tr><tr><td data-num="15"></td><td><pre>            <span class="token keyword">return</span> </pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"[-] Password Not Found.\n"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">return</span> </pre></td></tr><tr><td data-num="18"></td><td><pre> </pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    passFile<span class="token operator">=</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'shadow.txt'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token keyword">for</span> line <span class="token keyword">in</span> passFile<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>      <span class="token comment">## 读取文件中的所有内容</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token keyword">if</span> <span class="token string">":"</span> <span class="token keyword">in</span> line<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="23"></td><td><pre>            user<span class="token operator">=</span>line<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>                     <span class="token comment">## 获得用户名</span></pre></td></tr><tr><td data-num="24"></td><td><pre>            cryptPass<span class="token operator">=</span>line<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span>   <span class="token comment">## 获得密码字段</span></pre></td></tr><tr><td data-num="25"></td><td><pre>            <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"[*] Cracking Password for:"</span><span class="token operator">+</span>user<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre>            testPass<span class="token punctuation">(</span>cryptPass<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre>main<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><div class="tags"><a href="/tags/linux/" rel="tag"><i class="ic i-tag"></i> linux</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2022-03-28 11:12:09" itemprop="dateModified" datetime="2022-03-28T11:12:09+08:00">2022-03-28</time> </span><span id="article/7a06714c.html" class="item leancloud_visitors" data-flag-title="Linux /etc/shadow（影子文件）解析" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>21r000 <i class="ic i-at"><em>@</em></i>未入江湖，怎敢佩刀</li><li class="link"><strong>本文链接：</strong> <a href="https://www.21r000.xyz/article/7a06714c.html" title="Linux &#x2F;etc&#x2F;shadow（影子文件）解析">https://www.21r000.xyz/article/7a06714c.html</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/article/b4ab0f6d.html" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;21r000-image.oss-cn-shanghai.aliyuncs.com&#x2F;pic2021&#x2F;6833939bly1gicitf0kl1j20zk0m87fe.jpg" title="逆向工程Studying Notes Days 8"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> 逆向工程</span><h3>逆向工程Studying Notes Days 8</h3></a></div><div class="item right"></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.</span> <span class="toc-text">文件介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%97%E6%AE%B5%E8%A7%A3%E6%9E%90"><span class="toc-number">3.</span> <span class="toc-text">字段解析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E5%90%8D"><span class="toc-number">3.1.</span> <span class="toc-text">用户名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E5%AF%86%E5%AF%86%E7%A0%81"><span class="toc-number">3.2.</span> <span class="toc-text">加密密码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E5%90%8E%E4%B8%80%E6%AC%A1%E4%BF%AE%E6%94%B9%E6%97%B6%E9%97%B4"><span class="toc-number">3.3.</span> <span class="toc-text">最后一次修改时间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E5%B0%8F%E4%BF%AE%E6%94%B9%E6%97%B6%E9%97%B4%E9%97%B4%E9%9A%94"><span class="toc-number">3.4.</span> <span class="toc-text">最小修改时间间隔</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%86%E7%A0%81%E6%9C%89%E6%95%88%E6%9C%9F"><span class="toc-number">3.5.</span> <span class="toc-text">密码有效期</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%86%E7%A0%81%E9%9C%80%E8%A6%81%E5%8F%98%E6%9B%B4%E5%89%8D%E7%9A%84%E8%AD%A6%E5%91%8A%E5%A4%A9%E6%95%B0"><span class="toc-number">3.6.</span> <span class="toc-text">密码需要变更前的警告天数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%86%E7%A0%81%E8%BF%87%E6%9C%9F%E5%90%8E%E7%9A%84%E5%AE%BD%E9%99%90%E5%A4%A9%E6%95%B0"><span class="toc-number">3.7.</span> <span class="toc-text">密码过期后的宽限天数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B4%A6%E5%8F%B7%E5%A4%B1%E6%95%88%E6%97%B6%E9%97%B4"><span class="toc-number">3.8.</span> <span class="toc-text">账号失效时间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%9D%E7%95%99"><span class="toc-number">3.9.</span> <span class="toc-text">保留</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BF%98%E8%AE%B0%E5%AF%86%E7%A0%81%E6%80%8E%E4%B9%88%E5%8A%9E"><span class="toc-number">3.10.</span> <span class="toc-text">忘记密码怎么办</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#linux-etcshadow%E7%A0%B4%E8%A7%A3"><span class="toc-number">4.</span> <span class="toc-text">linux &#x2F;etc&#x2F;shadow 破解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%86%E7%A0%81%E6%A0%BC%E5%BC%8F"><span class="toc-number">4.1.</span> <span class="toc-text">密码格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%97%E6%B3%95%E7%BB%93%E6%9E%84"><span class="toc-number">4.2.</span> <span class="toc-text">算法结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E8%A7%A3%E5%AF%86%E8%84%9A%E6%9C%AC"><span class="toc-number">4.3.</span> <span class="toc-text">加 &#x2F; 解密脚本</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A0%E5%AF%86%E8%84%9A%E6%9C%AC"><span class="toc-number">4.3.1.</span> <span class="toc-text">加密脚本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%AF%86%E8%84%9A%E6%9C%AC"><span class="toc-number">4.3.2.</span> <span class="toc-text">解密脚本</span></a></li></ol></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li class="active"><a href="/article/7a06714c.html" rel="bookmark" title="Linux /etc/shadow（影子文件）解析">Linux /etc/shadow（影子文件）解析</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="21r000" data-src="/images/avatar.jpg"><p class="name" itemprop="name">21r000</p><div class="description" itemprop="description">固态规则长方体空间移动工程师</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">75</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">12</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">15</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item Github" data-url="aHR0cHM6Ly9naXRodWIuY29tLzIxcjAwMA==" title="https:&#x2F;&#x2F;github.com&#x2F;21r000"><i class="ic i-github"></i></span> <span class="exturl item QQ" data-url="dGVuY2VudDovL21lc3NhZ2UvP3Vpbj0yODU1MTQ1MTEzJlNpdGU9Jk1lbnU9eWVz" title="tencent:&#x2F;&#x2F;message&#x2F;?uin&#x3D;2855145113&amp;Site&#x3D;&amp;Menu&#x3D;yes"><i class="ic i-qq"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/books/" rel="section"><i class="ic i-instagram"></i>图书阁</a></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友联</a></li><li class="item"><a href="/links/" rel="section"><i class="ic i-magic"></i>传送阵</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/%E6%B1%87%E7%BC%96/" title="分类于 汇编">汇编</a></div><span><a href="/article/189db1b1.html" title="汇编语言Studying Note之条件结构与条件控制流伪指令学习">汇编语言Studying Note之条件结构与条件控制流伪指令学习</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" title="分类于 漏洞复现">漏洞复现</a></div><span><a href="/article/1b0513b6.html" title="Dingtalk6.3.5 and 向日葵RCE复现">Dingtalk6.3.5 and 向日葵RCE复现</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/linux/" title="分类于 linux">linux</a></div><span><a href="/article/7a06714c.html" title="Linux &#x2F;etc&#x2F;shadow（影子文件）解析">Linux /etc/shadow（影子文件）解析</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/PE%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E8%A7%A3%E6%9E%90/" title="分类于 PE文件结构解析">PE文件结构解析</a></div><span><a href="/article/61ca529c.html" title="Windows PE文件结构解析Studying Notes之导出表与重定位表结构解析">Windows PE文件结构解析Studying Notes之导出表与重定位表结构解析</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/SNote/" title="分类于 SNote">SNote</a></div><span><a href="/article/f49682ad.html" title="Windows上搭建ELK毫秒级响应蛇工裤记录">Windows上搭建ELK毫秒级响应蛇工裤记录</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/SNote/" title="分类于 SNote">SNote</a></div><span><a href="/article/b3617362.html" title="云原生攻防靶场-Metarget搭建记录">云原生攻防靶场-Metarget搭建记录</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" title="分类于 漏洞复现">漏洞复现</a></div><span><a href="/article/39bc4a94.html" title="CVE-2020-0796 (SMBv3远程代码执行) Windows-10">CVE-2020-0796 (SMBv3远程代码执行) Windows-10</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" title="分类于 内网渗透">内网渗透</a></div><span><a href="/article/ffbd8b0.html" title="windows信息搜集篇（二）之SPN">windows信息搜集篇（二）之SPN</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/SNote/" title="分类于 SNote">SNote</a></div><span><a href="/article/141d7194.html" title="使用PicGo+Github&#x2F;Gitee+Typroa搭建属于自己的图床">使用PicGo+Github/Gitee+Typroa搭建属于自己的图床</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%B1%87%E7%BC%96/" title="分类于 汇编">汇编</a></div><span><a href="/article/28bedc94.html" title="汇编语言Studying Note之JMP和LOOP学习">汇编语言Studying Note之JMP和LOOP学习</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2021 – <span itemprop="copyrightYear">2022</span> <span class="with-love"><i class="ic i-"></i> </span><span class="author" itemprop="copyrightHolder">21r000 @ 21r000</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">302k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">4:35</span></div><div><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_pv">本站总访问量：<span id="busuanzi_value_site_pv"></span>次</span> <span class="post-meta-divider">|</span> <span id="busuanzi_container_site_uv" style="display:none">本站访客数：<span id="busuanzi_value_site_uv"></span>人</span></div><div class="beian-info"><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/">浙ICP备2022001000号-1</a></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"article/7a06714c.html",favicon:{show:"（●´3｀●）大通りからジェーンまで",hide:"(´Д｀)金を独行する"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,model:{jsonPath:"/live2dw/assets/wanko.model.json"},display:{position:"right",width:150,height:200},mobile:{show:!1},log:!1})</script></body></html><!-- rebuild by hrmmi -->